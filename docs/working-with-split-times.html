<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Working With Split Times | Visualising WRC Rally Timing and Results Data</title>
  <meta name="description" content="An introduction to visualising timing and results data for WRC rally events." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Working With Split Times | Visualising WRC Rally Timing and Results Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Working With Split Times | Visualising WRC Rally Timing and Results Data" />
  
  <meta name="twitter:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualising-stage-pace.html"/>
<link rel="next" href="visualising-pace-across-splits.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/htmlwidgets-1.5.3.9000/htmlwidgets.js"></script>
<script src="libs/formattable_widget-binding-0.2.1/formattable_widget.js"></script>
<link href="libs/jquery-sparkline-2.1.2/jquery.sparkline.css" rel="stylesheet" />
<script src="libs/jquery-sparkline-2.1.2/jquery.sparkline.js"></script>
<script src="libs/sparkline-binding-2.0/sparkline.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Visualising WRC Rally Results and Timing Data</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html"><i class="fa fa-check"></i><b>2</b> Accessing Data from the WRC Live Timing API</a>
<ul>
<li class="chapter" data-level="2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#current-season-rallies"><i class="fa fa-check"></i><b>2.1</b> Current Season Rallies</a></li>
<li class="chapter" data-level="2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#itinerary-lookup"><i class="fa fa-check"></i><b>2.2</b> Itinerary Lookup</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#leg-sections"><i class="fa fa-check"></i><b>2.2.1</b> Leg Sections</a></li>
<li class="chapter" data-level="2.2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#time-controls"><i class="fa fa-check"></i><b>2.2.2</b> Time Controls</a></li>
<li class="chapter" data-level="2.2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-details"><i class="fa fa-check"></i><b>2.2.3</b> Stage Details</a></li>
<li class="chapter" data-level="2.2.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#road-order-start-lists"><i class="fa fa-check"></i><b>2.2.4</b> Road Order Start Lists</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#competitor-details"><i class="fa fa-check"></i><b>2.3</b> Competitor Details</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#looking-up-entries-by-group"><i class="fa fa-check"></i><b>2.3.1</b> Looking Up Entries by Group</a></li>
<li class="chapter" data-level="2.3.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#driver-codriver-details"><i class="fa fa-check"></i><b>2.3.2</b> Driver &amp; Codriver Details</a></li>
<li class="chapter" data-level="2.3.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#summarising-essential-entry-data"><i class="fa fa-check"></i><b>2.3.3</b> Summarising Essential Entry Data</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#penalties-and-retirements"><i class="fa fa-check"></i><b>2.4</b> Penalties and Retirements</a></li>
<li class="chapter" data-level="2.5" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#results-and-stage-winner"><i class="fa fa-check"></i><b>2.5</b> Results and Stage Winner</a></li>
<li class="chapter" data-level="2.6" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-result"><i class="fa fa-check"></i><b>2.6</b> Stage Result</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-results-for-multiple-stages"><i class="fa fa-check"></i><b>2.6.1</b> Getting Stage Results for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-times"><i class="fa fa-check"></i><b>2.7</b> Stage Times</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.1</b> Getting Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.2</b> Getting Wide Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-positions"><i class="fa fa-check"></i><b>2.7.3</b> Getting Wide Stage Positions</a></li>
<li class="chapter" data-level="2.7.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-generic-wide-dataframes"><i class="fa fa-check"></i><b>2.7.4</b> Getting Generic Wide Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#split-times"><i class="fa fa-check"></i><b>2.8</b> Split Times</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#driver-split-times-detail"><i class="fa fa-check"></i><b>2.8.1</b> Driver Split Times Detail</a></li>
<li class="chapter" data-level="2.8.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#wide-driver-split-times"><i class="fa fa-check"></i><b>2.8.2</b> Wide Driver Split Times</a></li>
<li class="chapter" data-level="2.8.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#multiple-stage-long-splits-data"><i class="fa fa-check"></i><b>2.8.3</b> Multiple Stage Long Splits Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html"><i class="fa fa-check"></i><b>3</b> Visualising Results for a Single Stage</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#load-base-data"><i class="fa fa-check"></i><b>3.1</b> Load Base Data</a></li>
<li class="chapter" data-level="3.2" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#get-stage-results-data"><i class="fa fa-check"></i><b>3.2</b> Get Stage Results Data</a></li>
<li class="chapter" data-level="3.3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#previewing-stage-results-data"><i class="fa fa-check"></i><b>3.3</b> Previewing Stage Results Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-entry-metadata"><i class="fa fa-check"></i><b>3.3.1</b> Adding Entry Metadata</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-stage-metadata-to-table-captions"><i class="fa fa-check"></i><b>3.4</b> Adding Stage Metadata to Table Captions</a></li>
<li class="chapter" data-level="3.5" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-stage-results"><i class="fa fa-check"></i><b>3.5</b> Colour Highlighting Stage Results</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#heatmap-style-column-cell-backgrounds"><i class="fa fa-check"></i><b>3.5.1</b> Heatmap Style Column Cell Backgrounds</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#an-aside-calculating-diff-and-gap-times"><i class="fa fa-check"></i><b>3.6</b> An Aside — Calculating DIFF and GAP times</a></li>
<li class="chapter" data-level="3.7" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#rebasing-stage-results"><i class="fa fa-check"></i><b>3.7</b> Rebasing Stage Results</a></li>
<li class="chapter" data-level="3.8" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-rebased-values"><i class="fa fa-check"></i><b>3.8</b> Colour Highlighting Rebased Values</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html"><i class="fa fa-check"></i><b>4</b> Visualising Results for Multiple Stages</a>
<ul>
<li class="chapter" data-level="4.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#load-base-data-1"><i class="fa fa-check"></i><b>4.1</b> Load Base Data</a></li>
<li class="chapter" data-level="4.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-mutliple-stage-results"><i class="fa fa-check"></i><b>4.2</b> Retrieving Mutliple Stage Results</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-overall-position-data"><i class="fa fa-check"></i><b>4.2.1</b> Reshaping Overall Position Data</a></li>
<li class="chapter" data-level="4.2.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-overall-rally-time-data"><i class="fa fa-check"></i><b>4.2.2</b> Reshaping Overall Rally Time Data</a></li>
<li class="chapter" data-level="4.2.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-time-to-first-data"><i class="fa fa-check"></i><b>4.2.3</b> Reshaping Time to First Data</a></li>
<li class="chapter" data-level="4.2.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#mapping-stage-and-driver-identifiers-to-meaningful-labels"><i class="fa fa-check"></i><b>4.2.4</b> Mapping Stage and Driver Identifiers to Meaningful Labels</a></li>
<li class="chapter" data-level="4.2.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#rebasing-overall-times"><i class="fa fa-check"></i><b>4.2.5</b> Rebasing Overall Times</a></li>
<li class="chapter" data-level="4.2.6" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#finding-changes-in-rebased-gaps-across-stages"><i class="fa fa-check"></i><b>4.2.6</b> Finding Changes in Rebased Gaps Across Stages</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-overall-results"><i class="fa fa-check"></i><b>4.3</b> Visualising Overall Results</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-first-position"><i class="fa fa-check"></i><b>4.3.1</b> Visualising First Position</a></li>
<li class="chapter" data-level="4.3.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-position-changes-over-a-rally"><i class="fa fa-check"></i><b>4.3.2</b> Visualising Position Changes Over a Rally</a></li>
<li class="chapter" data-level="4.3.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-position-gainslosses"><i class="fa fa-check"></i><b>4.3.3</b> Visualising Position Gains/Losses</a></li>
<li class="chapter" data-level="4.3.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#per-driver-position-charts"><i class="fa fa-check"></i><b>4.3.4</b> Per Driver Position Charts</a></li>
<li class="chapter" data-level="4.3.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-time-to-first"><i class="fa fa-check"></i><b>4.3.5</b> Visualising Time to First</a></li>
<li class="chapter" data-level="4.3.6" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-rebased-gaps"><i class="fa fa-check"></i><b>4.3.6</b> Visualising Rebased Gaps</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-stage-times-and-results"><i class="fa fa-check"></i><b>4.4</b> Retrieving Stage Times and Results</a></li>
<li class="chapter" data-level="4.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-stage-times"><i class="fa fa-check"></i><b>4.5</b> Visualising Stage Times</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#stage-position-sparklines"><i class="fa fa-check"></i><b>4.5.1</b> Stage Position Sparklines</a></li>
<li class="chapter" data-level="4.5.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#gap-to-stage-winner-sparklines"><i class="fa fa-check"></i><b>4.5.2</b> Gap to Stage Winner Sparklines</a></li>
<li class="chapter" data-level="4.5.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#stage-position-charts"><i class="fa fa-check"></i><b>4.5.3</b> Stage Position Charts</a></li>
<li class="chapter" data-level="4.5.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#individual-stage-position-charts"><i class="fa fa-check"></i><b>4.5.4</b> Individual Stage position Charts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html"><i class="fa fa-check"></i><b>5</b> Finding Pace Across Stages</a>
<ul>
<li class="chapter" data-level="5.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#load-base-data-2"><i class="fa fa-check"></i><b>5.1</b> Load Base Data</a></li>
<li class="chapter" data-level="5.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#defining-pace"><i class="fa fa-check"></i><b>5.2</b> Defining Pace</a></li>
<li class="chapter" data-level="5.3" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-stage-pace"><i class="fa fa-check"></i><b>5.3</b> Calculating Stage Pace</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-a-single-stage"><i class="fa fa-check"></i><b>5.3.1</b> Calculating Pace for a Single Stage</a></li>
<li class="chapter" data-level="5.3.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-multiple-stages"><i class="fa fa-check"></i><b>5.3.2</b> Calculating Pace for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#rebasing-stage-pace"><i class="fa fa-check"></i><b>5.4</b> Rebasing Stage Pace</a></li>
<li class="chapter" data-level="5.5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#the-ultimate-rally"><i class="fa fa-check"></i><b>5.5</b> The Ultimate Rally</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html"><i class="fa fa-check"></i><b>6</b> Visualising Stage Pace</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#load-base-data-3"><i class="fa fa-check"></i><b>6.1</b> Load Base Data</a></li>
<li class="chapter" data-level="6.2" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#pace-maps"><i class="fa fa-check"></i><b>6.2</b> Pace Maps</a></li>
<li class="chapter" data-level="6.3" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#a-pace-map-function"><i class="fa fa-check"></i><b>6.3</b> A Pace Map Function</a></li>
<li class="chapter" data-level="6.4" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#off-the-pace-charts"><i class="fa fa-check"></i><b>6.4</b> Off-the-Pace Charts</a></li>
<li class="chapter" data-level="6.5" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#comparing-pace-across-stages"><i class="fa fa-check"></i><b>6.5</b> Comparing Pace Across Stages</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="working-with-split-times.html"><a href="working-with-split-times.html"><i class="fa fa-check"></i><b>7</b> Working With Split Times</a>
<ul>
<li class="chapter" data-level="7.1" data-path="working-with-split-times.html"><a href="working-with-split-times.html#load-base-data-4"><i class="fa fa-check"></i><b>7.1</b> Load Base Data</a></li>
<li class="chapter" data-level="7.2" data-path="working-with-split-times.html"><a href="working-with-split-times.html#get-splits-data"><i class="fa fa-check"></i><b>7.2</b> Get Splits Data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="working-with-split-times.html"><a href="working-with-split-times.html#split-locations"><i class="fa fa-check"></i><b>7.2.1</b> Split Locations</a></li>
<li class="chapter" data-level="7.2.2" data-path="working-with-split-times.html"><a href="working-with-split-times.html#mapping-split-codes-to-split-numbers"><i class="fa fa-check"></i><b>7.2.2</b> Mapping Split Codes to Split Numbers</a></li>
<li class="chapter" data-level="7.2.3" data-path="working-with-split-times.html"><a href="working-with-split-times.html#split-times-1"><i class="fa fa-check"></i><b>7.2.3</b> Split Times</a></li>
<li class="chapter" data-level="7.2.4" data-path="working-with-split-times.html"><a href="working-with-split-times.html#wide-driver-split-times-1"><i class="fa fa-check"></i><b>7.2.4</b> Wide Driver Split Times</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="working-with-split-times.html"><a href="working-with-split-times.html#rebasing-split-times"><i class="fa fa-check"></i><b>7.3</b> Rebasing Split Times</a></li>
<li class="chapter" data-level="7.4" data-path="working-with-split-times.html"><a href="working-with-split-times.html#visualising-rebased-split-times-using-sparklines"><i class="fa fa-check"></i><b>7.4</b> Visualising Rebased Split Times Using Sparklines</a></li>
<li class="chapter" data-level="7.5" data-path="working-with-split-times.html"><a href="working-with-split-times.html#finding-the-rank-position-at-each-split-point"><i class="fa fa-check"></i><b>7.5</b> Finding the Rank Position at Each Split Point</a></li>
<li class="chapter" data-level="7.6" data-path="working-with-split-times.html"><a href="working-with-split-times.html#finding-split-section-durations"><i class="fa fa-check"></i><b>7.6</b> Finding Split Section Durations</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="working-with-split-times.html"><a href="working-with-split-times.html#finding-split-section-ranks"><i class="fa fa-check"></i><b>7.6.1</b> Finding Split Section Ranks</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="working-with-split-times.html"><a href="working-with-split-times.html#using-sparklines-to-visdualise-split-time-differences"><i class="fa fa-check"></i><b>7.7</b> Using Sparklines to Visdualise Split Time Differences</a></li>
<li class="chapter" data-level="7.8" data-path="working-with-split-times.html"><a href="working-with-split-times.html#adding-overall-stage-time-to-the-split-times"><i class="fa fa-check"></i><b>7.8</b> Adding Overall Stage Time to the Split Times</a></li>
<li class="chapter" data-level="7.9" data-path="working-with-split-times.html"><a href="working-with-split-times.html#calculating-the-ultimate-stage-from-ultimate-split-times"><i class="fa fa-check"></i><b>7.9</b> Calculating the Ultimate Stage from Ultimate Split Times</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="working-with-split-times.html"><a href="working-with-split-times.html#rebasing-to-ultimate-split-times"><i class="fa fa-check"></i><b>7.9.1</b> Rebasing to Ultimate Split Times</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html"><i class="fa fa-check"></i><b>8</b> Visualising Pace Across Splits</a>
<ul>
<li class="chapter" data-level="8.1" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#load-base-data-5"><i class="fa fa-check"></i><b>8.1</b> Load Base Data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#obtaining-split-distances"><i class="fa fa-check"></i><b>8.1.1</b> Obtaining Split Distances</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#calculating-splits-pace"><i class="fa fa-check"></i><b>8.2</b> Calculating Splits Pace</a></li>
<li class="chapter" data-level="8.3" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#visualising-the-splits-pace"><i class="fa fa-check"></i><b>8.3</b> Visualising the Splits Pace</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#pace-over-each-section"><i class="fa fa-check"></i><b>8.3.1</b> Pace Over Each Section</a></li>
<li class="chapter" data-level="8.3.2" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#splits-sections-pace-maps"><i class="fa fa-check"></i><b>8.3.2</b> Splits Sections Pace Maps</a></li>
<li class="chapter" data-level="8.3.3" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#off-the-pace-splits-pace-mapping"><i class="fa fa-check"></i><b>8.3.3</b> Off-the-Pace Splits Pace Mapping</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://rallydatajunkie.com/"><em>RallyDataJunkie.com</em></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Timing and Results Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="working-with-split-times" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Working With Split Times</h1>
<p>In this chapter we’ll explore some of the ways in which we might start to work with split times data from a particular stage. On the one hand, we can consider split times purely on a time basis; on the other, we can explore the split times in terms of <em>pace</em> differences calculated by normalising the split times over split distances.</p>
<p>As with stage times, we can rebase split times to compare a specified driver directly with other drivers, not just the stage winner. We can also calculate how much time was spent on each split section by finding the difference between consecutive split times for a particular driver.</p>
<p>From the split section times, we can also calculate various derived measures, such as the ultimate possible stage time, based on the sum of fastest times to complete each split section.</p>
<p>Having access to split times also sets up the potential for rating the performance of a driver on each split against various stage and stage route metrics, such as road order or route metrics such as the “wiggliness” of the split section, although these will not be covered here.</p>
<div id="load-base-data-4" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Load Base Data</h2>
<p>To get the splits data from a standing start, we can load in the current season list, select the rally we want, look up the itinerary from the rally, extract the sections and then the stages and the retrieve the stage ID for the stage we are interested in:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="working-with-split-times.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;code/wrc-api.R&#39;</span>)</span>
<span id="cb265-2"><a href="working-with-split-times.html#cb265-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-3"><a href="working-with-split-times.html#cb265-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">get_active_season</span>()</span>
<span id="cb265-4"><a href="working-with-split-times.html#cb265-4" aria-hidden="true" tabindex="-1"></a>eventId <span class="ot">=</span> <span class="fu">get_eventId_from_name</span>(s, <span class="st">&#39;arctic&#39;</span>)</span>
<span id="cb265-5"><a href="working-with-split-times.html#cb265-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-6"><a href="working-with-split-times.html#cb265-6" aria-hidden="true" tabindex="-1"></a>itinerary <span class="ot">=</span> <span class="fu">get_itinerary</span>(eventId)</span>
<span id="cb265-7"><a href="working-with-split-times.html#cb265-7" aria-hidden="true" tabindex="-1"></a>sections <span class="ot">=</span> <span class="fu">get_sections</span>(itinerary)</span>
<span id="cb265-8"><a href="working-with-split-times.html#cb265-8" aria-hidden="true" tabindex="-1"></a>stages <span class="ot">=</span> <span class="fu">get_stages</span>(sections)</span>
<span id="cb265-9"><a href="working-with-split-times.html#cb265-9" aria-hidden="true" tabindex="-1"></a>stages_lookup <span class="ot">=</span> <span class="fu">get_stages_lookup</span>(stages)</span>
<span id="cb265-10"><a href="working-with-split-times.html#cb265-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-11"><a href="working-with-split-times.html#cb265-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For driver details</span></span>
<span id="cb265-12"><a href="working-with-split-times.html#cb265-12" aria-hidden="true" tabindex="-1"></a>entries <span class="ot">=</span> <span class="fu">get_rally_entries</span>(eventId)</span>
<span id="cb265-13"><a href="working-with-split-times.html#cb265-13" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">=</span> <span class="fu">get_car_data</span>(entries)</span></code></pre></div>
<p>As a working example, let’s define an example stage by its code:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="working-with-split-times.html#cb266-1" aria-hidden="true" tabindex="-1"></a>stage_code <span class="ot">=</span> <span class="st">&#39;SS3&#39;</span></span></code></pre></div>
<p>Get a sample stage ID:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="working-with-split-times.html#cb267-1" aria-hidden="true" tabindex="-1"></a>stageId <span class="ot">=</span> stages_lookup[[stage_code]]</span></code></pre></div>
</div>
<div id="get-splits-data" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Get Splits Data</h2>
<p>The split times represented the accumulated time going the the stage at each split point.</p>
<p><em>The split times <strong>do not</strong> include the overall stage time, so we need to be mindful that if we want to report on a stage the split times in and of themselves do not contain any information about the final section of the stage between the final split point and the stage finish line.</em></p>
<p>We can load the splits data if we know the event and stage ID:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="working-with-split-times.html#cb268-1" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">get_splits</span>(eventId, stageId)</span></code></pre></div>
<p>The splits data actually comprises two dataframes in columns <code>splitPoints</code> and <code>entrySplitPointTimes</code>.</p>
<div id="split-locations" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Split Locations</h3>
<p>The <code>splitPoints</code> dataframe contains information about the splits locations:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="working-with-split-times.html#cb269-1" aria-hidden="true" tabindex="-1"></a>splits_locations <span class="ot">=</span> splits<span class="sc">$</span>splitPoints</span>
<span id="cb269-2"><a href="working-with-split-times.html#cb269-2" aria-hidden="true" tabindex="-1"></a>splits_locations <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(number) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   splitPointId stageId number distance
## 1         3615    1750      1     4.83
## 2         3601    1750      2     9.02</code></pre>
<p>We can also generate a list of the split IDs:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="working-with-split-times.html#cb271-1" aria-hidden="true" tabindex="-1"></a>splits_list <span class="ot">=</span> splits_locations<span class="sc">$</span>splitPointId</span>
<span id="cb271-2"><a href="working-with-split-times.html#cb271-2" aria-hidden="true" tabindex="-1"></a>splits_list</span></code></pre></div>
<pre><code>## [1] 3593 3601 3615 3617 3621</code></pre>
<p>We can retrieve the split codes ordered by the distance into the stage of each split point from a lookup on the split points:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="working-with-split-times.html#cb273-1" aria-hidden="true" tabindex="-1"></a>get_split_cols <span class="ot">=</span> <span class="cf">function</span>(splits){</span>
<span id="cb273-2"><a href="working-with-split-times.html#cb273-2" aria-hidden="true" tabindex="-1"></a>  split_cols <span class="ot">=</span>  <span class="fu">as.character</span>(<span class="fu">arrange</span>(splits<span class="sc">$</span>splitPoints,</span>
<span id="cb273-3"><a href="working-with-split-times.html#cb273-3" aria-hidden="true" tabindex="-1"></a>                                     distance)<span class="sc">$</span>splitPointId)</span>
<span id="cb273-4"><a href="working-with-split-times.html#cb273-4" aria-hidden="true" tabindex="-1"></a>  split_cols</span>
<span id="cb273-5"><a href="working-with-split-times.html#cb273-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb273-6"><a href="working-with-split-times.html#cb273-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-7"><a href="working-with-split-times.html#cb273-7" aria-hidden="true" tabindex="-1"></a>split_cols <span class="ot">=</span> <span class="fu">get_split_cols</span>(splits)</span>
<span id="cb273-8"><a href="working-with-split-times.html#cb273-8" aria-hidden="true" tabindex="-1"></a>split_cols</span></code></pre></div>
<pre><code>## [1] &quot;3615&quot; &quot;3601&quot; &quot;3621&quot; &quot;3617&quot; &quot;3593&quot;</code></pre>
<p>Since the the split points dataframe does not including the final timing point location (i.e. the stage finish), we can get the full stage distance from the <code>stages</code> dataframe:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="working-with-split-times.html#cb275-1" aria-hidden="true" tabindex="-1"></a>stages[stages[<span class="st">&#39;code&#39;</span>]<span class="sc">==</span>stage_code, <span class="st">&#39;distance&#39;</span>]</span></code></pre></div>
<pre><code>## [1] 24.43</code></pre>
</div>
<div id="mapping-split-codes-to-split-numbers" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Mapping Split Codes to Split Numbers</h3>
<p>To provide a human readable version of the split identifiers, let’s map them onto a more meaningful label:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="working-with-split-times.html#cb277-1" aria-hidden="true" tabindex="-1"></a>get_split_label <span class="ot">=</span> <span class="cf">function</span>(x){</span>
<span id="cb277-2"><a href="working-with-split-times.html#cb277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&#39;split_&#39;</span>, splits_locations[splits_locations<span class="sc">$</span>splitPointId<span class="sc">==</span>x,</span>
<span id="cb277-3"><a href="working-with-split-times.html#cb277-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&#39;number&#39;</span>])</span>
<span id="cb277-4"><a href="working-with-split-times.html#cb277-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb277-5"><a href="working-with-split-times.html#cb277-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-6"><a href="working-with-split-times.html#cb277-6" aria-hidden="true" tabindex="-1"></a>splits_locations<span class="sc">$</span>splitname <span class="ot">=</span> <span class="fu">sapply</span>(splits_locations<span class="sc">$</span>splitPointId,</span>
<span id="cb277-7"><a href="working-with-split-times.html#cb277-7" aria-hidden="true" tabindex="-1"></a>                                 get_split_label)</span>
<span id="cb277-8"><a href="working-with-split-times.html#cb277-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-9"><a href="working-with-split-times.html#cb277-9" aria-hidden="true" tabindex="-1"></a>splits_locations <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   splitPointId stageId number distance splitname
## 1         3593    1750      5    23.21   split_5
## 2         3601    1750      2     9.02   split_2
## 3         3615    1750      1     4.83   split_1</code></pre>
<p>We can generate a lookup list of split point names and IDs as:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="working-with-split-times.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_stages_lookup</span>(splits_locations, <span class="st">&#39;splitPointId&#39;</span>, <span class="st">&#39;splitname&#39;</span>)</span></code></pre></div>
<pre><code>##      3593      3601      3615      3617      3621 
## &quot;split_5&quot; &quot;split_2&quot; &quot;split_1&quot; &quot;split_4&quot; &quot;split_3&quot;</code></pre>
<p>We can use this in a function that provides an annotated <em>and ordered</em> form of the split locations dataframe:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="working-with-split-times.html#cb281-1" aria-hidden="true" tabindex="-1"></a>get_split_locations <span class="ot">=</span> <span class="cf">function</span>(splits){</span>
<span id="cb281-2"><a href="working-with-split-times.html#cb281-2" aria-hidden="true" tabindex="-1"></a>  splits_locations <span class="ot">=</span> splits<span class="sc">$</span>splitPoints</span>
<span id="cb281-3"><a href="working-with-split-times.html#cb281-3" aria-hidden="true" tabindex="-1"></a>  splits_locations<span class="sc">$</span>splitname <span class="ot">=</span> <span class="fu">sapply</span>(splits_locations<span class="sc">$</span>splitPointId,</span>
<span id="cb281-4"><a href="working-with-split-times.html#cb281-4" aria-hidden="true" tabindex="-1"></a>                                      get_split_label)</span>
<span id="cb281-5"><a href="working-with-split-times.html#cb281-5" aria-hidden="true" tabindex="-1"></a>  splits_locations <span class="sc">%&gt;%</span></span>
<span id="cb281-6"><a href="working-with-split-times.html#cb281-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(number)</span>
<span id="cb281-7"><a href="working-with-split-times.html#cb281-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb281-8"><a href="working-with-split-times.html#cb281-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-9"><a href="working-with-split-times.html#cb281-9" aria-hidden="true" tabindex="-1"></a>splits_locations <span class="ot">=</span> <span class="fu">get_split_locations</span>(splits)</span>
<span id="cb281-10"><a href="working-with-split-times.html#cb281-10" aria-hidden="true" tabindex="-1"></a>splits_locations</span></code></pre></div>
<pre><code>##   splitPointId stageId number distance splitname
## 1         3615    1750      1     4.83   split_1
## 2         3601    1750      2     9.02   split_2
## 3         3621    1750      3    14.87   split_3
## 4         3617    1750      4    20.63   split_4
## 5         3593    1750      5    23.21   split_5</code></pre>
<p>Create a convenience list of splits names:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="working-with-split-times.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We could create these as ordered factors?</span></span>
<span id="cb283-2"><a href="working-with-split-times.html#cb283-2" aria-hidden="true" tabindex="-1"></a>split_names <span class="ot">=</span> splits_locations<span class="sc">$</span>splitname</span>
<span id="cb283-3"><a href="working-with-split-times.html#cb283-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-4"><a href="working-with-split-times.html#cb283-4" aria-hidden="true" tabindex="-1"></a>split_names</span></code></pre></div>
<pre><code>## [1] &quot;split_1&quot; &quot;split_2&quot; &quot;split_3&quot; &quot;split_4&quot; &quot;split_5&quot;</code></pre>
</div>
<div id="split-times-1" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> Split Times</h3>
<p>The second dataframe returned from the splits API call contains the splits times, accessed via the <code>get_driver_splits()</code> function defined previously and imported from the <em>wrc-api.R</em> file. The data is returned in a long format, with each row describing a single split time for a particular driver on the single stage the split times were retrieved for.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="working-with-split-times.html#cb285-1" aria-hidden="true" tabindex="-1"></a>driver_splits <span class="ot">=</span> <span class="fu">get_driver_splits</span>(splits)</span>
<span id="cb285-2"><a href="working-with-split-times.html#cb285-2" aria-hidden="true" tabindex="-1"></a>driver_splits <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   splitPointTimeId splitPointId entryId elapsedDuration         splitDateTime
## 1           123482         3615   21540       PT2M41.4S 2021-02-27T07:10:41.4
## 2           123483         3601   21540       PT4M32.5S 2021-02-27T07:12:32.5
##            splitDateTimeLocal elapsedDurationS
## 1 2021-02-27T09:10:41.4+02:00            161.4
## 2 2021-02-27T09:12:32.5+02:00            272.5</code></pre>
<p>The <code>get_multi_split_times(stage_list)</code> function can also provide us the long form data for multiple stages given one or more stage IDs.</p>
</div>
<div id="wide-driver-split-times-1" class="section level3" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Wide Driver Split Times</h3>
<p>We can cast the the driver split points into a wide format using the split point codes, ordered by split distance into the stage, as the widened column names:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="working-with-split-times.html#cb287-1" aria-hidden="true" tabindex="-1"></a>get_splits_wide <span class="ot">=</span> <span class="cf">function</span>(splits){</span>
<span id="cb287-2"><a href="working-with-split-times.html#cb287-2" aria-hidden="true" tabindex="-1"></a>  driver_splits <span class="ot">=</span> <span class="fu">get_driver_splits</span>(splits)</span>
<span id="cb287-3"><a href="working-with-split-times.html#cb287-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb287-4"><a href="working-with-split-times.html#cb287-4" aria-hidden="true" tabindex="-1"></a>  split_cols <span class="ot">=</span>  <span class="fu">get_split_cols</span>(splits)</span>
<span id="cb287-5"><a href="working-with-split-times.html#cb287-5" aria-hidden="true" tabindex="-1"></a>  splits_cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, <span class="st">&#39;splitPointId&#39;</span>, <span class="st">&#39;elapsedDurationS&#39;</span>)</span>
<span id="cb287-6"><a href="working-with-split-times.html#cb287-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb287-7"><a href="working-with-split-times.html#cb287-7" aria-hidden="true" tabindex="-1"></a>  splits_wide <span class="ot">=</span> driver_splits <span class="sc">%&gt;%</span> </span>
<span id="cb287-8"><a href="working-with-split-times.html#cb287-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(entryId) <span class="sc">%&gt;%</span></span>
<span id="cb287-9"><a href="working-with-split-times.html#cb287-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(splits_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb287-10"><a href="working-with-split-times.html#cb287-10" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">spread</span>(<span class="at">key =</span> splitPointId,</span>
<span id="cb287-11"><a href="working-with-split-times.html#cb287-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">value =</span> elapsedDurationS) <span class="sc">%&gt;%</span></span>
<span id="cb287-12"><a href="working-with-split-times.html#cb287-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, split_cols))) <span class="sc">%&gt;%</span></span>
<span id="cb287-13"><a href="working-with-split-times.html#cb287-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we don&#39;t cast, it&#39;s a</span></span>
<span id="cb287-14"><a href="working-with-split-times.html#cb287-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># non-rankable rowwise df</span></span>
<span id="cb287-15"><a href="working-with-split-times.html#cb287-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb287-16"><a href="working-with-split-times.html#cb287-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb287-17"><a href="working-with-split-times.html#cb287-17" aria-hidden="true" tabindex="-1"></a>  splits_wide</span>
<span id="cb287-18"><a href="working-with-split-times.html#cb287-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Rather than retrieve the split times into a long format, with one row per driver split, we can now retrieve the data into a wide form with one row per driver and a column for each split on the stage:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="working-with-split-times.html#cb288-1" aria-hidden="true" tabindex="-1"></a>splits_wide <span class="ot">=</span> <span class="fu">get_splits_wide</span>(splits)</span>
<span id="cb288-2"><a href="working-with-split-times.html#cb288-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb288-3"><a href="working-with-split-times.html#cb288-3" aria-hidden="true" tabindex="-1"></a>splits_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId  3615  3601  3621  3617  3593
## 1   21530 161.7 272.3 471.3 690.4 789.2
## 2   21531 162.3 273.7 472.3 692.1 792.4</code></pre>
<p>The following function, which closely resembles a similar function function for relabeling stage codes, allows us to rename the split points with more meaningful splits names:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="working-with-split-times.html#cb290-1" aria-hidden="true" tabindex="-1"></a>map_split_codes <span class="ot">=</span> <span class="cf">function</span>(df, splits_list) {</span>
<span id="cb290-2"><a href="working-with-split-times.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get stage codes lookup id-&gt;code</span></span>
<span id="cb290-3"><a href="working-with-split-times.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  splits_lookup_code <span class="ot">=</span> <span class="fu">get_stages_lookup</span>(splits_locations,</span>
<span id="cb290-4"><a href="working-with-split-times.html#cb290-4" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&#39;splitPointId&#39;</span>, <span class="st">&#39;splitname&#39;</span>)</span>
<span id="cb290-5"><a href="working-with-split-times.html#cb290-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb290-6"><a href="working-with-split-times.html#cb290-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#https://stackoverflow.com/a/34299333/454773</span></span>
<span id="cb290-7"><a href="working-with-split-times.html#cb290-7" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">rename</span>(df, <span class="at">replace =</span> splits_lookup_code,</span>
<span id="cb290-8"><a href="working-with-split-times.html#cb290-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">warn_missing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb290-9"><a href="working-with-split-times.html#cb290-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>For example:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="working-with-split-times.html#cb291-1" aria-hidden="true" tabindex="-1"></a>splits_wide <span class="ot">=</span> <span class="fu">get_splits_wide</span>(splits) <span class="sc">%&gt;%</span></span>
<span id="cb291-2"><a href="working-with-split-times.html#cb291-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">map_split_codes</span>(splits_list) <span class="sc">%&gt;%</span> </span>
<span id="cb291-3"><a href="working-with-split-times.html#cb291-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">map_driver_names</span>(cars)</span>
<span id="cb291-4"><a href="working-with-split-times.html#cb291-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb291-5"><a href="working-with-split-times.html#cb291-5" aria-hidden="true" tabindex="-1"></a>splits_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##   code split_1 split_2 split_3 split_4 split_5
## 1  OGI   161.7   272.3   471.3   690.4   789.2
## 2  EVA   162.3   273.7   472.3   692.1   792.4
## 3  NEU   159.1   268.6   465.8   682.7   782.7
## 4  ROV   159.6   270.6   468.3   686.6   786.9
## 5  KAT   161.4   270.3   469.8   689.5   789.9
## 6  GRE   165.8   278.3   479.3   700.4   800.4</code></pre>
<p>We can also update our helper function to relabel stages with a more general function:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="working-with-split-times.html#cb293-1" aria-hidden="true" tabindex="-1"></a>relabel_times_df2 <span class="ot">=</span> <span class="cf">function</span>(df, s_list, cars, <span class="at">typ=</span><span class="st">&#39;stage&#39;</span>) {</span>
<span id="cb293-2"><a href="working-with-split-times.html#cb293-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (typ<span class="sc">==</span><span class="st">&#39;split&#39;</span>)</span>
<span id="cb293-3"><a href="working-with-split-times.html#cb293-3" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">map_split_codes</span>(s_list)</span>
<span id="cb293-4"><a href="working-with-split-times.html#cb293-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb293-5"><a href="working-with-split-times.html#cb293-5" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">map_stage_codes</span>(s_list)</span>
<span id="cb293-6"><a href="working-with-split-times.html#cb293-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb293-7"><a href="working-with-split-times.html#cb293-7" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb293-8"><a href="working-with-split-times.html#cb293-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_driver_names</span>(cars)</span>
<span id="cb293-9"><a href="working-with-split-times.html#cb293-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="rebasing-split-times" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Rebasing Split Times</h2>
<p>The split times describe the split times recorded for each driver, but in many situations we may be interested in knowing the difference in split times for a specific driver relative to every other driver.</p>
<p>More formally, for drivers <span class="math inline">\(j\)</span> on stage <span class="math inline">\(S\)</span> and split <span class="math inline">\(s\)</span>, we find the rebased stage times relative to driver <span class="math inline">\(j\)</span> as:</p>
<p><span class="math display">\[
{_{S,s}}t_{i}^{j} = {_{S,s}}t_{i} - {_{S,s}}t_{j}
\]</span>
although we may want to negate that value depending on the sense of whether we want to focus on times from the selected driver’s perspective, or from the perspective of the field of drivers they are being rebased against.
.
To calculate the rebased times, we note that the wide dataframe format gives rows containing the split times for each driver, which is to say <span class="math inline">\({_{S,*}}t_i\)</span>.</p>
<p>To calculate the rebased times, we can simply subtract the row corresponding to the driver we want to rebase relative to, from the other driver rows.</p>
<p>Recall the heart of the rebase function we have previously defined:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="working-with-split-times.html#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/a/32267785/454773</span></span>
<span id="cb294-2"><a href="working-with-split-times.html#cb294-2" aria-hidden="true" tabindex="-1"></a>rebase_essence <span class="ot">=</span> <span class="cf">function</span>(df, id, rebase_cols,</span>
<span id="cb294-3"><a href="working-with-split-times.html#cb294-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">id_col=</span><span class="st">&#39;entryId&#39;</span>) {</span>
<span id="cb294-4"><a href="working-with-split-times.html#cb294-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb294-5"><a href="working-with-split-times.html#cb294-5" aria-hidden="true" tabindex="-1"></a>  df_ <span class="ot">=</span>  df</span>
<span id="cb294-6"><a href="working-with-split-times.html#cb294-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb294-7"><a href="working-with-split-times.html#cb294-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The rebase values are the ones</span></span>
<span id="cb294-8"><a href="working-with-split-times.html#cb294-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we want to subtract from each row</span></span>
<span id="cb294-9"><a href="working-with-split-times.html#cb294-9" aria-hidden="true" tabindex="-1"></a>  rebase_vals <span class="ot">=</span> <span class="fu">c</span>(df[df[[id_col]]<span class="sc">==</span>id, rebase_cols])</span>
<span id="cb294-10"><a href="working-with-split-times.html#cb294-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb294-11"><a href="working-with-split-times.html#cb294-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Do the rebasing</span></span>
<span id="cb294-12"><a href="working-with-split-times.html#cb294-12" aria-hidden="true" tabindex="-1"></a>  df_[,rebase_cols] <span class="ot">=</span>  df[,rebase_cols] <span class="sc">-</span> rebase_vals</span>
<span id="cb294-13"><a href="working-with-split-times.html#cb294-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb294-14"><a href="working-with-split-times.html#cb294-14" aria-hidden="true" tabindex="-1"></a>  df_</span>
<span id="cb294-15"><a href="working-with-split-times.html#cb294-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s try the original function with an example driver:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="working-with-split-times.html#cb295-1" aria-hidden="true" tabindex="-1"></a>ogierEntryId <span class="ot">=</span> <span class="fu">get_person_id</span>(cars, <span class="st">&#39;ogier&#39;</span>, <span class="at">ret=</span><span class="st">&#39;code&#39;</span>)</span>
<span id="cb295-2"><a href="working-with-split-times.html#cb295-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-3"><a href="working-with-split-times.html#cb295-3" aria-hidden="true" tabindex="-1"></a>ogier_rebased <span class="ot">=</span> <span class="fu">rebase</span>(splits_wide, ogierEntryId,</span>
<span id="cb295-4"><a href="working-with-split-times.html#cb295-4" aria-hidden="true" tabindex="-1"></a>                       split_names, <span class="at">id_col=</span><span class="st">&#39;code&#39;</span>)</span>
<span id="cb295-5"><a href="working-with-split-times.html#cb295-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-6"><a href="working-with-split-times.html#cb295-6" aria-hidden="true" tabindex="-1"></a>ogier_rebased <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    code split_1 split_2 split_3 split_4 split_5
## 1   OGI     0.0     0.0     0.0     0.0     0.0
## 2   EVA     0.6     1.4     1.0     1.7     3.2
## 3   NEU    -2.6    -3.7    -5.5    -7.7    -6.5
## 4   ROV    -2.1    -1.7    -3.0    -3.8    -2.3
## 5   KAT    -0.3    -2.0    -1.5    -0.9     0.7
## 6   GRE     4.1     6.0     8.0    10.0    11.2
## 7   TÄN    -4.2    -5.0    -7.5    -9.2    -7.6
## 8   SUN     0.1     2.2     3.0     3.8     5.0
## 9   BRE    -3.3    -2.0    -0.1    -2.0    -0.7
## 10  SOL     1.9     2.8     0.0    -2.1    -2.5</code></pre>
</div>
<div id="visualising-rebased-split-times-using-sparklines" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Visualising Rebased Split Times Using Sparklines</h2>
<p>If we cast the data back to a tidy long form data, we can easily generate a graphical summary from the long form data:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="working-with-split-times.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb297-2"><a href="working-with-split-times.html#cb297-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-3"><a href="working-with-split-times.html#cb297-3" aria-hidden="true" tabindex="-1"></a>ogier_rebased_long <span class="ot">&lt;-</span> ogier_rebased <span class="sc">%&gt;%</span></span>
<span id="cb297-4"><a href="working-with-split-times.html#cb297-4" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">gather</span>(<span class="at">key =</span><span class="st">&quot;Split&quot;</span>,</span>
<span id="cb297-5"><a href="working-with-split-times.html#cb297-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">value =</span><span class="st">&quot;TimeInS&quot;</span>,</span>
<span id="cb297-6"><a href="working-with-split-times.html#cb297-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">all_of</span>(split_names))</span>
<span id="cb297-7"><a href="working-with-split-times.html#cb297-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-8"><a href="working-with-split-times.html#cb297-8" aria-hidden="true" tabindex="-1"></a>ogier_rebased_long <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    code   Split TimeInS
## 1   OGI split_1     0.0
## 2   EVA split_1     0.6
## 3   NEU split_1    -2.6
## 4   ROV split_1    -2.1
## 5   KAT split_1    -0.3
## 6   GRE split_1     4.1
## 7   TÄN split_1    -4.2
## 8   SUN split_1     0.1
## 9   BRE split_1    -3.3
## 10  SOL split_1     1.9</code></pre>
<p>For example, we can use the <code>sparkline::spk_chr()</code> function to generate an HTML sparkline widget that we can embed in a <code>formattable::formattable()</code> generated table:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="working-with-split-times.html#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(formattable)</span>
<span id="cb299-2"><a href="working-with-split-times.html#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparkline)</span>
<span id="cb299-3"><a href="working-with-split-times.html#cb299-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-4"><a href="working-with-split-times.html#cb299-4" aria-hidden="true" tabindex="-1"></a>ogier_sparkline <span class="ot">&lt;-</span> ogier_rebased_long <span class="sc">%&gt;%</span></span>
<span id="cb299-5"><a href="working-with-split-times.html#cb299-5" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">group_by</span>(code) <span class="sc">%&gt;%</span></span>
<span id="cb299-6"><a href="working-with-split-times.html#cb299-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">summarize</span>(<span class="at">spk_ =</span> <span class="fu">spk_chr</span>(TimeInS, <span class="at">type =</span><span class="st">&quot;bar&quot;</span>))</span>
<span id="cb299-7"><a href="working-with-split-times.html#cb299-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-8"><a href="working-with-split-times.html#cb299-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to create an htmlwidget form of the table</span></span>
<span id="cb299-9"><a href="working-with-split-times.html#cb299-9" aria-hidden="true" tabindex="-1"></a>out <span class="ot">=</span> <span class="fu">as.htmlwidget</span>(<span class="fu">formattable</span>(<span class="fu">head</span>(ogier_sparkline, <span class="dv">5</span>)))</span>
<span id="cb299-10"><a href="working-with-split-times.html#cb299-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-11"><a href="working-with-split-times.html#cb299-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The table also has a requirement on the sparkline package</span></span>
<span id="cb299-12"><a href="working-with-split-times.html#cb299-12" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>dependencies <span class="ot">=</span> <span class="fu">c</span>(out<span class="sc">$</span>dependencies,</span>
<span id="cb299-13"><a href="working-with-split-times.html#cb299-13" aria-hidden="true" tabindex="-1"></a>                     htmlwidgets<span class="sc">:::</span><span class="fu">widget_dependencies</span>(<span class="st">&quot;sparkline&quot;</span>,</span>
<span id="cb299-14"><a href="working-with-split-times.html#cb299-14" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&quot;sparkline&quot;</span>))</span>
<span id="cb299-15"><a href="working-with-split-times.html#cb299-15" aria-hidden="true" tabindex="-1"></a>out</span></code></pre></div>
<div id="htmlwidget-119e7411fc59c4b28c8f" class="formattable_widget html-widget" style="width:100%;height:480px;" width="100%" height="480"></div>
<script type="application/json" data-for="htmlwidget-119e7411fc59c4b28c8f">{"x":{"html":"<table class=\"table table-condensed\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> code <\/th>\n   <th style=\"text-align:right;\"> spk_ <\/th>\n  <\/tr>\n <\/thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> AL- <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-63ddafcefd8baed87f46\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-63ddafcefd8baed87f46\">{\"x\":{\"values\":[21.3,37.2,77.4999999999999,104.3,115],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> ASU <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-26309ed39802c81479fe\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-26309ed39802c81479fe\">{\"x\":{\"values\":[9.60000000000002,16.6,26.9,34.9,41.1999999999999],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> BER <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-b77b3e876d5ad8414dd4\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-b77b3e876d5ad8414dd4\">{\"x\":{\"values\":[8617.1,null,null,null,7989.6],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> BRE <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-323a95226d982edc7c03\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-323a95226d982edc7c03\">{\"x\":{\"values\":[-3.29999999999998,-2,-0.100000000000023,-2,-0.700000000000045],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> BRY <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-05d4c51809489415c13e\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-05d4c51809489415c13e\">{\"x\":{\"values\":[8.70000000000002,15.7,24.5,46.6,52.1999999999999],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n<\/tbody>\n<\/table>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="finding-the-rank-position-at-each-split-point" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> Finding the Rank Position at Each Split Point</h2>
<p>It can often be tricky to work out the rank at each split by eye, so let’s create a simple function to display the rank at each split for us:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="working-with-split-times.html#cb300-1" aria-hidden="true" tabindex="-1"></a>get_split_rank <span class="ot">=</span> <span class="cf">function</span>(df, split_cols){</span>
<span id="cb300-2"><a href="working-with-split-times.html#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We need to drop any list names</span></span>
<span id="cb300-3"><a href="working-with-split-times.html#cb300-3" aria-hidden="true" tabindex="-1"></a>  split_names <span class="ot">=</span> <span class="fu">as.character</span>(split_names)</span>
<span id="cb300-4"><a href="working-with-split-times.html#cb300-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb300-5"><a href="working-with-split-times.html#cb300-5" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>( split_cols, dense_rank ))</span>
<span id="cb300-6"><a href="working-with-split-times.html#cb300-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb300-7"><a href="working-with-split-times.html#cb300-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-8"><a href="working-with-split-times.html#cb300-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-9"><a href="working-with-split-times.html#cb300-9" aria-hidden="true" tabindex="-1"></a><span class="fu">get_split_rank</span>(splits_wide, split_names) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(split_cols)` instead of `split_cols` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<pre><code>##   code split_1 split_2 split_3 split_4 split_5
## 1  OGI       6       5       6       7       6
## 2  EVA       8       7       8       8       9
## 3  NEU       3       2       2       2       2
## 4  ROV       4       4       3       3       4
## 5  KAT       5       3       4       6       7</code></pre>
</div>
<div id="finding-split-section-durations" class="section level2" number="7.6">
<h2><span class="header-section-number">7.6</span> Finding Split Section Durations</h2>
<p>Inspection of the split times data show the split times to be a strictly increasing function over the ordered in-stage split locations. That is, the times represent the time in stage up to that split point, rather than the fractional time taken to get from one split timing point to another.</p>
<p>In many cases, it will be convenient to know how much time a driver took to get from one split point to the next, not least because this allows us to identify sections of the stage where a driver may have particularly gained or lost time, or to identify where a driver may be making or losing time consistently across different parts of the stage.</p>
<p>In abstract terms, then, what we want to calculate is the time taken for a driver <span class="math inline">\(i\)</span> on stage <span class="math inline">\(S\)</span> to go between two split points, <span class="math inline">\(m\)</span> and <span class="math inline">\(n\)</span>, where <span class="math inline">\(m=0\)</span> is the start, <span class="math inline">\(m={_S}s_{max}+1\)</span> is the stage end, and <span class="math inline">\({_S}s_{max}\)</span> is the number of split points on stage <span class="math inline">\(S\)</span>:</p>
<p><span class="math display">\[
{_{S,m,n}}t_{i} = {_{S,n}}t_{i} - {_{S,m}}t_{i}: 0{\le}m&lt;n{\le}{_S}s_{max}
\]</span></p>
<p>For a specific, known stage, we might write the simpler:</p>
<p><span class="math display">\[
S={stagenum};
{_{m,n}}t_{i} = {_{n}}t_{i} - {_{m}}t_{i}: 0{\le}m&lt;n{\le}s_{max}
\]</span></p>
<p>For a driver, <em>i</em>, we note that the accumulated stage time on stage <span class="math inline">\(S\)</span> as given by the split times is:</p>
<p><span class="math display">\[
S={stagenum};t_{i}=\sum_{s=0}^{s{_{max}}}{_{s,s+1}}t_{i}:
\]</span></p>
<p>To get the duration between two split points, we can create two temporary dataframes, one representing the original split times without the first split <span class="math inline">\({_{{s+1},s_{max}}}t\)</span>, one representing the split times without the last split, <span class="math inline">\({_{s,s_{max}-1}}t\)</span>. Subtracting one dataframe from the other this finds the difference across all consecutive columns:</p>
<p><span class="math display">\[
{_{{s+1},s_{max}}}t - {_{s,s_{max}-1}}t
\]</span></p>
<p>Let’s see how that works in practice:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="working-with-split-times.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/a/50411529/454773</span></span>
<span id="cb303-2"><a href="working-with-split-times.html#cb303-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-3"><a href="working-with-split-times.html#cb303-3" aria-hidden="true" tabindex="-1"></a>get_split_duration <span class="ot">=</span> <span class="cf">function</span>(df, split_cols,</span>
<span id="cb303-4"><a href="working-with-split-times.html#cb303-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">retId=</span><span class="cn">TRUE</span>, <span class="at">id_col=</span><span class="st">&#39;entryId&#39;</span>) {</span>
<span id="cb303-5"><a href="working-with-split-times.html#cb303-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb303-6"><a href="working-with-split-times.html#cb303-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop names if they are set</span></span>
<span id="cb303-7"><a href="working-with-split-times.html#cb303-7" aria-hidden="true" tabindex="-1"></a>  split_cols <span class="ot">=</span> <span class="fu">as.character</span>(split_cols)</span>
<span id="cb303-8"><a href="working-with-split-times.html#cb303-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb303-9"><a href="working-with-split-times.html#cb303-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># [-1] drops the first column, [-ncol()] drops the last</span></span>
<span id="cb303-10"><a href="working-with-split-times.html#cb303-10" aria-hidden="true" tabindex="-1"></a>  df_ <span class="ot">=</span> df[,split_cols][<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> df[,split_cols][<span class="sc">-</span><span class="fu">ncol</span>(df[,split_cols])]</span>
<span id="cb303-11"><a href="working-with-split-times.html#cb303-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb303-12"><a href="working-with-split-times.html#cb303-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The split time to the first split is simply the first split time</span></span>
<span id="cb303-13"><a href="working-with-split-times.html#cb303-13" aria-hidden="true" tabindex="-1"></a>  df_[split_cols[<span class="dv">1</span>]] <span class="ot">=</span> df[split_cols[<span class="dv">1</span>]]</span>
<span id="cb303-14"><a href="working-with-split-times.html#cb303-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb303-15"><a href="working-with-split-times.html#cb303-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (retId) {</span>
<span id="cb303-16"><a href="working-with-split-times.html#cb303-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add in the entryId column</span></span>
<span id="cb303-17"><a href="working-with-split-times.html#cb303-17" aria-hidden="true" tabindex="-1"></a>    df_[[id_col]] <span class="ot">=</span> df[[id_col]]</span>
<span id="cb303-18"><a href="working-with-split-times.html#cb303-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb303-19"><a href="working-with-split-times.html#cb303-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the dataframe in a sensible column order</span></span>
<span id="cb303-20"><a href="working-with-split-times.html#cb303-20" aria-hidden="true" tabindex="-1"></a>    df_ <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(id_col, <span class="fu">all_of</span>(split_cols)))</span>
<span id="cb303-21"><a href="working-with-split-times.html#cb303-21" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb303-22"><a href="working-with-split-times.html#cb303-22" aria-hidden="true" tabindex="-1"></a>    df_</span>
<span id="cb303-23"><a href="working-with-split-times.html#cb303-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb303-24"><a href="working-with-split-times.html#cb303-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb303-25"><a href="working-with-split-times.html#cb303-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s see how that works:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="working-with-split-times.html#cb304-1" aria-hidden="true" tabindex="-1"></a>split_durations_wide <span class="ot">=</span> <span class="fu">get_split_duration</span>(splits_wide,</span>
<span id="cb304-2"><a href="working-with-split-times.html#cb304-2" aria-hidden="true" tabindex="-1"></a>                                          split_names, <span class="at">id_col=</span><span class="st">&#39;code&#39;</span>)</span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(id_col)` instead of `id_col` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="working-with-split-times.html#cb306-1" aria-hidden="true" tabindex="-1"></a>split_durations_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   code split_1 split_2 split_3 split_4 split_5
## 1  OGI   161.7   110.6   199.0   219.1    98.8
## 2  EVA   162.3   111.4   198.6   219.8   100.3
## 3  NEU   159.1   109.5   197.2   216.9   100.0
## 4  ROV   159.6   111.0   197.7   218.3   100.3
## 5  KAT   161.4   108.9   199.5   219.7   100.4</code></pre>
<div id="finding-split-section-ranks" class="section level3" number="7.6.1">
<h3><span class="header-section-number">7.6.1</span> Finding Split Section Ranks</h3>
<p>To find the rank in terms of which driver completed each stage <em>section</em> in the quickest time, we can simply pass the <code>split_durations_wide</code> dataframe rather than the <code>split_durations</code> dataframe to the <code>get_split_rank()</code> function:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="working-with-split-times.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_split_rank</span>(split_durations_wide, split_names) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##   code split_1 split_2 split_3 split_4 split_5
## 1  OGI       6       4       6       6       3
## 2  EVA       8       7       5       8       7
## 3  NEU       3       2       3       1       4
## 4  ROV       4       5       4       5       7
## 5  KAT       5       1       8       7       8</code></pre>
</div>
</div>
<div id="using-sparklines-to-visdualise-split-time-differences" class="section level2" number="7.7">
<h2><span class="header-section-number">7.7</span> Using Sparklines to Visdualise Split Time Differences</h2>
<p>TO DO</p>
</div>
<div id="adding-overall-stage-time-to-the-split-times" class="section level2" number="7.8">
<h2><span class="header-section-number">7.8</span> Adding Overall Stage Time to the Split Times</h2>
<p>It is important to note that the split times data <em>does not</em> contain all the timing data for the stage, just the times relating to split points along the stage route. For a complete summary of stage timing data, we also need to add in the overall stage time from the stage results table:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="working-with-split-times.html#cb310-1" aria-hidden="true" tabindex="-1"></a>stage_times <span class="ot">=</span> <span class="fu">get_stage_times</span>(eventId, stageId)</span>
<span id="cb310-2"><a href="working-with-split-times.html#cb310-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-3"><a href="working-with-split-times.html#cb310-3" aria-hidden="true" tabindex="-1"></a>stage_times <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   stageTimeId stageId entryId elapsedDurationMs  elapsedDuration    status
## 1       96580    1750   21536            834500 00:13:54.5000000 Completed
## 2       96474    1750   21532            835500 00:13:55.5000000 Completed
##    source position diffFirstMs diffFirst diffPrevMs diffPrev
## 1 Default        1           0  00:00:00          0 00:00:00
## 2 Default        2        1000  00:00:01       1000 00:00:01</code></pre>
<p><em>Recall that if required we can also retrieve stage time for multiple stages using the <code>get_multi_stage_times(stagelist)</code> function. The <code>get_stage_list(stages)</code> function will return a list of all stage IDs.</em></p>
<p>If we merge each driver’s stage times as an extra, final column to the wide split times dataframe, we can calculate the split section durations over the whole stage, including the time taken to get from the final split to the stage end.</p>
<p>Recalling that driver codes may not be unique, we should use the unique <em>entryId</em> values to create the extended dataframe:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="working-with-split-times.html#cb312-1" aria-hidden="true" tabindex="-1"></a>widen_splits_stage_times <span class="ot">=</span> <span class="cf">function</span>(splits_wide, stage_times,</span>
<span id="cb312-2"><a href="working-with-split-times.html#cb312-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">id_col=</span><span class="st">&#39;entryId&#39;</span>){</span>
<span id="cb312-3"><a href="working-with-split-times.html#cb312-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb312-4"><a href="working-with-split-times.html#cb312-4" aria-hidden="true" tabindex="-1"></a>  results_cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;elapsedDurationMs&#39;</span>, id_col,  <span class="st">&#39;diffFirstMs&#39;</span>, <span class="st">&#39;position&#39;</span>)</span>
<span id="cb312-5"><a href="working-with-split-times.html#cb312-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-6"><a href="working-with-split-times.html#cb312-6" aria-hidden="true" tabindex="-1"></a>  splits_wide <span class="ot">=</span> splits_wide <span class="sc">%&gt;%</span></span>
<span id="cb312-7"><a href="working-with-split-times.html#cb312-7" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">merge</span>(stage_times[,results_cols],</span>
<span id="cb312-8"><a href="working-with-split-times.html#cb312-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">by =</span> <span class="st">&#39;entryId&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb312-9"><a href="working-with-split-times.html#cb312-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">split_N =</span> elapsedDurationMs<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb312-10"><a href="working-with-split-times.html#cb312-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-11"><a href="working-with-split-times.html#cb312-11" aria-hidden="true" tabindex="-1"></a>  splits_wide</span>
<span id="cb312-12"><a href="working-with-split-times.html#cb312-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb312-13"><a href="working-with-split-times.html#cb312-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-14"><a href="working-with-split-times.html#cb312-14" aria-hidden="true" tabindex="-1"></a>full_splits_wide <span class="ot">=</span> <span class="fu">get_splits_wide</span>(splits) <span class="sc">%&gt;%</span></span>
<span id="cb312-15"><a href="working-with-split-times.html#cb312-15" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">widen_splits_stage_times</span>(stage_times) <span class="sc">%&gt;%</span></span>
<span id="cb312-16"><a href="working-with-split-times.html#cb312-16" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">map_split_codes</span>(splits_list) <span class="sc">%&gt;%</span> </span>
<span id="cb312-17"><a href="working-with-split-times.html#cb312-17" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">map_driver_names</span>(cars)</span>
<span id="cb312-18"><a href="working-with-split-times.html#cb312-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-19"><a href="working-with-split-times.html#cb312-19" aria-hidden="true" tabindex="-1"></a>full_splits_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   code split_1 split_2 split_3 split_4 split_5 elapsedDurationMs diffFirstMs
## 1  OGI   161.7   272.3   471.3   690.4   789.2            842000        7500
## 2  EVA   162.3   273.7   472.3   692.1   792.4            845800       11300
##   position split_N
## 1        6   842.0
## 2        9   845.8</code></pre>
<p>To make further processing easier, we add the overall stage time to the list of split time column names. The “final split” is now the completed stage time:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="working-with-split-times.html#cb314-1" aria-hidden="true" tabindex="-1"></a>split_names <span class="ot">=</span> <span class="fu">c</span>(split_names, <span class="st">&#39;split_N&#39;</span>)</span>
<span id="cb314-2"><a href="working-with-split-times.html#cb314-2" aria-hidden="true" tabindex="-1"></a>split_names</span></code></pre></div>
<pre><code>## [1] &quot;split_1&quot; &quot;split_2&quot; &quot;split_3&quot; &quot;split_4&quot; &quot;split_5&quot; &quot;split_N&quot;</code></pre>
</div>
<div id="calculating-the-ultimate-stage-from-ultimate-split-times" class="section level2" number="7.9">
<h2><span class="header-section-number">7.9</span> Calculating the Ultimate Stage from Ultimate Split Times</h2>
<p>The ultimate stage time for a stage is the sum of the fastest sectional split times on the stage as recorded by any driver. Rebasing the stage winner’s time against the ultimate stage time shows whether the driver potentially left time on the stage. (Of course, it might be that a very fast sectional time recorded by one driver may have wiped out their tyres and led to a relatively poor overall stage time, or risk taking that ended their stage prematurely…)</p>
<p>So how can we calculate the ultimate splits? For split section times <span class="math inline">\({_{S,s}}t_{i}\)</span>, the ultimate section time <span class="math inline">\({_{S,s}}u\)</span> is given as:</p>
<p><span class="math display">\[
{_{S,s}}u = \forall i: min({_{S,s}}t_i)
\]</span></p>
<p>We can calculate the times by case the wide split section duration dataframe to a long form, grouping by the <em>splitPointId</em> and then summarising the minimum time in each group.</p>
<p>Here’s how we can create the long form dataset:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="working-with-split-times.html#cb316-1" aria-hidden="true" tabindex="-1"></a>full_splits_wide <span class="sc">%&gt;%</span></span>
<span id="cb316-2"><a href="working-with-split-times.html#cb316-2" aria-hidden="true" tabindex="-1"></a>      <span class="co">#gather() is deprecated / retired...</span></span>
<span id="cb316-3"><a href="working-with-split-times.html#cb316-3" aria-hidden="true" tabindex="-1"></a>      <span class="co">#gather(splitPointId, sectionDurationS,</span></span>
<span id="cb316-4"><a href="working-with-split-times.html#cb316-4" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                 as.character(split_names))</span></span>
<span id="cb316-5"><a href="working-with-split-times.html#cb316-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">as.character</span>(split_names)), code) <span class="sc">%&gt;%</span></span>
<span id="cb316-6"><a href="working-with-split-times.html#cb316-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="fu">as.character</span>(split_names),</span>
<span id="cb316-7"><a href="working-with-split-times.html#cb316-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">&quot;splitname&quot;</span>,</span>
<span id="cb316-8"><a href="working-with-split-times.html#cb316-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">&quot;sectionDurationS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb316-9"><a href="working-with-split-times.html#cb316-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   code  splitname sectionDurationS
##   &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt;
## 1 OGI   split_1               162.
## 2 OGI   split_2               272.
## 3 OGI   split_3               471.</code></pre>
<p>We can also get the duration of each section:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="working-with-split-times.html#cb318-1" aria-hidden="true" tabindex="-1"></a>full_durations_wide <span class="ot">=</span> <span class="fu">get_split_duration</span>(full_splits_wide,</span>
<span id="cb318-2"><a href="working-with-split-times.html#cb318-2" aria-hidden="true" tabindex="-1"></a>                                          split_names, <span class="at">id_col=</span><span class="st">&#39;code&#39;</span>)</span>
<span id="cb318-3"><a href="working-with-split-times.html#cb318-3" aria-hidden="true" tabindex="-1"></a>full_durations_wide</span></code></pre></div>
<pre><code>##    code split_1 split_2 split_3 split_4 split_5 split_N
## 1   OGI   161.7   110.6   199.0   219.1    98.8    52.8
## 2   EVA   162.3   111.4   198.6   219.8   100.3    53.4
## 3   NEU   159.1   109.5   197.2   216.9   100.0    52.8
## 4   ROV   159.6   111.0   197.7   218.3   100.3    53.3
## 5   KAT   161.4   108.9   199.5   219.7   100.4    53.3
## 6   GRE   165.8   112.5   201.0   221.1   100.0    53.0
## 7   TÄN   157.5   109.8   196.5   217.4   100.4    52.9
## 8   SUN   161.8   112.7   199.8   219.9   100.0    52.7
## 9   BRE   158.4   111.9   200.9   217.2   100.1    53.4
## 10  SOL   163.6   111.5   196.2   217.0    98.4    52.4
## 11  LOU   161.4   111.1   199.1   221.1    98.8    52.8
## 12  TUO   165.2   115.4   204.1   225.4   100.2    54.1
## 13  BER  8778.8      NA      NA      NA      NA -7344.3
## 14  MIK   164.7   117.4   206.2   225.9   103.2    54.5
## 15  FOU   170.9   119.8   211.6   226.3   104.0    56.1
## 16  BRY   170.4   117.6   207.8   241.2   104.4    55.8
## 17  JOH   183.1   127.2   224.4   238.0   109.4    58.7
## 18  LAP   165.6   117.5   204.2   224.6   103.0    54.8
## 19  VEI   169.6   118.9   207.3   231.3   104.0    55.6
## 20  GRY   168.6   117.7   207.0   227.5   103.5    55.3
## 21  LIN   171.7   120.3   213.8   233.4   105.4    57.9
## 22  PRO   176.1   123.7   219.0   240.3   106.9    57.7
## 23  ASU   171.3   117.6   209.3   227.1   105.1    56.3
## 24  LIN   167.7   117.8   209.8   228.8   105.5    56.0
## 25  HEI   170.4   120.8   214.9   231.5   105.7    56.9
## 26  PIE   170.9   121.9   213.5   234.4   106.2    56.0
## 27  KRI   172.8   120.4   211.6   232.7   105.2    56.2
## 28  EKS   169.7   119.4   211.7   229.8   104.3    56.1
## 29  KAU   169.0   117.5   208.7   228.5   104.6    55.7
## 30  JEE   175.7   122.3   217.6   238.9   106.2    56.4
## 31  RUO   175.5   121.8   216.5   235.9   107.7    58.3
## 32  KES   179.8   126.5   221.8   237.2   107.0    58.1
## 33  SKA   177.3   123.8   235.2   237.3   108.7    57.5
## 34  KES   184.9   134.1   233.1   246.9   110.8    59.1
## 35  KOI   184.1   130.1   228.0   243.2   108.8    58.7
## 36  ZAL   176.9   124.3   220.5   236.7   106.6    58.6
## 37  STU   188.6   135.0   233.5   251.0   109.4    59.3
## 38  AL-   183.0   126.5   239.3   245.9   109.5    59.5
## 39  THU   182.3   127.9      NA      NA      NA      NA
## 40  SOL   178.7   125.5   226.5   240.4   109.5    59.8
## 41  JUR   181.2   128.6   220.0   241.0   108.5    57.3
## 42  VII   187.1   136.1   232.6   248.6   110.6    59.8
## 43  MIE   196.7   143.5   246.1   268.2   115.2    62.1
## 44  DIA   209.3   149.0   257.0   284.5   119.4    65.6
## 45  CHW   191.3   133.7   233.8   252.7   111.1    59.5
## 46  HAN   181.5   126.0   221.8   236.8   112.6    59.0
## 47  HOE   191.9   136.6   237.8   252.2   111.0    60.5
## 48  CRA   189.6   134.6   240.5   250.1   109.9    59.0
## 49  PIE   193.4   141.7   244.2   261.9   115.5    63.7
## 50  KAR   208.0   143.8   251.0   267.2   115.6    63.8
## 51  JOO   189.6   131.9   238.9   251.4   118.9    63.6
## 52  PAJ   183.9   126.6   231.8   243.1   114.0    61.8
## 53  HER   190.3   131.8   240.1   258.2   126.0    66.1
## 54  KOR   196.7   137.8   244.2   259.7   123.1    65.8</code></pre>
<p>To rebase on on an ultimate time basis, it helps to think of an ultimate driver whom we define as having a time equivalent to the fastest split duration time between two split points.</p>
<p>If we group by <em>splitPointId</em>, we can summarise on <em>sectionDurationS</em> to find the minimum duration at each split; we can also take the opportunity to add an accumulated stage time column at each split point as well:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="working-with-split-times.html#cb320-1" aria-hidden="true" tabindex="-1"></a>ultimate_splits_long <span class="ot">=</span> full_durations_wide <span class="sc">%&gt;%</span></span>
<span id="cb320-2"><a href="working-with-split-times.html#cb320-2" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pivot_longer</span>(split_names,</span>
<span id="cb320-3"><a href="working-with-split-times.html#cb320-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">names_to =</span> <span class="st">&quot;splitname&quot;</span>,</span>
<span id="cb320-4"><a href="working-with-split-times.html#cb320-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">values_to =</span> <span class="st">&quot;sectionDurationS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb320-5"><a href="working-with-split-times.html#cb320-5" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">select</span>(<span class="fu">c</span>(splitname, sectionDurationS)) <span class="sc">%&gt;%</span></span>
<span id="cb320-6"><a href="working-with-split-times.html#cb320-6" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># Defensive measure</span></span>
<span id="cb320-7"><a href="working-with-split-times.html#cb320-7" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sectionDurationS) <span class="sc">&amp;</span> sectionDurationS<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb320-8"><a href="working-with-split-times.html#cb320-8" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">group_by</span>(splitname) <span class="sc">%&gt;%</span> </span>
<span id="cb320-9"><a href="working-with-split-times.html#cb320-9" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">summarise</span>(<span class="at">ultimate =</span> <span class="fu">min</span>(sectionDurationS,</span>
<span id="cb320-10"><a href="working-with-split-times.html#cb320-10" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb320-11"><a href="working-with-split-times.html#cb320-11" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">mutate</span>(<span class="at">ultimateElapsed =</span> <span class="fu">cumsum</span>(ultimate))</span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(split_names)` instead of `split_names` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="working-with-split-times.html#cb322-1" aria-hidden="true" tabindex="-1"></a>ultimate_splits_long</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   splitname ultimate ultimateElapsed
##   &lt;chr&gt;        &lt;dbl&gt;           &lt;dbl&gt;
## 1 split_1      158.             158.
## 2 split_2      109.             266.
## 3 split_3      196.             463.
## 4 split_4      217.             680.
## 5 split_5       98.4            778.
## 6 split_N       52.4            830.</code></pre>
<p>Rebasing arbitrary drivers against the ultimate stage (and the distribution of times recorded by other drivers) may give an idea of which drivers were pushing on what parts of a stage and where they were being more cautious.</p>
<p>Note that ultimate split times can be used to create an ultimate stage time time that can itself contribute to the ultimate ultimate rally time (<em>sic</em>).</p>
<div id="rebasing-to-ultimate-split-times" class="section level3" number="7.9.1">
<h3><span class="header-section-number">7.9.1</span> Rebasing to Ultimate Split Times</h3>
<p>We can rebase to the ultimate split times in three senses:</p>
<ul>
<li>on an ideal, ultimate <em>per split</em> basis;</li>
<li>on an ideal elapsed time basis (the cumulative sum of ideal ultimate split durations);</li>
<li>on an actual best elapsed (stage) time basis at each split, rebasing relative to the minimum actual recorded elapsed time at each split.</li>
</ul>
<div id="per-split-ultimate-rebasing" class="section level4" number="7.9.1.1">
<h4><span class="header-section-number">7.9.1.1</span> Per Split Ultimate Rebasing</h4>
<p>To rebase on a per split basis, we can simply rebase durations relative to the minimum split duration at each split.</p>
<p>Let’s reshape the ultimate driver durations to a wide format:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="working-with-split-times.html#cb324-1" aria-hidden="true" tabindex="-1"></a>ultimate_wide_durations <span class="ot">=</span> ultimate_splits_long <span class="sc">%&gt;%</span> </span>
<span id="cb324-2"><a href="working-with-split-times.html#cb324-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">select</span>(splitname, ultimate) <span class="sc">%&gt;%</span></span>
<span id="cb324-3"><a href="working-with-split-times.html#cb324-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> splitname,</span>
<span id="cb324-4"><a href="working-with-split-times.html#cb324-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_from =</span> ultimate) <span class="sc">%&gt;%</span></span>
<span id="cb324-5"><a href="working-with-split-times.html#cb324-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">code=</span><span class="st">&#39;ultimate&#39;</span>)</span>
<span id="cb324-6"><a href="working-with-split-times.html#cb324-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb324-7"><a href="working-with-split-times.html#cb324-7" aria-hidden="true" tabindex="-1"></a>ultimate_wide_durations</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   split_1 split_2 split_3 split_4 split_5 split_N code    
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   
## 1    158.    109.    196.    217.    98.4    52.4 ultimate</code></pre>
<p>We can now add the ultimate driver split durations to the <em>full_durations_wide</em> data and rebase against this dummy driver:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="working-with-split-times.html#cb326-1" aria-hidden="true" tabindex="-1"></a>full_durations_wide <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="working-with-split-times.html#cb326-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(code, <span class="fu">all_of</span>(split_names)) <span class="sc">%&gt;%</span> </span>
<span id="cb326-3"><a href="working-with-split-times.html#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(ultimate_wide_durations) <span class="sc">%&gt;%</span></span>
<span id="cb326-4"><a href="working-with-split-times.html#cb326-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rebase</span>(<span class="st">&#39;ultimate&#39;</span>, ultimate_splits<span class="sc">$</span>splitname, <span class="at">id_col=</span><span class="st">&#39;code&#39;</span>)</span></code></pre></div>
<pre><code>## Error in rebase(., &quot;ultimate&quot;, ultimate_splits$splitname, id_col = &quot;code&quot;): object &#39;ultimate_splits&#39; not found</code></pre>
<p>In this case we note there is at least one driver in each column with a zero gap to the ultimate driver, specifically, the driver(s) who made it between two consecutive split points in the fastest time, and no driver with a negative gap.</p>
</div>
<div id="ultimate-stage-rebasing" class="section level4" number="7.9.1.2">
<h4><span class="header-section-number">7.9.1.2</span> Ultimate Stage Rebasing</h4>
<p>We can add an “ultimate” driver to the wide splits dataframe and then rebase as normal. The following function routinises the widening recipe we used above:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="working-with-split-times.html#cb328-1" aria-hidden="true" tabindex="-1"></a>ultimate_widen <span class="ot">=</span> <span class="cf">function</span>(df, col, valname){</span>
<span id="cb328-2"><a href="working-with-split-times.html#cb328-2" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">select</span>(splitname, <span class="fu">all_of</span>(col)) <span class="sc">%&gt;%</span></span>
<span id="cb328-3"><a href="working-with-split-times.html#cb328-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> splitname,</span>
<span id="cb328-4"><a href="working-with-split-times.html#cb328-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">values_from =</span> col) <span class="sc">%&gt;%</span></span>
<span id="cb328-5"><a href="working-with-split-times.html#cb328-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">code=</span>valname)</span>
<span id="cb328-6"><a href="working-with-split-times.html#cb328-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can get the wide form as:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="working-with-split-times.html#cb329-1" aria-hidden="true" tabindex="-1"></a>ultimate_wide_elapsed <span class="ot">=</span> <span class="fu">ultimate_widen</span>(ultimate_splits_long,</span>
<span id="cb329-2"><a href="working-with-split-times.html#cb329-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">&#39;ultimateElapsed&#39;</span>, <span class="st">&#39;ultimate&#39;</span>)</span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(col)` instead of `col` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="working-with-split-times.html#cb331-1" aria-hidden="true" tabindex="-1"></a>ultimate_wide_elapsed</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   split_1 split_2 split_3 split_4 split_5 split_N code    
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   
## 1    158.    266.    463.    680.    778.    830. ultimate</code></pre>
<p>We can now add that to our original dataframe and rebase against the ultimate stage to show how far off the ultimate stage pace each driver was.</p>
<p>Again, let’s make a routine of the process…</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="working-with-split-times.html#cb333-1" aria-hidden="true" tabindex="-1"></a>ultimate_rebaser <span class="ot">=</span> <span class="cf">function</span>(df, ultimate_df, split_names,</span>
<span id="cb333-2"><a href="working-with-split-times.html#cb333-2" aria-hidden="true" tabindex="-1"></a>                            ultimate_col ){</span>
<span id="cb333-3"><a href="working-with-split-times.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb333-4"><a href="working-with-split-times.html#cb333-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(code, <span class="fu">all_of</span>(split_names)) <span class="sc">%&gt;%</span> </span>
<span id="cb333-5"><a href="working-with-split-times.html#cb333-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(ultimate_df) <span class="sc">%&gt;%</span></span>
<span id="cb333-6"><a href="working-with-split-times.html#cb333-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rebase</span>(ultimate_col, split_names, <span class="at">id_col=</span><span class="st">&#39;code&#39;</span>)</span>
<span id="cb333-7"><a href="working-with-split-times.html#cb333-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="working-with-split-times.html#cb334-1" aria-hidden="true" tabindex="-1"></a>full_splits_wide <span class="sc">%&gt;%</span> </span>
<span id="cb334-2"><a href="working-with-split-times.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ultimate_rebaser</span>(ultimate_wide_elapsed, split_names, <span class="st">&#39;ultimate&#39;</span>)</span></code></pre></div>
<pre><code>##        code split_1 split_2 split_3 split_4 split_5 split_N
## 1       OGI     4.2     5.9     8.7    10.9    11.3    11.7
## 2       EVA     4.8     7.3     9.7    12.6    14.5    15.5
## 3       NEU     1.6     2.2     3.2     3.2     4.8     5.2
## 4       ROV     2.1     4.2     5.7     7.1     9.0     9.9
## 5       KAT     3.9     3.9     7.2    10.0    12.0    12.9
## 6       GRE     8.3    11.9    16.7    20.9    22.5    23.1
## 7       TÄN     0.0     0.9     1.2     1.7     3.7     4.2
## 8       SUN     4.3     8.1    11.7    14.7    16.3    16.6
## 9       BRE     0.9     3.9     8.6     8.9    10.6    11.6
## 10      SOL     6.1     8.7     8.7     8.8     8.8     8.8
## 11      LOU     3.9     6.1     9.0    13.2    13.6    14.0
## 12      TUO     7.7    14.2    22.1    30.6    32.4    34.1
## 13      BER  8621.3      NA      NA      NA  8000.9   604.2
## 14      MIK     7.2    15.7    25.7    34.7    39.5    41.6
## 15      FOU    13.4    24.3    39.7    49.1    54.7    58.4
## 16      BRY    12.9    21.6    33.2    57.5    63.5    66.9
## 17      JOH    25.6    43.9    72.1    93.2   104.2   110.5
## 18      LAP     8.1    16.7    24.7    32.4    37.0    39.4
## 19      VEI    12.1    22.1    33.2    47.6    53.2    56.4
## 20      GRY    11.1    19.9    30.7    41.3    46.4    49.3
## 21      LIN    14.2    25.6    43.2    59.7    66.7    72.2
## 22      PRO    18.6    33.4    56.2    79.6    88.1    93.4
## 23      ASU    13.8    22.5    35.6    45.8    52.5    56.4
## 24      LIN    10.2    19.1    32.7    44.6    51.7    55.3
## 25      HEI    12.9    24.8    43.5    58.1    65.4    69.9
## 26      PIE    13.4    26.4    43.7    61.2    69.0    72.6
## 27      KRI    15.3    26.8    42.2    58.0    64.8    68.6
## 28      EKS    12.2    22.7    38.2    51.1    57.0    60.7
## 29      KAU    11.5    20.1    32.6    44.2    50.4    53.7
## 30      JEE    18.2    31.6    53.0    75.0    82.8    86.8
## 31      RUO    18.0    30.9    51.2    70.2    79.5    85.4
## 32      KES    22.3    39.9    65.5    85.8    94.4   100.1
## 33      SKA    19.8    34.7    73.7    94.1   104.4   109.5
## 34      KES    27.4    52.6    89.5   119.5   131.9   138.6
## 35      KOI    26.6    47.8    79.6   105.9   116.3   122.6
## 36      ZAL    19.4    34.8    59.1    78.9    87.1    93.3
## 37      STU    31.1    57.2    94.5   128.6   139.6   146.5
## 38      AL-    25.5    43.1    86.2   115.2   126.3   133.4
## 39      THU    24.8    43.8      NA      NA      NA   653.7
## 40      SOL    21.2    37.8    68.1    91.6   102.7   110.1
## 41      JUR    23.7    43.4    67.2    91.3   101.4   106.3
## 42      VII    29.6    56.8    93.2   124.9   137.1   144.5
## 43      MIE    39.2    73.8   123.7   175.0   191.8   201.5
## 44      DIA    51.8    91.9   152.7   220.3   241.3   254.5
## 45      CHW    33.8    58.6    96.2   132.0   144.7   151.8
## 46      HAN    24.0    41.1    66.7    86.6   100.8   107.4
## 47      HOE    34.4    62.1   103.7   139.0   151.6   159.7
## 48      CRA    32.1    57.8   102.1   135.3   146.8   153.4
## 49      PIE    35.9    68.7   116.7   161.7   178.8   190.1
## 50      KAR    50.5    85.4   140.2   190.5   207.7   219.1
## 51      JOO    32.1    55.1    97.8   132.3   152.8   164.0
## 52      PAJ    26.4    44.1    79.7   105.9   121.5   130.9
## 53      HER    32.8    55.7    99.6   140.9   168.5   182.2
## 54      KOR    39.2    68.1   116.1   158.9   183.6   197.0
## 55 ultimate     0.0     0.0     0.0     0.0     0.0     0.0</code></pre>
<p>We note there there is only one guaranteed difference of 0.0, from the driver with the fastest time at the first split, and that no times will be less than zero.</p>
</div>
<div id="actual-best-elapsed-time-rebasing" class="section level4" number="7.9.1.3">
<h4><span class="header-section-number">7.9.1.3</span> Actual Best Elapsed Time Rebasing</h4>
<p>The <em>full_splits_wide</em> dataframe contains the elapsed times for each driver at each split so we can summarise the long form of that data to get the best actual recorded elapsed times:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="working-with-split-times.html#cb336-1" aria-hidden="true" tabindex="-1"></a>actual_ultimate <span class="ot">=</span> full_splits_wide <span class="sc">%&gt;%</span> </span>
<span id="cb336-2"><a href="working-with-split-times.html#cb336-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">select</span>(code, <span class="fu">all_of</span>(split_names)) <span class="sc">%&gt;%</span> </span>
<span id="cb336-3"><a href="working-with-split-times.html#cb336-3" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># Make long</span></span>
<span id="cb336-4"><a href="working-with-split-times.html#cb336-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">as.character</span>(split_names)),</span>
<span id="cb336-5"><a href="working-with-split-times.html#cb336-5" aria-hidden="true" tabindex="-1"></a>                             code) <span class="sc">%&gt;%</span></span>
<span id="cb336-6"><a href="working-with-split-times.html#cb336-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">pivot_longer</span>(<span class="fu">as.character</span>(split_names),</span>
<span id="cb336-7"><a href="working-with-split-times.html#cb336-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">names_to =</span> <span class="st">&quot;splitname&quot;</span>,</span>
<span id="cb336-8"><a href="working-with-split-times.html#cb336-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">values_to =</span> <span class="st">&quot;sectionDurationS&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb336-9"><a href="working-with-split-times.html#cb336-9" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">group_by</span>(splitname) <span class="sc">%&gt;%</span></span>
<span id="cb336-10"><a href="working-with-split-times.html#cb336-10" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">summarise</span>(<span class="at">actualUltimate =</span> <span class="fu">min</span>(sectionDurationS,</span>
<span id="cb336-11"><a href="working-with-split-times.html#cb336-11" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb336-12"><a href="working-with-split-times.html#cb336-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-13"><a href="working-with-split-times.html#cb336-13" aria-hidden="true" tabindex="-1"></a>actual_ultimate</span></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   splitname actualUltimate
##   &lt;chr&gt;              &lt;dbl&gt;
## 1 split_1             158.
## 2 split_2             267.
## 3 split_3             464.
## 4 split_4             681.
## 5 split_5             782.
## 6 split_N             834.</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="working-with-split-times.html#cb338-1" aria-hidden="true" tabindex="-1"></a>ultimate_splits_long<span class="sc">$</span>actual <span class="ot">=</span> actual_ultimate<span class="sc">$</span>actualUltimate</span>
<span id="cb338-2"><a href="working-with-split-times.html#cb338-2" aria-hidden="true" tabindex="-1"></a>ultimate_splits_long</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   splitname ultimate ultimateElapsed actual
##   &lt;chr&gt;        &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;
## 1 split_1      158.             158.   158.
## 2 split_2      109.             266.   267.
## 3 split_3      196.             463.   464.
## 4 split_4      217.             680.   681.
## 5 split_5       98.4            778.   782.
## 6 split_N       52.4            830.   834.</code></pre>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="working-with-split-times.html#cb340-1" aria-hidden="true" tabindex="-1"></a>ultimate_wide_actual <span class="ot">=</span> <span class="fu">ultimate_widen</span>(ultimate_splits_long,</span>
<span id="cb340-2"><a href="working-with-split-times.html#cb340-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&#39;actual&#39;</span>,</span>
<span id="cb340-3"><a href="working-with-split-times.html#cb340-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">&#39;ultimate&#39;</span>)</span>
<span id="cb340-4"><a href="working-with-split-times.html#cb340-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb340-5"><a href="working-with-split-times.html#cb340-5" aria-hidden="true" tabindex="-1"></a>ultimate_wide_actual</span></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##   split_1 split_2 split_3 split_4 split_5 split_N code    
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   
## 1    158.    267.    464.    681.    782.    834. ultimate</code></pre>
<p>And then rebase:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="working-with-split-times.html#cb342-1" aria-hidden="true" tabindex="-1"></a>full_splits_wide <span class="sc">%&gt;%</span> </span>
<span id="cb342-2"><a href="working-with-split-times.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ultimate_rebaser</span>(ultimate_wide_actual, split_names, <span class="st">&#39;ultimate&#39;</span>)</span></code></pre></div>
<pre><code>##        code split_1 split_2 split_3 split_4 split_5 split_N
## 1       OGI     4.2     5.0     7.5     9.2     7.6     7.5
## 2       EVA     4.8     6.4     8.5    10.9    10.8    11.3
## 3       NEU     1.6     1.3     2.0     1.5     1.1     1.0
## 4       ROV     2.1     3.3     4.5     5.4     5.3     5.7
## 5       KAT     3.9     3.0     6.0     8.3     8.3     8.7
## 6       GRE     8.3    11.0    15.5    19.2    18.8    18.9
## 7       TÄN     0.0     0.0     0.0     0.0     0.0     0.0
## 8       SUN     4.3     7.2    10.5    13.0    12.6    12.4
## 9       BRE     0.9     3.0     7.4     7.2     6.9     7.4
## 10      SOL     6.1     7.8     7.5     7.1     5.1     4.6
## 11      LOU     3.9     5.2     7.8    11.5     9.9     9.8
## 12      TUO     7.7    13.3    20.9    28.9    28.7    29.9
## 13      BER  8621.3      NA      NA      NA  7997.2   600.0
## 14      MIK     7.2    14.8    24.5    33.0    35.8    37.4
## 15      FOU    13.4    23.4    38.5    47.4    51.0    54.2
## 16      BRY    12.9    20.7    32.0    55.8    59.8    62.7
## 17      JOH    25.6    43.0    70.9    91.5   100.5   106.3
## 18      LAP     8.1    15.8    23.5    30.7    33.3    35.2
## 19      VEI    12.1    21.2    32.0    45.9    49.5    52.2
## 20      GRY    11.1    19.0    29.5    39.6    42.7    45.1
## 21      LIN    14.2    24.7    42.0    58.0    63.0    68.0
## 22      PRO    18.6    32.5    55.0    77.9    84.4    89.2
## 23      ASU    13.8    21.6    34.4    44.1    48.8    52.2
## 24      LIN    10.2    18.2    31.5    42.9    48.0    51.1
## 25      HEI    12.9    23.9    42.3    56.4    61.7    65.7
## 26      PIE    13.4    25.5    42.5    59.5    65.3    68.4
## 27      KRI    15.3    25.9    41.0    56.3    61.1    64.4
## 28      EKS    12.2    21.8    37.0    49.4    53.3    56.5
## 29      KAU    11.5    19.2    31.4    42.5    46.7    49.5
## 30      JEE    18.2    30.7    51.8    73.3    79.1    82.6
## 31      RUO    18.0    30.0    50.0    68.5    75.8    81.2
## 32      KES    22.3    39.0    64.3    84.1    90.7    95.9
## 33      SKA    19.8    33.8    72.5    92.4   100.7   105.3
## 34      KES    27.4    51.7    88.3   117.8   128.2   134.4
## 35      KOI    26.6    46.9    78.4   104.2   112.6   118.4
## 36      ZAL    19.4    33.9    57.9    77.2    83.4    89.1
## 37      STU    31.1    56.3    93.3   126.9   135.9   142.3
## 38      AL-    25.5    42.2    85.0   113.5   122.6   129.2
## 39      THU    24.8    42.9      NA      NA      NA   649.5
## 40      SOL    21.2    36.9    66.9    89.9    99.0   105.9
## 41      JUR    23.7    42.5    66.0    89.6    97.7   102.1
## 42      VII    29.6    55.9    92.0   123.2   133.4   140.3
## 43      MIE    39.2    72.9   122.5   173.3   188.1   197.3
## 44      DIA    51.8    91.0   151.5   218.6   237.6   250.3
## 45      CHW    33.8    57.7    95.0   130.3   141.0   147.6
## 46      HAN    24.0    40.2    65.5    84.9    97.1   103.2
## 47      HOE    34.4    61.2   102.5   137.3   147.9   155.5
## 48      CRA    32.1    56.9   100.9   133.6   143.1   149.2
## 49      PIE    35.9    67.8   115.5   160.0   175.1   185.9
## 50      KAR    50.5    84.5   139.0   188.8   204.0   214.9
## 51      JOO    32.1    54.2    96.6   130.6   149.1   159.8
## 52      PAJ    26.4    43.2    78.5   104.2   117.8   126.7
## 53      HER    32.8    54.8    98.4   139.2   164.8   178.0
## 54      KOR    39.2    67.2   114.9   157.2   179.9   192.8
## 55 ultimate     0.0     0.0     0.0     0.0     0.0     0.0</code></pre>
<p>In this case, there is at least one zero value per split corresponding to the drive(s) who recorded the fastest elapsed time up to each split point.</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualising-stage-pace.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualising-pace-across-splits.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/edit/master/split-times.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/blob/master/split-times.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
