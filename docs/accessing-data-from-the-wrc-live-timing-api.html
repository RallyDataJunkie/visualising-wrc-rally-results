<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Accessing Data from the WRC Live Timing API | Visualising WRC Rally Timing and Results Data</title>
  <meta name="description" content="An introduction to visualising timing and results data for WRC rally events." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Accessing Data from the WRC Live Timing API | Visualising WRC Rally Timing and Results Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Accessing Data from the WRC Live Timing API | Visualising WRC Rally Timing and Results Data" />
  
  <meta name="twitter:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction.html"/>
<link rel="next" href="visualising-results-for-a-single-stage.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/htmlwidgets-1.5.3.9000/htmlwidgets.js"></script>
<script src="libs/formattable_widget-binding-0.2.1/formattable_widget.js"></script>
<link href="libs/jquery-sparkline-2.1.2/jquery.sparkline.css" rel="stylesheet" />
<script src="libs/jquery-sparkline-2.1.2/jquery.sparkline.js"></script>
<script src="libs/sparkline-binding-2.0/sparkline.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Visualising WRC Rally Results and Timing Data</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html"><i class="fa fa-check"></i><b>2</b> Accessing Data from the WRC Live Timing API</a>
<ul>
<li class="chapter" data-level="2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#current-season-rallies"><i class="fa fa-check"></i><b>2.1</b> Current Season Rallies</a></li>
<li class="chapter" data-level="2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#itinerary-lookup"><i class="fa fa-check"></i><b>2.2</b> Itinerary Lookup</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#leg-sections"><i class="fa fa-check"></i><b>2.2.1</b> Leg Sections</a></li>
<li class="chapter" data-level="2.2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#time-controls"><i class="fa fa-check"></i><b>2.2.2</b> Time Controls</a></li>
<li class="chapter" data-level="2.2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-details"><i class="fa fa-check"></i><b>2.2.3</b> Stage Details</a></li>
<li class="chapter" data-level="2.2.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#road-order-start-lists"><i class="fa fa-check"></i><b>2.2.4</b> Road Order Start Lists</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#competitor-details"><i class="fa fa-check"></i><b>2.3</b> Competitor Details</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#looking-up-entries-by-group"><i class="fa fa-check"></i><b>2.3.1</b> Looking Up Entries by Group</a></li>
<li class="chapter" data-level="2.3.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#driver-codriver-details"><i class="fa fa-check"></i><b>2.3.2</b> Driver &amp; Codriver Details</a></li>
<li class="chapter" data-level="2.3.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#summarising-essential-entry-data"><i class="fa fa-check"></i><b>2.3.3</b> Summarising Essential Entry Data</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#penalties-and-retirements"><i class="fa fa-check"></i><b>2.4</b> Penalties and Retirements</a></li>
<li class="chapter" data-level="2.5" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#results-and-stage-winner"><i class="fa fa-check"></i><b>2.5</b> Results and Stage Winner</a></li>
<li class="chapter" data-level="2.6" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-result"><i class="fa fa-check"></i><b>2.6</b> Stage Result</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-results-for-multiple-stages"><i class="fa fa-check"></i><b>2.6.1</b> Getting Stage Results for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-times"><i class="fa fa-check"></i><b>2.7</b> Stage Times</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.1</b> Getting Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.2</b> Getting Wide Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-positions"><i class="fa fa-check"></i><b>2.7.3</b> Getting Wide Stage Positions</a></li>
<li class="chapter" data-level="2.7.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-generic-wide-dataframes"><i class="fa fa-check"></i><b>2.7.4</b> Getting Generic Wide Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#split-times"><i class="fa fa-check"></i><b>2.8</b> Split Times</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#driver-split-times-detail"><i class="fa fa-check"></i><b>2.8.1</b> Driver Split Times Detail</a></li>
<li class="chapter" data-level="2.8.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#wide-driver-split-times"><i class="fa fa-check"></i><b>2.8.2</b> Wide Driver Split Times</a></li>
<li class="chapter" data-level="2.8.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#multiple-stage-long-splits-data"><i class="fa fa-check"></i><b>2.8.3</b> Multiple Stage Long Splits Data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html"><i class="fa fa-check"></i><b>3</b> Visualising Results for a Single Stage</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#load-base-data"><i class="fa fa-check"></i><b>3.1</b> Load Base Data</a></li>
<li class="chapter" data-level="3.2" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#get-stage-results-data"><i class="fa fa-check"></i><b>3.2</b> Get Stage Results Data</a></li>
<li class="chapter" data-level="3.3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#previewing-stage-results-data"><i class="fa fa-check"></i><b>3.3</b> Previewing Stage Results Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-entry-metadata"><i class="fa fa-check"></i><b>3.3.1</b> Adding Entry Metadata</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-stage-metadata-to-table-captions"><i class="fa fa-check"></i><b>3.4</b> Adding Stage Metadata to Table Captions</a></li>
<li class="chapter" data-level="3.5" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-stage-results"><i class="fa fa-check"></i><b>3.5</b> Colour Highlighting Stage Results</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#heatmap-style-column-cell-backgrounds"><i class="fa fa-check"></i><b>3.5.1</b> Heatmap Style Column Cell Backgrounds</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#an-aside-calculating-diff-and-gap-times"><i class="fa fa-check"></i><b>3.6</b> An Aside — Calculating DIFF and GAP times</a></li>
<li class="chapter" data-level="3.7" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#rebasing-stage-results"><i class="fa fa-check"></i><b>3.7</b> Rebasing Stage Results</a></li>
<li class="chapter" data-level="3.8" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-rebased-values"><i class="fa fa-check"></i><b>3.8</b> Colour Highlighting Rebased Values</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html"><i class="fa fa-check"></i><b>4</b> Visualising Results for Multiple Stages</a>
<ul>
<li class="chapter" data-level="4.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#load-base-data-1"><i class="fa fa-check"></i><b>4.1</b> Load Base Data</a></li>
<li class="chapter" data-level="4.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-mutliple-stage-results"><i class="fa fa-check"></i><b>4.2</b> Retrieving Mutliple Stage Results</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-overall-position-data"><i class="fa fa-check"></i><b>4.2.1</b> Reshaping Overall Position Data</a></li>
<li class="chapter" data-level="4.2.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-overall-rally-time-data"><i class="fa fa-check"></i><b>4.2.2</b> Reshaping Overall Rally Time Data</a></li>
<li class="chapter" data-level="4.2.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-time-to-first-data"><i class="fa fa-check"></i><b>4.2.3</b> Reshaping Time to First Data</a></li>
<li class="chapter" data-level="4.2.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#mapping-stage-and-driver-identifiers-to-meaningful-labels"><i class="fa fa-check"></i><b>4.2.4</b> Mapping Stage and Driver Identifiers to Meaningful Labels</a></li>
<li class="chapter" data-level="4.2.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#rebasing-overall-times"><i class="fa fa-check"></i><b>4.2.5</b> Rebasing Overall Times</a></li>
<li class="chapter" data-level="4.2.6" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#finding-changes-in-rebased-gaps-across-stages"><i class="fa fa-check"></i><b>4.2.6</b> Finding Changes in Rebased Gaps Across Stages</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-overall-results"><i class="fa fa-check"></i><b>4.3</b> Visualising Overall Results</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-first-position"><i class="fa fa-check"></i><b>4.3.1</b> Visualising First Position</a></li>
<li class="chapter" data-level="4.3.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-position-changes-over-a-rally"><i class="fa fa-check"></i><b>4.3.2</b> Visualising Position Changes Over a Rally</a></li>
<li class="chapter" data-level="4.3.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-position-gainslosses"><i class="fa fa-check"></i><b>4.3.3</b> Visualising Position Gains/Losses</a></li>
<li class="chapter" data-level="4.3.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#per-driver-position-charts"><i class="fa fa-check"></i><b>4.3.4</b> Per Driver Position Charts</a></li>
<li class="chapter" data-level="4.3.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-time-to-first"><i class="fa fa-check"></i><b>4.3.5</b> Visualising Time to First</a></li>
<li class="chapter" data-level="4.3.6" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-rebased-gaps"><i class="fa fa-check"></i><b>4.3.6</b> Visualising Rebased Gaps</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-stage-times-and-results"><i class="fa fa-check"></i><b>4.4</b> Retrieving Stage Times and Results</a></li>
<li class="chapter" data-level="4.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-stage-times"><i class="fa fa-check"></i><b>4.5</b> Visualising Stage Times</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#stage-position-sparklines"><i class="fa fa-check"></i><b>4.5.1</b> Stage Position Sparklines</a></li>
<li class="chapter" data-level="4.5.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#gap-to-stage-winner-sparklines"><i class="fa fa-check"></i><b>4.5.2</b> Gap to Stage Winner Sparklines</a></li>
<li class="chapter" data-level="4.5.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#stage-position-charts"><i class="fa fa-check"></i><b>4.5.3</b> Stage Position Charts</a></li>
<li class="chapter" data-level="4.5.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#individual-stage-position-charts"><i class="fa fa-check"></i><b>4.5.4</b> Individual Stage position Charts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html"><i class="fa fa-check"></i><b>5</b> Finding Pace Across Stages</a>
<ul>
<li class="chapter" data-level="5.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#load-base-data-2"><i class="fa fa-check"></i><b>5.1</b> Load Base Data</a></li>
<li class="chapter" data-level="5.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#defining-pace"><i class="fa fa-check"></i><b>5.2</b> Defining Pace</a></li>
<li class="chapter" data-level="5.3" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-stage-pace"><i class="fa fa-check"></i><b>5.3</b> Calculating Stage Pace</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-a-single-stage"><i class="fa fa-check"></i><b>5.3.1</b> Calculating Pace for a Single Stage</a></li>
<li class="chapter" data-level="5.3.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-multiple-stages"><i class="fa fa-check"></i><b>5.3.2</b> Calculating Pace for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#rebasing-stage-pace"><i class="fa fa-check"></i><b>5.4</b> Rebasing Stage Pace</a></li>
<li class="chapter" data-level="5.5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#the-ultimate-rally"><i class="fa fa-check"></i><b>5.5</b> The Ultimate Rally</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html"><i class="fa fa-check"></i><b>6</b> Visualising Stage Pace</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#load-base-data-3"><i class="fa fa-check"></i><b>6.1</b> Load Base Data</a></li>
<li class="chapter" data-level="6.2" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#pace-maps"><i class="fa fa-check"></i><b>6.2</b> Pace Maps</a></li>
<li class="chapter" data-level="6.3" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#a-pace-map-function"><i class="fa fa-check"></i><b>6.3</b> A Pace Map Function</a></li>
<li class="chapter" data-level="6.4" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#off-the-pace-charts"><i class="fa fa-check"></i><b>6.4</b> Off-the-Pace Charts</a></li>
<li class="chapter" data-level="6.5" data-path="visualising-stage-pace.html"><a href="visualising-stage-pace.html#comparing-pace-across-stages"><i class="fa fa-check"></i><b>6.5</b> Comparing Pace Across Stages</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="working-with-split-times.html"><a href="working-with-split-times.html"><i class="fa fa-check"></i><b>7</b> Working With Split Times</a>
<ul>
<li class="chapter" data-level="7.1" data-path="working-with-split-times.html"><a href="working-with-split-times.html#load-base-data-4"><i class="fa fa-check"></i><b>7.1</b> Load Base Data</a></li>
<li class="chapter" data-level="7.2" data-path="working-with-split-times.html"><a href="working-with-split-times.html#get-splits-data"><i class="fa fa-check"></i><b>7.2</b> Get Splits Data</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="working-with-split-times.html"><a href="working-with-split-times.html#split-locations"><i class="fa fa-check"></i><b>7.2.1</b> Split Locations</a></li>
<li class="chapter" data-level="7.2.2" data-path="working-with-split-times.html"><a href="working-with-split-times.html#mapping-split-codes-to-split-numbers"><i class="fa fa-check"></i><b>7.2.2</b> Mapping Split Codes to Split Numbers</a></li>
<li class="chapter" data-level="7.2.3" data-path="working-with-split-times.html"><a href="working-with-split-times.html#split-times-1"><i class="fa fa-check"></i><b>7.2.3</b> Split Times</a></li>
<li class="chapter" data-level="7.2.4" data-path="working-with-split-times.html"><a href="working-with-split-times.html#wide-driver-split-times-1"><i class="fa fa-check"></i><b>7.2.4</b> Wide Driver Split Times</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="working-with-split-times.html"><a href="working-with-split-times.html#rebasing-split-times"><i class="fa fa-check"></i><b>7.3</b> Rebasing Split Times</a></li>
<li class="chapter" data-level="7.4" data-path="working-with-split-times.html"><a href="working-with-split-times.html#visualising-rebased-split-times-using-sparklines"><i class="fa fa-check"></i><b>7.4</b> Visualising Rebased Split Times Using Sparklines</a></li>
<li class="chapter" data-level="7.5" data-path="working-with-split-times.html"><a href="working-with-split-times.html#finding-the-rank-position-at-each-split-point"><i class="fa fa-check"></i><b>7.5</b> Finding the Rank Position at Each Split Point</a></li>
<li class="chapter" data-level="7.6" data-path="working-with-split-times.html"><a href="working-with-split-times.html#finding-split-section-durations"><i class="fa fa-check"></i><b>7.6</b> Finding Split Section Durations</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="working-with-split-times.html"><a href="working-with-split-times.html#finding-split-section-ranks"><i class="fa fa-check"></i><b>7.6.1</b> Finding Split Section Ranks</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="working-with-split-times.html"><a href="working-with-split-times.html#using-sparklines-to-visdualise-split-time-differences"><i class="fa fa-check"></i><b>7.7</b> Using Sparklines to Visdualise Split Time Differences</a></li>
<li class="chapter" data-level="7.8" data-path="working-with-split-times.html"><a href="working-with-split-times.html#adding-overall-stage-time-to-the-split-times"><i class="fa fa-check"></i><b>7.8</b> Adding Overall Stage Time to the Split Times</a></li>
<li class="chapter" data-level="7.9" data-path="working-with-split-times.html"><a href="working-with-split-times.html#calculating-the-ultimate-stage-from-ultimate-split-times"><i class="fa fa-check"></i><b>7.9</b> Calculating the Ultimate Stage from Ultimate Split Times</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="working-with-split-times.html"><a href="working-with-split-times.html#rebasing-to-ultimate-split-times"><i class="fa fa-check"></i><b>7.9.1</b> Rebasing to Ultimate Split Times</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html"><i class="fa fa-check"></i><b>8</b> Visualising Pace Across Splits</a>
<ul>
<li class="chapter" data-level="8.1" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#load-base-data-5"><i class="fa fa-check"></i><b>8.1</b> Load Base Data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#obtaining-split-distances"><i class="fa fa-check"></i><b>8.1.1</b> Obtaining Split Distances</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#calculating-splits-pace"><i class="fa fa-check"></i><b>8.2</b> Calculating Splits Pace</a></li>
<li class="chapter" data-level="8.3" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#visualising-the-splits-pace"><i class="fa fa-check"></i><b>8.3</b> Visualising the Splits Pace</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#pace-over-each-section"><i class="fa fa-check"></i><b>8.3.1</b> Pace Over Each Section</a></li>
<li class="chapter" data-level="8.3.2" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#splits-sections-pace-maps"><i class="fa fa-check"></i><b>8.3.2</b> Splits Sections Pace Maps</a></li>
<li class="chapter" data-level="8.3.3" data-path="visualising-pace-across-splits.html"><a href="visualising-pace-across-splits.html#off-the-pace-splits-pace-mapping"><i class="fa fa-check"></i><b>8.3.3</b> Off-the-Pace Splits Pace Mapping</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://rallydatajunkie.com/"><em>RallyDataJunkie.com</em></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Timing and Results Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="accessing-data-from-the-wrc-live-timing-api" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Accessing Data from the WRC Live Timing API</h1>
<p>We can get rally details, timing and results data from the WRC live timing service JSON API.</p>
<div id="current-season-rallies" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Current Season Rallies</h2>
<p>To start with, let’s see what rallies are scheduled for the current, active season. The <code>jsonlite::fromJSON()</code> will retrieve a JSON (<em>JavaScript Object Notation</em>) file from a URL and attempt to unpack it into an <em>R</em> dataframe:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-5" aria-hidden="true" tabindex="-1"></a>season_url <span class="ot">=</span> <span class="st">&quot;https://api.wrc.com/contel-page/83388/calendar/active-season/&quot;</span></span>
<span id="cb1-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-6" aria-hidden="true" tabindex="-1"></a>get_active_season <span class="ot">=</span> <span class="cf">function</span>(<span class="at">active_season_url=</span>season_url) {</span>
<span id="cb1-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-7" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(active_season_url)<span class="sc">$</span>rallyEvents<span class="sc">$</span>items</span>
<span id="cb1-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-10" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">get_active_season</span>()</span>
<span id="cb1-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the column names of the resulting dataframe</span></span>
<span id="cb1-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(s)</span></code></pre></div>
<pre><code>##  [1] &quot;id&quot;         &quot;name&quot;       &quot;active&quot;     &quot;jwrc&quot;       &quot;deleted&quot;   
##  [6] &quot;rally&quot;      &quot;status&quot;     &quot;pageInfo&quot;   &quot;pageResult&quot; &quot;eventDays&quot; 
## [11] &quot;winner&quot;</code></pre>
<p>Let’s preview the contents of a couple of those columns:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The tidyr / magrittr pipe syntax makes things easier to read</span></span>
<span id="cb3-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb3-2" aria-hidden="true" tabindex="-1"></a>s <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&#39;id&#39;</span>, <span class="st">&#39;name&#39;</span>)) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##     id                                           name
## 1 1695                         WRC Rallye Monte-Carlo
## 2 1745 WRC Arctic Rally Finland Powered by CapitalBox
## 3 1696                              WRC Croatia Rally
## 4 1698                 WRC Vodafone Rally de Portugal
## 5 1704                      WRC Rally Italia Sardegna
## 6 1709                         WRC Safari Rally Kenya</code></pre>
<p>We can search the <em>name</em> column to find the unique identifier value for a particular event:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb5-1" aria-hidden="true" tabindex="-1"></a>eventId <span class="ot">=</span> s[s[<span class="st">&#39;name&#39;</span>]<span class="sc">==</span><span class="st">&#39;WRC Arctic Rally Finland Powered by CapitalBox&#39;</span>,<span class="st">&#39;id&#39;</span>]</span>
<span id="cb5-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb5-3" aria-hidden="true" tabindex="-1"></a>eventId</span></code></pre></div>
<pre><code>## [1] 1745</code></pre>
<p>Or we can be more generic with a regular expression lookup:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb7-1" aria-hidden="true" tabindex="-1"></a>get_eventId_from_name <span class="ot">=</span> <span class="cf">function</span>(season, name){</span>
<span id="cb7-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  season[<span class="fu">str_detect</span>(season<span class="sc">$</span>name,</span>
<span id="cb7-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb7-3" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">regex</span>(name, <span class="at">ignore_case =</span> T)), <span class="st">&#39;id&#39;</span>]</span>
<span id="cb7-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb7-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">get_eventId_from_name</span>(s, <span class="st">&#39;arctic&#39;</span>)</span></code></pre></div>
<pre><code>## [1] 1745</code></pre>
</div>
<div id="itinerary-lookup" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Itinerary Lookup</h2>
<p>We can make another call to the WRC API to look up the itinerary for the event. Each leg of the event corresponds to a particular day:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-1" aria-hidden="true" tabindex="-1"></a>results_api <span class="ot">=</span> <span class="st">&#39;https://api.wrc.com/results-api&#39;</span></span>
<span id="cb9-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-3" aria-hidden="true" tabindex="-1"></a>get_itinerary <span class="ot">=</span> <span class="cf">function</span>(eventId) {</span>
<span id="cb9-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(<span class="fu">paste0</span>(results_api,<span class="st">&quot;/rally-event/&quot;</span>,</span>
<span id="cb9-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-5" aria-hidden="true" tabindex="-1"></a>                            eventId, <span class="st">&quot;/itinerary&quot;</span>))<span class="sc">$</span>itineraryLegs</span>
<span id="cb9-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-8" aria-hidden="true" tabindex="-1"></a>itinerary <span class="ot">=</span> <span class="fu">get_itinerary</span>(eventId)</span>
<span id="cb9-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb9-10" aria-hidden="true" tabindex="-1"></a>itinerary <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>itinerarySections)</span></code></pre></div>
<pre><code>##   itineraryLegId itineraryId startListId                   name    legDate
## 1            320         266         523   Friday 26th February 2021-02-26
## 2            319         266         524 Saturday 27th February 2021-02-27
## 3            318         266         525   Sunday 28th February 2021-02-28
##   order    status
## 1     1 Completed
## 2     2 Completed
## 3     3   Running</code></pre>
<p>The <em>itinerarySections</em> columns dataframes describing details of each leg.</p>
<div id="leg-sections" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Leg Sections</h3>
<p>Within each leg, the itinerary provides information about each section (that is, each “loop”) of the rally. This information is retrieved in form of a dataframe in a standard format. We can use the base <em>R</em> <code>do.call()</code> to call the <code>rbind()</code> function against each row of the dataframe and bind all the dataframes in a specified column into a single dataframe:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb11-1" aria-hidden="true" tabindex="-1"></a>get_sections <span class="ot">=</span> <span class="cf">function</span>(itinerary){</span>
<span id="cb11-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  sections <span class="ot">=</span> <span class="fu">do.call</span>(rbind, itinerary<span class="sc">$</span>itinerarySections)</span>
<span id="cb11-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb11-3" aria-hidden="true" tabindex="-1"></a>  sections</span>
<span id="cb11-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb11-6" aria-hidden="true" tabindex="-1"></a>sections <span class="ot">=</span> <span class="fu">get_sections</span>(itinerary)</span>
<span id="cb11-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb11-8" aria-hidden="true" tabindex="-1"></a>sections <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(controls, stages))</span></code></pre></div>
<pre><code>##   itinerarySectionId itineraryLegId order      name
## 1                733            320     1 Section 1
## 2                734            320     2 Section 2
## 3                735            319     3 Section 3
## 4                736            319     4 Section 4
## 5                737            318     5 Section 5
## 6                738            318     6 Section 6</code></pre>
<p>In the sections dataframe we have one row per section. Two of the columns, `<em>controls</em> and <em>stages</em> each use dataframes to “nest” subdataframes within each row.</p>
<p>For example, here’s one of the <em>controls</em> dataframes that describes timing controls:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb13-1" aria-hidden="true" tabindex="-1"></a>sections<span class="sc">$</span>controls[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##   controlId eventId stageId         type code                        location
## 1      7527     170      NA  TimeControl  TC0 Start ( Santasport, Rovaniemi )
## 2      7564     170    1747  TimeControl  TC1                     Sarriojärvi
## 3      7563     170    1747   StageStart  SS1         Sarriojärvi 1 (Live TV)
## 4      7562     170    1747 FlyingFinish  SF1         Sarriojärvi 1 (Live TV)
## 5      7531     170      NA    RegroupIn TC1A                      Regroup IN
##   timingPrecision distance targetDuration targetDurationMs firstCarDueDateTime
## 1          Minute       NA           &lt;NA&gt;               NA 2021-02-26T11:30:00
## 2          Minute    77.79       01:32:00          5520000 2021-02-26T13:02:00
## 3          Minute    31.05       00:06:00           360000 2021-02-26T13:08:00
## 4           Tenth       NA           &lt;NA&gt;               NA                &lt;NA&gt;
## 5          Minute    31.57       01:20:00          4800000 2021-02-26T14:28:00
##    firstCarDueDateTimeLocal    status controlPenalties       roundingPolicy
## 1 2021-02-26T13:30:00+02:00 Completed              All           NoRounding
## 2 2021-02-26T15:02:00+02:00 Completed              All           NoRounding
## 3 2021-02-26T15:08:00+02:00 Completed             None RoundToClosestMinute
## 4                      &lt;NA&gt; Completed             None           NoRounding
## 5 2021-02-26T16:28:00+02:00 Completed              All           NoRounding
##   locked
## 1   TRUE
## 2   TRUE
## 3   TRUE
## 4   TRUE
## 5   TRUE</code></pre>
<p>And an example of a dataframe from the first row of the <em>stages</em> column:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb15-1" aria-hidden="true" tabindex="-1"></a>sections<span class="sc">$</span>stages[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>##   stageId eventId number                    name distance    status
## 1    1747     170      1 Sarriojärvi 1 (Live TV)    31.05 Completed
##      stageType timingPrecision locked code
## 1 SpecialStage           Tenth   TRUE  SS1</code></pre>
</div>
<div id="time-controls" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Time Controls</h3>
<p>We can look up information about each time control from data provided as part of the itinerary lookup using the same trick as before to “unroll” the contents of each dataframe in a specified column into a single dataframe.</p>
<p>An alternative to the <code>do.call()</code> approach is to use a tidy approach and use the <code>dplyr::bind_rows()</code> function on the <code>sections$controls</code> column values via a pipe. We can add a reference to the original section ID by naming each row in the <em>controls</em> column with the <em>itinerarySectionId</em> value and then ensuring an identifier column is defined when we bind the dataframes:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-1" aria-hidden="true" tabindex="-1"></a>get_controls <span class="ot">=</span> <span class="cf">function</span>(sections){</span>
<span id="cb17-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Name each row in the list of dataframes we want to bind</span></span>
<span id="cb17-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(sections<span class="sc">$</span>controls) <span class="ot">=</span> sections<span class="sc">$</span>itinerarySectionId</span>
<span id="cb17-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  controls <span class="ot">=</span> sections<span class="sc">$</span>controls <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure that we create an identifier column (uses list names)</span></span>
<span id="cb17-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(<span class="at">.id=</span><span class="st">&#39;itinerarySectionId&#39;</span>)</span>
<span id="cb17-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-9" aria-hidden="true" tabindex="-1"></a>  controls</span>
<span id="cb17-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-12" aria-hidden="true" tabindex="-1"></a>controls <span class="ot">=</span> <span class="fu">get_controls</span>(sections)</span>
<span id="cb17-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb17-14" aria-hidden="true" tabindex="-1"></a>controls <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   itinerarySectionId controlId eventId stageId        type code
## 1                733      7527     170      NA TimeControl  TC0
## 2                733      7564     170    1747 TimeControl  TC1
##                          location timingPrecision distance targetDuration
## 1 Start ( Santasport, Rovaniemi )          Minute       NA           &lt;NA&gt;
## 2                     Sarriojärvi          Minute    77.79       01:32:00
##   targetDurationMs firstCarDueDateTime  firstCarDueDateTimeLocal    status
## 1               NA 2021-02-26T11:30:00 2021-02-26T13:30:00+02:00 Completed
## 2          5520000 2021-02-26T13:02:00 2021-02-26T15:02:00+02:00 Completed
##   controlPenalties roundingPolicy locked
## 1              All     NoRounding   TRUE
## 2              All     NoRounding   TRUE</code></pre>
</div>
<div id="stage-details" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Stage Details</h3>
<p>We can pull stage details from the dataframes contained in the <code>sections</code> dataframe from the itinerary lookup:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-1" aria-hidden="true" tabindex="-1"></a>get_stages <span class="ot">=</span> <span class="cf">function</span>(sections){</span>
<span id="cb19-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Name each row in the list of dataframes we want to bind</span></span>
<span id="cb19-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(sections<span class="sc">$</span>stages) <span class="ot">=</span> sections<span class="sc">$</span>itinerarySectionId</span>
<span id="cb19-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  stages <span class="ot">=</span> sections<span class="sc">$</span>stages <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure that we create an identifier column (uses list names)</span></span>
<span id="cb19-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(<span class="at">.id=</span><span class="st">&#39;itinerarySectionId&#39;</span>)</span>
<span id="cb19-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-9" aria-hidden="true" tabindex="-1"></a>  stages</span>
<span id="cb19-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-12" aria-hidden="true" tabindex="-1"></a>stages <span class="ot">=</span> <span class="fu">get_stages</span>(sections)</span>
<span id="cb19-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb19-14" aria-hidden="true" tabindex="-1"></a>stages <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##   itinerarySectionId stageId eventId number                    name distance
## 1                733    1747     170      1 Sarriojärvi 1 (Live TV)    31.05
## 2                734    1743     170      2 Sarriojärvi 2 (Live TV)    31.05
## 3                735    1750     170      3            Mustalampi 1    24.43
## 4                735    1751     170      4 Kaihuavaara 1 (Live TV)    19.91
## 5                735    1748     170      5             Siikakämä 1    27.68
## 6                736    1745     170      6            Mustalampi 2    24.43
##      status    stageType timingPrecision locked code
## 1 Completed SpecialStage           Tenth   TRUE  SS1
## 2 Completed SpecialStage           Tenth   TRUE  SS2
## 3 Completed SpecialStage           Tenth   TRUE  SS3
## 4 Completed SpecialStage           Tenth   TRUE  SS4
## 5 Completed SpecialStage           Tenth   TRUE  SS5
## 6 Completed SpecialStage           Tenth   TRUE  SS6</code></pre>
<p>We can get a list of stage IDs from the <code>stageId</code> column (<code>stages$stageId</code>):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb21-1" aria-hidden="true" tabindex="-1"></a>get_stage_list <span class="ot">=</span> <span class="cf">function</span>(stages){</span>
<span id="cb21-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  stage_list <span class="ot">=</span> stages<span class="sc">$</span>stageId</span>
<span id="cb21-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  stage_list</span>
<span id="cb21-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb21-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">get_stage_list</span>(stages)</span></code></pre></div>
<pre><code>##  [1] 1747 1743 1750 1751 1748 1745 1744 1742 1746 1749</code></pre>
<p>Perhaps more conveniently, we can create a lookup from code to stage ID:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/a/19265431/454773</span></span>
<span id="cb23-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-2" aria-hidden="true" tabindex="-1"></a>get_stages_lookup <span class="ot">=</span> <span class="cf">function</span>(stages,</span>
<span id="cb23-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fromCol=</span><span class="st">&#39;code&#39;</span>,  <span class="at">toCol=</span><span class="st">&#39;stageId&#39;</span>){</span>
<span id="cb23-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  stages_lookup <span class="ot">=</span> stages[[toCol]]</span>
<span id="cb23-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(stages_lookup) <span class="ot">=</span> stages[[fromCol]]</span>
<span id="cb23-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  stages_lookup</span>
<span id="cb23-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-9" aria-hidden="true" tabindex="-1"></a>stages_lookup <span class="ot">=</span> <span class="fu">get_stages_lookup</span>(stages)</span>
<span id="cb23-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb23-10" aria-hidden="true" tabindex="-1"></a>stages_lookup</span></code></pre></div>
<pre><code>##  SS1  SS2  SS3  SS4  SS5  SS6  SS7  SS8  SS9 SS10 
## 1747 1743 1750 1751 1748 1745 1744 1742 1746 1749</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lookup particular stage ID by stage code</span></span>
<span id="cb25-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#stages_lookup[[&#39;SS2&#39;]]</span></span></code></pre></div>
<p>From the <code>stages</code> table, we can get the identifier for a particular stage, either by code (for example, <em>“SS3”</em>) or by (partial) name match:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-1" aria-hidden="true" tabindex="-1"></a>ssnum <span class="ot">=</span> <span class="st">&#39;SS3&#39;</span></span>
<span id="cb26-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-3" aria-hidden="true" tabindex="-1"></a>get_stage_id <span class="ot">=</span> <span class="cf">function</span>(stages, sname, <span class="at">typ=</span><span class="st">&#39;code&#39;</span>){</span>
<span id="cb26-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># code, name</span></span>
<span id="cb26-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (typ<span class="sc">==</span><span class="st">&#39;code&#39;</span>)</span>
<span id="cb26-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-6" aria-hidden="true" tabindex="-1"></a>    stageId <span class="ot">=</span> stages[stages[typ] <span class="sc">==</span> sname, <span class="st">&#39;stageId&#39;</span>]</span>
<span id="cb26-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb26-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-8" aria-hidden="true" tabindex="-1"></a>    stageId <span class="ot">=</span> stages[stringr<span class="sc">::</span><span class="fu">str_detect</span>(stages[[typ]], sname), <span class="st">&#39;stageId&#39;</span>]</span>
<span id="cb26-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  stageId</span>
<span id="cb26-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-12" aria-hidden="true" tabindex="-1"></a>stageId <span class="ot">=</span> <span class="fu">get_stage_id</span>(stages, <span class="st">&#39;Mustalampi 1&#39;</span>, <span class="st">&#39;name&#39;</span>)</span>
<span id="cb26-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb26-13" aria-hidden="true" tabindex="-1"></a>stageId</span></code></pre></div>
<pre><code>## [1] 1750</code></pre>
<p>And the stage distance and name:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-1" aria-hidden="true" tabindex="-1"></a>get_stage_info <span class="ot">=</span> <span class="cf">function</span>(stages, sid, <span class="at">typ=</span><span class="st">&#39;stageId&#39;</span>, <span class="at">clean=</span><span class="cn">TRUE</span>){</span>
<span id="cb28-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stageId, code</span></span>
<span id="cb28-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  name<span class="ot">=</span>stages[stages[typ] <span class="sc">==</span> sid, <span class="st">&#39;name&#39;</span>]</span>
<span id="cb28-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  distance<span class="ot">=</span>stages[stages[typ] <span class="sc">==</span> sid, <span class="st">&#39;distance&#39;</span>]</span>
<span id="cb28-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (clean)</span>
<span id="cb28-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-6" aria-hidden="true" tabindex="-1"></a>    stringr<span class="sc">::</span><span class="fu">str_replace</span>(name, <span class="st">&#39; (Live TV)&#39;</span>, <span class="st">&#39;&#39;</span>)</span>
<span id="cb28-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">name=</span>name, <span class="at">distance=</span>distance)</span>
<span id="cb28-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="fu">get_stage_info</span>(stages, stageId)</span></code></pre></div>
<pre><code>##           name       distance 
## &quot;Mustalampi 1&quot;        &quot;24.43&quot;</code></pre>
</div>
<div id="road-order-start-lists" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Road Order Start Lists</h3>
<p>The <em>startListId</em> can be used alongside the event ID to look up the startlist for a leg. We can order the startlist by start order:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-1" aria-hidden="true" tabindex="-1"></a>get_startlist <span class="ot">=</span> <span class="cf">function</span>(eventId, startListId) {</span>
<span id="cb30-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  startlist_url <span class="ot">=</span> <span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>,</span>
<span id="cb30-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-3" aria-hidden="true" tabindex="-1"></a>                         eventId,<span class="st">&#39;/start-list-external/&#39;</span>, startListId)</span>
<span id="cb30-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  startlist <span class="ot">=</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(startlist_url)<span class="sc">$</span>startListItems</span>
<span id="cb30-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order the startlist dataframe by start order</span></span>
<span id="cb30-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-8" aria-hidden="true" tabindex="-1"></a>  startlist <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(order)</span>
<span id="cb30-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Example startlist ID</span></span>
<span id="cb30-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Use a regular expression to find the startlist ID by day</span></span>
<span id="cb30-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-13" aria-hidden="true" tabindex="-1"></a>startListId <span class="ot">=</span> itinerary[<span class="fu">str_detect</span>(itinerary<span class="sc">$</span>name,</span>
<span id="cb30-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">regex</span>(<span class="st">&#39;Friday&#39;</span>, <span class="at">ignore_case =</span> T)),</span>
<span id="cb30-15"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-15" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;startListId&#39;</span>]</span>
<span id="cb30-16"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-17" aria-hidden="true" tabindex="-1"></a>startlist <span class="ot">=</span> <span class="fu">get_startlist</span>(eventId, startListId)</span>
<span id="cb30-18"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb30-19" aria-hidden="true" tabindex="-1"></a>startlist <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##   startListItemId startListId entryId       startDateTime
## 1           24435         523   21530 2021-02-26T11:30:00
## 2           24409         523   21531 2021-02-26T11:33:00
## 3           24410         523   21532 2021-02-26T11:36:00
## 4           24411         523   21533 2021-02-26T11:39:00
## 5           24412         523   21534 2021-02-26T11:42:00
## 6           24413         523   21535 2021-02-26T11:45:00
##          startDateTimeLocal order
## 1 2021-02-26T13:30:00+02:00     1
## 2 2021-02-26T13:33:00+02:00     2
## 3 2021-02-26T13:36:00+02:00     3
## 4 2021-02-26T13:39:00+02:00     4
## 5 2021-02-26T13:42:00+02:00     5
## 6 2021-02-26T13:45:00+02:00     6</code></pre>
<p>Looking up a startlist ID is a little fiddly:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb32-1" aria-hidden="true" tabindex="-1"></a>get_startlist_id <span class="ot">=</span> <span class="cf">function</span>(itinerary, itinerarySectionId){</span>
<span id="cb32-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  sections <span class="ot">=</span> <span class="fu">get_sections</span>(itinerary)</span>
<span id="cb32-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  itineraryLegId <span class="ot">=</span> sections[sections<span class="sc">$</span>itinerarySectionId<span class="sc">==</span>itinerarySectionId,</span>
<span id="cb32-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb32-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&#39;itineraryLegId&#39;</span>]</span>
<span id="cb32-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  itinerary[itinerary<span class="sc">$</span>itineraryLegId<span class="sc">==</span>itineraryLegId,<span class="st">&#39;startListId&#39;</span>]</span>
<span id="cb32-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb32-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">get_startlist_id</span>(itinerary, stages<span class="sc">$</span>itinerarySectionId[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>## [1] 523</code></pre>
</div>
</div>
<div id="competitor-details" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Competitor Details</h2>
<p>Details of car entries for each event can be retrieved from the WRC live timing API given an event ID.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-1" aria-hidden="true" tabindex="-1"></a>get_rally_entries <span class="ot">=</span> <span class="cf">function</span>(eventId) {</span>
<span id="cb34-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  cars_url <span class="ot">=</span> <span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>,</span>
<span id="cb34-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-3" aria-hidden="true" tabindex="-1"></a>                  eventId,<span class="st">&#39;/cars&#39;</span>)</span>
<span id="cb34-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(cars_url)</span>
<span id="cb34-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-7" aria-hidden="true" tabindex="-1"></a>entries <span class="ot">=</span> <span class="fu">get_rally_entries</span>(eventId)</span>
<span id="cb34-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># $driver, $codriver, $manufacturer, $entrant, $group, $eventClasses</span></span>
<span id="cb34-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># $identifier, $vehicleModel, $eligibility, $status</span></span>
<span id="cb34-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb34-11" aria-hidden="true" tabindex="-1"></a>entries <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   driver.personId driver.countryId driver.country.countryId
## 1             670               76                       76
## 2             534              235                      235
##                                    driver.country.name driver.country.iso2
## 1                                               France                  FR
## 2 United Kingdom of Great Britain and Northern Ireland                  GB
##   driver.country.iso3 driver.firstName driver.lastName driver.abbvName
## 1                 FRA        Sébastien           OGIER        S. OGIER
## 2                 GBR            Elfyn           EVANS        E. EVANS
##   driver.fullName driver.code codriver.personId codriver.countryId
## 1 Sébastien OGIER         OGI              3027                 76
## 2     Elfyn EVANS         EVA               553                235
##   codriver.country.countryId
## 1                         76
## 2                        235
##                                  codriver.country.name codriver.country.iso2
## 1                                               France                    FR
## 2 United Kingdom of Great Britain and Northern Ireland                    GB
##   codriver.country.iso3 codriver.firstName codriver.lastName codriver.abbvName
## 1                   FRA             Julien         INGRASSIA      J. INGRASSIA
## 2                   GBR              Scott            MARTIN         S. MARTIN
##   codriver.fullName codriver.code manufacturer.manufacturerId manufacturer.name
## 1  Julien INGRASSIA           ING                          84            Toyota
## 2      Scott MARTIN           MAR                          84            Toyota
##   manufacturer.logoFilename entrant.entrantId            entrant.name
## 1                    toyota                91 TOYOTA GAZOO RACING WRT
## 2                    toyota                91 TOYOTA GAZOO RACING WRT
##   entrant.logoFilename group.groupId group.name  eventClasses tags entryId
## 1                 &lt;NA&gt;            10        WRC 640, 170, RC1 NULL   21530
## 2                 &lt;NA&gt;            10        WRC 640, 170, RC1 NULL   21531
##   eventId driverId codriverId manufacturerId entrantId groupId entryListOrder
## 1     170      670       3027             84        91      10              1
## 2     170      534        553             84        91      10              2
##   identifier vehicleModel eligibility priority   status tyreManufacturer
## 1          1    Yaris WRC           M       P1 Rejoined             None
## 2         33    Yaris WRC           M       P1    Entry             None</code></pre>
<div id="looking-up-entries-by-group" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Looking Up Entries by Group</h3>
<p>We can index the entries by group to find all the WRC car <code>entryId</code> values:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb36-1" aria-hidden="true" tabindex="-1"></a>entries[entries<span class="sc">$</span>group<span class="sc">$</span>name<span class="sc">==</span><span class="st">&#39;WRC&#39;</span>, <span class="st">&#39;entryId&#39;</span>]</span></code></pre></div>
<pre><code>##  [1] 21530 21531 21532 21533 21534 21535 21536 21537 21538 21539 21540 21541
## [13] 21542</code></pre>
</div>
<div id="driver-codriver-details" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Driver &amp; Codriver Details</h3>
<p>Detailed information for each driver and codriver can be found in the corresponding sub-dataframes.</p>
<p>For example, we can look up the details for each driver, noting in this case that we need to column bind (<code>cbind()</code>) the subdataframes to produce the collated dataframe of driver details:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb38-1" aria-hidden="true" tabindex="-1"></a>get_drivers <span class="ot">=</span> <span class="cf">function</span>(entries){</span>
<span id="cb38-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  drivers <span class="ot">=</span> <span class="fu">do.call</span>(cbind, entries<span class="sc">$</span>driver)</span>
<span id="cb38-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  drivers</span>
<span id="cb38-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb38-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb38-6" aria-hidden="true" tabindex="-1"></a>drivers <span class="ot">=</span> <span class="fu">get_drivers</span>(entries)</span>
<span id="cb38-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb38-8" aria-hidden="true" tabindex="-1"></a>drivers <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   personId countryId country.countryId
## 1      670        76                76
## 2      534       235               235
##                                           country.name country.iso2
## 1                                               France           FR
## 2 United Kingdom of Great Britain and Northern Ireland           GB
##   country.iso3 firstName lastName abbvName        fullName code
## 1          FRA Sébastien    OGIER S. OGIER Sébastien OGIER  OGI
## 2          GBR     Elfyn    EVANS E. EVANS     Elfyn EVANS  EVA</code></pre>
<p>We can similarly obtain data for the codrivers:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#codrivers = do.call(cbind, entries$codriver)</span></span>
<span id="cb40-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, there is a tidyverse approach with dplyr::bind_cols()</span></span>
<span id="cb40-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-3" aria-hidden="true" tabindex="-1"></a>get_codrivers <span class="ot">=</span> <span class="cf">function</span>(entries){</span>
<span id="cb40-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  codrivers <span class="ot">=</span> <span class="fu">bind_cols</span>(entries<span class="sc">$</span>codriver)</span>
<span id="cb40-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  codrivers</span>
<span id="cb40-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-8" aria-hidden="true" tabindex="-1"></a>codrivers <span class="ot">=</span> <span class="fu">get_codrivers</span>(entries)</span>
<span id="cb40-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb40-10" aria-hidden="true" tabindex="-1"></a>codrivers <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   personId countryId country.countryId
## 1     3027        76                76
## 2      553       235               235
##                                           country.name country.iso2
## 1                                               France           FR
## 2 United Kingdom of Great Britain and Northern Ireland           GB
##   country.iso3 firstName  lastName     abbvName         fullName code
## 1          FRA    Julien INGRASSIA J. INGRASSIA Julien INGRASSIA  ING
## 2          GBR     Scott    MARTIN    S. MARTIN     Scott MARTIN  MAR</code></pre>
<p>We can conveniently obtain the identifier for a particular driver or codriver by searching against their name or three letter code, although note that <em>the three letter code may not be a unique identifier</em>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-1" aria-hidden="true" tabindex="-1"></a>get_person_id <span class="ot">=</span> <span class="cf">function</span>(persons, sname, <span class="at">typ=</span><span class="st">&#39;fullName&#39;</span>){</span>
<span id="cb42-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># code, fullName</span></span>
<span id="cb42-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (typ<span class="sc">==</span><span class="st">&#39;code&#39;</span>)</span>
<span id="cb42-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-4" aria-hidden="true" tabindex="-1"></a>    personsId <span class="ot">=</span> persons[persons[typ]<span class="sc">==</span>sname, <span class="st">&#39;personId&#39;</span>]</span>
<span id="cb42-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb42-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-6" aria-hidden="true" tabindex="-1"></a>    personId <span class="ot">=</span> persons[<span class="fu">str_detect</span>(persons[[typ]],</span>
<span id="cb42-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-7" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">regex</span>(sname,</span>
<span id="cb42-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-8" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">ignore_case =</span> T)),</span>
<span id="cb42-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-9" aria-hidden="true" tabindex="-1"></a>                       <span class="st">&#39;personId&#39;</span>]</span>
<span id="cb42-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-10" aria-hidden="true" tabindex="-1"></a>  personId</span>
<span id="cb42-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-13" aria-hidden="true" tabindex="-1"></a>ogierDriverId <span class="ot">=</span> <span class="fu">get_person_id</span>(drivers, <span class="st">&#39;ogier&#39;</span>)</span>
<span id="cb42-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb42-14" aria-hidden="true" tabindex="-1"></a>ogierDriverId</span></code></pre></div>
<pre><code>## [1] 670</code></pre>
<p>From the driver person identifier we can get the entry identifier for the rally we’re exploring:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb44-1" aria-hidden="true" tabindex="-1"></a>ogierEntryId  <span class="ot">=</span> entries[entries[<span class="st">&#39;driverId&#39;</span>]<span class="sc">==</span>ogierDriverId, <span class="st">&#39;entryId&#39;</span>]</span>
<span id="cb44-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb44-2" aria-hidden="true" tabindex="-1"></a>ogierEntryId</span></code></pre></div>
<pre><code>## [1] 21530</code></pre>
</div>
<div id="summarising-essential-entry-data" class="section level3" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Summarising Essential Entry Data</h3>
<p>We can manually create a dataframe containing essential fields from the original cars dataframe and the dataframes contained within it:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-1" aria-hidden="true" tabindex="-1"></a>get_car_data <span class="ot">=</span> <span class="cf">function</span>(entries){</span>
<span id="cb46-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, <span class="st">&#39;driverId&#39;</span>, <span class="st">&#39;codriverId&#39;</span>,<span class="st">&#39;manufacturerId&#39;</span>,</span>
<span id="cb46-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;vehicleModel&#39;</span>,<span class="st">&#39;eligibility&#39;</span>, <span class="st">&#39;classname&#39;</span>,<span class="st">&#39;manufacturer&#39;</span>,</span>
<span id="cb46-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;entrantname&#39;</span>, <span class="st">&#39;groupname&#39;</span>, <span class="st">&#39;drivername&#39;</span>, <span class="st">&#39;code&#39;</span>,</span>
<span id="cb46-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">&#39;driverfullname&#39;</span>, <span class="st">&#39;codrivername&#39;</span>,<span class="st">&#39;codriverfullname&#39;</span></span>
<span id="cb46-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-6" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb46-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  entries <span class="ot">=</span> entries <span class="sc">%&gt;%</span></span>
<span id="cb46-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-9" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">classname =</span> eventClasses<span class="sc">$</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb46-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">manufacturer =</span> manufacturer<span class="sc">$</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb46-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-11" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">entrantname =</span> entrant<span class="sc">$</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb46-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-12" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">groupname =</span> group<span class="sc">$</span>name) <span class="sc">%&gt;%</span></span>
<span id="cb46-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-13" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">drivername =</span> driver<span class="sc">$</span>abbvName) <span class="sc">%&gt;%</span></span>
<span id="cb46-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-14" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">driverfullname =</span> driver<span class="sc">$</span>fullName) <span class="sc">%&gt;%</span></span>
<span id="cb46-15"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-15" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">codrivername =</span> codriver<span class="sc">$</span>abbvName) <span class="sc">%&gt;%</span></span>
<span id="cb46-16"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-16" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">codriverfullname =</span> codriver<span class="sc">$</span>fullName) <span class="sc">%&gt;%</span></span>
<span id="cb46-17"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-17" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">mutate</span>(<span class="at">code =</span> driver<span class="sc">$</span>code) <span class="sc">%&gt;%</span></span>
<span id="cb46-18"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-18" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">select</span>(<span class="fu">all_of</span>(cols))</span>
<span id="cb46-19"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-20"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If we don&#39;t cast, it&#39;s a non-rankable rowwise df</span></span>
<span id="cb46-21"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(entries)</span>
<span id="cb46-22"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-23"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-24"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="fu">get_car_data</span>(entries) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId driverId codriverId manufacturerId vehicleModel eligibility classname
## 1   21530      670       3027             84    Yaris WRC           M       RC1
## 2   21531      534        553             84    Yaris WRC           M       RC1
##   manufacturer             entrantname groupname drivername code
## 1       Toyota TOYOTA GAZOO RACING WRT       WRC   S. OGIER  OGI
## 2       Toyota TOYOTA GAZOO RACING WRT       WRC   E. EVANS  EVA
##    driverfullname codrivername codriverfullname
## 1 Sébastien OGIER J. INGRASSIA Julien INGRASSIA
## 2     Elfyn EVANS    S. MARTIN     Scott MARTIN</code></pre>
</div>
</div>
<div id="penalties-and-retirements" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Penalties and Retirements</h2>
<p>We can look up <em>penalties</em> from an event ID:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb48-1" aria-hidden="true" tabindex="-1"></a>get_penalties <span class="ot">=</span> <span class="cf">function</span>(eventId) {</span>
<span id="cb48-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  penalties_url <span class="ot">=</span> <span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>,</span>
<span id="cb48-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb48-3" aria-hidden="true" tabindex="-1"></a>                       eventId, <span class="st">&#39;/penalties&#39;</span>)</span>
<span id="cb48-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb48-4" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(penalties_url)</span>
<span id="cb48-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb48-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_penalties</span>(eventId) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   penaltyId controlId entryId penaltyDurationMs penaltyDuration     reason
## 1       959      7546   21559             10000           PT10S 1 MIN LATE
## 2       956      7533   21568             10000           PT10S 1 MIN LATE</code></pre>
<p>The event ID is also all we need to request a list of <em>retirements</em>:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb50-1" aria-hidden="true" tabindex="-1"></a>get_retirements <span class="ot">=</span> <span class="cf">function</span>(eventId) {</span>
<span id="cb50-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  retirements_url <span class="ot">=</span> <span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>,</span>
<span id="cb50-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb50-3" aria-hidden="true" tabindex="-1"></a>                       eventId, <span class="st">&#39;/retirements&#39;</span>)</span>
<span id="cb50-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(retirements_url)</span>
<span id="cb50-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb50-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_retirements</span>(eventId) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   retirementId controlId entryId     reason  retirementDateTime
## 1         1802      7562   21547 MECHANICAL 2021-02-26T14:50:00
## 2         1803      7556   21542   OFF ROAD 2021-02-27T08:01:00
##     retirementDateTimeLocal    status
## 1 0001-01-01T00:00:00+00:00 Permanent
## 2 0001-01-01T00:00:00+00:00 Temporary</code></pre>
</div>
<div id="results-and-stage-winner" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Results and Stage Winner</h2>
<p>As well as retrieving penalties and retirements using just the event ID as a key, we can also retrieve the overall results and the stage winners:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb52-1" aria-hidden="true" tabindex="-1"></a>get_result <span class="ot">=</span> <span class="cf">function</span>(eventId) {</span>
<span id="cb52-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  result_url <span class="ot">=</span> <span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>,</span>
<span id="cb52-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                    eventId,<span class="st">&#39;/result&#39;</span>)</span>
<span id="cb52-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb52-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(result_url)</span>
<span id="cb52-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb52-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">get_result</span>(eventId) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId stageTimeMs   stageTime penaltyTimeMs penaltyTime totalTimeMs
## 1   21536     7429600 PT2H3M49.6S             0        PT0S     7429600
## 2   21533     7447100  PT2H4M7.1S             0        PT0S     7447100
##     totalTime position diffFirstMs diffFirst diffPrevMs diffPrev
## 1 PT2H3M49.6S        1           0      PT0S          0     PT0S
## 2  PT2H4M7.1S        2       17500   PT17.5S      17500  PT17.5S</code></pre>
<p>And for the stage winners:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb54-1" aria-hidden="true" tabindex="-1"></a>get_stage_winners <span class="ot">=</span> <span class="cf">function</span>(eventId) {</span>
<span id="cb54-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  stage_winners_url <span class="ot">=</span> <span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>,</span>
<span id="cb54-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb54-3" aria-hidden="true" tabindex="-1"></a>                             eventId,<span class="st">&#39;/stage-winners&#39;</span>)</span>
<span id="cb54-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb54-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb54-5" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(stage_winners_url)</span>
<span id="cb54-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb54-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="fu">get_stage_winners</span>(eventId) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   stageId entryId               stageName elapsedDurationMs  elapsedDuration
## 1    1747   21536 Sarriojärvi 1 (Live TV)            957800 00:15:57.8000000
## 2    1743   21536 Sarriojärvi 2 (Live TV)            952900 00:15:52.9000000</code></pre>
</div>
<div id="stage-result" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Stage Result</h2>
<p>At the end of each stage, there are actually two different sorts of results data are available: data relating to the result of the stage itself, and data relating to how the stage result affected the overall rally position.</p>
<p>Let’s start by getting the overall rally result at the end of a particular stage. Note that the overall result does not include the stage ID in the returned data so we need to add it in:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-1" aria-hidden="true" tabindex="-1"></a>get_overall_result <span class="ot">=</span> <span class="cf">function</span>(eventId, stageId) {</span>
<span id="cb56-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  overall_url <span class="ot">=</span> <span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>,</span>
<span id="cb56-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-3" aria-hidden="true" tabindex="-1"></a>                           eventId, <span class="st">&#39;/stage-result/stage-external/&#39;</span>,</span>
<span id="cb56-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-4" aria-hidden="true" tabindex="-1"></a>                           stageId)</span>
<span id="cb56-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-5" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(overall_url) <span class="sc">%&gt;%</span></span>
<span id="cb56-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Also add in the stage ID</span></span>
<span id="cb56-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">stageId =</span> stageId)</span>
<span id="cb56-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-10" aria-hidden="true" tabindex="-1"></a>overall_result <span class="ot">=</span> <span class="fu">get_overall_result</span>(eventId, stageId)</span>
<span id="cb56-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb56-12" aria-hidden="true" tabindex="-1"></a>overall_result <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId stageTimeMs  stageTime penaltyTimeMs penaltyTime totalTimeMs
## 1   21536     2745200 PT45M45.2S             0        PT0S     2745200
## 2   21538     2768800  PT46M8.8S             0        PT0S     2768800
##    totalTime position diffFirstMs diffFirst diffPrevMs diffPrev stageId
## 1 PT45M45.2S        1           0      PT0S          0     PT0S    1750
## 2  PT46M8.8S        2       23600   PT23.6S      23600  PT23.6S    1750</code></pre>
<div id="getting-stage-results-for-multiple-stages" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Getting Stage Results for Multiple Stages</h3>
<p>It will be convenient to be able to retrieve overall results for multiple stages from one function call. One way of achieving that is to create a function to retrieve the details for a single specified stage that can be applied via a <code>purrr::map()</code> function call to a list of the stage IDs we want overall results data for:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;purrr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:jsonlite&#39;:
## 
##     flatten</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-1" aria-hidden="true" tabindex="-1"></a>get_overall_result2 <span class="ot">=</span> <span class="cf">function</span>(stageId, eventId) {</span>
<span id="cb61-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get_overall_result</span>(eventId, stageId)</span>
<span id="cb61-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-5" aria-hidden="true" tabindex="-1"></a>get_multi_overall <span class="ot">=</span> <span class="cf">function</span>(stage_list){</span>
<span id="cb61-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-6" aria-hidden="true" tabindex="-1"></a>  multi_overall <span class="ot">=</span> stage_list <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(get_overall_result2, <span class="at">eventId=</span>eventId) <span class="sc">%&gt;%</span> </span>
<span id="cb61-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>()</span>
<span id="cb61-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-9" aria-hidden="true" tabindex="-1"></a>  multi_overall</span>
<span id="cb61-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify the stage IDs for multiple stages</span></span>
<span id="cb61-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-13" aria-hidden="true" tabindex="-1"></a>stage_list <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1747</span>,    <span class="dv">1743</span>)</span>
<span id="cb61-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-15" aria-hidden="true" tabindex="-1"></a>multi_overall_results <span class="ot">=</span> <span class="fu">get_multi_overall</span>(stage_list)</span>
<span id="cb61-16"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb61-17"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb61-17" aria-hidden="true" tabindex="-1"></a>multi_overall_results <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##     entryId stageTimeMs  stageTime penaltyTimeMs penaltyTime totalTimeMs
## 107   21579     2866500 PT47M46.5S             0        PT0S     2866500
## 108   21573     3115400 PT51M55.4S             0        PT0S     3115400
##      totalTime position diffFirstMs  diffFirst diffPrevMs diffPrev stageId
## 107 PT47M46.5S       53      955800 PT15M55.8S     123200 PT2M3.2S    1743
## 108 PT51M55.4S       54     1204700  PT20M4.7S     248900 PT4M8.9S    1743</code></pre>
</div>
</div>
<div id="stage-times" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Stage Times</h2>
<p>We can get the stage times for each stage on a rally by event and stage ID:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-1" aria-hidden="true" tabindex="-1"></a>get_stage_times <span class="ot">=</span> <span class="cf">function</span>(eventId, stageId) {</span>
<span id="cb63-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  stage_times_url <span class="ot">=</span> <span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>,</span>
<span id="cb63-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-3" aria-hidden="true" tabindex="-1"></a>                           eventId, <span class="st">&#39;/stage-times/stage-external/&#39;</span>,</span>
<span id="cb63-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-4" aria-hidden="true" tabindex="-1"></a>                           stageId)</span>
<span id="cb63-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-5" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(stage_times_url)</span>
<span id="cb63-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-8" aria-hidden="true" tabindex="-1"></a>stage_times <span class="ot">=</span> <span class="fu">get_stage_times</span>(eventId, stageId)</span>
<span id="cb63-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb63-10" aria-hidden="true" tabindex="-1"></a>stage_times <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   stageTimeId stageId entryId elapsedDurationMs  elapsedDuration    status
## 1       96580    1750   21536            834500 00:13:54.5000000 Completed
## 2       96474    1750   21532            835500 00:13:55.5000000 Completed
##    source position diffFirstMs diffFirst diffPrevMs diffPrev
## 1 Default        1           0  00:00:00          0 00:00:00
## 2 Default        2        1000  00:00:01       1000 00:00:01</code></pre>
<div id="getting-stage-times-for-multiple-stages" class="section level3" number="2.7.1">
<h3><span class="header-section-number">2.7.1</span> Getting Stage Times for Multiple Stages</h3>
<p>It will also be convenient to be able to retrieve stage times for multiple stages from a single function call. We can take the same approach we used previously:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-1" aria-hidden="true" tabindex="-1"></a>get_stage_times2 <span class="ot">=</span> <span class="cf">function</span>(stageId, eventId) {</span>
<span id="cb65-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-2" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">get_stage_times</span>(eventId, stageId)</span>
<span id="cb65-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-3" aria-hidden="true" tabindex="-1"></a>                            }</span>
<span id="cb65-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-5" aria-hidden="true" tabindex="-1"></a>get_multi_stage_times <span class="ot">=</span> <span class="cf">function</span>(stage_list){</span>
<span id="cb65-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-6" aria-hidden="true" tabindex="-1"></a>  multi_stage_times <span class="ot">=</span> stage_list <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">map</span>(get_stage_times2, <span class="at">eventId=</span>eventId) <span class="sc">%&gt;%</span> </span>
<span id="cb65-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">bind_rows</span>()</span>
<span id="cb65-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-9" aria-hidden="true" tabindex="-1"></a>  multi_stage_times</span>
<span id="cb65-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-12" aria-hidden="true" tabindex="-1"></a>multi_stage_times <span class="ot">=</span> <span class="fu">get_multi_stage_times</span>(stage_list)</span>
<span id="cb65-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb65-14" aria-hidden="true" tabindex="-1"></a>multi_stage_times <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##     stageTimeId stageId entryId elapsedDurationMs  elapsedDuration    status
## 109       96321    1743   21573           1950700 00:32:30.7000000 Completed
## 110       96355    1743   21547                NA             &lt;NA&gt;       DNS
##      source position diffFirstMs        diffFirst diffPrevMs         diffPrev
## 109 Default       54      997800 00:16:37.8000000     245500 00:04:05.5000000
## 110 Default       NA          NA             &lt;NA&gt;         NA             &lt;NA&gt;</code></pre>
</div>
<div id="getting-wide-stage-times-for-multiple-stages" class="section level3" number="2.7.2">
<h3><span class="header-section-number">2.7.2</span> Getting Wide Stage Times for Multiple Stages</h3>
<p>We can then widen the stage times for each driver:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-1" aria-hidden="true" tabindex="-1"></a>get_multi_stage_times_wide <span class="ot">=</span> <span class="cf">function</span>(multi_stage_times, stage_list){</span>
<span id="cb67-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-2" aria-hidden="true" tabindex="-1"></a>  stage_times_cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, <span class="st">&#39;stageId&#39;</span>, <span class="st">&#39;elapsedDurationMs&#39;</span>)</span>
<span id="cb67-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  multi_stage_times_wide <span class="ot">=</span> multi_stage_times <span class="sc">%&gt;%</span> </span>
<span id="cb67-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="fu">all_of</span>(stage_times_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">elapsedDurationS =</span> elapsedDurationMs <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-7" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="sc">-</span>elapsedDurationMs) <span class="sc">%&gt;%</span></span>
<span id="cb67-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">group_by</span>(entryId) <span class="sc">%&gt;%</span></span>
<span id="cb67-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-9" aria-hidden="true" tabindex="-1"></a>                    tidyr<span class="sc">::</span><span class="fu">spread</span>(<span class="at">key =</span> stageId,</span>
<span id="cb67-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">value =</span> elapsedDurationS) <span class="sc">%&gt;%</span></span>
<span id="cb67-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, <span class="fu">as.character</span>(stage_list))) <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-12" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If we don&#39;t cast, it&#39;s a</span></span>
<span id="cb67-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-13" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># non-rankable rowwise df</span></span>
<span id="cb67-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">as.data.frame</span>()</span>
<span id="cb67-15"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-16"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-16" aria-hidden="true" tabindex="-1"></a>  multi_stage_times_wide</span>
<span id="cb67-17"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-18"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-19"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-19" aria-hidden="true" tabindex="-1"></a>multi_stage_times_wide <span class="ot">=</span> <span class="fu">get_multi_stage_times_wide</span>(multi_stage_times,</span>
<span id="cb67-20"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-20" aria-hidden="true" tabindex="-1"></a>                                                    stage_list)</span>
<span id="cb67-21"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-22"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb67-22" aria-hidden="true" tabindex="-1"></a>multi_stage_times_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId  1747  1743
## 1   21530 980.5 980.0
## 2   21531 974.5 968.2</code></pre>
</div>
<div id="getting-wide-stage-positions" class="section level3" number="2.7.3">
<h3><span class="header-section-number">2.7.3</span> Getting Wide Stage Positions</h3>
<p>We can also get the stage positions:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-1" aria-hidden="true" tabindex="-1"></a>get_multi_stage_positions_wide <span class="ot">=</span> <span class="cf">function</span>(multi_stage_times, stage_list){</span>
<span id="cb69-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  stage_positions_cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, <span class="st">&#39;stageId&#39;</span>, <span class="st">&#39;position&#39;</span>)</span>
<span id="cb69-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  multi_stage_positions_wide <span class="ot">=</span> multi_stage_times <span class="sc">%&gt;%</span> </span>
<span id="cb69-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="fu">all_of</span>(stage_positions_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb69-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">group_by</span>(entryId) <span class="sc">%&gt;%</span></span>
<span id="cb69-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-7" aria-hidden="true" tabindex="-1"></a>                    tidyr<span class="sc">::</span><span class="fu">spread</span>(<span class="at">key =</span> stageId,</span>
<span id="cb69-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">value =</span> position) <span class="sc">%&gt;%</span></span>
<span id="cb69-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-9" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, <span class="fu">as.character</span>(stage_list))) <span class="sc">%&gt;%</span></span>
<span id="cb69-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-10" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># If we don&#39;t cast, it&#39;s a</span></span>
<span id="cb69-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-11" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># non-rankable rowwise df</span></span>
<span id="cb69-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-12" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">as.data.frame</span>()</span>
<span id="cb69-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-15"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-15" aria-hidden="true" tabindex="-1"></a>multi_stage_positions_wide <span class="ot">=</span> <span class="fu">get_multi_stage_positions_wide</span>(multi_stage_times, stage_list)</span>
<span id="cb69-16"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb69-17" aria-hidden="true" tabindex="-1"></a>multi_stage_positions_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId 1747 1743
## 1   21530    9   10
## 2   21531    5    5</code></pre>
</div>
<div id="getting-generic-wide-dataframes" class="section level3" number="2.7.4">
<h3><span class="header-section-number">2.7.4</span> Getting Generic Wide Dataframes</h3>
<p>We can start to work up a function that is able to handle widening data frames more generally, albeit with a potential need to handle exceptions:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-1" aria-hidden="true" tabindex="-1"></a>get_multi_stage_generic_wide <span class="ot">=</span> <span class="cf">function</span>(multi_stage_generic, stage_list,</span>
<span id="cb71-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-2" aria-hidden="true" tabindex="-1"></a>                                        wide_val, <span class="at">group_key=</span><span class="st">&#39;entryId&#39;</span>,</span>
<span id="cb71-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">spread_key=</span><span class="st">&#39;stageId&#39;</span>){</span>
<span id="cb71-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  stage_times_cols <span class="ot">=</span> <span class="fu">c</span>(group_key, spread_key, wide_val )</span>
<span id="cb71-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (wide_val<span class="sc">==</span><span class="st">&#39;elapsedDurationMs&#39;</span>) {</span>
<span id="cb71-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-8" aria-hidden="true" tabindex="-1"></a>    multi_stage_times_wide <span class="ot">=</span> multi_stage_times <span class="sc">%&gt;%</span> </span>
<span id="cb71-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">all_of</span>(stage_times_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb71-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">elapsedDurationS =</span> elapsedDurationMs <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>elapsedDurationMs)</span>
<span id="cb71-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-13" aria-hidden="true" tabindex="-1"></a>    wide_val <span class="ot">=</span> <span class="st">&#39;elapsedDurationS&#39;</span></span>
<span id="cb71-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-15"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-16"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-16" aria-hidden="true" tabindex="-1"></a>  multi_stage_generic_wide <span class="ot">=</span> multi_stage_generic <span class="sc">%&gt;%</span> </span>
<span id="cb71-17"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="fu">all_of</span>(stage_times_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb71-18"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># group_by_at lets us pass in the grouping column by variable</span></span>
<span id="cb71-19"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by_at</span>(group_key) <span class="sc">%&gt;%</span></span>
<span id="cb71-20"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-20" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">spread</span>(<span class="at">key =</span> spread_key,</span>
<span id="cb71-21"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">value =</span> wide_val) <span class="sc">%&gt;%</span></span>
<span id="cb71-22"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>( <span class="fu">c</span>(group_key, <span class="fu">as.character</span>(stage_list))) <span class="sc">%&gt;%</span></span>
<span id="cb71-23"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we don&#39;t cast, it&#39;s a</span></span>
<span id="cb71-24"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># non-rankable rowwise df</span></span>
<span id="cb71-25"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb71-26"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-27"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-27" aria-hidden="true" tabindex="-1"></a>  multi_stage_generic_wide</span>
<span id="cb71-28"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-29"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-30"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb71-30" aria-hidden="true" tabindex="-1"></a>multi_stage_positions_wide_g <span class="ot">=</span> <span class="fu">get_multi_stage_generic_wide</span>(multi_stage_times, stage_list, <span class="st">&#39;position&#39;</span>)</span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(group_key)` instead of `group_key` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb73-1" aria-hidden="true" tabindex="-1"></a>multi_stage_positions_wide_g <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId 1747 1743
## 1   21530    9   10
## 2   21531    5    5</code></pre>
</div>
</div>
<div id="split-times" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Split Times</h2>
<p>We can get split times and distance into stage data for each stage given the stage identifier:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-1" aria-hidden="true" tabindex="-1"></a>get_splits <span class="ot">=</span> <span class="cf">function</span>(eventId, stageId){</span>
<span id="cb75-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-2" aria-hidden="true" tabindex="-1"></a>  splits_url<span class="ot">=</span><span class="fu">paste0</span>(results_api, <span class="st">&#39;/rally-event/&#39;</span>, eventId,</span>
<span id="cb75-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-3" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&#39;/split-times/stage-external/&#39;</span>, stageId)</span>
<span id="cb75-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-5" aria-hidden="true" tabindex="-1"></a>    jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(splits_url)</span>
<span id="cb75-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-8" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">get_splits</span>(eventId, stageId)</span>
<span id="cb75-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co"># $splitPoints</span></span>
<span id="cb75-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co"># $entrySplitPointTimes</span></span></code></pre></div>
<p>This includes handy information about split locations, such as distance into stage. This can also be useful for pace calculations:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb76-1" aria-hidden="true" tabindex="-1"></a>splits<span class="sc">$</span>splitPoints</span></code></pre></div>
<pre><code>##   splitPointId stageId number distance
## 1         3593    1750      5    23.21
## 2         3601    1750      2     9.02
## 3         3615    1750      1     4.83
## 4         3617    1750      4    20.63
## 5         3621    1750      3    14.87</code></pre>
<p>We can also view the split point times for each driver. This second dataframe contains rows summarising the stage for each driver, and includes the stage start time and duration as well as a column <em>splitPointTimes</em> that itself contains a data frame of elapsed duration split point times:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb78-1" aria-hidden="true" tabindex="-1"></a>splits<span class="sc">$</span>entrySplitPointTimes <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>splitPointTimes) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId       startDateTime        startDateTimeLocal stageTimeDurationMs
## 1   21540 2021-02-27T07:08:00 2021-02-27T09:08:00+02:00              844300
## 2   21541 2021-02-27T07:11:00 2021-02-27T09:11:00+02:00              864400
##   stageTimeDuration
## 1  00:14:04.3000000
## 2  00:14:24.4000000</code></pre>
<p>To view the split times for a specific driver, we can index into the dataframe using the driver <code>entryId</code> value:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb80-1" aria-hidden="true" tabindex="-1"></a>splits<span class="sc">$</span>entrySplitPointTimes[splits<span class="sc">$</span>entrySplitPointTimes[<span class="st">&#39;entryId&#39;</span>]<span class="sc">==</span>ogierEntryId,]<span class="sc">$</span>splitPointTimes</span></code></pre></div>
<pre><code>## [[1]]
##   splitPointTimeId splitPointId entryId elapsedDurationMs elapsedDuration
## 1           123492         3615   21530            161700       PT2M41.7S
## 2           123495         3601   21530            272300       PT4M32.3S
## 3           123499         3621   21530            471300       PT7M51.3S
## 4           123505         3617   21530            690400      PT11M30.4S
## 5           123507         3593   21530            789200       PT13M9.2S
##           splitDateTime          splitDateTimeLocal
## 1 2021-02-27T07:22:41.7 2021-02-27T09:22:41.7+02:00
## 2 2021-02-27T07:24:32.3 2021-02-27T09:24:32.3+02:00
## 3 2021-02-27T07:27:51.3 2021-02-27T09:27:51.3+02:00
## 4 2021-02-27T07:31:30.4 2021-02-27T09:31:30.4+02:00
## 5 2021-02-27T07:33:09.2 2021-02-27T09:33:09.2+02:00</code></pre>
<p>Each dataframe gives the split times on the stage for a particular driver in a long format.</p>
<p>Note that the split point times are strictly increasing and describe the elapsed time into the stage at each split point from the start location and time.</p>
<div id="driver-split-times-detail" class="section level3" number="2.8.1">
<h3><span class="header-section-number">2.8.1</span> Driver Split Times Detail</h3>
<p>We can get an unrolled long structure by combining the <em>splitPointTimes</em> dataframes from all drivers, also taking the opportunity to convert the elapsed duration in milliseconds to seconds along the way:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#driver_splits = do.call(rbind, entry_splits$splitPointTimes)</span></span>
<span id="cb82-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The tidyverse approach is to use dplyr::bind_rows()</span></span>
<span id="cb82-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also construct a pipe to streamline the processing</span></span>
<span id="cb82-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-4" aria-hidden="true" tabindex="-1"></a>get_driver_splits <span class="ot">=</span> <span class="cf">function</span>(splits){</span>
<span id="cb82-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-5" aria-hidden="true" tabindex="-1"></a>  driver_splits <span class="ot">=</span> splits<span class="sc">$</span>entrySplitPointTimes<span class="sc">$</span>splitPointTimes <span class="sc">%&gt;%</span></span>
<span id="cb82-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-7" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">elapsedDurationS =</span> elapsedDurationMs <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(<span class="sc">-</span>elapsedDurationMs)</span>
<span id="cb82-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-9" aria-hidden="true" tabindex="-1"></a>  driver_splits</span>
<span id="cb82-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb82-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-12" aria-hidden="true" tabindex="-1"></a>driver_splits <span class="ot">=</span> <span class="fu">get_driver_splits</span>(splits)</span>
<span id="cb82-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb82-14" aria-hidden="true" tabindex="-1"></a>driver_splits <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   splitPointTimeId splitPointId entryId elapsedDuration         splitDateTime
## 1           123482         3615   21540       PT2M41.4S 2021-02-27T07:10:41.4
## 2           123483         3601   21540       PT4M32.5S 2021-02-27T07:12:32.5
##            splitDateTimeLocal elapsedDurationS
## 1 2021-02-27T09:10:41.4+02:00            161.4
## 2 2021-02-27T09:12:32.5+02:00            272.5</code></pre>
</div>
<div id="wide-driver-split-times" class="section level3" number="2.8.2">
<h3><span class="header-section-number">2.8.2</span> Wide Driver Split Times</h3>
<p>We can cast the data into a wide format, with splits ordered by their distance into the stage. Start by creating a function to help get the split point codes in order by distance along the stage:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb84-1" aria-hidden="true" tabindex="-1"></a>get_split_cols <span class="ot">=</span> <span class="cf">function</span>(splits){</span>
<span id="cb84-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  split_cols <span class="ot">=</span>  <span class="fu">as.character</span>(<span class="fu">arrange</span>(splits<span class="sc">$</span>splitPoints, distance)<span class="sc">$</span>splitPointId)</span>
<span id="cb84-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb84-3" aria-hidden="true" tabindex="-1"></a>  split_cols</span>
<span id="cb84-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb84-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now create a function to get the driver splits in a wide format using the distance-into-stage ordered split point codes as the widened columns:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-1" aria-hidden="true" tabindex="-1"></a>get_driver_splits_wide <span class="ot">=</span> <span class="cf">function</span>(driver_splits, splits){</span>
<span id="cb85-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-2" aria-hidden="true" tabindex="-1"></a>    split_cols <span class="ot">=</span>  <span class="fu">get_split_cols</span>(splits)</span>
<span id="cb85-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-3" aria-hidden="true" tabindex="-1"></a>    splits_cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, <span class="st">&#39;splitPointId&#39;</span>, <span class="st">&#39;elapsedDurationS&#39;</span>)</span>
<span id="cb85-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-5" aria-hidden="true" tabindex="-1"></a>    driver_splits_wide <span class="ot">=</span> driver_splits <span class="sc">%&gt;%</span> </span>
<span id="cb85-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-6" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">group_by</span>(entryId) <span class="sc">%&gt;%</span></span>
<span id="cb85-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-7" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">select</span>(<span class="fu">all_of</span>(splits_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb85-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-8" aria-hidden="true" tabindex="-1"></a>                            tidyr<span class="sc">::</span><span class="fu">spread</span>(<span class="at">key =</span> splitPointId,</span>
<span id="cb85-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">value =</span> elapsedDurationS) <span class="sc">%&gt;%</span></span>
<span id="cb85-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-10" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">select</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>, split_cols))) <span class="sc">%&gt;%</span></span>
<span id="cb85-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-11" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># If we don&#39;t cast, it&#39;s a</span></span>
<span id="cb85-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-12" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># non-rankable rowwise df</span></span>
<span id="cb85-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-13" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">as.data.frame</span>()</span>
<span id="cb85-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-14" aria-hidden="true" tabindex="-1"></a>    driver_splits_wide</span>
<span id="cb85-15"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb85-16"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-17"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-17" aria-hidden="true" tabindex="-1"></a>driver_splits_wide <span class="ot">=</span>  <span class="fu">get_driver_splits_wide</span>(driver_splits, splits)</span>
<span id="cb85-18"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb85-19" aria-hidden="true" tabindex="-1"></a>driver_splits_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId  3615  3601  3621  3617  3593
## 1   21530 161.7 272.3 471.3 690.4 789.2
## 2   21531 162.3 273.7 472.3 692.1 792.4</code></pre>
</div>
<div id="multiple-stage-long-splits-data" class="section level3" number="2.8.3">
<h3><span class="header-section-number">2.8.3</span> Multiple Stage Long Splits Data</h3>
<p>A convenient way of working with the split times across multiple stages is to put the splits into a long form and then filter out the rows we are interested in.</p>
<p>We can generate a long form dataframe using the <code>dlplyr::bind_rows()</code> that we have met before:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-1" aria-hidden="true" tabindex="-1"></a>get_split_times2 <span class="ot">=</span> <span class="cf">function</span>(stageId, eventId) {</span>
<span id="cb87-2"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-2" aria-hidden="true" tabindex="-1"></a>                              splits <span class="ot">=</span> <span class="fu">get_splits</span>(eventId, stageId)</span>
<span id="cb87-3"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-3" aria-hidden="true" tabindex="-1"></a>                              split_times <span class="ot">=</span> splits<span class="sc">$</span>entrySplitPointTimes</span>
<span id="cb87-4"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-4" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">names</span>(split_times<span class="sc">$</span>splitPointTimes) <span class="ot">=</span> splits<span class="sc">$</span>splitPoints<span class="sc">$</span>splitPointId</span>
<span id="cb87-5"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-5" aria-hidden="true" tabindex="-1"></a>                              split_times<span class="sc">$</span>splitPointTimes</span>
<span id="cb87-6"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-6" aria-hidden="true" tabindex="-1"></a>                            }</span>
<span id="cb87-7"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-8" aria-hidden="true" tabindex="-1"></a>get_multi_split_times <span class="ot">=</span> <span class="cf">function</span>(stage_list){</span>
<span id="cb87-9"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-9" aria-hidden="true" tabindex="-1"></a>  multi_split_times <span class="ot">=</span> stage_list <span class="sc">%&gt;%</span></span>
<span id="cb87-10"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-10" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">map</span>(get_split_times2, <span class="at">eventId=</span>eventId) <span class="sc">%&gt;%</span> </span>
<span id="cb87-11"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-11" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">bind_rows</span>()</span>
<span id="cb87-12"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-12" aria-hidden="true" tabindex="-1"></a>  multi_split_times</span>
<span id="cb87-13"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-14"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-15" aria-hidden="true" tabindex="-1"></a>stage_list_sample <span class="ot">=</span> stage_list[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb87-16"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-17"><a href="accessing-data-from-the-wrc-live-timing-api.html#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="fu">get_multi_split_times</span>(stage_list[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   splitPointTimeId splitPointId entryId elapsedDurationMs elapsedDuration
## 1           122826         3596   21530            135200       PT2M15.2S
## 2           122828         3608   21530            330100       PT5M30.1S
## 3           122829         3603   21530            473700       PT7M53.7S
##           splitDateTime          splitDateTimeLocal
## 1 2021-02-26T13:10:15.2 2021-02-26T15:10:15.2+02:00
## 2 2021-02-26T13:13:30.1 2021-02-26T15:13:30.1+02:00
## 3 2021-02-26T13:15:53.7 2021-02-26T15:15:53.7+02:00</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualising-results-for-a-single-stage.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/edit/master/wrc-api.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/blob/master/wrc-api.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
