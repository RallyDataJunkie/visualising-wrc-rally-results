[["index.html", "Visualising WRC Rally Timing and Results Data A RallyDataJunkie Adventure Index", " Visualising WRC Rally Timing and Results Data A RallyDataJunkie Adventure Tony Hirst Index "],["introduction.html", "1 Introduction", " 1 Introduction For fans of WRC, the live timing data screens as well as results from ewrc-results.com provide up-to-date information about timing and results over the course of an event weekend, as well as a historical results for the current season (WRC) as well as back into the mists of time (ewrc-results). In this recipe collection, I’ll describe various ways of visualising WRC rally results and timing data using data retrieved from the WRC results API. Many of the techniques should also apply directly to data retreived from other services, such as ewrc-results.com if the data is appropriately represented. "],["accessing-data-from-the-wrc-live-timing-api.html", "2 Accessing Data from the WRC Live Timing API 2.1 Current Season Rallies 2.2 Itinerary Lookup 2.3 Competitor Details 2.4 Penalties and Retirements 2.5 Results and Stage Winner 2.6 Stage Result 2.7 Stage Times 2.8 Split Times", " 2 Accessing Data from the WRC Live Timing API We can get rally details, timing and results data from the WRC live timing service JSON API. 2.1 Current Season Rallies To start with, let’s see what rallies are scheduled for the current, active season. The jsonlite::fromJSON() will retrieve a JSON (JavaScript Object Notation) file from a URL and attempt to unpack it into an R dataframe: library(jsonlite) library(stringr) library(dplyr) get_active_season = function(active_season_url=&quot;https://api.wrc.com/contel-page/83388/calendar/active-season/&quot;) { jsonlite::fromJSON(active_season_url)$rallyEvents$items } s = get_active_season() # Preview the column names of the resulting dataframe colnames(s) ## [1] &quot;id&quot; &quot;name&quot; &quot;active&quot; &quot;jwrc&quot; &quot;deleted&quot; ## [6] &quot;rally&quot; &quot;status&quot; &quot;pageInfo&quot; &quot;pageResult&quot; &quot;eventDays&quot; ## [11] &quot;winner&quot; Let’s preview the contents of a couple of those columns: # The tidyr / magrittr pipe syntax makes things easier to read s %&gt;% select(c(&#39;id&#39;, &#39;name&#39;)) %&gt;% head() ## id name ## 1 1695 WRC Rallye Monte-Carlo ## 2 1745 WRC Arctic Rally Finland Powered by CapitalBox ## 3 1696 WRC Croatia Rally ## 4 1698 WRC Vodafone Rally de Portugal ## 5 1704 WRC Rally Italia Sardegna ## 6 1709 WRC Safari Rally Kenya We can search the name column to find the unique identifier value for a particular event: eventId = s[s[&#39;name&#39;]==&#39;WRC Arctic Rally Finland Powered by CapitalBox&#39;,&#39;id&#39;] eventId ## [1] 1745 Or we can be more generic with a regular expression lookup: get_eventId_from_name = function(season, name){ season[str_detect(season$name, regex(name, ignore_case = T)), &#39;id&#39;] } get_eventId_from_name(s, &#39;arctic&#39;) ## [1] 1745 2.2 Itinerary Lookup We can make another call to the WRC API to look up the itinerary for the event. Each leg of the event corresponds to a particular day: results_api = &#39;https://api.wrc.com/results-api&#39; get_itinerary = function(eventId) { jsonlite::fromJSON(paste0(results_api,&quot;/rally-event/&quot;, eventId, &quot;/itinerary&quot;))$itineraryLegs } itinerary = get_itinerary(eventId) itinerary ## itinerarySections ## 1 7527, 7564, 7563, 7562, 7531, 170, 170, 170, 170, 170, NA, 1747, 1747, 1747, NA, TimeControl, TimeControl, StageStart, FlyingFinish, RegroupIn, TC0, TC1, SS1, SF1, TC1A, Start ( Santasport, Rovaniemi ), Sarriojärvi, Sarriojärvi 1 (Live TV), Sarriojärvi 1 (Live TV), Regroup IN, Minute, Minute, Minute, Tenth, Minute, NA, 77.79, 31.05, NA, 31.57, NA, 01:32:00, 00:06:00, NA, 01:20:00, NA, 5520000, 360000, NA, 4800000, 2021-02-26T11:30:00, 2021-02-26T13:02:00, 2021-02-26T13:08:00, NA, 2021-02-26T14:28:00, 2021-02-26T13:30:00+02:00, 2021-02-26T15:02:00+02:00, 2021-02-26T15:08:00+02:00, NA, 2021-02-26T16:28:00+02:00, Completed, Completed, Completed, Completed, Completed, All, All, None, None, All, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, 7532, 7561, 7560, 7559, 7533, 7526, 7535, 7534, 170, 170, 170, 170, 170, 170, 170, 170, NA, 1743, 1743, 1743, NA, NA, NA, NA, RegroupOut, TimeControl, StageStart, FlyingFinish, TimeControl, TimeControl, TimeControl, TimeControl, TC1B, TC2, SS2, SF2, TC2A, TC2B, TC2C, TC2D, Regroup OUT, Sarriojärvi, Sarriojärvi 2 (Live TV), Sarriojärvi 2 (Live TV), Parc Fermé &amp; Technical Zone IN, Parc Fermé &amp; Technical Zone Santasport, Service OUT, Finish DAY 1 /Parc Fermé 1 Sampokeskus, Minute, Minute, Minute, Tenth, Minute, Minute, Minute, Minute, 0, 10.23, 31.05, NA, 64.62, 0, 0, 2.83, 01:40:00, 00:24:00, 00:06:00, NA, 01:30:00, 00:10:00, 00:45:00, 00:30:00, 6000000, 1440000, 360000, NA, 5400000, 600000, 2700000, 1800000, 2021-02-26T16:08:00, 2021-02-26T16:32:00, 2021-02-26T16:38:00, NA, 2021-02-26T18:08:00, 2021-02-26T18:18:00, 2021-02-26T19:03:00, 2021-02-26T19:33:00, 2021-02-26T18:08:00+02:00, 2021-02-26T18:32:00+02:00, 2021-02-26T18:38:00+02:00, NA, 2021-02-26T20:08:00+02:00, 2021-02-26T20:18:00+02:00, 2021-02-26T21:03:00+02:00, 2021-02-26T21:33:00+02:00, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, None, All, None, None, All, None, None, None, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, NoRounding, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 1747, 170, 1, Sarriojärvi 1 (Live TV), 31.05, Completed, SpecialStage, Tenth, TRUE, SS1, 1743, 170, 2, Sarriojärvi 2 (Live TV), 31.05, Completed, SpecialStage, Tenth, TRUE, SS2, 733, 734, 320, 320, 1, 2, Section 1, Section 2 ## 2 7530, 7529, 7528, 7558, 7557, 7556, 7555, 7554, 7553, 7565, 7536, 7550, 7524, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, NA, NA, NA, 1750, 1750, 1750, 1751, 1751, 1751, 1748, 1748, 1748, NA, TimeControl, TimeControl, TimeControl, TimeControl, StageStart, FlyingFinish, TimeControl, StageStart, FlyingFinish, TimeControl, StageStart, FlyingFinish, RegroupIn, TC2E, TC2F, TC2G, TC3, SS3, SF3, TC4, SS4, SF4, TC5, SS5, SF5, TC5A, Parc Fermé OUT, Service IN, Service OUT , Mustalampi, Mustalampi 1, Mustalampi 1, Kaihuavaara, Kaihuavaara 1 (Live TV), Kaihuavaara 1 (Live TV), Siikakämä, Siikakämä 1, Siikakämä 1, Regroup &amp; Technical Zone IN, Minute, Minute, Minute, Minute, Minute, Tenth, Minute, Minute, Tenth, Minute, Minute, Tenth, Minute, 0, 2.7, 0, 37.03, 24.43, NA, 28.96, 19.91, NA, 50.79, 27.68, NA, 37.57, NA, 00:15:00, 00:15:00, 01:00:00, 00:03:00, NA, 01:24:00, 00:06:00, NA, 01:27:00, 00:03:00, NA, 01:12:00, NA, 900000, 900000, 3600000, 180000, NA, 5040000, 360000, NA, 5220000, 180000, NA, 4320000, 2021-02-27T05:35:00, 2021-02-27T05:50:00, 2021-02-27T06:05:00, 2021-02-27T07:05:00, 2021-02-27T07:08:00, NA, 2021-02-27T08:32:00, 2021-02-27T08:38:00, NA, 2021-02-27T10:05:00, 2021-02-27T10:08:00, NA, 2021-02-27T11:20:00, 2021-02-27T07:35:00+02:00, 2021-02-27T07:50:00+02:00, 2021-02-27T08:05:00+02:00, 2021-02-27T09:05:00+02:00, 2021-02-27T09:08:00+02:00, NA, 2021-02-27T10:32:00+02:00, 2021-02-27T10:38:00+02:00, NA, 2021-02-27T12:05:00+02:00, 2021-02-27T12:08:00+02:00, NA, 2021-02-27T13:20:00+02:00, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Late, All, All, All, None, None, All, None, None, All, None, None, All, NoRounding, NoRounding, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 7512, 7522, 7549, 7548, 7547, 7546, 7545, 7544, 7543, 7542, 7541, 7521, 7520, 7519, 7518, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, NA, NA, 1745, 1745, 1745, 1744, 1744, 1744, 1742, 1742, 1742, NA, NA, NA, NA, RegroupOut, TimeControl, TimeControl, StageStart, FlyingFinish, TimeControl, StageStart, FlyingFinish, TimeControl, StageStart, FlyingFinish, TimeControl, TimeControl, TimeControl, TimeControl, TC5B, TC5C, TC6, SS6, SF6, TC7, SS7, SF7, TC8, SS8, SF8, TC8A, TC8B, TC8C, TC8D, Regroup &amp; Technical Zone OUT - Service IN, Service OUT, Mustalampi, Mustalampi 2, Mustalampi 2, Kaihuavaara, Kaihuavaara 2 (Live TV), Kaihuavaara 2 (Live TV), Siikakämä, Siikakämä 2, Siikakämä 2, Parc Fermé &amp; Technical Zone IN, Parc Fermé &amp; Technical Zone Santasport, Service Out , Finish DAY 2 /Parc Fermé 2 Sampokeskus, Minute, Minute, Minute, Minute, Tenth, Minute, Minute, Tenth, Minute, Minute, Tenth, Minute, Minute, Minute, Minute, 0, NA, 37.03, 24.43, NA, 28.96, 19.91, NA, 50.79, 27.68, NA, 37.57, 0, 0, 2.83, 00:45:00, 00:30:00, 01:00:00, 00:03:00, NA, 01:24:00, 00:06:00, NA, 01:27:00, 00:03:00, NA, 01:20:00, 00:10:00, 00:45:00, 00:30:00, 2700000, 1800000, 3600000, 180000, NA, 5040000, 360000, NA, 5220000, 180000, NA, 4800000, 600000, 2700000, 1800000, 2021-02-27T12:05:00, 2021-02-27T12:35:00, 2021-02-27T13:35:00, 2021-02-27T13:38:00, NA, 2021-02-27T15:02:00, 2021-02-27T15:08:00, NA, 2021-02-27T16:35:00, 2021-02-27T16:38:00, NA, 2021-02-27T17:58:00, 2021-02-27T18:08:00, 2021-02-27T18:53:00, 2021-02-27T19:23:00, 2021-02-27T14:05:00+02:00, 2021-02-27T14:35:00+02:00, 2021-02-27T15:35:00+02:00, 2021-02-27T15:38:00+02:00, NA, 2021-02-27T17:02:00+02:00, 2021-02-27T17:08:00+02:00, NA, 2021-02-27T18:35:00+02:00, 2021-02-27T18:38:00+02:00, NA, 2021-02-27T19:58:00+02:00, 2021-02-27T20:08:00+02:00, 2021-02-27T20:53:00+02:00, 2021-02-27T21:23:00+02:00, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, None, None, All, None, None, All, None, None, All, None, None, All, None, None, None, NoRounding, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, NoRounding, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, NoRounding, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 1750, 1751, 1748, 170, 170, 170, 3, 4, 5, Mustalampi 1, Kaihuavaara 1 (Live TV), Siikakämä 1, 24.43, 19.91, 27.68, Completed, Completed, Completed, SpecialStage, SpecialStage, SpecialStage, Tenth, Tenth, Tenth, TRUE, TRUE, TRUE, SS3, SS4, SS5, 1745, 1744, 1742, 170, 170, 170, 6, 7, 8, Mustalampi 2, Kaihuavaara 2 (Live TV), Siikakämä 2, 24.43, 19.91, 27.68, Completed, Completed, Completed, SpecialStage, SpecialStage, SpecialStage, Tenth, Tenth, Tenth, TRUE, TRUE, TRUE, SS6, SS7, SS8, 735, 736, 319, 319, 3, 4, Section 3, Section 4 ## 3 7517, 7516, 7515, 7540, 7539, 7538, 7514, 170, 170, 170, 170, 170, 170, 170, NA, NA, NA, 1746, 1746, 1746, NA, TimeControl, TimeControl, TimeControl, TimeControl, StageStart, FlyingFinish, RegroupIn, TC8E, TC8F, TC8G, TC9, SS9, SF9, TC9A, Parc Fermé OUT, Service IN, Service OUT, Aittajärvi, Aittajärvi 1 (Live TV), Aittajärvi 1 (Live TV), Regroup &amp; Technical Zone IN, Minute, Minute, Minute, Minute, Minute, Tenth, Minute, 0, 2.7, 0, 29.5, 22.47, NA, 21, NA, 00:15:00, 00:15:00, 00:47:00, 00:06:00, NA, 01:00:00, NA, 900000, 900000, 2820000, 360000, NA, 3600000, 2021-02-28T06:45:00, 2021-02-28T07:00:00, 2021-02-28T07:15:00, 2021-02-28T08:02:00, 2021-02-28T08:08:00, NA, 2021-02-28T09:08:00, 2021-02-28T08:45:00+02:00, 2021-02-28T09:00:00+02:00, 2021-02-28T09:15:00+02:00, 2021-02-28T10:02:00+02:00, 2021-02-28T10:08:00+02:00, NA, 2021-02-28T11:08:00+02:00, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Late, All, All, All, None, None, All, NoRounding, NoRounding, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 7513, 7537, 7551, 7552, 7523, 7525, 170, 170, 170, 170, 170, 170, NA, 1749, 1749, 1749, NA, NA, RegroupOut, TimeControl, StageStart, FlyingFinish, TimeControl, TimeControl, TC9B, TC10, SS10, SF10, TC10A, TC10B, Regroup OUT, Aittajärvi, Aittajärvi 2 (Wolf Power Stage), Aittajärvi 2 (Wolf Power Stage), Holding Area OUT, Finish - Technical Zone/Parc Fermé IN Santasport, Minute, Minute, Minute, Thousandth, Minute, Minute, 0, 29.5, 22.47, NA, NA, 21, 01:17:00, 00:47:00, 00:06:00, NA, NA, 00:50:00, 4620000, 2820000, 360000, NA, NA, 3000000, 2021-02-28T10:25:00, 2021-02-28T11:12:00, 2021-02-28T11:18:00, NA, NA, NA, 2021-02-28T12:25:00+02:00, 2021-02-28T13:12:00+02:00, 2021-02-28T13:18:00+02:00, NA, NA, NA, Completed, Completed, Completed, Completed, Completed, Completed, None, All, None, None, None, Late, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, 1746, 170, 9, Aittajärvi 1 (Live TV), 22.47, Completed, SpecialStage, Tenth, FALSE, SS9, 1749, 170, 10, Aittajärvi 2 (Wolf Power Stage), 22.47, Completed, PowerStage, Thousandth, FALSE, SS10, 737, 738, 318, 318, 5, 6, Section 5, Section 6 ## itineraryLegId itineraryId startListId name legDate ## 1 320 266 523 Friday 26th February 2021-02-26 ## 2 319 266 524 Saturday 27th February 2021-02-27 ## 3 318 266 525 Sunday 28th February 2021-02-28 ## order status ## 1 1 Completed ## 2 2 Completed ## 3 3 Running The startListId can be used alongside the event ID to look up the startlist for a leg. We can order the startlist by start order: get_startlist = function(eventId, startListId) { startlist_url = paste0(results_api, &#39;/rally-event/&#39;, eventId,&#39;/start-list-external/&#39;, startListId) startlist = jsonlite::fromJSON(startlist_url)$startListItems # Order the startlist dataframe by start order startlist %&gt;% arrange(order) } # Example startlist ID # Use a regular expression to find the startlist ID by day startListId = itinerary[str_detect(itinerary$name, regex(&#39;Friday&#39;, ignore_case = T)), &#39;startListId&#39;] startlist = get_startlist(eventId, startListId) startlist %&gt;% head() ## startListItemId startListId entryId startDateTime ## 1 24435 523 21530 2021-02-26T11:30:00 ## 2 24409 523 21531 2021-02-26T11:33:00 ## 3 24410 523 21532 2021-02-26T11:36:00 ## 4 24411 523 21533 2021-02-26T11:39:00 ## 5 24412 523 21534 2021-02-26T11:42:00 ## 6 24413 523 21535 2021-02-26T11:45:00 ## startDateTimeLocal order ## 1 2021-02-26T13:30:00+02:00 1 ## 2 2021-02-26T13:33:00+02:00 2 ## 3 2021-02-26T13:36:00+02:00 3 ## 4 2021-02-26T13:39:00+02:00 4 ## 5 2021-02-26T13:42:00+02:00 5 ## 6 2021-02-26T13:45:00+02:00 6 2.2.1 Leg Sections Within each leg, the itinerary provides information about each section (that is, each “loop”) of the rally. This information is retrieved in form of a dataframe in a standard format. We can use the base R do.call() to call the rbind() function against each row of the dataframe and bind all the dataframes in a specified column into a single dataframe: get_sections = function(itinerary){ sections = do.call(rbind, itinerary$itinerarySections) sections } sections = get_sections(itinerary) sections %&gt;% head() ## controls ## 1 7527, 7564, 7563, 7562, 7531, 170, 170, 170, 170, 170, NA, 1747, 1747, 1747, NA, TimeControl, TimeControl, StageStart, FlyingFinish, RegroupIn, TC0, TC1, SS1, SF1, TC1A, Start ( Santasport, Rovaniemi ), Sarriojärvi, Sarriojärvi 1 (Live TV), Sarriojärvi 1 (Live TV), Regroup IN, Minute, Minute, Minute, Tenth, Minute, NA, 77.79, 31.05, NA, 31.57, NA, 01:32:00, 00:06:00, NA, 01:20:00, NA, 5520000, 360000, NA, 4800000, 2021-02-26T11:30:00, 2021-02-26T13:02:00, 2021-02-26T13:08:00, NA, 2021-02-26T14:28:00, 2021-02-26T13:30:00+02:00, 2021-02-26T15:02:00+02:00, 2021-02-26T15:08:00+02:00, NA, 2021-02-26T16:28:00+02:00, Completed, Completed, Completed, Completed, Completed, All, All, None, None, All, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE ## 2 7532, 7561, 7560, 7559, 7533, 7526, 7535, 7534, 170, 170, 170, 170, 170, 170, 170, 170, NA, 1743, 1743, 1743, NA, NA, NA, NA, RegroupOut, TimeControl, StageStart, FlyingFinish, TimeControl, TimeControl, TimeControl, TimeControl, TC1B, TC2, SS2, SF2, TC2A, TC2B, TC2C, TC2D, Regroup OUT, Sarriojärvi, Sarriojärvi 2 (Live TV), Sarriojärvi 2 (Live TV), Parc Fermé &amp; Technical Zone IN, Parc Fermé &amp; Technical Zone Santasport, Service OUT, Finish DAY 1 /Parc Fermé 1 Sampokeskus, Minute, Minute, Minute, Tenth, Minute, Minute, Minute, Minute, 0, 10.23, 31.05, NA, 64.62, 0, 0, 2.83, 01:40:00, 00:24:00, 00:06:00, NA, 01:30:00, 00:10:00, 00:45:00, 00:30:00, 6000000, 1440000, 360000, NA, 5400000, 600000, 2700000, 1800000, 2021-02-26T16:08:00, 2021-02-26T16:32:00, 2021-02-26T16:38:00, NA, 2021-02-26T18:08:00, 2021-02-26T18:18:00, 2021-02-26T19:03:00, 2021-02-26T19:33:00, 2021-02-26T18:08:00+02:00, 2021-02-26T18:32:00+02:00, 2021-02-26T18:38:00+02:00, NA, 2021-02-26T20:08:00+02:00, 2021-02-26T20:18:00+02:00, 2021-02-26T21:03:00+02:00, 2021-02-26T21:33:00+02:00, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, None, All, None, None, All, None, None, None, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, NoRounding, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE ## 3 7530, 7529, 7528, 7558, 7557, 7556, 7555, 7554, 7553, 7565, 7536, 7550, 7524, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, NA, NA, NA, 1750, 1750, 1750, 1751, 1751, 1751, 1748, 1748, 1748, NA, TimeControl, TimeControl, TimeControl, TimeControl, StageStart, FlyingFinish, TimeControl, StageStart, FlyingFinish, TimeControl, StageStart, FlyingFinish, RegroupIn, TC2E, TC2F, TC2G, TC3, SS3, SF3, TC4, SS4, SF4, TC5, SS5, SF5, TC5A, Parc Fermé OUT, Service IN, Service OUT , Mustalampi, Mustalampi 1, Mustalampi 1, Kaihuavaara, Kaihuavaara 1 (Live TV), Kaihuavaara 1 (Live TV), Siikakämä, Siikakämä 1, Siikakämä 1, Regroup &amp; Technical Zone IN, Minute, Minute, Minute, Minute, Minute, Tenth, Minute, Minute, Tenth, Minute, Minute, Tenth, Minute, 0, 2.7, 0, 37.03, 24.43, NA, 28.96, 19.91, NA, 50.79, 27.68, NA, 37.57, NA, 00:15:00, 00:15:00, 01:00:00, 00:03:00, NA, 01:24:00, 00:06:00, NA, 01:27:00, 00:03:00, NA, 01:12:00, NA, 900000, 900000, 3600000, 180000, NA, 5040000, 360000, NA, 5220000, 180000, NA, 4320000, 2021-02-27T05:35:00, 2021-02-27T05:50:00, 2021-02-27T06:05:00, 2021-02-27T07:05:00, 2021-02-27T07:08:00, NA, 2021-02-27T08:32:00, 2021-02-27T08:38:00, NA, 2021-02-27T10:05:00, 2021-02-27T10:08:00, NA, 2021-02-27T11:20:00, 2021-02-27T07:35:00+02:00, 2021-02-27T07:50:00+02:00, 2021-02-27T08:05:00+02:00, 2021-02-27T09:05:00+02:00, 2021-02-27T09:08:00+02:00, NA, 2021-02-27T10:32:00+02:00, 2021-02-27T10:38:00+02:00, NA, 2021-02-27T12:05:00+02:00, 2021-02-27T12:08:00+02:00, NA, 2021-02-27T13:20:00+02:00, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Late, All, All, All, None, None, All, None, None, All, None, None, All, NoRounding, NoRounding, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE ## 4 7512, 7522, 7549, 7548, 7547, 7546, 7545, 7544, 7543, 7542, 7541, 7521, 7520, 7519, 7518, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, NA, NA, 1745, 1745, 1745, 1744, 1744, 1744, 1742, 1742, 1742, NA, NA, NA, NA, RegroupOut, TimeControl, TimeControl, StageStart, FlyingFinish, TimeControl, StageStart, FlyingFinish, TimeControl, StageStart, FlyingFinish, TimeControl, TimeControl, TimeControl, TimeControl, TC5B, TC5C, TC6, SS6, SF6, TC7, SS7, SF7, TC8, SS8, SF8, TC8A, TC8B, TC8C, TC8D, Regroup &amp; Technical Zone OUT - Service IN, Service OUT, Mustalampi, Mustalampi 2, Mustalampi 2, Kaihuavaara, Kaihuavaara 2 (Live TV), Kaihuavaara 2 (Live TV), Siikakämä, Siikakämä 2, Siikakämä 2, Parc Fermé &amp; Technical Zone IN, Parc Fermé &amp; Technical Zone Santasport, Service Out , Finish DAY 2 /Parc Fermé 2 Sampokeskus, Minute, Minute, Minute, Minute, Tenth, Minute, Minute, Tenth, Minute, Minute, Tenth, Minute, Minute, Minute, Minute, 0, NA, 37.03, 24.43, NA, 28.96, 19.91, NA, 50.79, 27.68, NA, 37.57, 0, 0, 2.83, 00:45:00, 00:30:00, 01:00:00, 00:03:00, NA, 01:24:00, 00:06:00, NA, 01:27:00, 00:03:00, NA, 01:20:00, 00:10:00, 00:45:00, 00:30:00, 2700000, 1800000, 3600000, 180000, NA, 5040000, 360000, NA, 5220000, 180000, NA, 4800000, 600000, 2700000, 1800000, 2021-02-27T12:05:00, 2021-02-27T12:35:00, 2021-02-27T13:35:00, 2021-02-27T13:38:00, NA, 2021-02-27T15:02:00, 2021-02-27T15:08:00, NA, 2021-02-27T16:35:00, 2021-02-27T16:38:00, NA, 2021-02-27T17:58:00, 2021-02-27T18:08:00, 2021-02-27T18:53:00, 2021-02-27T19:23:00, 2021-02-27T14:05:00+02:00, 2021-02-27T14:35:00+02:00, 2021-02-27T15:35:00+02:00, 2021-02-27T15:38:00+02:00, NA, 2021-02-27T17:02:00+02:00, 2021-02-27T17:08:00+02:00, NA, 2021-02-27T18:35:00+02:00, 2021-02-27T18:38:00+02:00, NA, 2021-02-27T19:58:00+02:00, 2021-02-27T20:08:00+02:00, 2021-02-27T20:53:00+02:00, 2021-02-27T21:23:00+02:00, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Completed, None, None, All, None, None, All, None, None, All, None, None, All, None, None, None, NoRounding, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, NoRounding, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, NoRounding, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE ## 5 7517, 7516, 7515, 7540, 7539, 7538, 7514, 170, 170, 170, 170, 170, 170, 170, NA, NA, NA, 1746, 1746, 1746, NA, TimeControl, TimeControl, TimeControl, TimeControl, StageStart, FlyingFinish, RegroupIn, TC8E, TC8F, TC8G, TC9, SS9, SF9, TC9A, Parc Fermé OUT, Service IN, Service OUT, Aittajärvi, Aittajärvi 1 (Live TV), Aittajärvi 1 (Live TV), Regroup &amp; Technical Zone IN, Minute, Minute, Minute, Minute, Minute, Tenth, Minute, 0, 2.7, 0, 29.5, 22.47, NA, 21, NA, 00:15:00, 00:15:00, 00:47:00, 00:06:00, NA, 01:00:00, NA, 900000, 900000, 2820000, 360000, NA, 3600000, 2021-02-28T06:45:00, 2021-02-28T07:00:00, 2021-02-28T07:15:00, 2021-02-28T08:02:00, 2021-02-28T08:08:00, NA, 2021-02-28T09:08:00, 2021-02-28T08:45:00+02:00, 2021-02-28T09:00:00+02:00, 2021-02-28T09:15:00+02:00, 2021-02-28T10:02:00+02:00, 2021-02-28T10:08:00+02:00, NA, 2021-02-28T11:08:00+02:00, Completed, Completed, Completed, Completed, Completed, Completed, Completed, Late, All, All, All, None, None, All, NoRounding, NoRounding, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE ## 6 7513, 7537, 7551, 7552, 7523, 7525, 170, 170, 170, 170, 170, 170, NA, 1749, 1749, 1749, NA, NA, RegroupOut, TimeControl, StageStart, FlyingFinish, TimeControl, TimeControl, TC9B, TC10, SS10, SF10, TC10A, TC10B, Regroup OUT, Aittajärvi, Aittajärvi 2 (Wolf Power Stage), Aittajärvi 2 (Wolf Power Stage), Holding Area OUT, Finish - Technical Zone/Parc Fermé IN Santasport, Minute, Minute, Minute, Thousandth, Minute, Minute, 0, 29.5, 22.47, NA, NA, 21, 01:17:00, 00:47:00, 00:06:00, NA, NA, 00:50:00, 4620000, 2820000, 360000, NA, NA, 3000000, 2021-02-28T10:25:00, 2021-02-28T11:12:00, 2021-02-28T11:18:00, NA, NA, NA, 2021-02-28T12:25:00+02:00, 2021-02-28T13:12:00+02:00, 2021-02-28T13:18:00+02:00, NA, NA, NA, Completed, Completed, Completed, Completed, Completed, Completed, None, All, None, None, None, Late, NoRounding, NoRounding, RoundToClosestMinute, NoRounding, NoRounding, NoRounding, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE ## stages ## 1 1747, 170, 1, Sarriojärvi 1 (Live TV), 31.05, Completed, SpecialStage, Tenth, TRUE, SS1 ## 2 1743, 170, 2, Sarriojärvi 2 (Live TV), 31.05, Completed, SpecialStage, Tenth, TRUE, SS2 ## 3 1750, 1751, 1748, 170, 170, 170, 3, 4, 5, Mustalampi 1, Kaihuavaara 1 (Live TV), Siikakämä 1, 24.43, 19.91, 27.68, Completed, Completed, Completed, SpecialStage, SpecialStage, SpecialStage, Tenth, Tenth, Tenth, TRUE, TRUE, TRUE, SS3, SS4, SS5 ## 4 1745, 1744, 1742, 170, 170, 170, 6, 7, 8, Mustalampi 2, Kaihuavaara 2 (Live TV), Siikakämä 2, 24.43, 19.91, 27.68, Completed, Completed, Completed, SpecialStage, SpecialStage, SpecialStage, Tenth, Tenth, Tenth, TRUE, TRUE, TRUE, SS6, SS7, SS8 ## 5 1746, 170, 9, Aittajärvi 1 (Live TV), 22.47, Completed, SpecialStage, Tenth, FALSE, SS9 ## 6 1749, 170, 10, Aittajärvi 2 (Wolf Power Stage), 22.47, Completed, PowerStage, Thousandth, FALSE, SS10 ## itinerarySectionId itineraryLegId order name ## 1 733 320 1 Section 1 ## 2 734 320 2 Section 2 ## 3 735 319 3 Section 3 ## 4 736 319 4 Section 4 ## 5 737 318 5 Section 5 ## 6 738 318 6 Section 6 In the sections dataframe we have one row per section. We notice again the presence of columns that use dataframes to “nest” subdataframes within each row relating to to timing controls and stages associated with each leg. 2.2.2 Time Controls We can look up information about each time control from data provided as part of the itinerary lookup using the same trick as before to “unroll” the contents of each dataframe in a specified column into a single dataframe. An alternative to the do.call() approach is to use a tidy approach and use the dplyr::bind_rows() function on the sections$controls column values via a pipe: get_controls = function(sections){ controls = sections$controls %&gt;% bind_rows() controls } controls = get_controls(sections) controls %&gt;% head(2) ## controlId eventId stageId type code location ## 1 7527 170 NA TimeControl TC0 Start ( Santasport, Rovaniemi ) ## 2 7564 170 1747 TimeControl TC1 Sarriojärvi ## timingPrecision distance targetDuration targetDurationMs firstCarDueDateTime ## 1 Minute NA &lt;NA&gt; NA 2021-02-26T11:30:00 ## 2 Minute 77.79 01:32:00 5520000 2021-02-26T13:02:00 ## firstCarDueDateTimeLocal status controlPenalties roundingPolicy locked ## 1 2021-02-26T13:30:00+02:00 Completed All NoRounding TRUE ## 2 2021-02-26T15:02:00+02:00 Completed All NoRounding TRUE 2.2.3 Stage Details We can pull stage details from the dataframes contained in the sections dataframe from the itinerary lookup: get_stages = function(sections){ stages = sections$stages %&gt;% bind_rows() stages } stages = get_stages(sections) stages %&gt;% head() ## stageId eventId number name distance status ## 1 1747 170 1 Sarriojärvi 1 (Live TV) 31.05 Completed ## 2 1743 170 2 Sarriojärvi 2 (Live TV) 31.05 Completed ## 3 1750 170 3 Mustalampi 1 24.43 Completed ## 4 1751 170 4 Kaihuavaara 1 (Live TV) 19.91 Completed ## 5 1748 170 5 Siikakämä 1 27.68 Completed ## 6 1745 170 6 Mustalampi 2 24.43 Completed ## stageType timingPrecision locked code ## 1 SpecialStage Tenth TRUE SS1 ## 2 SpecialStage Tenth TRUE SS2 ## 3 SpecialStage Tenth TRUE SS3 ## 4 SpecialStage Tenth TRUE SS4 ## 5 SpecialStage Tenth TRUE SS5 ## 6 SpecialStage Tenth TRUE SS6 We can get a list of stage IDs from the stageId column (stages$stageId); or we can create a lookup from code to stage ID: # https://stackoverflow.com/a/19265431/454773 get_stages_lookup = function(stages){ stages_lookup = stages$stageId names(stages_lookup) = stages$code stages_lookup } stages_lookup = get_stages_lookup(stages) stages_lookup ## SS1 SS2 SS3 SS4 SS5 SS6 SS7 SS8 SS9 SS10 ## 1747 1743 1750 1751 1748 1745 1744 1742 1746 1749 # Lookup particular stage ID by stage code #stages_lookup[[&#39;SS2&#39;]] From the stages table, we can get the identifier for a particular stage, either by code (for example, “SS3”) or by (partial) name match: ssnum = &#39;SS3&#39; get_stage_id = function(stages, sname, typ=&#39;code&#39;){ # code, name if (typ==&#39;code&#39;) stageId = stages[stages[typ] == sname, &#39;stageId&#39;] else stageId = stages[stringr::str_detect(stages[[typ]], sname), &#39;stageId&#39;] stageId } stageId = get_stage_id(stages, &#39;Mustalampi 1&#39;, &#39;name&#39;) stageId ## [1] 1750 And the stage distance and name: get_stage_info = function(stages, sid, typ=&#39;stageId&#39;, clean=TRUE){ # stageId, code name=stages[stages[typ] == sid, &#39;name&#39;] distance=stages[stages[typ] == sid, &#39;distance&#39;] if (clean) stringr::str_replace(name, &#39; (Live TV)&#39;, &#39;&#39;) c(name=name, distance=distance) } get_stage_info(stages, stageId) ## name distance ## &quot;Mustalampi 1&quot; &quot;24.43&quot; 2.3 Competitor Details Details of car entries for each event can be retrieved from the WRC live timing API given an event ID. get_rally_entries = function(eventId) { cars_url = paste0(results_api, &#39;/rally-event/&#39;, eventId,&#39;/cars&#39;) jsonlite::fromJSON(cars_url) } entries = get_rally_entries(eventId) # $driver, $codriver, $manufacturer, $entrant, $group, $eventClasses # $identifier, $vehicleModel, $eligibility, $status entries %&gt;% head(2) ## driver.personId driver.countryId driver.country.countryId ## 1 670 76 76 ## 2 534 235 235 ## driver.country.name driver.country.iso2 ## 1 France FR ## 2 United Kingdom of Great Britain and Northern Ireland GB ## driver.country.iso3 driver.firstName driver.lastName driver.abbvName ## 1 FRA Sébastien OGIER S. OGIER ## 2 GBR Elfyn EVANS E. EVANS ## driver.fullName driver.code codriver.personId codriver.countryId ## 1 Sébastien OGIER OGI 3027 76 ## 2 Elfyn EVANS EVA 553 235 ## codriver.country.countryId ## 1 76 ## 2 235 ## codriver.country.name codriver.country.iso2 ## 1 France FR ## 2 United Kingdom of Great Britain and Northern Ireland GB ## codriver.country.iso3 codriver.firstName codriver.lastName codriver.abbvName ## 1 FRA Julien INGRASSIA J. INGRASSIA ## 2 GBR Scott MARTIN S. MARTIN ## codriver.fullName codriver.code manufacturer.manufacturerId manufacturer.name ## 1 Julien INGRASSIA ING 84 Toyota ## 2 Scott MARTIN MAR 84 Toyota ## manufacturer.logoFilename entrant.entrantId entrant.name ## 1 toyota 91 TOYOTA GAZOO RACING WRT ## 2 toyota 91 TOYOTA GAZOO RACING WRT ## entrant.logoFilename group.groupId group.name eventClasses tags entryId ## 1 &lt;NA&gt; 10 WRC 640, 170, RC1 NULL 21530 ## 2 &lt;NA&gt; 10 WRC 640, 170, RC1 NULL 21531 ## eventId driverId codriverId manufacturerId entrantId groupId entryListOrder ## 1 170 670 3027 84 91 10 1 ## 2 170 534 553 84 91 10 2 ## identifier vehicleModel eligibility priority status tyreManufacturer ## 1 1 Yaris WRC M P1 Rejoined None ## 2 33 Yaris WRC M P1 Entry None We can index the entries by group to find all the WRC car entryId values: entries[entries$group$name==&#39;WRC&#39;, &#39;entryId&#39;] ## [1] 21530 21531 21532 21533 21534 21535 21536 21537 21538 21539 21540 21541 ## [13] 21542 Detailed information for each driver and codriver can be found in the corresponding sub-dataframes. For example, we can look up the details for each driver, noting in this case that we need to column bind (cbind()) the subdataframes to produce the collated dataframe of driver details: get_drivers = function(entries){ drivers = do.call(cbind, entries$driver) drivers } drivers = get_drivers(entries) drivers %&gt;% head(2) ## personId countryId country.countryId ## 1 670 76 76 ## 2 534 235 235 ## country.name country.iso2 ## 1 France FR ## 2 United Kingdom of Great Britain and Northern Ireland GB ## country.iso3 firstName lastName abbvName fullName code ## 1 FRA Sébastien OGIER S. OGIER Sébastien OGIER OGI ## 2 GBR Elfyn EVANS E. EVANS Elfyn EVANS EVA We can similarly obtain data for the codrivers: #codrivers = do.call(cbind, entries$codriver) # Again, there is a tidyverse approach with dplyr::bind_cols() get_codrivers = function(entries){ codrivers = bind_cols(entries$codriver) codrivers } codrivers = get_codrivers(entries) codrivers %&gt;% head(2) ## personId countryId country.countryId ## 1 3027 76 76 ## 2 553 235 235 ## country.name country.iso2 ## 1 France FR ## 2 United Kingdom of Great Britain and Northern Ireland GB ## country.iso3 firstName lastName abbvName fullName code ## 1 FRA Julien INGRASSIA J. INGRASSIA Julien INGRASSIA ING ## 2 GBR Scott MARTIN S. MARTIN Scott MARTIN MAR We can conveniently obtain the identifier for a particular driver or codriver by searching against their name or three letter code: get_person_id = function(drivers, sname, typ=&#39;fullName&#39;){ # code, fullName if (typ==&#39;code&#39;) driverId = drivers[drivers[typ]==sname, &#39;personId&#39;] else driverId = drivers[str_detect(drivers[[typ]], regex(sname, ignore_case = T)), &#39;personId&#39;] driverId } ogierDriverId = get_person_id(drivers, &#39;ogier&#39;) ogierDriverId ## [1] 670 From the driver person identifier we can get the entry identifier for the rally we’re exploring: ogierEntryId = entries[entries[&#39;driverId&#39;]==ogierDriverId, &#39;entryId&#39;] ogierEntryId ## [1] 21530 We can manually create a dataframe containing essential fields from the original cars dataframe and the dataframes contained within it: get_car_data = function(entries){ cols = c(&#39;entryId&#39;, &#39;driverId&#39;, &#39;codriverId&#39;,&#39;manufacturerId&#39;, &#39;vehicleModel&#39;,&#39;eligibility&#39;, &#39;classname&#39;,&#39;manufacturer&#39;, &#39;entrantname&#39;, &#39;groupname&#39;, &#39;drivername&#39;, &#39;code&#39;, &#39;driverfullname&#39;, &#39;codrivername&#39;,&#39;codriverfullname&#39; ) entries = entries %&gt;% rowwise() %&gt;% mutate(classname = eventClasses$name) %&gt;% mutate(manufacturer = manufacturer$name) %&gt;% mutate(entrantname = entrant$name) %&gt;% mutate(groupname = group$name) %&gt;% mutate(drivername = driver$abbvName) %&gt;% mutate(driverfullname = driver$fullName) %&gt;% mutate(codrivername = codriver$abbvName) %&gt;% mutate(codriverfullname = codriver$fullName) %&gt;% mutate(code = driver$code) %&gt;% select(all_of(cols)) # If we don&#39;t cast, it&#39;s a non-rankable rowwise df as.data.frame(entries) } get_car_data(entries) %&gt;% head(2) ## entryId driverId codriverId manufacturerId vehicleModel eligibility classname ## 1 21530 670 3027 84 Yaris WRC M RC1 ## 2 21531 534 553 84 Yaris WRC M RC1 ## manufacturer entrantname groupname drivername code ## 1 Toyota TOYOTA GAZOO RACING WRT WRC S. OGIER OGI ## 2 Toyota TOYOTA GAZOO RACING WRT WRC E. EVANS EVA ## driverfullname codrivername codriverfullname ## 1 Sébastien OGIER J. INGRASSIA Julien INGRASSIA ## 2 Elfyn EVANS S. MARTIN Scott MARTIN 2.4 Penalties and Retirements We can look up penalties from an event ID: get_penalties = function(eventId) { penalties_url = paste0(results_api, &#39;/rally-event/&#39;, eventId, &#39;/penalties&#39;) jsonlite::fromJSON(penalties_url) } get_penalties(eventId) %&gt;% head(2) ## penaltyId controlId entryId penaltyDurationMs penaltyDuration reason ## 1 959 7546 21559 10000 PT10S 1 MIN LATE ## 2 956 7533 21568 10000 PT10S 1 MIN LATE The event ID is also all we need to request a list of retirements: get_retirements = function(eventId) { retirements_url = paste0(results_api, &#39;/rally-event/&#39;, eventId, &#39;/retirements&#39;) jsonlite::fromJSON(retirements_url) } get_retirements(eventId) %&gt;% head(2) ## retirementId controlId entryId reason retirementDateTime ## 1 1802 7562 21547 MECHANICAL 2021-02-26T14:50:00 ## 2 1803 7556 21542 OFF ROAD 2021-02-27T08:01:00 ## retirementDateTimeLocal status ## 1 0001-01-01T00:00:00+00:00 Permanent ## 2 0001-01-01T00:00:00+00:00 Temporary 2.5 Results and Stage Winner As well as retrieving penalties and retirements using just the event ID as a key, we can also retrieve the overall results and the stage winners: get_result = function(eventId) { result_url = paste0(results_api, &#39;/rally-event/&#39;, eventId,&#39;/result&#39;) jsonlite::fromJSON(result_url) } get_result(eventId) %&gt;% head(2) ## entryId stageTimeMs stageTime penaltyTimeMs penaltyTime totalTimeMs ## 1 21536 7429600 PT2H3M49.6S 0 PT0S 7429600 ## 2 21533 7447100 PT2H4M7.1S 0 PT0S 7447100 ## totalTime position diffFirstMs diffFirst diffPrevMs diffPrev ## 1 PT2H3M49.6S 1 0 PT0S 0 PT0S ## 2 PT2H4M7.1S 2 17500 PT17.5S 17500 PT17.5S And for the stage winners: get_stage_winners = function(eventId) { stage_winners_url = paste0(results_api, &#39;/rally-event/&#39;, eventId,&#39;/stage-winners&#39;) jsonlite::fromJSON(stage_winners_url) } get_stage_winners(eventId) %&gt;% head(2) ## stageId entryId stageName elapsedDurationMs elapsedDuration ## 1 1747 21536 Sarriojärvi 1 (Live TV) 957800 00:15:57.8000000 ## 2 1743 21536 Sarriojärvi 2 (Live TV) 952900 00:15:52.9000000 2.6 Stage Result At the end of each stage, there are actually two different sorts of results data availbe: data relating to the result of the stage itself, and data relating to how the stage result affected the overall rally position. Let’s start by getting the overall rally result at the end of a particular stage. Note that the overall result does not include the stage ID in the returned data so we need to add it in: get_overall_result = function(eventId, stageId) { overall_url = paste0(results_api, &#39;/rally-event/&#39;, eventId, &#39;/stage-result/stage-external/&#39;, stageId) jsonlite::fromJSON(overall_url) %&gt;% # Also add in the stage ID mutate(stageId = stageId) } overall_result = get_overall_result(eventId, stageId) overall_result %&gt;% head(2) ## entryId stageTimeMs stageTime penaltyTimeMs penaltyTime totalTimeMs ## 1 21536 2745200 PT45M45.2S 0 PT0S 2745200 ## 2 21538 2768800 PT46M8.8S 0 PT0S 2768800 ## totalTime position diffFirstMs diffFirst diffPrevMs diffPrev stageId ## 1 PT45M45.2S 1 0 PT0S 0 PT0S 1750 ## 2 PT46M8.8S 2 23600 PT23.6S 23600 PT23.6S 1750 2.6.1 Getting Stage Results for Multiple Stages It will be convenient to be able to retrieve overall results for multiple stages from one function call. One way of achieving that is to create a function to retrieve the details for a single specified stage that can be applied via a purrr::map() function call to a list of the stage IDs we want overall results data for: library(purrr) ## ## Attaching package: &#39;purrr&#39; ## The following object is masked from &#39;package:jsonlite&#39;: ## ## flatten get_overall_result2 = function(stageId, eventId) { get_overall_result(eventId, stageId) } get_multi_overall = function(stagelist){ multi_overall = stagelist %&gt;% map(get_overall_result2, eventId=eventId) %&gt;% bind_rows() multi_overall } # Specify the stage IDs for multiple stages stagelist = c(1747, 1743) multi_overall_results = get_multi_overall(stagelist) multi_overall_results %&gt;% tail(2) ## entryId stageTimeMs stageTime penaltyTimeMs penaltyTime totalTimeMs ## 107 21579 2866500 PT47M46.5S 0 PT0S 2866500 ## 108 21573 3115400 PT51M55.4S 0 PT0S 3115400 ## totalTime position diffFirstMs diffFirst diffPrevMs diffPrev stageId ## 107 PT47M46.5S 53 955800 PT15M55.8S 123200 PT2M3.2S 1743 ## 108 PT51M55.4S 54 1204700 PT20M4.7S 248900 PT4M8.9S 1743 2.7 Stage Times We can get the stage times for each stage on a rally by event and stage ID: get_stage_times = function(eventId, stageId) { stage_times_url = paste0(results_api, &#39;/rally-event/&#39;, eventId, &#39;/stage-times/stage-external/&#39;, stageId) jsonlite::fromJSON(stage_times_url) } stage_times = get_stage_times(eventId, stageId) stage_times %&gt;% head(2) ## stageTimeId stageId entryId elapsedDurationMs elapsedDuration status ## 1 96580 1750 21536 834500 00:13:54.5000000 Completed ## 2 96474 1750 21532 835500 00:13:55.5000000 Completed ## source position diffFirstMs diffFirst diffPrevMs diffPrev ## 1 Default 1 0 00:00:00 0 00:00:00 ## 2 Default 2 1000 00:00:01 1000 00:00:01 2.7.1 Getting Stage Times for Multiple Stages It will also be convenient to be able to retrieve stage times for multiple stages from a single function call. We can take the same approach we used previously: get_stage_times2 = function(stageId, eventId) { get_stage_times(eventId, stageId) } get_multi_stage_times = function(stagelist){ multi_stage_times = stagelist %&gt;% map(get_stage_times2, eventId=eventId) %&gt;% bind_rows() multi_stage_times } multi_stage_times = get_multi_stage_times(stagelist) multi_stage_times %&gt;% tail(2) ## stageTimeId stageId entryId elapsedDurationMs elapsedDuration status ## 109 96321 1743 21573 1950700 00:32:30.7000000 Completed ## 110 96355 1743 21547 NA &lt;NA&gt; DNS ## source position diffFirstMs diffFirst diffPrevMs diffPrev ## 109 Default 54 997800 00:16:37.8000000 245500 00:04:05.5000000 ## 110 Default NA NA &lt;NA&gt; NA &lt;NA&gt; 2.7.2 Getting Wide Stage Times for Multiple Stages We can then widen the stage times for each driver: get_multi_stage_times_wide = function(multi_stage_times){ stage_times_cols = c(&#39;entryId&#39;, &#39;stageId&#39;, &#39;elapsedDurationMs&#39;) multi_stage_times_wide = multi_stage_times %&gt;% select(all_of(stage_times_cols)) %&gt;% mutate(elapsedDurationS = elapsedDurationMs / 1000) %&gt;% select(-elapsedDurationMs) %&gt;% group_by(entryId) %&gt;% tidyr::spread(key = stageId, value = elapsedDurationS) %&gt;% select(c(&#39;entryId&#39;, as.character(stagelist))) multi_stage_times_wide } multi_stage_times_wide = get_multi_stage_times_wide(multi_stage_times) multi_stage_times_wide %&gt;% head(2) ## # A tibble: 2 x 3 ## # Groups: entryId [2] ## entryId `1747` `1743` ## &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 21530 980. 980 ## 2 21531 974. 968. 2.7.3 Getting Wide Stage Positions We can also get the stage positions: get_multi_stage_positions_wide = function(multi_stage_times){ stage_positions_cols = c(&#39;entryId&#39;, &#39;stageId&#39;, &#39;position&#39;) multi_stage_positions_wide = multi_stage_times %&gt;% select(all_of(stage_positions_cols)) %&gt;% group_by(entryId) %&gt;% tidyr::spread(key = stageId, value = position) %&gt;% select(c(&#39;entryId&#39;, as.character(stagelist))) } multi_stage_positions_wide = get_multi_stage_positions_wide(multi_stage_times) multi_stage_positions_wide %&gt;% head(2) ## # A tibble: 2 x 3 ## # Groups: entryId [2] ## entryId `1747` `1743` ## &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 21530 9 10 ## 2 21531 5 5 2.8 Split Times We can get split times and distance into stage data for each stage given the stage identifier: get_splits = function(eventId, stageId){ splits_url=paste0(results_api, &#39;/rally-event/&#39;, eventId, &#39;/split-times/stage-external/&#39;, stageId) jsonlite::fromJSON(splits_url) } splits = get_splits(eventId, stageId) # $splitPoints # $entrySplitPointTimes This includes handy information about split locations, such as distance into stage. This can also be useful for pace calculations: splits$splitPoints ## splitPointId stageId number distance ## 1 3593 1750 5 23.21 ## 2 3601 1750 2 9.02 ## 3 3615 1750 1 4.83 ## 4 3617 1750 4 20.63 ## 5 3621 1750 3 14.87 We can also view the split point times for each driver: splits$entrySplitPointTimes %&gt;% head(2) ## entryId startDateTime startDateTimeLocal stageTimeDurationMs ## 1 21540 2021-02-27T07:08:00 2021-02-27T09:08:00+02:00 844300 ## 2 21541 2021-02-27T07:11:00 2021-02-27T09:11:00+02:00 864400 ## stageTimeDuration ## 1 00:14:04.3000000 ## 2 00:14:24.4000000 ## splitPointTimes ## 1 123482, 123483, 123486, 123488, 123490, 3615, 3601, 3621, 3617, 3593, 21540, 21540, 21540, 21540, 21540, 161400, 272500, 471600, 692700, 791500, PT2M41.4S, PT4M32.5S, PT7M51.6S, PT11M32.7S, PT13M11.5S, 2021-02-27T07:10:41.4, 2021-02-27T07:12:32.5, 2021-02-27T07:15:51.6, 2021-02-27T07:19:32.7, 2021-02-27T07:21:11.5, 2021-02-27T09:10:41.4+02:00, 2021-02-27T09:12:32.5+02:00, 2021-02-27T09:15:51.6+02:00, 2021-02-27T09:19:32.7+02:00, 2021-02-27T09:21:11.5+02:00 ## 2 123484, 123485, 123487, 123493, 123494, 3615, 3601, 3621, 3617, 3593, 21541, 21541, 21541, 21541, 21541, 165200, 280600, 484700, 710100, 810300, PT2M45.2S, PT4M40.6S, PT8M4.7S, PT11M50.1S, PT13M30.3S, 2021-02-27T07:13:45.2, 2021-02-27T07:15:40.6, 2021-02-27T07:19:04.7, 2021-02-27T07:22:50.1, 2021-02-27T07:24:30.3, 2021-02-27T09:13:45.2+02:00, 2021-02-27T09:15:40.6+02:00, 2021-02-27T09:19:04.7+02:00, 2021-02-27T09:22:50.1+02:00, 2021-02-27T09:24:30.3+02:00 To view the split times for a specific driver, we can index into the dataframe using the driver entryId value: splits$entrySplitPointTimes[splits$entrySplitPointTimes[&#39;entryId&#39;]==ogierEntryId,]$splitPointTimes ## [[1]] ## splitPointTimeId splitPointId entryId elapsedDurationMs elapsedDuration ## 1 123492 3615 21530 161700 PT2M41.7S ## 2 123495 3601 21530 272300 PT4M32.3S ## 3 123499 3621 21530 471300 PT7M51.3S ## 4 123505 3617 21530 690400 PT11M30.4S ## 5 123507 3593 21530 789200 PT13M9.2S ## splitDateTime splitDateTimeLocal ## 1 2021-02-27T07:22:41.7 2021-02-27T09:22:41.7+02:00 ## 2 2021-02-27T07:24:32.3 2021-02-27T09:24:32.3+02:00 ## 3 2021-02-27T07:27:51.3 2021-02-27T09:27:51.3+02:00 ## 4 2021-02-27T07:31:30.4 2021-02-27T09:31:30.4+02:00 ## 5 2021-02-27T07:33:09.2 2021-02-27T09:33:09.2+02:00 2.8.1 Driver Split Times Detail We can get a flatter structure over all drivers, converting the elapsed duration in milliseconds to seconds along the way: #driver_splits = do.call(rbind, entry_splits$splitPointTimes) # The tidyverse approach is to use dplyr::bind_rows() # We can also construct a pipe to streamline the processing get_driver_splits = function(splits){ driver_splits = splits$entrySplitPointTimes$splitPointTimes %&gt;% bind_rows() %&gt;% mutate(elapsedDurationS = elapsedDurationMs / 1000) %&gt;% select(-elapsedDurationMs) driver_splits } driver_splits = get_driver_splits(splits) driver_splits %&gt;% head(2) ## splitPointTimeId splitPointId entryId elapsedDuration splitDateTime ## 1 123482 3615 21540 PT2M41.4S 2021-02-27T07:10:41.4 ## 2 123483 3601 21540 PT4M32.5S 2021-02-27T07:12:32.5 ## splitDateTimeLocal elapsedDurationS ## 1 2021-02-27T09:10:41.4+02:00 161.4 ## 2 2021-02-27T09:12:32.5+02:00 272.5 2.8.2 Wide Driver Split Times We can cast the data into a wide format, with splits ordered by their distance into the stage. Start by creating a function to help get the split point codes in order by distance along the stage: get_split_cols = function(splits){ split_cols = as.character(arrange(splits$splitPoints, distance)$splitPointId) split_cols } Now create a function to get the driver splits in a wide format using the order split point codes as the widened columns: get_driver_splits_wide = function(driver_splits, splits){ split_cols = get_split_cols(splits) splits_cols = c(&#39;entryId&#39;, &#39;splitPointId&#39;, &#39;elapsedDurationS&#39;) driver_splits_wide = driver_splits %&gt;% group_by(entryId) %&gt;% select(all_of(splits_cols)) %&gt;% tidyr::spread(key = splitPointId, value = elapsedDurationS) %&gt;% select(all_of(c(&#39;entryId&#39;, split_cols))) %&gt;% # If we don&#39;t cast, it&#39;s a # non-rankable rowwise df as.data.frame() driver_splits_wide } driver_splits_wide = get_driver_splits_wide(driver_splits, splits) driver_splits_wide %&gt;% head(2) ## entryId 3615 3601 3621 3617 3593 ## 1 21530 161.7 272.3 471.3 690.4 789.2 ## 2 21531 162.3 273.7 472.3 692.1 792.4 "],["visualising-results-for-a-single-stage.html", "3 Visualising Results for a Single Stage 3.1 Load Base Data 3.2 Get Stage Results Data 3.3 Previewing Stage Results Data 3.4 Adding Stage Metadata 3.5 Rebasing the Stage Results", " 3 Visualising Results for a Single Stage In this chapter, we’ll introduce some basic chart and chartable techniques for displaying stage timing and results data. 3.1 Load Base Data To get the splits data from a standing start, we can load in the current season list, select the rally we want, look up the itinerary from the rally, extract the sections and then the stages and the retrieve the stage ID for the stage we are interested in: source(&#39;code/wrc-api.R&#39;) s = get_active_season() eventId = get_eventId_from_name(s, &#39;arctic&#39;) entries = get_rally_entries(eventId) itinerary = get_itinerary(eventId) sections = get_sections(itinerary) stages = get_stages(sections) stages_lookup = get_stages_lookup(stages) Get a sample stage ID: stageId = stages_lookup[[&#39;SS3&#39;]] 3.2 Get Stage Results Data Start by loading in some stage times data and previewing the columns available to us: stage_times = get_stage_times(eventId, stageId) colnames(stage_times) ## [1] &quot;stageTimeId&quot; &quot;stageId&quot; &quot;entryId&quot; ## [4] &quot;elapsedDurationMs&quot; &quot;elapsedDuration&quot; &quot;status&quot; ## [7] &quot;source&quot; &quot;position&quot; &quot;diffFirstMs&quot; ## [10] &quot;diffFirst&quot; &quot;diffPrevMs&quot; &quot;diffPrev&quot; 3.3 Previewing Stage Results Data Just using the stage restuls data, how might we display it? Let’s start with a view of the top 10. We can use the knitr::kable() function to provide a styled version of the table that slightly improves its appearance: library(knitr) kable( head(stage_times, 10)) stageTimeId stageId entryId elapsedDurationMs elapsedDuration status source position diffFirstMs diffFirst diffPrevMs diffPrev 96580 1750 21536 834500 00:13:54.5000000 Completed Default 1 0 00:00:00 0 00:00:00 96474 1750 21532 835500 00:13:55.5000000 Completed Default 2 1000 00:00:01 1000 00:00:01 96623 1750 21539 839100 00:13:59.1000000 Completed Default 3 4600 00:00:04.6000000 3600 00:00:03.6000000 96509 1750 21533 840200 00:14:00.2000000 Completed Default 4 5700 00:00:05.7000000 1100 00:00:01.1000000 96656 1750 21538 841900 00:14:01.9000000 Completed Default 5 7400 00:00:07.4000000 1700 00:00:01.7000000 96624 1750 21530 842000 00:14:02 Completed Default 6 7500 00:00:07.5000000 100 00:00:00.1000000 96693 1750 21534 843200 00:14:03.2000000 Completed Default 7 8700 00:00:08.7000000 1200 00:00:01.2000000 96480 1750 21540 844300 00:14:04.3000000 Completed Default 8 9800 00:00:09.8000000 1100 00:00:01.1000000 96523 1750 21531 845800 00:14:05.8000000 Completed Default 9 11300 00:00:11.3000000 1500 00:00:01.5000000 96419 1750 21537 846900 00:14:06.9000000 Completed Default 10 12400 00:00:12.4000000 1100 00:00:01.1000000 The data itself looks quite cryptic, so we need to convert it to something a little bit more human readable. To enrich the display, we might want to add in information relating to a stage, rather than just refer to it by stage ID, or to describe each entry in rather more detail than just by the entry ID. The styling of the table also means that not all the columns may be displayed, so reducing the number of columns would presumably help address that, in part at least. 3.3.1 Adding Entry Metadata n the first instance, it would probably make sense to pull in some human readable data about each entry: cars = get_car_data(entries) cars %&gt;% head(2) ## entryId driverId codriverId manufacturerId vehicleModel eligibility classname ## 1 21530 670 3027 84 Yaris WRC M RC1 ## 2 21531 534 553 84 Yaris WRC M RC1 ## manufacturer entrantname groupname identifier drivername code ## 1 Toyota TOYOTA GAZOO RACING WRT WRC 1 S. OGIER OGI ## 2 Toyota TOYOTA GAZOO RACING WRT WRC 33 E. EVANS EVA ## driverfullname codrivername codriverfullname ## 1 Sébastien OGIER J. INGRASSIA Julien INGRASSIA ## 2 Elfyn EVANS S. MARTIN Scott MARTIN We can the merge this data into out original table, and filter out some of the less useful columns. We’ll also limit ourselve to just the top 10 results: top10_display_cols_base = c(&#39;position&#39;, &#39;identifier&#39;, &#39;code&#39;, #&#39;drivername&#39;, &#39;codrivername&#39;, #&#39;groupname&#39;, &#39;entrantname&#39;, #&#39;classname&#39;, &#39;eligibility&#39;, #&#39;elapsedDuration&#39;, # gap is the time delta between a driver # and the leader; diff (or interval) # is the difference between a driver # and the driver immediately ahead &#39;TimeInS&#39;, &#39;gap&#39;, &#39;diff&#39;) top10_stage_times = stage_times %&gt;% # A minor optimisation step to # limit the amount of merging arrange(position) %&gt;% head(10) %&gt;% # Merge in the entries data merge(cars, by=&#39;entryId&#39;) %&gt;% # Convert millseconds to seconds mutate(TimeInS = elapsedDurationMs/1000, gap = diffFirstMs/1000, diff = diffPrevMs/1000) %&gt;% # Limit columns and set column order select(all_of(top10_display_cols_base)) %&gt;% # The merge may upset the row order # so reset the order again arrange(position) %&gt;% # Improve column names by remaming them rename(Pos=position, Car = identifier, Code = code, `Time (s)` = TimeInS, Gap = gap, Diff = diff) kable( top10_stage_times ) Pos Car Code Time (s) Gap Diff 1 8 TÄN 834.5 0.0 0.0 2 11 NEU 835.5 1.0 1.0 3 2 SOL 839.1 4.6 3.6 4 69 ROV 840.2 5.7 1.1 5 42 BRE 841.9 7.4 1.7 6 1 OGI 842.0 7.5 0.1 7 18 KAT 843.2 8.7 1.2 8 7 LOU 844.3 9.8 1.1 9 33 EVA 845.8 11.3 1.5 10 3 SUN 846.9 12.4 1.1 3.4 Adding Stage Metadata To improve the table further, we may want to add a caption to the tabledescribing the stage to which the results actually refer. The caption might include the stage code and the stage name, for example, and perhaps the stage distance. It might also be handy to retrieve the stage number so that if we are displaying several tables, we can check we present the stages in the correct running order: stage_cols = c(&#39;stageId&#39;, &#39;number&#39;, &#39;name&#39;, &#39;distance&#39;, &#39;code&#39;) stage_info = stages %&gt;% select(all_of(stage_cols)) %&gt;% # Tidy up the stage name mutate(name = str_replace(name, &#39; \\\\(Live TV\\\\)&#39;, &#39;&#39;)) stage_info %&gt;% head(2) ## stageId number name distance code ## 1 1747 1 Sarriojärvi 1 31.05 SS1 ## 2 1743 2 Sarriojärvi 2 31.05 SS2 We can create a caption for our selected stage using what essentially amounts to a string template: stage_info_ = stage_info[stage_info[&#39;stageId&#39;]==stageId,] # paste0() ensures there are no separators between substrings caption = paste0(&#39;Stage &#39;, stage_info_$code, &#39;, &#39;, stage_info_$name, &#39; (&#39;, stage_info_$distance, &#39;km)&#39;) caption ## [1] &quot;Stage SS3, Mustalampi 1 (24.43km)&quot; Let’s add a caption to our kable() table, noting that by default the boodown script used to create the rendered version of the original Rmd file automatically adds a table number to the caption: kable( top10_stage_times, caption = caption) Table 3.1: Stage SS3, Mustalampi 1 (24.43km) Pos Car Code Time (s) Gap Diff 1 8 TÄN 834.5 0.0 0.0 2 11 NEU 835.5 1.0 1.0 3 2 SOL 839.1 4.6 3.6 4 69 ROV 840.2 5.7 1.1 5 42 BRE 841.9 7.4 1.7 6 1 OGI 842.0 7.5 0.1 7 18 KAT 843.2 8.7 1.2 8 7 LOU 844.3 9.8 1.1 9 33 EVA 845.8 11.3 1.5 10 3 SUN 846.9 12.4 1.1 3.5 Rebasing the Stage Results That sort of table is typical of many a motorsport timing results table. But can we do more with the data, or reveal any new insights from it? The table is design is actually very powerful. For any driver, we can see how far off the stage winning time they were (the Gap) and by summing appropriate Diff values you can quickly determine the time difference between any two drivers. However, if we are interested in a particular driver, we can “rebase” the table to show the time differences between that driver and the other drivers explictly. "]]
