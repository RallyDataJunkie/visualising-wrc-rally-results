<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Visualising Results for a Single Stage | Visualising WRC Rally Timing and Results Data</title>
  <meta name="description" content="An introduction to visualising timing and results data for WRC rally events." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Visualising Results for a Single Stage | Visualising WRC Rally Timing and Results Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Visualising Results for a Single Stage | Visualising WRC Rally Timing and Results Data" />
  
  <meta name="twitter:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="accessing-data-from-the-wrc-live-timing-api.html"/>
<link rel="next" href="visualising-results-for-multiple-stages.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/formattable_widget-binding-0.2.1/formattable_widget.js"></script>
<link href="libs/jquery-sparkline-2.1.2/jquery.sparkline.css" rel="stylesheet" />
<script src="libs/jquery-sparkline-2.1.2/jquery.sparkline.js"></script>
<script src="libs/sparkline-binding-2.0/sparkline.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Visualising WRC Rally Results and Timing Data</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html"><i class="fa fa-check"></i><b>2</b> Accessing Data from the WRC Live Timing API</a>
<ul>
<li class="chapter" data-level="2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#current-season-rallies"><i class="fa fa-check"></i><b>2.1</b> Current Season Rallies</a></li>
<li class="chapter" data-level="2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#itinerary-lookup"><i class="fa fa-check"></i><b>2.2</b> Itinerary Lookup</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#leg-sections"><i class="fa fa-check"></i><b>2.2.1</b> Leg Sections</a></li>
<li class="chapter" data-level="2.2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#time-controls"><i class="fa fa-check"></i><b>2.2.2</b> Time Controls</a></li>
<li class="chapter" data-level="2.2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-details"><i class="fa fa-check"></i><b>2.2.3</b> Stage Details</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#competitor-details"><i class="fa fa-check"></i><b>2.3</b> Competitor Details</a></li>
<li class="chapter" data-level="2.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#penalties-and-retirements"><i class="fa fa-check"></i><b>2.4</b> Penalties and Retirements</a></li>
<li class="chapter" data-level="2.5" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#results-and-stage-winner"><i class="fa fa-check"></i><b>2.5</b> Results and Stage Winner</a></li>
<li class="chapter" data-level="2.6" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-result"><i class="fa fa-check"></i><b>2.6</b> Stage Result</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-results-for-multiple-stages"><i class="fa fa-check"></i><b>2.6.1</b> Getting Stage Results for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-times"><i class="fa fa-check"></i><b>2.7</b> Stage Times</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.1</b> Getting Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.2</b> Getting Wide Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-positions"><i class="fa fa-check"></i><b>2.7.3</b> Getting Wide Stage Positions</a></li>
<li class="chapter" data-level="2.7.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-generic-wide-dataframes"><i class="fa fa-check"></i><b>2.7.4</b> Getting Generic Wide Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#split-times"><i class="fa fa-check"></i><b>2.8</b> Split Times</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#driver-split-times-detail"><i class="fa fa-check"></i><b>2.8.1</b> Driver Split Times Detail</a></li>
<li class="chapter" data-level="2.8.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#wide-driver-split-times"><i class="fa fa-check"></i><b>2.8.2</b> Wide Driver Split Times</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html"><i class="fa fa-check"></i><b>3</b> Visualising Results for a Single Stage</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#load-base-data"><i class="fa fa-check"></i><b>3.1</b> Load Base Data</a></li>
<li class="chapter" data-level="3.2" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#get-stage-results-data"><i class="fa fa-check"></i><b>3.2</b> Get Stage Results Data</a></li>
<li class="chapter" data-level="3.3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#previewing-stage-results-data"><i class="fa fa-check"></i><b>3.3</b> Previewing Stage Results Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-entry-metadata"><i class="fa fa-check"></i><b>3.3.1</b> Adding Entry Metadata</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-stage-metadata-to-table-captions"><i class="fa fa-check"></i><b>3.4</b> Adding Stage Metadata to Table Captions</a></li>
<li class="chapter" data-level="3.5" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-stage-results"><i class="fa fa-check"></i><b>3.5</b> Colour Highlighting Stage Results</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#heatmap-style-column-cell-backgrounds"><i class="fa fa-check"></i><b>3.5.1</b> Heatmap Style Column Cell Backgrounds</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#an-aside-calculating-diff-and-gap-times"><i class="fa fa-check"></i><b>3.6</b> An Aside — Calculating DIFF and GAP times</a></li>
<li class="chapter" data-level="3.7" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#rebasing-stage-results"><i class="fa fa-check"></i><b>3.7</b> Rebasing Stage Results</a></li>
<li class="chapter" data-level="3.8" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-rebased-values"><i class="fa fa-check"></i><b>3.8</b> Colour Highlighting Rebased Values</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html"><i class="fa fa-check"></i><b>4</b> Visualising Results for Multiple Stages</a>
<ul>
<li class="chapter" data-level="4.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#load-base-data-1"><i class="fa fa-check"></i><b>4.1</b> Load Base Data</a></li>
<li class="chapter" data-level="4.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-mutliple-stage-results"><i class="fa fa-check"></i><b>4.2</b> Retrieving Mutliple Stage Results</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-overall-position-data"><i class="fa fa-check"></i><b>4.2.1</b> Reshaping Overall Position Data</a></li>
<li class="chapter" data-level="4.2.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-overall-rally-time-data"><i class="fa fa-check"></i><b>4.2.2</b> Reshaping Overall Rally Time Data</a></li>
<li class="chapter" data-level="4.2.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#reshaping-time-to-first-data"><i class="fa fa-check"></i><b>4.2.3</b> Reshaping Time to First Data</a></li>
<li class="chapter" data-level="4.2.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#mapping-stage-and-driver-identifiers-to-meaningful-labels"><i class="fa fa-check"></i><b>4.2.4</b> Mapping Stage and Driver Identifiers to Meaningful Labels</a></li>
<li class="chapter" data-level="4.2.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#rebasing-overall-times"><i class="fa fa-check"></i><b>4.2.5</b> Rebasing Overall Times</a></li>
<li class="chapter" data-level="4.2.6" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#finding-changes-in-rebased-gaps-across-stages"><i class="fa fa-check"></i><b>4.2.6</b> Finding Changes in Rebased Gaps Across Stages</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-overall-results"><i class="fa fa-check"></i><b>4.3</b> Visualising Overall Results</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-first-position"><i class="fa fa-check"></i><b>4.3.1</b> Visualising First Position</a></li>
<li class="chapter" data-level="4.3.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-position-changes-over-a-rally"><i class="fa fa-check"></i><b>4.3.2</b> Visualising Position Changes Over a Rally</a></li>
<li class="chapter" data-level="4.3.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-position-gainslosses"><i class="fa fa-check"></i><b>4.3.3</b> Visualising Position Gains/Losses</a></li>
<li class="chapter" data-level="4.3.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#per-driver-position-charts"><i class="fa fa-check"></i><b>4.3.4</b> Per Driver Position Charts</a></li>
<li class="chapter" data-level="4.3.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-time-to-first"><i class="fa fa-check"></i><b>4.3.5</b> Visualising Time to First</a></li>
<li class="chapter" data-level="4.3.6" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-rebased-gaps"><i class="fa fa-check"></i><b>4.3.6</b> Visualising Rebased Gaps</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-stage-times-and-results"><i class="fa fa-check"></i><b>4.4</b> Retrieving Stage Times and Results</a></li>
<li class="chapter" data-level="4.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-stage-times"><i class="fa fa-check"></i><b>4.5</b> Visualising Stage Times</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#stage-position-sparklines"><i class="fa fa-check"></i><b>4.5.1</b> Stage Position Sparklines</a></li>
<li class="chapter" data-level="4.5.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#gap-to-stage-winner-sparklines"><i class="fa fa-check"></i><b>4.5.2</b> Gap to Stage Winner Sparklines</a></li>
<li class="chapter" data-level="4.5.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#stage-position-charts"><i class="fa fa-check"></i><b>4.5.3</b> Stage Position Charts</a></li>
<li class="chapter" data-level="4.5.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#individual-stage-position-charts"><i class="fa fa-check"></i><b>4.5.4</b> Individual Stage position Charts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html"><i class="fa fa-check"></i><b>5</b> Finding Pace Across Stages</a>
<ul>
<li class="chapter" data-level="5.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#load-base-data-2"><i class="fa fa-check"></i><b>5.1</b> Load Base Data</a></li>
<li class="chapter" data-level="5.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#defining-pace"><i class="fa fa-check"></i><b>5.2</b> Defining Pace</a></li>
<li class="chapter" data-level="5.3" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-stage-pace"><i class="fa fa-check"></i><b>5.3</b> Calculating Stage Pace</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-a-single-stage"><i class="fa fa-check"></i><b>5.3.1</b> Calculating Pace for a Single Stage</a></li>
<li class="chapter" data-level="5.3.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-multiple-stages"><i class="fa fa-check"></i><b>5.3.2</b> Calculating Pace for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#rebasing-stage-pace"><i class="fa fa-check"></i><b>5.4</b> Rebasing Stage Pace</a></li>
<li class="chapter" data-level="5.5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#visualising-stage-pace-using-pace-maps"><i class="fa fa-check"></i><b>5.5</b> Visualising Stage Pace Using Pace Maps</a></li>
<li class="chapter" data-level="5.6" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#off-the-pace-charts"><i class="fa fa-check"></i><b>5.6</b> Off-the-Pace Charts</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualising-split-times.html"><a href="visualising-split-times.html"><i class="fa fa-check"></i><b>6</b> Visualising Split Times</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#load-base-data-3"><i class="fa fa-check"></i><b>6.1</b> Load Base Data</a></li>
<li class="chapter" data-level="6.2" data-path="visualising-split-times.html"><a href="visualising-split-times.html#get-splits-data"><i class="fa fa-check"></i><b>6.2</b> Get Splits Data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#wide-driver-split-times-1"><i class="fa fa-check"></i><b>6.2.1</b> Wide Driver Split Times</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="visualising-split-times.html"><a href="visualising-split-times.html#rebasing-split-times"><i class="fa fa-check"></i><b>6.3</b> Rebasing Split Times</a></li>
<li class="chapter" data-level="6.4" data-path="visualising-split-times.html"><a href="visualising-split-times.html#visualising-rebased-split-times-using-sparklines"><i class="fa fa-check"></i><b>6.4</b> Visualising Rebased Split Times Using Sparklines</a></li>
<li class="chapter" data-level="6.5" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-the-rank-position-at-each-split-point"><i class="fa fa-check"></i><b>6.5</b> Finding the Rank Position at Each Split Point</a></li>
<li class="chapter" data-level="6.6" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-split-section-durations"><i class="fa fa-check"></i><b>6.6</b> Finding Split Section Durations</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-split-section-ranks"><i class="fa fa-check"></i><b>6.6.1</b> Finding Split Section Ranks</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="visualising-split-times.html"><a href="visualising-split-times.html#adding-overall-stage-time-to-the-split-times"><i class="fa fa-check"></i><b>6.7</b> Adding Overall Stage Time to the Split Times</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html"><i class="fa fa-check"></i><b>7</b> Finding Pace Across Splits</a>
<ul>
<li class="chapter" data-level="7.1" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html#load-base-data-4"><i class="fa fa-check"></i><b>7.1</b> Load Base Data</a></li>
<li class="chapter" data-level="7.2" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html#calculating-splits-pace"><i class="fa fa-check"></i><b>7.2</b> Calculating Splits Pace</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://rallydatajunkie.com/"><em>RallyDataJunkie.com</em></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Timing and Results Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="visualising-results-for-a-single-stage" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Visualising Results for a Single Stage</h1>
<p>In this chapter, we’ll introduce some basic chart and chartable techniques for displaying stage timing and results data.</p>
<div id="load-base-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Load Base Data</h2>
<p>To get the splits data from a standing start, we can load in the current season list, select the rally we want, look up the itinerary from the rally, extract the sections and then the stages and the retrieve the stage ID for the stage we are interested in.</p>
<p>To begin with, load in our WRC API helper functions:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="visualising-results-for-a-single-stage.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;code/wrc-api.R&#39;</span>)</span></code></pre></div>
<p>Now let’s grab some data:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="visualising-results-for-a-single-stage.html#cb82-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">get_active_season</span>()</span>
<span id="cb82-2"><a href="visualising-results-for-a-single-stage.html#cb82-2" aria-hidden="true" tabindex="-1"></a>eventId <span class="ot">=</span> <span class="fu">get_eventId_from_name</span>(s, <span class="st">&#39;arctic&#39;</span>)</span>
<span id="cb82-3"><a href="visualising-results-for-a-single-stage.html#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="visualising-results-for-a-single-stage.html#cb82-4" aria-hidden="true" tabindex="-1"></a>entries <span class="ot">=</span> <span class="fu">get_rally_entries</span>(eventId)</span>
<span id="cb82-5"><a href="visualising-results-for-a-single-stage.html#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="visualising-results-for-a-single-stage.html#cb82-6" aria-hidden="true" tabindex="-1"></a>itinerary <span class="ot">=</span> <span class="fu">get_itinerary</span>(eventId)</span>
<span id="cb82-7"><a href="visualising-results-for-a-single-stage.html#cb82-7" aria-hidden="true" tabindex="-1"></a>sections <span class="ot">=</span> <span class="fu">get_sections</span>(itinerary)</span>
<span id="cb82-8"><a href="visualising-results-for-a-single-stage.html#cb82-8" aria-hidden="true" tabindex="-1"></a>stages <span class="ot">=</span> <span class="fu">get_stages</span>(sections)</span>
<span id="cb82-9"><a href="visualising-results-for-a-single-stage.html#cb82-9" aria-hidden="true" tabindex="-1"></a>stages_lookup <span class="ot">=</span> <span class="fu">get_stages_lookup</span>(stages)</span></code></pre></div>
<p>Get a sample stage ID:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="visualising-results-for-a-single-stage.html#cb83-1" aria-hidden="true" tabindex="-1"></a>stageId <span class="ot">=</span> stages_lookup[[<span class="st">&#39;SS3&#39;</span>]]</span></code></pre></div>
</div>
<div id="get-stage-results-data" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Get Stage Results Data</h2>
<p>Start by loading in some stage times data and previewing the columns available to us:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="visualising-results-for-a-single-stage.html#cb84-1" aria-hidden="true" tabindex="-1"></a>stage_times <span class="ot">=</span> <span class="fu">get_stage_times</span>(eventId, stageId)</span>
<span id="cb84-2"><a href="visualising-results-for-a-single-stage.html#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="visualising-results-for-a-single-stage.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(stage_times)</span></code></pre></div>
<pre><code>##  [1] &quot;stageTimeId&quot;       &quot;stageId&quot;           &quot;entryId&quot;          
##  [4] &quot;elapsedDurationMs&quot; &quot;elapsedDuration&quot;   &quot;status&quot;           
##  [7] &quot;source&quot;            &quot;position&quot;          &quot;diffFirstMs&quot;      
## [10] &quot;diffFirst&quot;         &quot;diffPrevMs&quot;        &quot;diffPrev&quot;</code></pre>
</div>
<div id="previewing-stage-results-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Previewing Stage Results Data</h2>
<p>Just using the stage results data, how might we display it?</p>
<p>Let’s start with a view of the top 10. We can use the <code>knitr::kable()</code> function to provide a styled version of the table that slightly improves its appearance:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="visualising-results-for-a-single-stage.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb86-2"><a href="visualising-results-for-a-single-stage.html#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="visualising-results-for-a-single-stage.html#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>( <span class="fu">head</span>(stage_times, <span class="dv">10</span>))</span></code></pre></div>
<table>
<colgroup>
<col width="8%" />
<col width="5%" />
<col width="5%" />
<col width="12%" />
<col width="11%" />
<col width="6%" />
<col width="5%" />
<col width="6%" />
<col width="8%" />
<col width="11%" />
<col width="7%" />
<col width="11%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">stageTimeId</th>
<th align="right">stageId</th>
<th align="right">entryId</th>
<th align="right">elapsedDurationMs</th>
<th align="left">elapsedDuration</th>
<th align="left">status</th>
<th align="left">source</th>
<th align="right">position</th>
<th align="right">diffFirstMs</th>
<th align="left">diffFirst</th>
<th align="right">diffPrevMs</th>
<th align="left">diffPrev</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">96580</td>
<td align="right">1750</td>
<td align="right">21536</td>
<td align="right">834500</td>
<td align="left">00:13:54.5000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">00:00:00</td>
<td align="right">0</td>
<td align="left">00:00:00</td>
</tr>
<tr class="even">
<td align="right">96474</td>
<td align="right">1750</td>
<td align="right">21532</td>
<td align="right">835500</td>
<td align="left">00:13:55.5000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">2</td>
<td align="right">1000</td>
<td align="left">00:00:01</td>
<td align="right">1000</td>
<td align="left">00:00:01</td>
</tr>
<tr class="odd">
<td align="right">96623</td>
<td align="right">1750</td>
<td align="right">21539</td>
<td align="right">839100</td>
<td align="left">00:13:59.1000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">3</td>
<td align="right">4600</td>
<td align="left">00:00:04.6000000</td>
<td align="right">3600</td>
<td align="left">00:00:03.6000000</td>
</tr>
<tr class="even">
<td align="right">96509</td>
<td align="right">1750</td>
<td align="right">21533</td>
<td align="right">840200</td>
<td align="left">00:14:00.2000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">4</td>
<td align="right">5700</td>
<td align="left">00:00:05.7000000</td>
<td align="right">1100</td>
<td align="left">00:00:01.1000000</td>
</tr>
<tr class="odd">
<td align="right">96656</td>
<td align="right">1750</td>
<td align="right">21538</td>
<td align="right">841900</td>
<td align="left">00:14:01.9000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">5</td>
<td align="right">7400</td>
<td align="left">00:00:07.4000000</td>
<td align="right">1700</td>
<td align="left">00:00:01.7000000</td>
</tr>
<tr class="even">
<td align="right">96624</td>
<td align="right">1750</td>
<td align="right">21530</td>
<td align="right">842000</td>
<td align="left">00:14:02</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">6</td>
<td align="right">7500</td>
<td align="left">00:00:07.5000000</td>
<td align="right">100</td>
<td align="left">00:00:00.1000000</td>
</tr>
<tr class="odd">
<td align="right">96693</td>
<td align="right">1750</td>
<td align="right">21534</td>
<td align="right">843200</td>
<td align="left">00:14:03.2000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">7</td>
<td align="right">8700</td>
<td align="left">00:00:08.7000000</td>
<td align="right">1200</td>
<td align="left">00:00:01.2000000</td>
</tr>
<tr class="even">
<td align="right">96480</td>
<td align="right">1750</td>
<td align="right">21540</td>
<td align="right">844300</td>
<td align="left">00:14:04.3000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">8</td>
<td align="right">9800</td>
<td align="left">00:00:09.8000000</td>
<td align="right">1100</td>
<td align="left">00:00:01.1000000</td>
</tr>
<tr class="odd">
<td align="right">96523</td>
<td align="right">1750</td>
<td align="right">21531</td>
<td align="right">845800</td>
<td align="left">00:14:05.8000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">9</td>
<td align="right">11300</td>
<td align="left">00:00:11.3000000</td>
<td align="right">1500</td>
<td align="left">00:00:01.5000000</td>
</tr>
<tr class="even">
<td align="right">96419</td>
<td align="right">1750</td>
<td align="right">21537</td>
<td align="right">846900</td>
<td align="left">00:14:06.9000000</td>
<td align="left">Completed</td>
<td align="left">Default</td>
<td align="right">10</td>
<td align="right">12400</td>
<td align="left">00:00:12.4000000</td>
<td align="right">1100</td>
<td align="left">00:00:01.1000000</td>
</tr>
</tbody>
</table>
<p>An alternative rich table formatter is the <a href="https://github.com/renkun-ken/formattable"><code>formattable</code></a> (<a href="https://www.displayr.com/formattable/">example usage</a>) <em>R</em> package which builds on <code>kable()</code> and provides even more comprehensive support,, including cell colour highlighting, for rendering tables in a stylised way. In interactive HTML environments, the tables are rendered as an HTML widget, which allows for even more customisation, such as the inclusion of interactive HTML sparklines.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="visualising-results-for-a-single-stage.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(formattable)</span>
<span id="cb87-2"><a href="visualising-results-for-a-single-stage.html#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="visualising-results-for-a-single-stage.html#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>( <span class="fu">head</span>(stage_times, <span class="dv">10</span>) )</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
stageTimeId
</th>
<th style="text-align:right;">
stageId
</th>
<th style="text-align:right;">
entryId
</th>
<th style="text-align:right;">
elapsedDurationMs
</th>
<th style="text-align:right;">
elapsedDuration
</th>
<th style="text-align:right;">
status
</th>
<th style="text-align:right;">
source
</th>
<th style="text-align:right;">
position
</th>
<th style="text-align:right;">
diffFirstMs
</th>
<th style="text-align:right;">
diffFirst
</th>
<th style="text-align:right;">
diffPrevMs
</th>
<th style="text-align:right;">
diffPrev
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
96580
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21536
</td>
<td style="text-align:right;">
834500
</td>
<td style="text-align:right;">
00:13:54.5000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
00:00:00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
00:00:00
</td>
</tr>
<tr>
<td style="text-align:right;">
96474
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21532
</td>
<td style="text-align:right;">
835500
</td>
<td style="text-align:right;">
00:13:55.5000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1000
</td>
<td style="text-align:right;">
00:00:01
</td>
<td style="text-align:right;">
1000
</td>
<td style="text-align:right;">
00:00:01
</td>
</tr>
<tr>
<td style="text-align:right;">
96623
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21539
</td>
<td style="text-align:right;">
839100
</td>
<td style="text-align:right;">
00:13:59.1000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
4600
</td>
<td style="text-align:right;">
00:00:04.6000000
</td>
<td style="text-align:right;">
3600
</td>
<td style="text-align:right;">
00:00:03.6000000
</td>
</tr>
<tr>
<td style="text-align:right;">
96509
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21533
</td>
<td style="text-align:right;">
840200
</td>
<td style="text-align:right;">
00:14:00.2000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
5700
</td>
<td style="text-align:right;">
00:00:05.7000000
</td>
<td style="text-align:right;">
1100
</td>
<td style="text-align:right;">
00:00:01.1000000
</td>
</tr>
<tr>
<td style="text-align:right;">
96656
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21538
</td>
<td style="text-align:right;">
841900
</td>
<td style="text-align:right;">
00:14:01.9000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
7400
</td>
<td style="text-align:right;">
00:00:07.4000000
</td>
<td style="text-align:right;">
1700
</td>
<td style="text-align:right;">
00:00:01.7000000
</td>
</tr>
<tr>
<td style="text-align:right;">
96624
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21530
</td>
<td style="text-align:right;">
842000
</td>
<td style="text-align:right;">
00:14:02
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
7500
</td>
<td style="text-align:right;">
00:00:07.5000000
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
00:00:00.1000000
</td>
</tr>
<tr>
<td style="text-align:right;">
96693
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21534
</td>
<td style="text-align:right;">
843200
</td>
<td style="text-align:right;">
00:14:03.2000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
8700
</td>
<td style="text-align:right;">
00:00:08.7000000
</td>
<td style="text-align:right;">
1200
</td>
<td style="text-align:right;">
00:00:01.2000000
</td>
</tr>
<tr>
<td style="text-align:right;">
96480
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21540
</td>
<td style="text-align:right;">
844300
</td>
<td style="text-align:right;">
00:14:04.3000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
9800
</td>
<td style="text-align:right;">
00:00:09.8000000
</td>
<td style="text-align:right;">
1100
</td>
<td style="text-align:right;">
00:00:01.1000000
</td>
</tr>
<tr>
<td style="text-align:right;">
96523
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21531
</td>
<td style="text-align:right;">
845800
</td>
<td style="text-align:right;">
00:14:05.8000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
11300
</td>
<td style="text-align:right;">
00:00:11.3000000
</td>
<td style="text-align:right;">
1500
</td>
<td style="text-align:right;">
00:00:01.5000000
</td>
</tr>
<tr>
<td style="text-align:right;">
96419
</td>
<td style="text-align:right;">
1750
</td>
<td style="text-align:right;">
21537
</td>
<td style="text-align:right;">
846900
</td>
<td style="text-align:right;">
00:14:06.9000000
</td>
<td style="text-align:right;">
Completed
</td>
<td style="text-align:right;">
Default
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
12400
</td>
<td style="text-align:right;">
00:00:12.4000000
</td>
<td style="text-align:right;">
1100
</td>
<td style="text-align:right;">
00:00:01.1000000
</td>
</tr>
</tbody>
</table>
<p>The data itself looks quite cryptic, so we need to convert it to something a little bit more human readable. To enrich the display, we might want to add in information relating to a stage, rather than just refer to it by stage ID, or to describe each entry in rather more detail than just by the entry ID.</p>
<p>The way the table is actually presented may also mean that not all the columns may be displayed, so reducing the number of columns would presumably help address that, in part at least.</p>
<div id="adding-entry-metadata" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Adding Entry Metadata</h3>
<p>In the first instance, it would probably make sense to pull in some human readable data about each entry:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="visualising-results-for-a-single-stage.html#cb88-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">=</span> <span class="fu">get_car_data</span>(entries)</span>
<span id="cb88-2"><a href="visualising-results-for-a-single-stage.html#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="visualising-results-for-a-single-stage.html#cb88-3" aria-hidden="true" tabindex="-1"></a>cars <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId driverId codriverId manufacturerId vehicleModel eligibility classname
## 1   21530      670       3027             84    Yaris WRC           M       RC1
## 2   21531      534        553             84    Yaris WRC           M       RC1
##   manufacturer             entrantname groupname identifier drivername code
## 1       Toyota TOYOTA GAZOO RACING WRT       WRC          1   S. OGIER  OGI
## 2       Toyota TOYOTA GAZOO RACING WRT       WRC         33   E. EVANS  EVA
##    driverfullname codrivername codriverfullname
## 1 Sébastien OGIER J. INGRASSIA Julien INGRASSIA
## 2     Elfyn EVANS    S. MARTIN     Scott MARTIN</code></pre>
<p>We can the merge this data into out original table, and filter out some of the less useful columns. We’ll also limit ourselves to just the top 10 results:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="visualising-results-for-a-single-stage.html#cb90-1" aria-hidden="true" tabindex="-1"></a>top10_display_cols_base <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;position&#39;</span>, <span class="st">&#39;identifier&#39;</span>, <span class="st">&#39;code&#39;</span>,</span>
<span id="cb90-2"><a href="visualising-results-for-a-single-stage.html#cb90-2" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#&#39;drivername&#39;, &#39;codrivername&#39;,</span></span>
<span id="cb90-3"><a href="visualising-results-for-a-single-stage.html#cb90-3" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#&#39;groupname&#39;, &#39;entrantname&#39;,</span></span>
<span id="cb90-4"><a href="visualising-results-for-a-single-stage.html#cb90-4" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#&#39;classname&#39;, &#39;eligibility&#39;,</span></span>
<span id="cb90-5"><a href="visualising-results-for-a-single-stage.html#cb90-5" aria-hidden="true" tabindex="-1"></a>                            <span class="co">#&#39;elapsedDuration&#39;,</span></span>
<span id="cb90-6"><a href="visualising-results-for-a-single-stage.html#cb90-6" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># gap is the time delta between a driver</span></span>
<span id="cb90-7"><a href="visualising-results-for-a-single-stage.html#cb90-7" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># and the leader; diff (or interval)</span></span>
<span id="cb90-8"><a href="visualising-results-for-a-single-stage.html#cb90-8" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># is the difference between a driver</span></span>
<span id="cb90-9"><a href="visualising-results-for-a-single-stage.html#cb90-9" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># and the driver immediately ahead</span></span>
<span id="cb90-10"><a href="visualising-results-for-a-single-stage.html#cb90-10" aria-hidden="true" tabindex="-1"></a>                            <span class="st">&#39;TimeInS&#39;</span>, <span class="st">&#39;gap&#39;</span>, <span class="st">&#39;diff&#39;</span>)</span>
<span id="cb90-11"><a href="visualising-results-for-a-single-stage.html#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="visualising-results-for-a-single-stage.html#cb90-12" aria-hidden="true" tabindex="-1"></a>top10_stage_times <span class="ot">=</span> stage_times <span class="sc">%&gt;%</span></span>
<span id="cb90-13"><a href="visualising-results-for-a-single-stage.html#cb90-13" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># A minor optimisation step to </span></span>
<span id="cb90-14"><a href="visualising-results-for-a-single-stage.html#cb90-14" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># limit the amount of merging</span></span>
<span id="cb90-15"><a href="visualising-results-for-a-single-stage.html#cb90-15" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">arrange</span>(position) <span class="sc">%&gt;%</span></span>
<span id="cb90-16"><a href="visualising-results-for-a-single-stage.html#cb90-16" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb90-17"><a href="visualising-results-for-a-single-stage.html#cb90-17" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># Merge in the entries data</span></span>
<span id="cb90-18"><a href="visualising-results-for-a-single-stage.html#cb90-18" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">merge</span>(cars, <span class="at">by=</span><span class="st">&#39;entryId&#39;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb90-19"><a href="visualising-results-for-a-single-stage.html#cb90-19" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># Convert milliseconds to seconds</span></span>
<span id="cb90-20"><a href="visualising-results-for-a-single-stage.html#cb90-20" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">TimeInS =</span> elapsedDurationMs<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb90-21"><a href="visualising-results-for-a-single-stage.html#cb90-21" aria-hidden="true" tabindex="-1"></a>                             <span class="at">gap =</span> diffFirstMs<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb90-22"><a href="visualising-results-for-a-single-stage.html#cb90-22" aria-hidden="true" tabindex="-1"></a>                             <span class="at">diff =</span> diffPrevMs<span class="sc">/</span><span class="dv">1000</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb90-23"><a href="visualising-results-for-a-single-stage.html#cb90-23" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># Limit columns and set column order</span></span>
<span id="cb90-24"><a href="visualising-results-for-a-single-stage.html#cb90-24" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">select</span>(<span class="fu">all_of</span>(top10_display_cols_base)) <span class="sc">%&gt;%</span></span>
<span id="cb90-25"><a href="visualising-results-for-a-single-stage.html#cb90-25" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># The merge may upset the row order</span></span>
<span id="cb90-26"><a href="visualising-results-for-a-single-stage.html#cb90-26" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># so reset the order again</span></span>
<span id="cb90-27"><a href="visualising-results-for-a-single-stage.html#cb90-27" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">arrange</span>(position) <span class="sc">%&gt;%</span></span>
<span id="cb90-28"><a href="visualising-results-for-a-single-stage.html#cb90-28" aria-hidden="true" tabindex="-1"></a>                      <span class="co"># Improve column names by renaming them</span></span>
<span id="cb90-29"><a href="visualising-results-for-a-single-stage.html#cb90-29" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">rename</span>(<span class="at">Pos=</span>position,</span>
<span id="cb90-30"><a href="visualising-results-for-a-single-stage.html#cb90-30" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Car =</span> identifier,</span>
<span id="cb90-31"><a href="visualising-results-for-a-single-stage.html#cb90-31" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Code =</span> code,</span>
<span id="cb90-32"><a href="visualising-results-for-a-single-stage.html#cb90-32" aria-hidden="true" tabindex="-1"></a>                             <span class="st">`</span><span class="at">Time (s)</span><span class="st">`</span> <span class="ot">=</span> TimeInS,</span>
<span id="cb90-33"><a href="visualising-results-for-a-single-stage.html#cb90-33" aria-hidden="true" tabindex="-1"></a>                             <span class="at">Gap =</span> gap, <span class="at">Diff =</span> diff)</span>
<span id="cb90-34"><a href="visualising-results-for-a-single-stage.html#cb90-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-35"><a href="visualising-results-for-a-single-stage.html#cb90-35" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>( top10_stage_times )</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
Pos
</th>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Code
</th>
<th style="text-align:right;">
Time (s)
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
TÄN
</td>
<td style="text-align:right;">
834.5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NEU
</td>
<td style="text-align:right;">
835.5
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
SOL
</td>
<td style="text-align:right;">
839.1
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
ROV
</td>
<td style="text-align:right;">
840.2
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
BRE
</td>
<td style="text-align:right;">
841.9
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
1.7
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
OGI
</td>
<td style="text-align:right;">
842.0
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
KAT
</td>
<td style="text-align:right;">
843.2
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
LOU
</td>
<td style="text-align:right;">
844.3
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
EVA
</td>
<td style="text-align:right;">
845.8
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
1.5
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
SUN
</td>
<td style="text-align:right;">
846.9
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="adding-stage-metadata-to-table-captions" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Adding Stage Metadata to Table Captions</h2>
<p>To improve the table further, we may want to add a caption to the table describing the stage to which the results actually refer.</p>
<p>The caption might include the stage code and the stage name, for example, and perhaps the stage distance. It might also be handy to retrieve the stage number so that if we are displaying several tables, we can check we present the stages in the correct running order:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="visualising-results-for-a-single-stage.html#cb91-1" aria-hidden="true" tabindex="-1"></a>stage_cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;stageId&#39;</span>, <span class="st">&#39;number&#39;</span>, <span class="st">&#39;name&#39;</span>, <span class="st">&#39;distance&#39;</span>, <span class="st">&#39;code&#39;</span>)</span>
<span id="cb91-2"><a href="visualising-results-for-a-single-stage.html#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="visualising-results-for-a-single-stage.html#cb91-3" aria-hidden="true" tabindex="-1"></a>stage_info <span class="ot">=</span> stages <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="visualising-results-for-a-single-stage.html#cb91-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">select</span>(<span class="fu">all_of</span>(stage_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb91-5"><a href="visualising-results-for-a-single-stage.html#cb91-5" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Tidy up the stage name</span></span>
<span id="cb91-6"><a href="visualising-results-for-a-single-stage.html#cb91-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_replace</span>(name, <span class="st">&#39; </span><span class="sc">\\</span><span class="st">(Live TV</span><span class="sc">\\</span><span class="st">)&#39;</span>, <span class="st">&#39;&#39;</span>))</span>
<span id="cb91-7"><a href="visualising-results-for-a-single-stage.html#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="visualising-results-for-a-single-stage.html#cb91-8" aria-hidden="true" tabindex="-1"></a>stage_info <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   stageId number          name distance code
## 1    1747      1 Sarriojärvi 1    31.05  SS1
## 2    1743      2 Sarriojärvi 2    31.05  SS2</code></pre>
<p>We can create a caption for our selected stage using what essentially amounts to a string template:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="visualising-results-for-a-single-stage.html#cb93-1" aria-hidden="true" tabindex="-1"></a>stage_info_ <span class="ot">=</span> stage_info[stage_info[<span class="st">&#39;stageId&#39;</span>]<span class="sc">==</span>stageId,]</span>
<span id="cb93-2"><a href="visualising-results-for-a-single-stage.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># paste0() ensures there are no separators between substrings</span></span>
<span id="cb93-3"><a href="visualising-results-for-a-single-stage.html#cb93-3" aria-hidden="true" tabindex="-1"></a>caption <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&#39;Stage &#39;</span>, stage_info_<span class="sc">$</span>code,</span>
<span id="cb93-4"><a href="visualising-results-for-a-single-stage.html#cb93-4" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;, &#39;</span>, stage_info_<span class="sc">$</span>name, <span class="st">&#39; (&#39;</span>,</span>
<span id="cb93-5"><a href="visualising-results-for-a-single-stage.html#cb93-5" aria-hidden="true" tabindex="-1"></a>                 stage_info_<span class="sc">$</span>distance, <span class="st">&#39;km)&#39;</span>)</span>
<span id="cb93-6"><a href="visualising-results-for-a-single-stage.html#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="visualising-results-for-a-single-stage.html#cb93-7" aria-hidden="true" tabindex="-1"></a>caption</span></code></pre></div>
<pre><code>## [1] &quot;Stage SS3, Mustalampi 1 (24.43km)&quot;</code></pre>
<p>We can add a caption to the table via the <em>caption</em> parameter:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="visualising-results-for-a-single-stage.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>( top10_stage_times, <span class="at">caption =</span> caption)</span></code></pre></div>
<table class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-51">Table 3.1: </span>Stage SS3, Mustalampi 1 (24.43km)
</caption>
<thead>
<tr>
<th style="text-align:right;">
Pos
</th>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Code
</th>
<th style="text-align:right;">
Time (s)
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
TÄN
</td>
<td style="text-align:right;">
834.5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NEU
</td>
<td style="text-align:right;">
835.5
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
SOL
</td>
<td style="text-align:right;">
839.1
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
ROV
</td>
<td style="text-align:right;">
840.2
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
BRE
</td>
<td style="text-align:right;">
841.9
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
1.7
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
OGI
</td>
<td style="text-align:right;">
842.0
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
KAT
</td>
<td style="text-align:right;">
843.2
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
LOU
</td>
<td style="text-align:right;">
844.3
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
EVA
</td>
<td style="text-align:right;">
845.8
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
1.5
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
SUN
</td>
<td style="text-align:right;">
846.9
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
</tbody>
</table>
</div>
<div id="colour-highlighting-stage-results" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Colour Highlighting Stage Results</h2>
<p>The <code>formattable::formattable()</code> function is capable of highlighting cell values in a variety of customisable ways.</p>
<p>For example, we can emphasise differences that exceed a specific amount:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="visualising-results-for-a-single-stage.html#cb96-1" aria-hidden="true" tabindex="-1"></a>large_diff <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb96-2"><a href="visualising-results-for-a-single-stage.html#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="visualising-results-for-a-single-stage.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>(top10_stage_times,</span>
<span id="cb96-4"><a href="visualising-results-for-a-single-stage.html#cb96-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">Diff =</span> <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>,</span>
<span id="cb96-5"><a href="visualising-results-for-a-single-stage.html#cb96-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style =</span> x <span class="sc">~</span> <span class="fu">style</span>(<span class="at">font.weight =</span></span>
<span id="cb96-6"><a href="visualising-results-for-a-single-stage.html#cb96-6" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">ifelse</span>(x<span class="sc">&gt;=</span>large_diff,</span>
<span id="cb96-7"><a href="visualising-results-for-a-single-stage.html#cb96-7" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">&quot;bold&quot;</span>, <span class="st">&#39;normal&#39;</span>))))) </span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
Pos
</th>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Code
</th>
<th style="text-align:right;">
Time (s)
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
TÄN
</td>
<td style="text-align:right;">
834.5
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
<span style="font-weight: normal">0.0</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NEU
</td>
<td style="text-align:right;">
835.5
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
<span style="font-weight: normal">1.0</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
SOL
</td>
<td style="text-align:right;">
839.1
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
<span style="font-weight: bold">3.6</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
ROV
</td>
<td style="text-align:right;">
840.2
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:right;">
<span style="font-weight: normal">1.1</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
BRE
</td>
<td style="text-align:right;">
841.9
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
<span style="font-weight: normal">1.7</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
OGI
</td>
<td style="text-align:right;">
842.0
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
<span style="font-weight: normal">0.1</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
KAT
</td>
<td style="text-align:right;">
843.2
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
<span style="font-weight: normal">1.2</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
LOU
</td>
<td style="text-align:right;">
844.3
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
<span style="font-weight: normal">1.1</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
EVA
</td>
<td style="text-align:right;">
845.8
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
<span style="font-weight: normal">1.5</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
SUN
</td>
<td style="text-align:right;">
846.9
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
<span style="font-weight: normal">1.1</span>
</td>
</tr>
</tbody>
</table>
<p>Alternatively, we can add a coloured bar that depicts the increasing gap time down the leaderboard:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="visualising-results-for-a-single-stage.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://www.displayr.com/formattable/</span></span>
<span id="cb97-2"><a href="visualising-results-for-a-single-stage.html#cb97-2" aria-hidden="true" tabindex="-1"></a>unit.scale <span class="ot">=</span> <span class="cf">function</span>(x) (x <span class="sc">-</span> <span class="fu">min</span>(x)) <span class="sc">/</span> (<span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x))</span>
<span id="cb97-3"><a href="visualising-results-for-a-single-stage.html#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="visualising-results-for-a-single-stage.html#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>(top10_stage_times,</span>
<span id="cb97-5"><a href="visualising-results-for-a-single-stage.html#cb97-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">Gap =</span> <span class="fu">color_bar</span>(<span class="st">&quot;#FA614B66&quot;</span>, <span class="at">fun =</span> unit.scale)))</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
Pos
</th>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Code
</th>
<th style="text-align:right;">
Time (s)
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
TÄN
</td>
<td style="text-align:right;">
834.5
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 0.00%">0.0</span>
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NEU
</td>
<td style="text-align:right;">
835.5
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 8.06%">1.0</span>
</td>
<td style="text-align:right;">
1.0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
SOL
</td>
<td style="text-align:right;">
839.1
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 37.10%">4.6</span>
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
ROV
</td>
<td style="text-align:right;">
840.2
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 45.97%">5.7</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
BRE
</td>
<td style="text-align:right;">
841.9
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 59.68%">7.4</span>
</td>
<td style="text-align:right;">
1.7
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
OGI
</td>
<td style="text-align:right;">
842.0
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 60.48%">7.5</span>
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
KAT
</td>
<td style="text-align:right;">
843.2
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 70.16%">8.7</span>
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
LOU
</td>
<td style="text-align:right;">
844.3
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 79.03%">9.8</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
EVA
</td>
<td style="text-align:right;">
845.8
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 91.13%">11.3</span>
</td>
<td style="text-align:right;">
1.5
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
SUN
</td>
<td style="text-align:right;">
846.9
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; padding-right: 2px; background-color: rgba(250, 97, 75, 0.4); width: 100.00%">12.4</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
</tbody>
</table>
<p>There seems to be an edge effect there for the zero gap value? Let’s see if we can tidy that up a bit:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="visualising-results-for-a-single-stage.html#cb98-1" aria-hidden="true" tabindex="-1"></a>new_color_bar <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">color =</span> <span class="st">&quot;lightgreen&quot;</span>, ...){</span>
<span id="cb98-2"><a href="visualising-results-for-a-single-stage.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>,</span>
<span id="cb98-3"><a href="visualising-results-for-a-single-stage.html#cb98-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="cf">function</span>(x) <span class="fu">style</span>(</span>
<span id="cb98-4"><a href="visualising-results-for-a-single-stage.html#cb98-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">display =</span> <span class="st">&quot;inline-block&quot;</span>,</span>
<span id="cb98-5"><a href="visualising-results-for-a-single-stage.html#cb98-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">direction =</span> <span class="st">&quot;rtl&quot;</span>, </span>
<span id="cb98-6"><a href="visualising-results-for-a-single-stage.html#cb98-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">unicode-bidi</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;plaintext&quot;</span>,</span>
<span id="cb98-7"><a href="visualising-results-for-a-single-stage.html#cb98-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;border-radius&quot;</span> <span class="ot">=</span> <span class="st">&quot;4px&quot;</span>,</span>
<span id="cb98-8"><a href="visualising-results-for-a-single-stage.html#cb98-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;background-color&quot;</span> <span class="ot">=</span> color,</span>
<span id="cb98-9"><a href="visualising-results-for-a-single-stage.html#cb98-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">width =</span> <span class="fu">percent</span>(<span class="fu">proportion</span>(<span class="fu">abs</span>(<span class="fu">as.numeric</span>(x)), ...))</span>
<span id="cb98-10"><a href="visualising-results-for-a-single-stage.html#cb98-10" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb98-11"><a href="visualising-results-for-a-single-stage.html#cb98-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-12"><a href="visualising-results-for-a-single-stage.html#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="visualising-results-for-a-single-stage.html#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>(top10_stage_times,</span>
<span id="cb98-14"><a href="visualising-results-for-a-single-stage.html#cb98-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">Gap =</span>  <span class="fu">new_color_bar</span>(<span class="st">&quot;#FA614B66&quot;</span>)))</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
Pos
</th>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Code
</th>
<th style="text-align:right;">
Time (s)
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
TÄN
</td>
<td style="text-align:right;">
834.5
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 0.00%">0.0</span>
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NEU
</td>
<td style="text-align:right;">
835.5
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 8.06%">1.0</span>
</td>
<td style="text-align:right;">
1.0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
SOL
</td>
<td style="text-align:right;">
839.1
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 37.10%">4.6</span>
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
ROV
</td>
<td style="text-align:right;">
840.2
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 45.97%">5.7</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
BRE
</td>
<td style="text-align:right;">
841.9
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 59.68%">7.4</span>
</td>
<td style="text-align:right;">
1.7
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
OGI
</td>
<td style="text-align:right;">
842.0
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 60.48%">7.5</span>
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
KAT
</td>
<td style="text-align:right;">
843.2
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 70.16%">8.7</span>
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
LOU
</td>
<td style="text-align:right;">
844.3
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 79.03%">9.8</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
EVA
</td>
<td style="text-align:right;">
845.8
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 91.13%">11.3</span>
</td>
<td style="text-align:right;">
1.5
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
SUN
</td>
<td style="text-align:right;">
846.9
</td>
<td style="text-align:right;">
<span style="display: inline-block; direction: rtl; unicode-bidi: plaintext; border-radius: 4px; background-color: #FA614B66; width: 100.00%">12.4</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
</tbody>
</table>
<p>The edge effect is gone, but the default <code>color_bar()</code> function doesn’t seem to render the values very well where the bars is narrow, at least when the table is rendered to HTML using <code>bookdown</code>.</p>
<p>If we provide am alternative color bar function that makes use of a CSS linear gradient to create the bar rather than a setting the width of text cell and colouring its background we can decouple the color bar and the size of the text area:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="visualising-results-for-a-single-stage.html#cb99-1" aria-hidden="true" tabindex="-1"></a>bg <span class="ot">=</span> <span class="cf">function</span>(start, end, color, ...) {</span>
<span id="cb99-2"><a href="visualising-results-for-a-single-stage.html#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">&quot;linear-gradient(90deg,transparent &quot;</span>,<span class="fu">percent</span>(start),<span class="st">&quot;,&quot;</span>,</span>
<span id="cb99-3"><a href="visualising-results-for-a-single-stage.html#cb99-3" aria-hidden="true" tabindex="-1"></a>        color, <span class="fu">percent</span>(start), <span class="st">&quot;,&quot;</span>, color, <span class="fu">percent</span>(end),</span>
<span id="cb99-4"><a href="visualising-results-for-a-single-stage.html#cb99-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;, transparent&quot;</span>, <span class="fu">percent</span>(end),<span class="st">&quot;)&quot;</span>)</span>
<span id="cb99-5"><a href="visualising-results-for-a-single-stage.html#cb99-5" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb99-6"><a href="visualising-results-for-a-single-stage.html#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="visualising-results-for-a-single-stage.html#cb99-7" aria-hidden="true" tabindex="-1"></a>color_bar2 <span class="ot">=</span>  <span class="cf">function</span> (<span class="at">color =</span> <span class="st">&quot;lightgray&quot;</span>, <span class="at">fun =</span> <span class="st">&quot;proportion&quot;</span>, ...) </span>
<span id="cb99-8"><a href="visualising-results-for-a-single-stage.html#cb99-8" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb99-9"><a href="visualising-results-for-a-single-stage.html#cb99-9" aria-hidden="true" tabindex="-1"></a>    fun <span class="ot">&lt;-</span> <span class="fu">match.fun</span>(fun)</span>
<span id="cb99-10"><a href="visualising-results-for-a-single-stage.html#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>, <span class="at">style =</span> <span class="cf">function</span>(x) <span class="fu">style</span>(<span class="at">display =</span> <span class="st">&quot;inline-block&quot;</span>,</span>
<span id="cb99-11"><a href="visualising-results-for-a-single-stage.html#cb99-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">`</span><span class="at">unicode-bidi</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;plaintext&quot;</span>, </span>
<span id="cb99-12"><a href="visualising-results-for-a-single-stage.html#cb99-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;background&quot;</span> <span class="ot">=</span> <span class="fu">bg</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">fun</span>(<span class="fu">as.numeric</span>(x), ...), <span class="dv">1</span>, color), <span class="st">&quot;width&quot;</span><span class="ot">=</span><span class="st">&quot;100%&quot;</span> ))</span>
<span id="cb99-13"><a href="visualising-results-for-a-single-stage.html#cb99-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-14"><a href="visualising-results-for-a-single-stage.html#cb99-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-15"><a href="visualising-results-for-a-single-stage.html#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>(top10_stage_times,</span>
<span id="cb99-16"><a href="visualising-results-for-a-single-stage.html#cb99-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">Gap =</span> <span class="fu">color_bar2</span>(<span class="st">&quot;#FA614B66&quot;</span>) ))</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
Pos
</th>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Code
</th>
<th style="text-align:right;">
Time (s)
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
TÄN
</td>
<td style="text-align:right;">
834.5
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  100.00% , #FA614B66 100.00% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">0.0</span>
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NEU
</td>
<td style="text-align:right;">
835.5
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  91.94% , #FA614B66 91.94% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">1.0</span>
</td>
<td style="text-align:right;">
1.0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
SOL
</td>
<td style="text-align:right;">
839.1
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  62.90% , #FA614B66 62.90% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">4.6</span>
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
ROV
</td>
<td style="text-align:right;">
840.2
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  54.03% , #FA614B66 54.03% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">5.7</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
BRE
</td>
<td style="text-align:right;">
841.9
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  40.32% , #FA614B66 40.32% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">7.4</span>
</td>
<td style="text-align:right;">
1.7
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
OGI
</td>
<td style="text-align:right;">
842.0
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  39.52% , #FA614B66 39.52% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">7.5</span>
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
KAT
</td>
<td style="text-align:right;">
843.2
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  29.84% , #FA614B66 29.84% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">8.7</span>
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
LOU
</td>
<td style="text-align:right;">
844.3
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  20.97% , #FA614B66 20.97% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">9.8</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
EVA
</td>
<td style="text-align:right;">
845.8
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  8.87% , #FA614B66 8.87% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">11.3</span>
</td>
<td style="text-align:right;">
1.5
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
SUN
</td>
<td style="text-align:right;">
846.9
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  0.00% , #FA614B66 0.00% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">12.4</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
</tbody>
</table>
<div id="heatmap-style-column-cell-backgrounds" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Heatmap Style Column Cell Backgrounds</h3>
<p>As well as in cell bar charts, we can also use more of a heatmap style approach and colour the background down a column according to value.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="visualising-results-for-a-single-stage.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>(top10_stage_times,</span>
<span id="cb100-2"><a href="visualising-results-for-a-single-stage.html#cb100-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">Gap =</span> <span class="fu">color_bar2</span>(<span class="st">&quot;#FA614B66&quot;</span>),</span>
<span id="cb100-3"><a href="visualising-results-for-a-single-stage.html#cb100-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Diff =</span> <span class="fu">color_tile</span>(<span class="st">&quot;#DeF7E9&quot;</span>, <span class="st">&quot;#71CA97&quot;</span>)))</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
Pos
</th>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Code
</th>
<th style="text-align:right;">
Time (s)
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
TÄN
</td>
<td style="text-align:right;">
834.5
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  100.00% , #FA614B66 100.00% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">0.0</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #def7e9">0.0</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NEU
</td>
<td style="text-align:right;">
835.5
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  91.94% , #FA614B66 91.94% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">1.0</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #bfead2">1.0</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
SOL
</td>
<td style="text-align:right;">
839.1
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  62.90% , #FA614B66 62.90% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">4.6</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #71ca97">3.6</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
ROV
</td>
<td style="text-align:right;">
840.2
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  54.03% , #FA614B66 54.03% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">5.7</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #bce9cf">1.1</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
BRE
</td>
<td style="text-align:right;">
841.9
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  40.32% , #FA614B66 40.32% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">7.4</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #aae1c2">1.7</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
OGI
</td>
<td style="text-align:right;">
842.0
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  39.52% , #FA614B66 39.52% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">7.5</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #daf5e6">0.1</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
KAT
</td>
<td style="text-align:right;">
843.2
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  29.84% , #FA614B66 29.84% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">8.7</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #b9e8cd">1.2</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
LOU
</td>
<td style="text-align:right;">
844.3
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  20.97% , #FA614B66 20.97% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">9.8</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #bce9cf">1.1</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
EVA
</td>
<td style="text-align:right;">
845.8
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  8.87% , #FA614B66 8.87% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">11.3</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #b0e4c6">1.5</span>
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
SUN
</td>
<td style="text-align:right;">
846.9
</td>
<td style="text-align:right;">
<span style="display: inline-block; unicode-bidi: plaintext; background: linear-gradient(90deg,transparent  0.00% , #FA614B66 0.00% , #FA614B66 100.00% , transparent 100.00% ); width: 100%">12.4</span>
</td>
<td style="text-align:right;">
<span style="display: block; padding: 0 4px; border-radius: 4px; background-color: #bce9cf">1.1</span>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="an-aside-calculating-diff-and-gap-times" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> An Aside — Calculating DIFF and GAP times</h2>
<p>As has previously been mentioned, the <em>GAP</em> to leader and +/- <em>DIFF</em> times to any car placed directly ahead of a particular car, are typical across many forms of motorsport timing screen. In rally terms, these metrics might apply either in overall rally terms <em>or</em> in stage terms; in circuit racing, the measures might apply relative to overall race position <em>or</em> track position.</p>
<p>The <em>GAP</em> (time to leader) is calculated as the difference between a time associated with the current leader and a similarly measured time associated with every other driver.</p>
<p>The <span class="math inline">\(\textrm{GAP}\)</span> between driver in first position, <span class="math inline">\(i=1\)</span>, and the driver in the <span class="math inline">\(j\)</span>’th position is given in various abuses of the notation as:</p>
<p><span class="math display">\[\textrm{GAP}{_j}=t_{j,\textrm{GAP}}=t_{j,1,DIFF}=t_j-t_1\]</span></p>
<p>Alternatively, we can calculate the gap as the sum of differences between consecutively placed drivers, <span class="math inline">\(j\neq1\)</span>, and the leader. The interval or DIFF between drivers in positions <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, where <span class="math inline">\(i\)</span> is ahead of <span class="math inline">\(j\)</span> (that is, <span class="math inline">\(i&lt;j\)</span>) and the driver in first position has <span class="math inline">\(i=1\)</span> is given as:</p>
<p><span class="math display">\[\textrm{DIFF}_{j,i}=t_{j,i,\textrm{DIFF}}=t_{j,i}=t_j-t_i: i&lt;j, t_0=t_1\]</span></p>
<p>Strictly, <span class="math inline">\(\textrm{GAP}_j=\textrm{DIFF}_{j,1}\)</span>.</p>
<p>To specify a particular stage, we might use <span class="math inline">\({_S}\textrm{GAP}{_j}\)</span> and <span class="math inline">\({_S}\textrm{DIFF}{_j}\)</span>.</p>
<p>The <span class="math inline">\(\textrm{GAP}\)</span> between a driver in position <span class="math inline">\(j=P\)</span> and the leader <span class="math inline">\(i=1\)</span> is then:</p>
<p><span class="math display">\[\textrm{GAP}_j=t_{j,\textrm{GAP}}=\textrm{DIFF}_{2,1}+\textrm{DIFF}_{3,2}+..+\textrm{DIFF}_{P,P-1}\]</span></p>
<p>We can write this more succinctly as:</p>
<p><span class="math display">\[\textrm{GAP}{_j}=t_{j,\textrm{GAP}}=0+\sum_{m=1}^{j}\textrm{DIFF}_{m,m-1}=\sum_{m=1}^{j}\left ( t_m-t_{m-1} \right ): j\ge1, t_0=t_1\]</span></p>
<p>We can implement these calculations directly as follows:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="visualising-results-for-a-single-stage.html#cb101-1" aria-hidden="true" tabindex="-1"></a>top10_stage_times <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="visualising-results-for-a-single-stage.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DIFF =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(<span class="st">`</span><span class="at">Time (s)</span><span class="st">`</span>)),</span>
<span id="cb101-3"><a href="visualising-results-for-a-single-stage.html#cb101-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">GAP =</span> <span class="fu">cumsum</span>(DIFF)) <span class="sc">%&gt;%</span></span>
<span id="cb101-4"><a href="visualising-results-for-a-single-stage.html#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&#39;Car&#39;</span>, <span class="st">&#39;Gap&#39;</span>, <span class="st">&#39;GAP&#39;</span>, <span class="st">&#39;Diff&#39;</span>, <span class="st">&#39;DIFF&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb101-5"><a href="visualising-results-for-a-single-stage.html#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>(<span class="at">caption =</span> caption)</span></code></pre></div>
<table class="table table-condensed">
<caption>
<span id="tab:unnamed-chunk-57">Table 3.2: </span>Stage SS3, Mustalampi 1 (24.43km)
</caption>
<thead>
<tr>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
GAP
</th>
<th style="text-align:right;">
Diff
</th>
<th style="text-align:right;">
DIFF
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
1.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
4.6
</td>
<td style="text-align:right;">
3.6
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
<tr>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
1.7
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
0.1
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
8.7
</td>
<td style="text-align:right;">
1.2
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
11.3
</td>
<td style="text-align:right;">
1.5
</td>
<td style="text-align:right;">
1.5
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
12.4
</td>
<td style="text-align:right;">
1.1
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
</tbody>
</table>
</div>
<div id="rebasing-stage-results" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Rebasing Stage Results</h2>
<p>Simple as they are, the <em>GAP</em> and <em>DIFF</em> times are very powerful: for any driver, we can see how far off the stage winning time they were (the <code>Gap</code>) and by summing appropriate <code>Diff</code> values you can quickly determine the time difference between any two drivers.</p>
<p>However, if we are interested in a particular driver, we can “rebase” the table to show the time differences between that driver and the other drivers explicitly.</p>
<p>To rebase times, <span class="math inline">\(t_i\)</span> for a set of drivers, <span class="math inline">\(i\)</span>, relative to a particular driver, <span class="math inline">\(j\)</span>, we set:</p>
<p><span class="math display">\[
t_{i}^{j} = t_i - t_j
\]</span>
For a stage <span class="math inline">\(S\)</span>, we might extend the notation to write:</p>
<p><span class="math display">\[
{_S}t_{i}^{j} = {_S}t_{i} - {_S}t_{j}
\]</span></p>
<p>using the simpler form with the <span class="math inline">\(S\)</span> prefix where the stage is known.</p>
<p>We might also abuse the <span class="math inline">\(textrm{GAP}\)</span> notation to specify a rebased time <span class="math inline">\(_S\textrm{GAP}_{i,j}={_S}t_{i}^{j}\)</span> noting <span class="math inline">\({_S}\textrm{GAP}_i={_S}\textrm{GAP}_{i,1}={_S}\textrm{DIFF}_{i,1}\)</span>.</p>
<p>In passing, we note that we can calculate the overall rally time (without penalties) for driver <span class="math inline">\(i\)</span>, up to and including stage <span class="math inline">\(N\)</span> as:</p>
<p><span class="math display">\[
{_N}T_{i}=\sum_{S=1}^{N}{_S}t_{i}
\]</span></p>
<p>The overall time at the end of the rally is then given as:</p>
<p><span class="math display">\[
T_{i}=\sum_{S=1}^{S{_{max}}}{_S}t_{i} + {penalties}_i
\]</span></p>
<p>Let’s see how the rebasing works.</p>
<p>First, get a driver code:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="visualising-results-for-a-single-stage.html#cb102-1" aria-hidden="true" tabindex="-1"></a>ogier <span class="ot">=</span> <span class="fu">get_person_id</span>(cars, <span class="st">&#39;ogier&#39;</span>, <span class="at">ret=</span><span class="st">&#39;identifier&#39;</span>)</span>
<span id="cb102-2"><a href="visualising-results-for-a-single-stage.html#cb102-2" aria-hidden="true" tabindex="-1"></a>ogier</span></code></pre></div>
<pre><code>## [1] &quot;1&quot;</code></pre>
<p>Now we can start to build up a rebase function that takes a data frame, an <em>entryId</em> and a set of columns we want to rebase.</p>
<p>To begin with, we note that we can rebase a single column simply by finding the value associated with a particular driver in that column and subtracting that value from each row in the column.</p>
<p>For example, we can get Ogier’s stage time:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="visualising-results-for-a-single-stage.html#cb104-1" aria-hidden="true" tabindex="-1"></a>ogier_time <span class="ot">=</span> top10_stage_times[top10_stage_times[[<span class="st">&#39;Car&#39;</span>]]<span class="sc">==</span>ogier,</span>
<span id="cb104-2"><a href="visualising-results-for-a-single-stage.html#cb104-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;Time (s)&quot;</span>]</span>
<span id="cb104-3"><a href="visualising-results-for-a-single-stage.html#cb104-3" aria-hidden="true" tabindex="-1"></a>ogier_time</span></code></pre></div>
<pre><code>## [1] 842</code></pre>
<p>And we can then subtract that time from every other car’s time:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="visualising-results-for-a-single-stage.html#cb106-1" aria-hidden="true" tabindex="-1"></a>top10_stage_times<span class="sc">$</span><span class="st">`</span><span class="at">Time (s)</span><span class="st">`</span> <span class="sc">-</span> ogier_time</span></code></pre></div>
<pre><code>##  [1] -7.5 -6.5 -2.9 -1.8 -0.1  0.0  1.2  2.3  3.8  4.9</code></pre>
<p>To rebase more than one column, we can specify a list of columns we want to rebase and then process the response as a named list before subtracting the items in that named list from each of the correspondingly named columns in each row of the dataframe:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="visualising-results-for-a-single-stage.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/a/32267785/454773</span></span>
<span id="cb108-2"><a href="visualising-results-for-a-single-stage.html#cb108-2" aria-hidden="true" tabindex="-1"></a>rebase_cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;Time (s)&#39;</span>, <span class="st">&#39;Gap&#39;</span>)</span>
<span id="cb108-3"><a href="visualising-results-for-a-single-stage.html#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="visualising-results-for-a-single-stage.html#cb108-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> top10_stage_times</span>
<span id="cb108-5"><a href="visualising-results-for-a-single-stage.html#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="visualising-results-for-a-single-stage.html#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co"># From each row, select specific columns</span></span>
<span id="cb108-7"><a href="visualising-results-for-a-single-stage.html#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co"># From those values subtract correspondingly named items</span></span>
<span id="cb108-8"><a href="visualising-results-for-a-single-stage.html#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="co"># representing the times in those columns for our specified driver</span></span>
<span id="cb108-9"><a href="visualising-results-for-a-single-stage.html#cb108-9" aria-hidden="true" tabindex="-1"></a>df[,rebase_cols] <span class="sc">-</span> <span class="fu">c</span>(df[df<span class="sc">$</span>Car<span class="sc">==</span>ogier, rebase_cols])</span></code></pre></div>
<pre><code>##    Time (s)  Gap
## 1      -7.5 -7.5
## 2      -6.5 -6.5
## 3      -2.9 -2.9
## 4      -1.8 -1.8
## 5      -0.1 -0.1
## 6       0.0  0.0
## 7       1.2  1.2
## 8       2.3  2.3
## 9       3.8  3.8
## 10      4.9  4.9</code></pre>
<p>Let’s put that into a function, generalised to allow is to specify which column we want to use as a rebasing identifier column, and optioning allow the return of either just the rebased columns (and identifier) or the complete dataframe, including rebased columns:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="visualising-results-for-a-single-stage.html#cb110-1" aria-hidden="true" tabindex="-1"></a>rebase <span class="ot">=</span> <span class="cf">function</span>(df, id, rebase_cols,</span>
<span id="cb110-2"><a href="visualising-results-for-a-single-stage.html#cb110-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">id_col=</span><span class="st">&#39;entryId&#39;</span>, <span class="at">base=</span><span class="cn">FALSE</span>,  <span class="at">base_id=</span><span class="cn">FALSE</span>) {</span>
<span id="cb110-3"><a href="visualising-results-for-a-single-stage.html#cb110-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-4"><a href="visualising-results-for-a-single-stage.html#cb110-4" aria-hidden="true" tabindex="-1"></a>  df_ <span class="ot">=</span>  df</span>
<span id="cb110-5"><a href="visualising-results-for-a-single-stage.html#cb110-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-6"><a href="visualising-results-for-a-single-stage.html#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The rebase values are the ones</span></span>
<span id="cb110-7"><a href="visualising-results-for-a-single-stage.html#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we want to subtract from each row</span></span>
<span id="cb110-8"><a href="visualising-results-for-a-single-stage.html#cb110-8" aria-hidden="true" tabindex="-1"></a>  rebase_vals <span class="ot">=</span> <span class="fu">c</span>(df[df[[id_col]]<span class="sc">==</span>id, rebase_cols])</span>
<span id="cb110-9"><a href="visualising-results-for-a-single-stage.html#cb110-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-10"><a href="visualising-results-for-a-single-stage.html#cb110-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Do the rebasing</span></span>
<span id="cb110-11"><a href="visualising-results-for-a-single-stage.html#cb110-11" aria-hidden="true" tabindex="-1"></a>  df_[,rebase_cols] <span class="ot">=</span>  df[,rebase_cols] <span class="sc">-</span> rebase_vals</span>
<span id="cb110-12"><a href="visualising-results-for-a-single-stage.html#cb110-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb110-13"><a href="visualising-results-for-a-single-stage.html#cb110-13" aria-hidden="true" tabindex="-1"></a>  df_[[id_col]] <span class="ot">=</span> df[[id_col]]</span>
<span id="cb110-14"><a href="visualising-results-for-a-single-stage.html#cb110-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-15"><a href="visualising-results-for-a-single-stage.html#cb110-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return just the rebased and identifier columns or the</span></span>
<span id="cb110-16"><a href="visualising-results-for-a-single-stage.html#cb110-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># whole dataframe</span></span>
<span id="cb110-17"><a href="visualising-results-for-a-single-stage.html#cb110-17" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">=</span> rebase_cols</span>
<span id="cb110-18"><a href="visualising-results-for-a-single-stage.html#cb110-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (base_id)</span>
<span id="cb110-19"><a href="visualising-results-for-a-single-stage.html#cb110-19" aria-hidden="true" tabindex="-1"></a>    cols <span class="ot">=</span> <span class="fu">c</span>(id_col, cols)</span>
<span id="cb110-20"><a href="visualising-results-for-a-single-stage.html#cb110-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (base)</span>
<span id="cb110-21"><a href="visualising-results-for-a-single-stage.html#cb110-21" aria-hidden="true" tabindex="-1"></a>    df_ <span class="sc">%&gt;%</span> <span class="fu">select</span>(cols)</span>
<span id="cb110-22"><a href="visualising-results-for-a-single-stage.html#cb110-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb110-23"><a href="visualising-results-for-a-single-stage.html#cb110-23" aria-hidden="true" tabindex="-1"></a>    df_</span>
<span id="cb110-24"><a href="visualising-results-for-a-single-stage.html#cb110-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We can now rebase the stage times across one or more columns relative to a specified driver:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="visualising-results-for-a-single-stage.html#cb111-1" aria-hidden="true" tabindex="-1"></a>rebase_cols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;Time (s)&#39;</span>, <span class="st">&#39;Gap&#39;</span>)</span>
<span id="cb111-2"><a href="visualising-results-for-a-single-stage.html#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="visualising-results-for-a-single-stage.html#cb111-3" aria-hidden="true" tabindex="-1"></a>rov <span class="ot">=</span> <span class="fu">get_person_id</span>(cars, <span class="st">&#39;rov&#39;</span>, <span class="at">ret=</span><span class="st">&#39;identifier&#39;</span>)</span>
<span id="cb111-4"><a href="visualising-results-for-a-single-stage.html#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="visualising-results-for-a-single-stage.html#cb111-5" aria-hidden="true" tabindex="-1"></a>rov_rebased_gap <span class="ot">=</span> <span class="fu">rebase</span>(top10_stage_times, rov, rebase_cols,</span>
<span id="cb111-6"><a href="visualising-results-for-a-single-stage.html#cb111-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">id_col=</span><span class="st">&#39;Car&#39;</span>)</span>
<span id="cb111-7"><a href="visualising-results-for-a-single-stage.html#cb111-7" aria-hidden="true" tabindex="-1"></a>rov_rebased_gap</span></code></pre></div>
<pre><code>##    Pos Car Code Time (s)  Gap Diff
## 1    1   8  TÄN     -5.7 -5.7  0.0
## 2    2  11  NEU     -4.7 -4.7  1.0
## 3    3   2  SOL     -1.1 -1.1  3.6
## 4    4  69  ROV      0.0  0.0  1.1
## 5    5  42  BRE      1.7  1.7  1.7
## 6    6   1  OGI      1.8  1.8  0.1
## 7    7  18  KAT      3.0  3.0  1.2
## 8    8   7  LOU      4.1  4.1  1.1
## 9    9  33  EVA      5.6  5.6  1.5
## 10  10   3  SUN      6.7  6.7  1.1</code></pre>
<p>The rebased time dataframe makes it easier to see how a specified driver compares with every other driver. But can we make the differences jump out in a more striking fashion?</p>
</div>
<div id="colour-highlighting-rebased-values" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Colour Highlighting Rebased Values</h2>
<p>In the rebased tables, we are likely to be presented with a range of positive and negative values within a rebased column.</p>
<p>We can highlight the positive and negative values using colour. For example:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="visualising-results-for-a-single-stage.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>(rov_rebased_gap,</span>
<span id="cb113-2"><a href="visualising-results-for-a-single-stage.html#cb113-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">Gap =</span> <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>,</span>
<span id="cb113-3"><a href="visualising-results-for-a-single-stage.html#cb113-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">style =</span> x <span class="sc">~</span> <span class="fu">style</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(x<span class="sc">&lt;</span><span class="dv">0</span>,</span>
<span id="cb113-4"><a href="visualising-results-for-a-single-stage.html#cb113-4" aria-hidden="true" tabindex="-1"></a>                                              <span class="st">&quot;red&quot;</span>, </span>
<span id="cb113-5"><a href="visualising-results-for-a-single-stage.html#cb113-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">ifelse</span>(x<span class="sc">&gt;</span><span class="dv">0</span>, <span class="st">&#39;green&#39;</span>, <span class="st">&#39;grey&#39;</span>)),</span>
<span id="cb113-6"><a href="visualising-results-for-a-single-stage.html#cb113-6" aria-hidden="true" tabindex="-1"></a>                                            <span class="co"># Example additional style</span></span>
<span id="cb113-7"><a href="visualising-results-for-a-single-stage.html#cb113-7" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">font.weight =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(x)<span class="sc">&gt;=</span><span class="dv">2</span>,</span>
<span id="cb113-8"><a href="visualising-results-for-a-single-stage.html#cb113-8" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">&#39;bold&#39;</span>,</span>
<span id="cb113-9"><a href="visualising-results-for-a-single-stage.html#cb113-9" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">&#39;normal&#39;</span>) ))))</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
Pos
</th>
<th style="text-align:right;">
Car
</th>
<th style="text-align:right;">
Code
</th>
<th style="text-align:right;">
Time (s)
</th>
<th style="text-align:right;">
Gap
</th>
<th style="text-align:right;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
TÄN
</td>
<td style="text-align:right;">
-5.7
</td>
<td style="text-align:right;">
<span style="color: red; font-weight: bold">-5.7</span>
</td>
<td style="text-align:right;">
0.0
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
NEU
</td>
<td style="text-align:right;">
-4.7
</td>
<td style="text-align:right;">
<span style="color: red; font-weight: bold">-4.7</span>
</td>
<td style="text-align:right;">
1.0
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
SOL
</td>
<td style="text-align:right;">
-1.1
</td>
<td style="text-align:right;">
<span style="color: red; font-weight: normal">-1.1</span>
</td>
<td style="text-align:right;">
3.6
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
ROV
</td>
<td style="text-align:right;">
0.0
</td>
<td style="text-align:right;">
<span style="color: grey; font-weight: normal">0.0</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
42
</td>
<td style="text-align:right;">
BRE
</td>
<td style="text-align:right;">
1.7
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: normal">1.7</span>
</td>
<td style="text-align:right;">
1.7
</td>
</tr>
<tr>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
OGI
</td>
<td style="text-align:right;">
1.8
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: normal">1.8</span>
</td>
<td style="text-align:right;">
0.1
</td>
</tr>
<tr>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
KAT
</td>
<td style="text-align:right;">
3.0
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">3.0</span>
</td>
<td style="text-align:right;">
1.2
</td>
</tr>
<tr>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
LOU
</td>
<td style="text-align:right;">
4.1
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">4.1</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
<tr>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
33
</td>
<td style="text-align:right;">
EVA
</td>
<td style="text-align:right;">
5.6
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">5.6</span>
</td>
<td style="text-align:right;">
1.5
</td>
</tr>
<tr>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
SUN
</td>
<td style="text-align:right;">
6.7
</td>
<td style="text-align:right;">
<span style="color: green; font-weight: bold">6.7</span>
</td>
<td style="text-align:right;">
1.1
</td>
</tr>
</tbody>
</table>
<p>Although the <code>formattable()</code> function does not directly support divergent colour indicators, we can create a custom formatter that does provide such a view over the data.</p>
<p>For example, we can create a mapping that will display coloured backgrounds that diverge around the zero value to give distinct hues for positive and negative values.</p>
<p>The easiest way to render such a mapping is to map the rage of value onto the unit range, and map the 0 value in the original range to the 0.5 value in the normalised unit range.</p>
<p>The following function will create a normalised range across a set of positive <em>and</em> negative values, mapping the origin (0) to the normalised 0.5 value:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="visualising-results-for-a-single-stage.html#cb114-1" aria-hidden="true" tabindex="-1"></a>xnormalize <span class="ot">=</span> <span class="cf">function</span>(x){</span>
<span id="cb114-2"><a href="visualising-results-for-a-single-stage.html#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalise to the full range of values about 0</span></span>
<span id="cb114-3"><a href="visualising-results-for-a-single-stage.html#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># O will map to 0.5 in the normalised range</span></span>
<span id="cb114-4"><a href="visualising-results-for-a-single-stage.html#cb114-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">c</span>(x, <span class="sc">-</span><span class="fu">max</span>(<span class="fu">abs</span>(x)), <span class="fu">max</span>(<span class="fu">abs</span>(x)))</span>
<span id="cb114-5"><a href="visualising-results-for-a-single-stage.html#cb114-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">normalize</span>(x)[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(x)<span class="sc">-</span><span class="dv">2</span>)]</span>
<span id="cb114-6"><a href="visualising-results-for-a-single-stage.html#cb114-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s see how it works:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="visualising-results-for-a-single-stage.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xnormalize</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 0.25 0.50 1.00</code></pre>
<p>We can now define a custom mapping to render red and green palettised backgrounds depending on whether the value is negative or positive. To maintain contrast in the displayed text values, we can render white or black text depending on the likely intensity of the background colour:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="visualising-results-for-a-single-stage.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/a/49887341/454773</span></span>
<span id="cb117-2"><a href="visualising-results-for-a-single-stage.html#cb117-2" aria-hidden="true" tabindex="-1"></a>color_tile2 <span class="ot">&lt;-</span> <span class="cf">function</span> (...) {</span>
<span id="cb117-3"><a href="visualising-results-for-a-single-stage.html#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>, <span class="at">style =</span> <span class="cf">function</span>(x) {</span>
<span id="cb117-4"><a href="visualising-results-for-a-single-stage.html#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style</span>(<span class="at">display =</span> <span class="st">&quot;block&quot;</span>,</span>
<span id="cb117-5"><a href="visualising-results-for-a-single-stage.html#cb117-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;text-align&#39;</span> <span class="ot">=</span> <span class="st">&#39;center&#39;</span>,</span>
<span id="cb117-6"><a href="visualising-results-for-a-single-stage.html#cb117-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">padding =</span> <span class="st">&quot;0 4px&quot;</span>, </span>
<span id="cb117-7"><a href="visualising-results-for-a-single-stage.html#cb117-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">border-radius</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;4px&quot;</span>,</span>
<span id="cb117-8"><a href="visualising-results-for-a-single-stage.html#cb117-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">font.weight</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(x)<span class="sc">&gt;</span> <span class="fl">0.3</span><span class="sc">*</span><span class="fu">max</span>(x), <span class="st">&quot;bold&quot;</span>, <span class="st">&quot;normal&quot;</span>),</span>
<span id="cb117-9"><a href="visualising-results-for-a-single-stage.html#cb117-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(x)<span class="sc">&gt;</span> <span class="fl">0.3</span><span class="sc">*</span><span class="fu">max</span>(x),<span class="st">&#39;white&#39;</span>,</span>
<span id="cb117-10"><a href="visualising-results-for-a-single-stage.html#cb117-10" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">ifelse</span>(x<span class="sc">==</span><span class="dv">0</span>,<span class="st">&#39;lightgrey&#39;</span>,<span class="st">&#39;black&#39;</span>)),</span>
<span id="cb117-11"><a href="visualising-results-for-a-single-stage.html#cb117-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">background-color</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">csscolor</span>(<span class="fu">matrix</span>(<span class="fu">as.integer</span>(<span class="fu">colorRamp</span>(...)(<span class="fu">xnormalize</span>(<span class="fu">as.numeric</span>(x)))), </span>
<span id="cb117-12"><a href="visualising-results-for-a-single-stage.html#cb117-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">byrow=</span><span class="cn">TRUE</span>, </span>
<span id="cb117-13"><a href="visualising-results-for-a-single-stage.html#cb117-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">dimnames=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;blue&quot;</span>), <span class="cn">NULL</span>),</span>
<span id="cb117-14"><a href="visualising-results-for-a-single-stage.html#cb117-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow=</span><span class="dv">3</span>)))</span>
<span id="cb117-15"><a href="visualising-results-for-a-single-stage.html#cb117-15" aria-hidden="true" tabindex="-1"></a>  })}</span>
<span id="cb117-16"><a href="visualising-results-for-a-single-stage.html#cb117-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-17"><a href="visualising-results-for-a-single-stage.html#cb117-17" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>(rov_rebased_gap, <span class="at">align=</span><span class="st">&#39;c&#39;</span>,</span>
<span id="cb117-18"><a href="visualising-results-for-a-single-stage.html#cb117-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">Gap =</span> <span class="fu">color_tile2</span>(<span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&#39;white&#39;</span>, <span class="st">&quot;forestgreen&quot;</span>))))</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:center;">
Pos
</th>
<th style="text-align:center;">
Car
</th>
<th style="text-align:center;">
Code
</th>
<th style="text-align:center;">
Time (s)
</th>
<th style="text-align:center;">
Gap
</th>
<th style="text-align:center;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
TÄN
</td>
<td style="text-align:center;">
-5.7
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: bold; color: white; background-color: #ff2626">-5.7</span>
</td>
<td style="text-align:center;">
0.0
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
NEU
</td>
<td style="text-align:center;">
-4.7
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: bold; color: white; background-color: #ff4c4c">-4.7</span>
</td>
<td style="text-align:center;">
1.0
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
SOL
</td>
<td style="text-align:center;">
-1.1
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: normal; color: black; background-color: #ffd5d5">-1.1</span>
</td>
<td style="text-align:center;">
3.6
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
69
</td>
<td style="text-align:center;">
ROV
</td>
<td style="text-align:center;">
0.0
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: normal; color: lightgrey; background-color: #ffffff">0.0</span>
</td>
<td style="text-align:center;">
1.1
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
42
</td>
<td style="text-align:center;">
BRE
</td>
<td style="text-align:center;">
1.7
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: normal; color: black; background-color: #c6e1c6">1.7</span>
</td>
<td style="text-align:center;">
1.7
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
OGI
</td>
<td style="text-align:center;">
1.8
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: normal; color: black; background-color: #c3dfc3">1.8</span>
</td>
<td style="text-align:center;">
0.1
</td>
</tr>
<tr>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
KAT
</td>
<td style="text-align:center;">
3.0
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: bold; color: white; background-color: #9ccb9c">3.0</span>
</td>
<td style="text-align:center;">
1.2
</td>
</tr>
<tr>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
LOU
</td>
<td style="text-align:center;">
4.1
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: bold; color: white; background-color: #77b877">4.1</span>
</td>
<td style="text-align:center;">
1.1
</td>
</tr>
<tr>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
33
</td>
<td style="text-align:center;">
EVA
</td>
<td style="text-align:center;">
5.6
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: bold; color: white; background-color: #469e46">5.6</span>
</td>
<td style="text-align:center;">
1.5
</td>
</tr>
<tr>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
SUN
</td>
<td style="text-align:center;">
6.7
</td>
<td style="text-align:center;">
<span style="display: block; text-align: center; padding: 0 4px; border-radius: 4px; font-weight: bold; color: white; background-color: #228b22">6.7</span>
</td>
<td style="text-align:center;">
1.1
</td>
</tr>
</tbody>
</table>
<p><em>For further possible discussions about divergent palette definitions, see <a href="https://stackoverflow.com/questions/37482977/what-is-a-good-palette-for-divergent-colors-in-r-or-can-viridis-and-magma-b">here</a>.</em></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="visualising-results-for-a-single-stage.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall the CSS style from previously</span></span>
<span id="cb118-2"><a href="visualising-results-for-a-single-stage.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="co">#bg = function(start, end, color, ...) {</span></span>
<span id="cb118-3"><a href="visualising-results-for-a-single-stage.html#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  paste(&quot;linear-gradient(90deg,transparent &quot;,percent(start),&quot;,&quot;,</span></span>
<span id="cb118-4"><a href="visualising-results-for-a-single-stage.html#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co">#        color, percent(start), &quot;,&quot;, color, percent(end),</span></span>
<span id="cb118-5"><a href="visualising-results-for-a-single-stage.html#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="co">#        &quot;, transparent&quot;, percent(end),&quot;)&quot;)</span></span>
<span id="cb118-6"><a href="visualising-results-for-a-single-stage.html#cb118-6" aria-hidden="true" tabindex="-1"></a><span class="co">#} </span></span>
<span id="cb118-7"><a href="visualising-results-for-a-single-stage.html#cb118-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-8"><a href="visualising-results-for-a-single-stage.html#cb118-8" aria-hidden="true" tabindex="-1"></a>pm_color_bar2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">color1 =</span> <span class="st">&quot;lightgreen&quot;</span>, <span class="at">color2 =</span> <span class="st">&quot;pink&quot;</span>, ...){</span>
<span id="cb118-9"><a href="visualising-results-for-a-single-stage.html#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>,</span>
<span id="cb118-10"><a href="visualising-results-for-a-single-stage.html#cb118-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="cf">function</span>(x) <span class="fu">style</span>(</span>
<span id="cb118-11"><a href="visualising-results-for-a-single-stage.html#cb118-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">display =</span> <span class="st">&quot;inline-block&quot;</span>,</span>
<span id="cb118-12"><a href="visualising-results-for-a-single-stage.html#cb118-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="fu">ifelse</span>(x<span class="sc">&gt;</span> <span class="dv">0</span>,<span class="st">&#39;green&#39;</span>,<span class="fu">ifelse</span>(x<span class="sc">&lt;</span><span class="dv">0</span>,<span class="st">&#39;red&#39;</span>,<span class="st">&#39;lightgrey&#39;</span>)),</span>
<span id="cb118-13"><a href="visualising-results-for-a-single-stage.html#cb118-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;text-align&quot;</span> <span class="ot">=</span> <span class="fu">ifelse</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&#39;left&#39;</span>, <span class="fu">ifelse</span>(x<span class="sc">&lt;</span><span class="dv">0</span>, <span class="st">&#39;right&#39;</span>, <span class="st">&#39;center&#39;</span>)),</span>
<span id="cb118-14"><a href="visualising-results-for-a-single-stage.html#cb118-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;width&quot;</span><span class="ot">=</span><span class="st">&#39;100%&#39;</span>,</span>
<span id="cb118-15"><a href="visualising-results-for-a-single-stage.html#cb118-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;background&quot;</span> <span class="ot">=</span> <span class="fu">bg</span>(<span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="fl">0.5</span>,<span class="fu">xnormalize</span>(x)),</span>
<span id="cb118-16"><a href="visualising-results-for-a-single-stage.html#cb118-16" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> <span class="dv">0</span>,<span class="fu">xnormalize</span>(x),<span class="fl">0.5</span>),</span>
<span id="cb118-17"><a href="visualising-results-for-a-single-stage.html#cb118-17" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> <span class="dv">0</span>, color1, color2))</span>
<span id="cb118-18"><a href="visualising-results-for-a-single-stage.html#cb118-18" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb118-19"><a href="visualising-results-for-a-single-stage.html#cb118-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb118-20"><a href="visualising-results-for-a-single-stage.html#cb118-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-21"><a href="visualising-results-for-a-single-stage.html#cb118-21" aria-hidden="true" tabindex="-1"></a><span class="fu">formattable</span>(rov_rebased_gap, <span class="at">align=</span><span class="st">&#39;c&#39;</span>,</span>
<span id="cb118-22"><a href="visualising-results-for-a-single-stage.html#cb118-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="at">Gap =</span> <span class="fu">pm_color_bar2</span>()</span>
<span id="cb118-23"><a href="visualising-results-for-a-single-stage.html#cb118-23" aria-hidden="true" tabindex="-1"></a>              ))</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:center;">
Pos
</th>
<th style="text-align:center;">
Car
</th>
<th style="text-align:center;">
Code
</th>
<th style="text-align:center;">
Time (s)
</th>
<th style="text-align:center;">
Gap
</th>
<th style="text-align:center;">
Diff
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
TÄN
</td>
<td style="text-align:center;">
-5.7
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: red; text-align: right; width: 100%; background: linear-gradient(90deg,transparent  7.46% , pink 7.46% , pink 50.00% , transparent 50.00% )">-5.7</span>
</td>
<td style="text-align:center;">
0.0
</td>
</tr>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
11
</td>
<td style="text-align:center;">
NEU
</td>
<td style="text-align:center;">
-4.7
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: red; text-align: right; width: 100%; background: linear-gradient(90deg,transparent  14.93% , pink 14.93% , pink 50.00% , transparent 50.00% )">-4.7</span>
</td>
<td style="text-align:center;">
1.0
</td>
</tr>
<tr>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
SOL
</td>
<td style="text-align:center;">
-1.1
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: red; text-align: right; width: 100%; background: linear-gradient(90deg,transparent  41.79% , pink 41.79% , pink 50.00% , transparent 50.00% )">-1.1</span>
</td>
<td style="text-align:center;">
3.6
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
69
</td>
<td style="text-align:center;">
ROV
</td>
<td style="text-align:center;">
0.0
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: lightgrey; text-align: center; width: 100%; background: linear-gradient(90deg,transparent  50.00% , lightgreen 50.00% , lightgreen 50.00% , transparent 50.00% )">0.0</span>
</td>
<td style="text-align:center;">
1.1
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
42
</td>
<td style="text-align:center;">
BRE
</td>
<td style="text-align:center;">
1.7
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: green; text-align: left; width: 100%; background: linear-gradient(90deg,transparent  50.00% , lightgreen 50.00% , lightgreen 62.69% , transparent 62.69% )">1.7</span>
</td>
<td style="text-align:center;">
1.7
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
OGI
</td>
<td style="text-align:center;">
1.8
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: green; text-align: left; width: 100%; background: linear-gradient(90deg,transparent  50.00% , lightgreen 50.00% , lightgreen 63.43% , transparent 63.43% )">1.8</span>
</td>
<td style="text-align:center;">
0.1
</td>
</tr>
<tr>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
KAT
</td>
<td style="text-align:center;">
3.0
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: green; text-align: left; width: 100%; background: linear-gradient(90deg,transparent  50.00% , lightgreen 50.00% , lightgreen 72.39% , transparent 72.39% )">3.0</span>
</td>
<td style="text-align:center;">
1.2
</td>
</tr>
<tr>
<td style="text-align:center;">
8
</td>
<td style="text-align:center;">
7
</td>
<td style="text-align:center;">
LOU
</td>
<td style="text-align:center;">
4.1
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: green; text-align: left; width: 100%; background: linear-gradient(90deg,transparent  50.00% , lightgreen 50.00% , lightgreen 80.60% , transparent 80.60% )">4.1</span>
</td>
<td style="text-align:center;">
1.1
</td>
</tr>
<tr>
<td style="text-align:center;">
9
</td>
<td style="text-align:center;">
33
</td>
<td style="text-align:center;">
EVA
</td>
<td style="text-align:center;">
5.6
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: green; text-align: left; width: 100%; background: linear-gradient(90deg,transparent  50.00% , lightgreen 50.00% , lightgreen 91.79% , transparent 91.79% )">5.6</span>
</td>
<td style="text-align:center;">
1.5
</td>
</tr>
<tr>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
SUN
</td>
<td style="text-align:center;">
6.7
</td>
<td style="text-align:center;">
<span style="display: inline-block; color: green; text-align: left; width: 100%; background: linear-gradient(90deg,transparent  50.00% , lightgreen 50.00% , lightgreen 100.00% , transparent 100.00% )">6.7</span>
</td>
<td style="text-align:center;">
1.1
</td>
</tr>
</tbody>
</table>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="accessing-data-from-the-wrc-live-timing-api.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visualising-results-for-multiple-stages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/edit/master/stage-results.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/blob/master/stage-results.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
