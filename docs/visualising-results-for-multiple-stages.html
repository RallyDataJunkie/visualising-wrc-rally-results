<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Visualising Results for Multiple Stages | Visualising WRC Rally Timing and Results Data</title>
  <meta name="description" content="An introduction to visualising timing and results data for WRC rally events." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Visualising Results for Multiple Stages | Visualising WRC Rally Timing and Results Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Visualising Results for Multiple Stages | Visualising WRC Rally Timing and Results Data" />
  
  <meta name="twitter:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualising-results-for-a-single-stage.html"/>
<link rel="next" href="finding-pace-across-stages.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/formattable_widget-binding-0.2.1/formattable_widget.js"></script>
<link href="libs/jquery-sparkline-2.1.2/jquery.sparkline.css" rel="stylesheet" />
<script src="libs/jquery-sparkline-2.1.2/jquery.sparkline.js"></script>
<script src="libs/sparkline-binding-2.0/sparkline.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Visualising WRC Rally Results and Timing Data</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html"><i class="fa fa-check"></i><b>2</b> Accessing Data from the WRC Live Timing API</a>
<ul>
<li class="chapter" data-level="2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#current-season-rallies"><i class="fa fa-check"></i><b>2.1</b> Current Season Rallies</a></li>
<li class="chapter" data-level="2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#itinerary-lookup"><i class="fa fa-check"></i><b>2.2</b> Itinerary Lookup</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#leg-sections"><i class="fa fa-check"></i><b>2.2.1</b> Leg Sections</a></li>
<li class="chapter" data-level="2.2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#time-controls"><i class="fa fa-check"></i><b>2.2.2</b> Time Controls</a></li>
<li class="chapter" data-level="2.2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-details"><i class="fa fa-check"></i><b>2.2.3</b> Stage Details</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#competitor-details"><i class="fa fa-check"></i><b>2.3</b> Competitor Details</a></li>
<li class="chapter" data-level="2.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#penalties-and-retirements"><i class="fa fa-check"></i><b>2.4</b> Penalties and Retirements</a></li>
<li class="chapter" data-level="2.5" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#results-and-stage-winner"><i class="fa fa-check"></i><b>2.5</b> Results and Stage Winner</a></li>
<li class="chapter" data-level="2.6" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-result"><i class="fa fa-check"></i><b>2.6</b> Stage Result</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-results-for-multiple-stages"><i class="fa fa-check"></i><b>2.6.1</b> Getting Stage Results for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-times"><i class="fa fa-check"></i><b>2.7</b> Stage Times</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.1</b> Getting Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.2</b> Getting Wide Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-positions"><i class="fa fa-check"></i><b>2.7.3</b> Getting Wide Stage Positions</a></li>
<li class="chapter" data-level="2.7.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-generic-wide-dataframes"><i class="fa fa-check"></i><b>2.7.4</b> Getting Generic Wide Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#split-times"><i class="fa fa-check"></i><b>2.8</b> Split Times</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#driver-split-times-detail"><i class="fa fa-check"></i><b>2.8.1</b> Driver Split Times Detail</a></li>
<li class="chapter" data-level="2.8.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#wide-driver-split-times"><i class="fa fa-check"></i><b>2.8.2</b> Wide Driver Split Times</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html"><i class="fa fa-check"></i><b>3</b> Visualising Results for a Single Stage</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#load-base-data"><i class="fa fa-check"></i><b>3.1</b> Load Base Data</a></li>
<li class="chapter" data-level="3.2" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#get-stage-results-data"><i class="fa fa-check"></i><b>3.2</b> Get Stage Results Data</a></li>
<li class="chapter" data-level="3.3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#previewing-stage-results-data"><i class="fa fa-check"></i><b>3.3</b> Previewing Stage Results Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-entry-metadata"><i class="fa fa-check"></i><b>3.3.1</b> Adding Entry Metadata</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-stage-metadata-to-table-captions"><i class="fa fa-check"></i><b>3.4</b> Adding Stage Metadata to Table Captions</a></li>
<li class="chapter" data-level="3.5" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-stage-results"><i class="fa fa-check"></i><b>3.5</b> Colour Highlighting Stage Results</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#heatmap-style-column-cell-backgrounds"><i class="fa fa-check"></i><b>3.5.1</b> Heatmap Style Column Cell Backgrounds</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#an-aside-calculating-diff-and-gap-times"><i class="fa fa-check"></i><b>3.6</b> An Aside — Calculating DIFF and GAP times</a></li>
<li class="chapter" data-level="3.7" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#rebasing-stage-results"><i class="fa fa-check"></i><b>3.7</b> Rebasing Stage Results</a></li>
<li class="chapter" data-level="3.8" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-rebased-values"><i class="fa fa-check"></i><b>3.8</b> Colour Highlighting Rebased Values</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html"><i class="fa fa-check"></i><b>4</b> Visualising Results for Multiple Stages</a>
<ul>
<li class="chapter" data-level="4.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#load-base-data-1"><i class="fa fa-check"></i><b>4.1</b> Load Base Data</a></li>
<li class="chapter" data-level="4.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-stage-results-for-multiple-stages"><i class="fa fa-check"></i><b>4.2</b> Retrieving Stage Results for Multiple Stages</a></li>
<li class="chapter" data-level="4.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#mapping-stage-and-driver-identifiers-to-meaningful-labels"><i class="fa fa-check"></i><b>4.3</b> Mapping Stage and Driver Identifiers to Meaningful Labels</a></li>
<li class="chapter" data-level="4.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#rebasing-overall-times"><i class="fa fa-check"></i><b>4.4</b> Rebasing Overall Times</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#find-changes-in-rebased-gaps-across-stages"><i class="fa fa-check"></i><b>4.4.1</b> Find Changes in Rebased Gaps Across Stages</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-multiple-stage-results"><i class="fa fa-check"></i><b>4.5</b> Visualising Multiple Stage Results</a></li>
<li class="chapter" data-level="4.6" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>4.6</b> Retrieving Stage Times for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html"><i class="fa fa-check"></i><b>5</b> Finding Pace Across Stages</a>
<ul>
<li class="chapter" data-level="5.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#load-base-data-2"><i class="fa fa-check"></i><b>5.1</b> Load Base Data</a></li>
<li class="chapter" data-level="5.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#defining-pace"><i class="fa fa-check"></i><b>5.2</b> Defining Pace</a></li>
<li class="chapter" data-level="5.3" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-stage-pace"><i class="fa fa-check"></i><b>5.3</b> Calculating Stage Pace</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-a-single-stage"><i class="fa fa-check"></i><b>5.3.1</b> Calculating Pace for a Single Stage</a></li>
<li class="chapter" data-level="5.3.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-multiple-stages"><i class="fa fa-check"></i><b>5.3.2</b> Calculating Pace for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#rebasing-stage-pace"><i class="fa fa-check"></i><b>5.4</b> Rebasing Stage Pace</a></li>
<li class="chapter" data-level="5.5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#visualising-stage-pace-using-pace-maps"><i class="fa fa-check"></i><b>5.5</b> Visualising Stage Pace Using Pace Maps</a></li>
<li class="chapter" data-level="5.6" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#off-the-pace-charts"><i class="fa fa-check"></i><b>5.6</b> Off-the-Pace Charts</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualising-split-times.html"><a href="visualising-split-times.html"><i class="fa fa-check"></i><b>6</b> Visualising Split Times</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#load-base-data-3"><i class="fa fa-check"></i><b>6.1</b> Load Base Data</a></li>
<li class="chapter" data-level="6.2" data-path="visualising-split-times.html"><a href="visualising-split-times.html#get-splits-data"><i class="fa fa-check"></i><b>6.2</b> Get Splits Data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#wide-driver-split-times-1"><i class="fa fa-check"></i><b>6.2.1</b> Wide Driver Split Times</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="visualising-split-times.html"><a href="visualising-split-times.html#rebasing-split-times"><i class="fa fa-check"></i><b>6.3</b> Rebasing Split Times</a></li>
<li class="chapter" data-level="6.4" data-path="visualising-split-times.html"><a href="visualising-split-times.html#visualising-rebased-split-times-using-sparklines"><i class="fa fa-check"></i><b>6.4</b> Visualising Rebased Split Times Using Sparklines</a></li>
<li class="chapter" data-level="6.5" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-the-rank-position-at-each-split-point"><i class="fa fa-check"></i><b>6.5</b> Finding the Rank Position at Each Split Point</a></li>
<li class="chapter" data-level="6.6" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-split-section-durations"><i class="fa fa-check"></i><b>6.6</b> Finding Split Section Durations</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-split-section-ranks"><i class="fa fa-check"></i><b>6.6.1</b> Finding Split Section Ranks</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="visualising-split-times.html"><a href="visualising-split-times.html#adding-overall-stage-time-to-the-split-times"><i class="fa fa-check"></i><b>6.7</b> Adding Overall Stage Time to the Split Times</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html"><i class="fa fa-check"></i><b>7</b> Finding Pace Across Splits</a>
<ul>
<li class="chapter" data-level="7.1" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html#load-base-data-4"><i class="fa fa-check"></i><b>7.1</b> Load Base Data</a></li>
<li class="chapter" data-level="7.2" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html#calculating-splits-pace"><i class="fa fa-check"></i><b>7.2</b> Calculating Splits Pace</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://rallydatajunkie.com/"><em>RallyDataJunkie.com</em></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Timing and Results Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="visualising-results-for-multiple-stages" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Visualising Results for Multiple Stages</h1>
<p>As well as visualising the results for a single stage, we might want to visualise the results over multiple stages. The basic overall results can be retrieved from a single call to the WRC results API, but to view the stage times and rankings across multiple stages requires retrieving detailed for each stage and then combining it into a single dataframe.</p>
<div id="load-base-data-1" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Load Base Data</h2>
<p>To get the splits data from a standing start, we can load in the current season list, select the rally we want, look up the itinerary from the rally, extract the sections and then the stages and the retrieve the stage ID for the stage we are interested in.</p>
<p>To begin with, load in our WRC API helper functions:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="visualising-results-for-multiple-stages.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;code/wrc-api.R&#39;</span>)</span></code></pre></div>
<p>Now let’s grab some data:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="visualising-results-for-multiple-stages.html#cb120-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">get_active_season</span>()</span>
<span id="cb120-2"><a href="visualising-results-for-multiple-stages.html#cb120-2" aria-hidden="true" tabindex="-1"></a>eventId <span class="ot">=</span> <span class="fu">get_eventId_from_name</span>(s, <span class="st">&#39;arctic&#39;</span>)</span>
<span id="cb120-3"><a href="visualising-results-for-multiple-stages.html#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="visualising-results-for-multiple-stages.html#cb120-4" aria-hidden="true" tabindex="-1"></a>entries <span class="ot">=</span> <span class="fu">get_rally_entries</span>(eventId)</span>
<span id="cb120-5"><a href="visualising-results-for-multiple-stages.html#cb120-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-6"><a href="visualising-results-for-multiple-stages.html#cb120-6" aria-hidden="true" tabindex="-1"></a>itinerary <span class="ot">=</span> <span class="fu">get_itinerary</span>(eventId)</span>
<span id="cb120-7"><a href="visualising-results-for-multiple-stages.html#cb120-7" aria-hidden="true" tabindex="-1"></a>sections <span class="ot">=</span> <span class="fu">get_sections</span>(itinerary)</span>
<span id="cb120-8"><a href="visualising-results-for-multiple-stages.html#cb120-8" aria-hidden="true" tabindex="-1"></a>stages <span class="ot">=</span> <span class="fu">get_stages</span>(sections)</span>
<span id="cb120-9"><a href="visualising-results-for-multiple-stages.html#cb120-9" aria-hidden="true" tabindex="-1"></a>stages_lookup <span class="ot">=</span> <span class="fu">get_stages_lookup</span>(stages)</span></code></pre></div>
</div>
<div id="retrieving-stage-results-for-multiple-stages" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Retrieving Stage Results for Multiple Stages</h2>
<p>To being with, lets get the overall results at the end of each stage:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="visualising-results-for-multiple-stages.html#cb121-1" aria-hidden="true" tabindex="-1"></a>multi_overall_results <span class="ot">=</span> <span class="fu">get_multi_overall</span>(stage_list)</span>
<span id="cb121-2"><a href="visualising-results-for-multiple-stages.html#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="visualising-results-for-multiple-stages.html#cb121-3" aria-hidden="true" tabindex="-1"></a>multi_overall_results  <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##     entryId stageTimeMs  stageTime penaltyTimeMs penaltyTime totalTimeMs
## 107   21579     2866500 PT47M46.5S             0        PT0S     2866500
## 108   21573     3115400 PT51M55.4S             0        PT0S     3115400
##      totalTime position diffFirstMs  diffFirst diffPrevMs diffPrev stageId
## 107 PT47M46.5S       53      955800 PT15M55.8S     123200 PT2M3.2S    1743
## 108 PT51M55.4S       54     1204700  PT20M4.7S     248900 PT4M8.9S    1743</code></pre>
<p>We can reduce the amount of data by casting the long raw result to a wide format:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="visualising-results-for-multiple-stages.html#cb123-1" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="ot">=</span> <span class="fu">get_multi_stage_generic_wide</span>(multi_overall_results, stage_list, <span class="st">&#39;position&#39;</span>)</span>
<span id="cb123-2"><a href="visualising-results-for-multiple-stages.html#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="visualising-results-for-multiple-stages.html#cb123-3" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId 1747 1743
## 1   21530    9    9
## 2   21531    5    5</code></pre>
<p>To get the stage times, first create a column corresponding to time in seconds, then widen using those values:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="visualising-results-for-multiple-stages.html#cb125-1" aria-hidden="true" tabindex="-1"></a>multi_overall_results <span class="ot">=</span> multi_overall_results <span class="sc">%&gt;%</span></span>
<span id="cb125-2"><a href="visualising-results-for-multiple-stages.html#cb125-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">totalTimeS =</span> totalTimeMs<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb125-3"><a href="visualising-results-for-multiple-stages.html#cb125-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-4"><a href="visualising-results-for-multiple-stages.html#cb125-4" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="ot">=</span> <span class="fu">get_multi_stage_generic_wide</span>(multi_overall_results, stage_list, <span class="st">&#39;totalTimeS&#39;</span>)</span>
<span id="cb125-5"><a href="visualising-results-for-multiple-stages.html#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="visualising-results-for-multiple-stages.html#cb125-6" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId  1747   1743
## 1   21530 980.5 1960.5
## 2   21531 974.5 1942.7</code></pre>
<p>Another useful time is the time to first. As the overall rally leader may change at the end of each stage, it is convenient to grab the data directly from the original dataframe:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="visualising-results-for-multiple-stages.html#cb127-1" aria-hidden="true" tabindex="-1"></a>multi_overall_results <span class="ot">=</span> multi_overall_results <span class="sc">%&gt;%</span></span>
<span id="cb127-2"><a href="visualising-results-for-multiple-stages.html#cb127-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">diffFirstS =</span> diffFirstMs<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb127-3"><a href="visualising-results-for-multiple-stages.html#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="visualising-results-for-multiple-stages.html#cb127-4" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_gap <span class="ot">=</span> <span class="fu">get_multi_stage_generic_wide</span>(multi_overall_results, stage_list, <span class="st">&#39;diffFirstS&#39;</span>)</span>
<span id="cb127-5"><a href="visualising-results-for-multiple-stages.html#cb127-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-6"><a href="visualising-results-for-multiple-stages.html#cb127-6" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_gap <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId 1747 1743
## 1   21530 22.7 49.8
## 2   21531 16.7 32.0</code></pre>
<p>However, we could also calculate the gap to leader from the overall times, first by identifying the minimum accumulated time at each stage (that is, the minimum time, excluding null values, in each overall time column) and then by subtracting those values from each row in the overall times dataframe.</p>
<p>If we try to subtract a list of values from an <em>R</em> dataframe, we need to tell <em>R</em> how we want that subtraction performed. Internally, the dataframe is represented as a long list of values made up from values in the first column, then the second, and so on. If we subtract a list of <em>N</em> values from the dataframe, the values are selected from the first <em>N</em> items in this long serialised version of the dataframe, then the next <em>N</em> values and so on.</p>
<p>So to subtract a “dummy” row of values from the dataframe, we need another approach. The <code>purrr::map2df()</code> function allows us to apply a function, in this case the subtraction <code>-</code> function, with a set of specified values we want to subtract, from each row in the dataframe.</p>
<p>So let’s create a set of values representing the minimum overall time in each stage. The <code>matrixStats::colMins()</code> function will find the minimum values by row from a matrix, so cast the stage time columns from the wide dataframe to an appropriately sized matrix and then find the minimum in each column, ignoring null values:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="visualising-results-for-multiple-stages.html#cb129-1" aria-hidden="true" tabindex="-1"></a>overall_m <span class="ot">=</span> <span class="fu">as.matrix</span>(multi_overall_wide_time[,<span class="fu">as.character</span>(stage_list)],</span>
<span id="cb129-2"><a href="visualising-results-for-multiple-stages.html#cb129-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ncols=</span><span class="fu">length</span>(stage_list))</span>
<span id="cb129-3"><a href="visualising-results-for-multiple-stages.html#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="visualising-results-for-multiple-stages.html#cb129-4" aria-hidden="true" tabindex="-1"></a>mins_overall <span class="ot">=</span> matrixStats<span class="sc">::</span><span class="fu">colMins</span>(overall_m, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-5"><a href="visualising-results-for-multiple-stages.html#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="visualising-results-for-multiple-stages.html#cb129-6" aria-hidden="true" tabindex="-1"></a>mins_overall</span></code></pre></div>
<pre><code>## [1]  957.8 1910.7</code></pre>
<p>We can now subtract this “dummy row” of values from each row in the dataframe to find the gap to leader for each row on each stage:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="visualising-results-for-multiple-stages.html#cb131-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map2_df</span>(multi_overall_wide_time[,<span class="fu">as.character</span>(stage_list)], </span>
<span id="cb131-2"><a href="visualising-results-for-multiple-stages.html#cb131-2" aria-hidden="true" tabindex="-1"></a>              mins_overall, <span class="st">`</span><span class="at">-</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   `1747` `1743`
##    &lt;dbl&gt;  &lt;dbl&gt;
## 1   22.7   49.8
## 2   16.7   32</code></pre>
<p>Comparison with the “diffToFirst” times should show them to be the same.</p>
</div>
<div id="mapping-stage-and-driver-identifiers-to-meaningful-labels" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Mapping Stage and Driver Identifiers to Meaningful Labels</h2>
<p>To improve the look of the table, we might use stage codes and driver codes to label the columns and identify the rows.</p>
<p>To start with, we can map the column names that correspond to stage codes via a lookup list of stage ID to stage code values:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="visualising-results-for-multiple-stages.html#cb133-1" aria-hidden="true" tabindex="-1"></a>map_stage_codes <span class="ot">=</span> <span class="cf">function</span>(df, stage_list) {</span>
<span id="cb133-2"><a href="visualising-results-for-multiple-stages.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get stage codes lookup id-&gt;code</span></span>
<span id="cb133-3"><a href="visualising-results-for-multiple-stages.html#cb133-3" aria-hidden="true" tabindex="-1"></a>  stages_lookup_code <span class="ot">=</span> <span class="fu">get_stages_lookup</span>(stages, <span class="st">&#39;stageId&#39;</span>, <span class="st">&#39;code&#39;</span>)</span>
<span id="cb133-4"><a href="visualising-results-for-multiple-stages.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb133-5"><a href="visualising-results-for-multiple-stages.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#https://stackoverflow.com/a/34299333/454773</span></span>
<span id="cb133-6"><a href="visualising-results-for-multiple-stages.html#cb133-6" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">rename</span>(df, <span class="at">replace =</span> stages_lookup_code,</span>
<span id="cb133-7"><a href="visualising-results-for-multiple-stages.html#cb133-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">warn_missing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb133-8"><a href="visualising-results-for-multiple-stages.html#cb133-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-9"><a href="visualising-results-for-multiple-stages.html#cb133-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-10"><a href="visualising-results-for-multiple-stages.html#cb133-10" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="ot">=</span> <span class="fu">map_stage_codes</span>(multi_overall_wide_time,</span>
<span id="cb133-11"><a href="visualising-results-for-multiple-stages.html#cb133-11" aria-hidden="true" tabindex="-1"></a>                                          stage_list)</span>
<span id="cb133-12"><a href="visualising-results-for-multiple-stages.html#cb133-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-13"><a href="visualising-results-for-multiple-stages.html#cb133-13" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId   SS1    SS2
## 1   21530 980.5 1960.5
## 2   21531 974.5 1942.7</code></pre>
<p>We can also create a function to replace the entry ID with the driver code.
Note also the select statement at the end that puts the columns into a sensible order:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="visualising-results-for-multiple-stages.html#cb135-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">=</span> <span class="fu">get_car_data</span>(entries)</span>
<span id="cb135-2"><a href="visualising-results-for-multiple-stages.html#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="visualising-results-for-multiple-stages.html#cb135-3" aria-hidden="true" tabindex="-1"></a>map_driver_names <span class="ot">=</span> <span class="cf">function</span>(df, cars){</span>
<span id="cb135-4"><a href="visualising-results-for-multiple-stages.html#cb135-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb135-5"><a href="visualising-results-for-multiple-stages.html#cb135-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">merge</span>(cars[,<span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>,<span class="st">&#39;code&#39;</span>)],</span>
<span id="cb135-6"><a href="visualising-results-for-multiple-stages.html#cb135-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">by=</span><span class="st">&#39;entryId&#39;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb135-7"><a href="visualising-results-for-multiple-stages.html#cb135-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Limit columns and set column order</span></span>
<span id="cb135-8"><a href="visualising-results-for-multiple-stages.html#cb135-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="st">&#39;entryId&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb135-9"><a href="visualising-results-for-multiple-stages.html#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Move last column to first</span></span>
<span id="cb135-10"><a href="visualising-results-for-multiple-stages.html#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">&#39;code&#39;</span>, <span class="fu">everything</span>())</span>
<span id="cb135-11"><a href="visualising-results-for-multiple-stages.html#cb135-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-12"><a href="visualising-results-for-multiple-stages.html#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="visualising-results-for-multiple-stages.html#cb135-13" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="ot">=</span> <span class="fu">map_driver_names</span>(multi_overall_wide_time, cars)</span>
<span id="cb135-14"><a href="visualising-results-for-multiple-stages.html#cb135-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-15"><a href="visualising-results-for-multiple-stages.html#cb135-15" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   code   SS1    SS2
## 1  OGI 980.5 1960.5
## 2  EVA 974.5 1942.7</code></pre>
</div>
<div id="rebasing-overall-times" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Rebasing Overall Times</h2>
<p>We can rebase the overall times with respect to a particular driver in the normal way:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="visualising-results-for-multiple-stages.html#cb137-1" aria-hidden="true" tabindex="-1"></a>example_driver <span class="ot">=</span> multi_overall_wide_time[<span class="dv">2</span>,]<span class="sc">$</span>code</span>
<span id="cb137-2"><a href="visualising-results-for-multiple-stages.html#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="visualising-results-for-multiple-stages.html#cb137-3" aria-hidden="true" tabindex="-1"></a>overall_wide_time_rebased <span class="ot">=</span> <span class="fu">rebase</span>(multi_overall_wide_time,</span>
<span id="cb137-4"><a href="visualising-results-for-multiple-stages.html#cb137-4" aria-hidden="true" tabindex="-1"></a>                                   example_driver, stage_codes,</span>
<span id="cb137-5"><a href="visualising-results-for-multiple-stages.html#cb137-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">id_col=</span><span class="st">&#39;code&#39;</span>)</span></code></pre></div>
<pre><code>## Error in `[.data.frame`(df, df[[id_col]] == id, rebase_cols): object &#39;stage_codes&#39; not found</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="visualising-results-for-multiple-stages.html#cb139-1" aria-hidden="true" tabindex="-1"></a>overall_wide_time_rebased <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Error in head(., 3): object &#39;overall_wide_time_rebased&#39; not found</code></pre>
<div id="find-changes-in-rebased-gaps-across-stages" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Find Changes in Rebased Gaps Across Stages</h3>
<p>The rebasing operation essentially allows us to select a row of times for one particular driver and then subtract that row from every other row to give us a direct comparison of the gap between a specified driver and every other driver.</p>
<p>But we can also perform a consecutive column-wise differencing operation on the rebased times that allows to see how much time was gained or relative to a particular driver in going from one stage to the next (observant readers may note that this results in the rebased stage time for each stage…).</p>
<p>TO subtract one column from the next, create two offset dataframes, one containing all but the first stage (first stage column) and one containing all but the last stage (final stage column). If we subtract one dataframe from the other, it gives us our column differences. Inserting the original first column back in its rightful place gives us the columnwise differences table:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="visualising-results-for-multiple-stages.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/a/50411529/454773</span></span>
<span id="cb141-2"><a href="visualising-results-for-multiple-stages.html#cb141-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> overall_wide_time_rebased</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): object &#39;overall_wide_time_rebased&#39; not found</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="visualising-results-for-multiple-stages.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># [-1] drops the first column, [-ncol()] drops the last</span></span>
<span id="cb143-2"><a href="visualising-results-for-multiple-stages.html#cb143-2" aria-hidden="true" tabindex="-1"></a> df_ <span class="ot">=</span> df[,stage_codes][<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> df[,stage_codes][<span class="sc">-</span><span class="fu">ncol</span>(df[,stage_codes])]</span></code></pre></div>
<pre><code>## Error in `[.data.frame`(df, , stage_codes): object &#39;stage_codes&#39; not found</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="visualising-results-for-multiple-stages.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The split time to the first split is simply the first split time</span></span>
<span id="cb145-2"><a href="visualising-results-for-multiple-stages.html#cb145-2" aria-hidden="true" tabindex="-1"></a>df_[stage_codes[<span class="dv">1</span>]] <span class="ot">=</span> df[stage_codes[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## Error in `[.data.frame`(df, stage_codes[1]): object &#39;stage_codes&#39; not found</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="visualising-results-for-multiple-stages.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Return the dataframe in a sensible column order</span></span>
<span id="cb147-2"><a href="visualising-results-for-multiple-stages.html#cb147-2" aria-hidden="true" tabindex="-1"></a>df_ <span class="sc">%&gt;%</span> <span class="fu">select</span>(stage_codes) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Error in select(., stage_codes): object &#39;df_&#39; not found</code></pre>
<p><em>(A similar technique could be used to recreate stage times from the overall times.)</em></p>
</div>
</div>
<div id="visualising-multiple-stage-results" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Visualising Multiple Stage Results</h2>
<p>The overall stage results provides information regarding the overall times and positions at the end of each stage and the rebased overall times provide us with gap information from a specified driver to every other driver.</p>
<p>So how might we use exploratory data visualisation techniques to support a conversation with that data or highlight potential stories hidden within it?</p>
<p>TO DO…</p>
</div>
<div id="retrieving-stage-times-for-multiple-stages" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> Retrieving Stage Times for Multiple Stages</h2>
<p>We can retrieve detailed results for multiple stages by requesting stage results for a specified list of stages:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="visualising-results-for-multiple-stages.html#cb149-1" aria-hidden="true" tabindex="-1"></a>stage_list <span class="ot">=</span> <span class="fu">get_stage_list</span>(stages)</span>
<span id="cb149-2"><a href="visualising-results-for-multiple-stages.html#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="visualising-results-for-multiple-stages.html#cb149-3" aria-hidden="true" tabindex="-1"></a>multi_stage_times <span class="ot">=</span> <span class="fu">get_multi_stage_times</span>(stage_list)</span>
<span id="cb149-4"><a href="visualising-results-for-multiple-stages.html#cb149-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb149-5"><a href="visualising-results-for-multiple-stages.html#cb149-5" aria-hidden="true" tabindex="-1"></a>multi_stage_times <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##     stageTimeId stageId entryId elapsedDurationMs  elapsedDuration    status
## 539       96810    1749   21571           1301693 00:21:41.6930000 Completed
## 540       96793    1749   21541                NA             &lt;NA&gt;       DNS
##      source position diffFirstMs        diffFirst diffPrevMs         diffPrev
## 539 Default       52      699224 00:11:39.2240000     153590 00:02:33.5900000
## 540 Default       NA          NA             &lt;NA&gt;         NA             &lt;NA&gt;</code></pre>
<p>We can then cast the data to a wide format:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="visualising-results-for-multiple-stages.html#cb151-1" aria-hidden="true" tabindex="-1"></a>multi_stage_times_wide <span class="ot">=</span> <span class="fu">get_multi_stage_times_wide</span>(multi_stage_times, stage_list)</span>
<span id="cb151-2"><a href="visualising-results-for-multiple-stages.html#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="visualising-results-for-multiple-stages.html#cb151-3" aria-hidden="true" tabindex="-1"></a>multi_stage_times_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId  1747  1743  1750  1751  1748  1745  1744   1742  1746    1749
## 1   21530 980.5 980.0 842.0 548.5 751.2 853.7 556.7 1364.0 615.0 604.272
## 2   21531 974.5 968.2 845.8 546.6 750.2 853.6 552.6  784.1 607.5 608.028</code></pre>
<p>And process:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="visualising-results-for-multiple-stages.html#cb153-1" aria-hidden="true" tabindex="-1"></a>multi_stage_times_wide<span class="ot">=</span> <span class="fu">map_stage_codes</span>(multi_stage_times_wide,</span>
<span id="cb153-2"><a href="visualising-results-for-multiple-stages.html#cb153-2" aria-hidden="true" tabindex="-1"></a>                                          stage_list)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualising-results-for-a-single-stage.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="finding-pace-across-stages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/edit/master/multi-stage-results.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/blob/master/multi-stage-results.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
