<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Visualising Results for Multiple Stages | Visualising WRC Rally Timing and Results Data</title>
  <meta name="description" content="An introduction to visualising timing and results data for WRC rally events." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Visualising Results for Multiple Stages | Visualising WRC Rally Timing and Results Data" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Visualising Results for Multiple Stages | Visualising WRC Rally Timing and Results Data" />
  
  <meta name="twitter:description" content="An introduction to visualising timing and results data for WRC rally events." />
  

<meta name="author" content="Tony Hirst" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualising-results-for-a-single-stage.html"/>
<link rel="next" href="finding-pace-across-stages.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/formattable_widget-binding-0.2.1/formattable_widget.js"></script>
<link href="libs/jquery-sparkline-2.1.2/jquery.sparkline.css" rel="stylesheet" />
<script src="libs/jquery-sparkline-2.1.2/jquery.sparkline.js"></script>
<script src="libs/sparkline-binding-2.0/sparkline.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Visualising WRC Rally Results and Timing Data</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Index</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html"><i class="fa fa-check"></i><b>2</b> Accessing Data from the WRC Live Timing API</a>
<ul>
<li class="chapter" data-level="2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#current-season-rallies"><i class="fa fa-check"></i><b>2.1</b> Current Season Rallies</a></li>
<li class="chapter" data-level="2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#itinerary-lookup"><i class="fa fa-check"></i><b>2.2</b> Itinerary Lookup</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#leg-sections"><i class="fa fa-check"></i><b>2.2.1</b> Leg Sections</a></li>
<li class="chapter" data-level="2.2.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#time-controls"><i class="fa fa-check"></i><b>2.2.2</b> Time Controls</a></li>
<li class="chapter" data-level="2.2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-details"><i class="fa fa-check"></i><b>2.2.3</b> Stage Details</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#competitor-details"><i class="fa fa-check"></i><b>2.3</b> Competitor Details</a></li>
<li class="chapter" data-level="2.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#penalties-and-retirements"><i class="fa fa-check"></i><b>2.4</b> Penalties and Retirements</a></li>
<li class="chapter" data-level="2.5" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#results-and-stage-winner"><i class="fa fa-check"></i><b>2.5</b> Results and Stage Winner</a></li>
<li class="chapter" data-level="2.6" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-result"><i class="fa fa-check"></i><b>2.6</b> Stage Result</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-results-for-multiple-stages"><i class="fa fa-check"></i><b>2.6.1</b> Getting Stage Results for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#stage-times"><i class="fa fa-check"></i><b>2.7</b> Stage Times</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.1</b> Getting Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-times-for-multiple-stages"><i class="fa fa-check"></i><b>2.7.2</b> Getting Wide Stage Times for Multiple Stages</a></li>
<li class="chapter" data-level="2.7.3" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-wide-stage-positions"><i class="fa fa-check"></i><b>2.7.3</b> Getting Wide Stage Positions</a></li>
<li class="chapter" data-level="2.7.4" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#getting-generic-wide-dataframes"><i class="fa fa-check"></i><b>2.7.4</b> Getting Generic Wide Dataframes</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#split-times"><i class="fa fa-check"></i><b>2.8</b> Split Times</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#driver-split-times-detail"><i class="fa fa-check"></i><b>2.8.1</b> Driver Split Times Detail</a></li>
<li class="chapter" data-level="2.8.2" data-path="accessing-data-from-the-wrc-live-timing-api.html"><a href="accessing-data-from-the-wrc-live-timing-api.html#wide-driver-split-times"><i class="fa fa-check"></i><b>2.8.2</b> Wide Driver Split Times</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html"><i class="fa fa-check"></i><b>3</b> Visualising Results for a Single Stage</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#load-base-data"><i class="fa fa-check"></i><b>3.1</b> Load Base Data</a></li>
<li class="chapter" data-level="3.2" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#get-stage-results-data"><i class="fa fa-check"></i><b>3.2</b> Get Stage Results Data</a></li>
<li class="chapter" data-level="3.3" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#previewing-stage-results-data"><i class="fa fa-check"></i><b>3.3</b> Previewing Stage Results Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-entry-metadata"><i class="fa fa-check"></i><b>3.3.1</b> Adding Entry Metadata</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#adding-stage-metadata-to-table-captions"><i class="fa fa-check"></i><b>3.4</b> Adding Stage Metadata to Table Captions</a></li>
<li class="chapter" data-level="3.5" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-stage-results"><i class="fa fa-check"></i><b>3.5</b> Colour Highlighting Stage Results</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#heatmap-style-column-cell-backgrounds"><i class="fa fa-check"></i><b>3.5.1</b> Heatmap Style Column Cell Backgrounds</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#an-aside-calculating-diff-and-gap-times"><i class="fa fa-check"></i><b>3.6</b> An Aside — Calculating DIFF and GAP times</a></li>
<li class="chapter" data-level="3.7" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#rebasing-stage-results"><i class="fa fa-check"></i><b>3.7</b> Rebasing Stage Results</a></li>
<li class="chapter" data-level="3.8" data-path="visualising-results-for-a-single-stage.html"><a href="visualising-results-for-a-single-stage.html#colour-highlighting-rebased-values"><i class="fa fa-check"></i><b>3.8</b> Colour Highlighting Rebased Values</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html"><i class="fa fa-check"></i><b>4</b> Visualising Results for Multiple Stages</a>
<ul>
<li class="chapter" data-level="4.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#load-base-data-1"><i class="fa fa-check"></i><b>4.1</b> Load Base Data</a></li>
<li class="chapter" data-level="4.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-stage-results-for-multiple-stages"><i class="fa fa-check"></i><b>4.2</b> Retrieving Stage Results for Multiple Stages</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#widening-overall-position"><i class="fa fa-check"></i><b>4.2.1</b> Widening Overall Position</a></li>
<li class="chapter" data-level="4.2.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#widening-overall-rally-time"><i class="fa fa-check"></i><b>4.2.2</b> Widening Overall Rally Time</a></li>
<li class="chapter" data-level="4.2.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#widening-time-to-first"><i class="fa fa-check"></i><b>4.2.3</b> Widening Time to First</a></li>
<li class="chapter" data-level="4.2.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#mapping-stage-and-driver-identifiers-to-meaningful-labels"><i class="fa fa-check"></i><b>4.2.4</b> Mapping Stage and Driver Identifiers to Meaningful Labels</a></li>
<li class="chapter" data-level="4.2.5" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#rebasing-overall-times"><i class="fa fa-check"></i><b>4.2.5</b> Rebasing Overall Times</a></li>
<li class="chapter" data-level="4.2.6" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#finding-changes-in-rebased-gaps-across-stages"><i class="fa fa-check"></i><b>4.2.6</b> Finding Changes in Rebased Gaps Across Stages</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-multiple-stage-results"><i class="fa fa-check"></i><b>4.3</b> Visualising Multiple Stage Results</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-first-position"><i class="fa fa-check"></i><b>4.3.1</b> Visualising First Position</a></li>
<li class="chapter" data-level="4.3.2" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-position-changes-over-a-rally"><i class="fa fa-check"></i><b>4.3.2</b> Visualising Position Changes Over a Rally</a></li>
<li class="chapter" data-level="4.3.3" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#visualising-position-gainslosses"><i class="fa fa-check"></i><b>4.3.3</b> Visualising Position Gains/Losses</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="visualising-results-for-multiple-stages.html"><a href="visualising-results-for-multiple-stages.html#retrieving-stage-time-for-multiple-stages"><i class="fa fa-check"></i><b>4.4</b> Retrieving Stage Time for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html"><i class="fa fa-check"></i><b>5</b> Finding Pace Across Stages</a>
<ul>
<li class="chapter" data-level="5.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#load-base-data-2"><i class="fa fa-check"></i><b>5.1</b> Load Base Data</a></li>
<li class="chapter" data-level="5.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#defining-pace"><i class="fa fa-check"></i><b>5.2</b> Defining Pace</a></li>
<li class="chapter" data-level="5.3" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-stage-pace"><i class="fa fa-check"></i><b>5.3</b> Calculating Stage Pace</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-a-single-stage"><i class="fa fa-check"></i><b>5.3.1</b> Calculating Pace for a Single Stage</a></li>
<li class="chapter" data-level="5.3.2" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#calculating-pace-for-multiple-stages"><i class="fa fa-check"></i><b>5.3.2</b> Calculating Pace for Multiple Stages</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#rebasing-stage-pace"><i class="fa fa-check"></i><b>5.4</b> Rebasing Stage Pace</a></li>
<li class="chapter" data-level="5.5" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#visualising-stage-pace-using-pace-maps"><i class="fa fa-check"></i><b>5.5</b> Visualising Stage Pace Using Pace Maps</a></li>
<li class="chapter" data-level="5.6" data-path="finding-pace-across-stages.html"><a href="finding-pace-across-stages.html#off-the-pace-charts"><i class="fa fa-check"></i><b>5.6</b> Off-the-Pace Charts</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="visualising-split-times.html"><a href="visualising-split-times.html"><i class="fa fa-check"></i><b>6</b> Visualising Split Times</a>
<ul>
<li class="chapter" data-level="6.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#load-base-data-3"><i class="fa fa-check"></i><b>6.1</b> Load Base Data</a></li>
<li class="chapter" data-level="6.2" data-path="visualising-split-times.html"><a href="visualising-split-times.html#get-splits-data"><i class="fa fa-check"></i><b>6.2</b> Get Splits Data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#wide-driver-split-times-1"><i class="fa fa-check"></i><b>6.2.1</b> Wide Driver Split Times</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="visualising-split-times.html"><a href="visualising-split-times.html#rebasing-split-times"><i class="fa fa-check"></i><b>6.3</b> Rebasing Split Times</a></li>
<li class="chapter" data-level="6.4" data-path="visualising-split-times.html"><a href="visualising-split-times.html#visualising-rebased-split-times-using-sparklines"><i class="fa fa-check"></i><b>6.4</b> Visualising Rebased Split Times Using Sparklines</a></li>
<li class="chapter" data-level="6.5" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-the-rank-position-at-each-split-point"><i class="fa fa-check"></i><b>6.5</b> Finding the Rank Position at Each Split Point</a></li>
<li class="chapter" data-level="6.6" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-split-section-durations"><i class="fa fa-check"></i><b>6.6</b> Finding Split Section Durations</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="visualising-split-times.html"><a href="visualising-split-times.html#finding-split-section-ranks"><i class="fa fa-check"></i><b>6.6.1</b> Finding Split Section Ranks</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="visualising-split-times.html"><a href="visualising-split-times.html#adding-overall-stage-time-to-the-split-times"><i class="fa fa-check"></i><b>6.7</b> Adding Overall Stage Time to the Split Times</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html"><i class="fa fa-check"></i><b>7</b> Finding Pace Across Splits</a>
<ul>
<li class="chapter" data-level="7.1" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html#load-base-data-4"><i class="fa fa-check"></i><b>7.1</b> Load Base Data</a></li>
<li class="chapter" data-level="7.2" data-path="finding-pace-across-splits.html"><a href="finding-pace-across-splits.html#calculating-splits-pace"><i class="fa fa-check"></i><b>7.2</b> Calculating Splits Pace</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://rallydatajunkie.com/"><em>RallyDataJunkie.com</em></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualising WRC Rally Timing and Results Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="visualising-results-for-multiple-stages" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Visualising Results for Multiple Stages</h1>
<p>As well as visualising the results for a single stage, we might want to visualise the results over multiple stages. The basic overall results can be retrieved from a single call to the WRC results API, but to view the stage times and rankings across multiple stages requires retrieving detailed for each stage and then combining it into a single dataframe.</p>
<div id="load-base-data-1" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Load Base Data</h2>
<p>To get the splits data from a standing start, we can load in the current season list, select the rally we want, look up the itinerary from the rally, extract the sections and then the stages and the retrieve the stage ID for the stage we are interested in.</p>
<p>To begin with, load in our WRC API helper functions:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="visualising-results-for-multiple-stages.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;code/wrc-api.R&#39;</span>)</span></code></pre></div>
<p>Now let’s grab some data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="visualising-results-for-multiple-stages.html#cb2-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fu">get_active_season</span>()</span>
<span id="cb2-2"><a href="visualising-results-for-multiple-stages.html#cb2-2" aria-hidden="true" tabindex="-1"></a>eventId <span class="ot">=</span> <span class="fu">get_eventId_from_name</span>(s, <span class="st">&#39;arctic&#39;</span>)</span>
<span id="cb2-3"><a href="visualising-results-for-multiple-stages.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="visualising-results-for-multiple-stages.html#cb2-4" aria-hidden="true" tabindex="-1"></a>entries <span class="ot">=</span> <span class="fu">get_rally_entries</span>(eventId)</span>
<span id="cb2-5"><a href="visualising-results-for-multiple-stages.html#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="visualising-results-for-multiple-stages.html#cb2-6" aria-hidden="true" tabindex="-1"></a>itinerary <span class="ot">=</span> <span class="fu">get_itinerary</span>(eventId)</span>
<span id="cb2-7"><a href="visualising-results-for-multiple-stages.html#cb2-7" aria-hidden="true" tabindex="-1"></a>sections <span class="ot">=</span> <span class="fu">get_sections</span>(itinerary)</span>
<span id="cb2-8"><a href="visualising-results-for-multiple-stages.html#cb2-8" aria-hidden="true" tabindex="-1"></a>stages <span class="ot">=</span> <span class="fu">get_stages</span>(sections)</span>
<span id="cb2-9"><a href="visualising-results-for-multiple-stages.html#cb2-9" aria-hidden="true" tabindex="-1"></a>stages_lookup <span class="ot">=</span> <span class="fu">get_stages_lookup</span>(stages)</span>
<span id="cb2-10"><a href="visualising-results-for-multiple-stages.html#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="visualising-results-for-multiple-stages.html#cb2-11" aria-hidden="true" tabindex="-1"></a>stage_list <span class="ot">=</span> <span class="fu">get_stage_list</span>(stages)</span>
<span id="cb2-12"><a href="visualising-results-for-multiple-stages.html#cb2-12" aria-hidden="true" tabindex="-1"></a>stage_codes <span class="ot">=</span> stages<span class="sc">$</span>code</span>
<span id="cb2-13"><a href="visualising-results-for-multiple-stages.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># To generate stage codes as an ordered factor:</span></span>
<span id="cb2-14"><a href="visualising-results-for-multiple-stages.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># factor(stages$code, levels = stages$code)</span></span></code></pre></div>
</div>
<div id="retrieving-stage-results-for-multiple-stages" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Retrieving Stage Results for Multiple Stages</h2>
<p>To being with, lets get the overall results at the end of each stage:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="visualising-results-for-multiple-stages.html#cb3-1" aria-hidden="true" tabindex="-1"></a>multi_overall_results <span class="ot">=</span> <span class="fu">get_multi_overall</span>(stage_list)</span>
<span id="cb3-2"><a href="visualising-results-for-multiple-stages.html#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="visualising-results-for-multiple-stages.html#cb3-3" aria-hidden="true" tabindex="-1"></a>multi_overall_results  <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##     entryId stageTimeMs    stageTime penaltyTimeMs penaltyTime totalTimeMs
## 530   21542    11203500  PT3H6M43.5S             0        PT0S    11203500
## 531   21569    11754200 PT3H15M54.2S             0        PT0S    11754200
##        totalTime position diffFirstMs   diffFirst diffPrevMs   diffPrev stageId
## 530  PT3H6M43.5S       51     3773900 PT1H2M53.9S     696500 PT11M36.5S    1749
## 531 PT3H15M54.2S       52     4324600 PT1H12M4.6S     550700  PT9M10.7S    1749</code></pre>
<div id="widening-overall-position" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Widening Overall Position</h3>
<p>We can reduce the amount of data by casting the long raw result to a wide format, widening the data on a particular field of interest. For example, we can widen generate a wide dataframe describing overall positions, <span class="math inline">\({_S}o\)</span> at the end of each stage, where a particular driver’s position is given as <span class="math inline">\({_S}o_i\)</span>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="visualising-results-for-multiple-stages.html#cb5-1" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="ot">=</span> multi_overall_results <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="visualising-results-for-multiple-stages.html#cb5-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">get_multi_stage_generic_wide</span>(stage_list,</span>
<span id="cb5-3"><a href="visualising-results-for-multiple-stages.html#cb5-3" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">&#39;position&#39;</span>)</span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(group_key)` instead of `group_key` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="visualising-results-for-multiple-stages.html#cb7-1" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId 1747 1743 1750 1751 1748 1745 1744 1742 1746 1749
## 1   21530    9    9    9    8    8    7    6   22   20   20
## 2   21531    5    5    5    5    5    5    5    5    5    5</code></pre>
</div>
<div id="widening-overall-rally-time" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Widening Overall Rally Time</h3>
<p>We can also create a wide format report of the overall times, where each column gives the overall, accumulated rally time up to and including each stage, <span class="math inline">\({_S}T\)</span>; each cell then represents the accumulated time for a particular driver, <span class="math inline">\({_S}T_i\)</span>.</p>
<p>The times themeselves appear in units of milliseconds, so first create a column corresponding to time in seconds, then widen using those values:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="visualising-results-for-multiple-stages.html#cb9-1" aria-hidden="true" tabindex="-1"></a>multi_overall_results <span class="ot">=</span> multi_overall_results <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="visualising-results-for-multiple-stages.html#cb9-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">totalTimeS =</span> totalTimeMs<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb9-3"><a href="visualising-results-for-multiple-stages.html#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="visualising-results-for-multiple-stages.html#cb9-4" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="ot">=</span> multi_overall_results <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="visualising-results-for-multiple-stages.html#cb9-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">get_multi_stage_generic_wide</span>(stage_list,</span>
<span id="cb9-6"><a href="visualising-results-for-multiple-stages.html#cb9-6" aria-hidden="true" tabindex="-1"></a>                                                           <span class="st">&#39;totalTimeS&#39;</span>)</span>
<span id="cb9-7"><a href="visualising-results-for-multiple-stages.html#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="visualising-results-for-multiple-stages.html#cb9-8" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId  1747   1743   1750   1751   1748   1745   1744   1742   1746   1749
## 1   21530 980.5 1960.5 2802.5 3351.0 4102.2 4955.9 5512.6 6876.6 7491.6 8095.8
## 2   21531 974.5 1942.7 2788.5 3335.1 4085.3 4938.9 5491.5 6275.6 6883.1 7491.1</code></pre>
<p>We note that with stages presented in order, the rally time is strictly increasing across the rows.</p>
<p>We further note that we can derive stage times from the overall rally times by calculating the columnwise differences <span class="math inline">\({_S}t={_S}T-{_{S-1}}T: 1&lt;S&lt;N\)</span> for an <span class="math inline">\(N\)</span> stage rally.</p>
</div>
<div id="widening-time-to-first" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Widening Time to First</h3>
<p>Another useful time is the <em>time to first</em>, which is to say, the <em>gap</em>, <span class="math inline">\({_S}GAP_i\)</span>. Noting that the overall rally leader may change at the end of each stage, this measure is essentially a rebasing measure relative to a particular position rather than a particular driver:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="visualising-results-for-multiple-stages.html#cb11-1" aria-hidden="true" tabindex="-1"></a>multi_overall_results <span class="ot">=</span> multi_overall_results <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="visualising-results-for-multiple-stages.html#cb11-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mutate</span>(<span class="at">diffFirstS =</span> diffFirstMs<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb11-3"><a href="visualising-results-for-multiple-stages.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="visualising-results-for-multiple-stages.html#cb11-4" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_gap <span class="ot">=</span> multi_overall_results <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="visualising-results-for-multiple-stages.html#cb11-5" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">get_multi_stage_generic_wide</span>(stage_list,</span>
<span id="cb11-6"><a href="visualising-results-for-multiple-stages.html#cb11-6" aria-hidden="true" tabindex="-1"></a>                                                         <span class="st">&#39;diffFirstS&#39;</span>)</span>
<span id="cb11-7"><a href="visualising-results-for-multiple-stages.html#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="visualising-results-for-multiple-stages.html#cb11-8" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_gap <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId 1747 1743 1750 1751 1748 1745 1744  1742  1746  1749
## 1   21530 22.7 49.8 57.3 53.1 54.2 70.6 76.8 664.5 666.1 666.2
## 2   21531 16.7 32.0 43.3 37.2 37.3 53.6 55.7  63.5  57.6  61.5</code></pre>
<p>However, we could also calculate the gap to leader from the overall times, first by identifying the minimum accumulated time at each stage (that is, the minimum time, excluding null values, in each overall time column) and then by subtracting those values from each row in the overall times dataframe, which is to say:</p>
<p><span class="math display">\[
\textrm{GAP}_{i} = {_S}t_i - \textrm{min}({_S}T)
\]</span></p>
<p>If we try to subtract a list of values (for example, <span class="math inline">\(\forall s \in [1 \le S \le N]: \textrm{min}({_S}T)\)</span>) from an <em>R</em> dataframe, we need to tell <em>R</em> how we want that subtraction performed. Internally, the dataframe is represented as a long list of values made up from values in the first column, then the second, and so on. If we subtract a list of <em>N</em> values from the dataframe, the values are selected from the first <em>N</em> items in this long serialised version of the dataframe, then the next <em>N</em> values and so on.</p>
<p>So to subtract a “dummy” row of values from the dataframe, we need another approach. The <code>purrr::map2df()</code> function allows us to apply a function, in this case the subtraction <code>-</code> function, with a set of specified values we want to subtract, from each row in the dataframe.</p>
<p>So let’s create a set of values representing the minimum overall time in each stage. The <code>matrixStats::colMins()</code> function will find the minimum values by row from a matrix, so cast the stage time columns from the wide dataframe to an appropriately sized matrix and then find the minimum in each column, ignoring null values:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="visualising-results-for-multiple-stages.html#cb13-1" aria-hidden="true" tabindex="-1"></a>overall_m <span class="ot">=</span> <span class="fu">as.matrix</span>(multi_overall_wide_time[,<span class="fu">as.character</span>(stage_list)],</span>
<span id="cb13-2"><a href="visualising-results-for-multiple-stages.html#cb13-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ncols=</span><span class="fu">length</span>(stage_list))</span>
<span id="cb13-3"><a href="visualising-results-for-multiple-stages.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="visualising-results-for-multiple-stages.html#cb13-4" aria-hidden="true" tabindex="-1"></a>mins_overall <span class="ot">=</span> matrixStats<span class="sc">::</span><span class="fu">colMins</span>(overall_m, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb13-5"><a href="visualising-results-for-multiple-stages.html#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="visualising-results-for-multiple-stages.html#cb13-6" aria-hidden="true" tabindex="-1"></a>mins_overall</span></code></pre></div>
<pre><code>##  [1]  957.8 1910.7 2745.2 3297.9 4048.0 4885.3 5435.8 6212.1 6825.5 7429.6</code></pre>
<p>We can now subtract this “dummy row” of values from each row in the dataframe to find the gap to leader for each row on each stage:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="visualising-results-for-multiple-stages.html#cb15-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">map2_df</span>(multi_overall_wide_time[,<span class="fu">as.character</span>(stage_list)], </span>
<span id="cb15-2"><a href="visualising-results-for-multiple-stages.html#cb15-2" aria-hidden="true" tabindex="-1"></a>              mins_overall, <span class="st">`</span><span class="at">-</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 10
##   `1747` `1743` `1750` `1751` `1748` `1745` `1744` `1742` `1746` `1749`
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1   22.7   49.8   57.3   53.1   54.2   70.6   76.8  664.   666.   666. 
## 2   16.7   32     43.3   37.2   37.3   53.6   55.7   63.5   57.6   61.5</code></pre>
<p>Comparison with the “diffToFirst” times should show them to be the same.</p>
</div>
<div id="mapping-stage-and-driver-identifiers-to-meaningful-labels" class="section level3" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Mapping Stage and Driver Identifiers to Meaningful Labels</h3>
<p>To improve the look of the table, we might use stage codes and driver codes to label the columns and identify the rows.</p>
<p>To start with, we can map the column names that correspond to stage codes via a lookup list of stage ID to stage code values:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="visualising-results-for-multiple-stages.html#cb17-1" aria-hidden="true" tabindex="-1"></a>map_stage_codes <span class="ot">=</span> <span class="cf">function</span>(df, stage_list) {</span>
<span id="cb17-2"><a href="visualising-results-for-multiple-stages.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get stage codes lookup id-&gt;code</span></span>
<span id="cb17-3"><a href="visualising-results-for-multiple-stages.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  stages_lookup_code <span class="ot">=</span> <span class="fu">get_stages_lookup</span>(stages, <span class="st">&#39;stageId&#39;</span>, <span class="st">&#39;code&#39;</span>)</span>
<span id="cb17-4"><a href="visualising-results-for-multiple-stages.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-5"><a href="visualising-results-for-multiple-stages.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#https://stackoverflow.com/a/34299333/454773</span></span>
<span id="cb17-6"><a href="visualising-results-for-multiple-stages.html#cb17-6" aria-hidden="true" tabindex="-1"></a>  plyr<span class="sc">::</span><span class="fu">rename</span>(df, <span class="at">replace =</span> stages_lookup_code,</span>
<span id="cb17-7"><a href="visualising-results-for-multiple-stages.html#cb17-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">warn_missing =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-8"><a href="visualising-results-for-multiple-stages.html#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-9"><a href="visualising-results-for-multiple-stages.html#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="visualising-results-for-multiple-stages.html#cb17-10" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="ot">=</span> multi_overall_wide_time <span class="sc">%&gt;%</span></span>
<span id="cb17-11"><a href="visualising-results-for-multiple-stages.html#cb17-11" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">map_stage_codes</span>(stage_list)</span>
<span id="cb17-12"><a href="visualising-results-for-multiple-stages.html#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="visualising-results-for-multiple-stages.html#cb17-13" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId   SS1    SS2    SS3    SS4    SS5    SS6    SS7    SS8    SS9   SS10
## 1   21530 980.5 1960.5 2802.5 3351.0 4102.2 4955.9 5512.6 6876.6 7491.6 8095.8
## 2   21531 974.5 1942.7 2788.5 3335.1 4085.3 4938.9 5491.5 6275.6 6883.1 7491.1</code></pre>
<p>We can also create a function to replace the entry ID with the driver code.
Note also the select statement at the end that puts the columns into a sensible order:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="visualising-results-for-multiple-stages.html#cb19-1" aria-hidden="true" tabindex="-1"></a>cars <span class="ot">=</span> <span class="fu">get_car_data</span>(entries)</span>
<span id="cb19-2"><a href="visualising-results-for-multiple-stages.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="visualising-results-for-multiple-stages.html#cb19-3" aria-hidden="true" tabindex="-1"></a>map_driver_names <span class="ot">=</span> <span class="cf">function</span>(df, cars){</span>
<span id="cb19-4"><a href="visualising-results-for-multiple-stages.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="visualising-results-for-multiple-stages.html#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">merge</span>(cars[,<span class="fu">c</span>(<span class="st">&#39;entryId&#39;</span>,<span class="st">&#39;code&#39;</span>)],</span>
<span id="cb19-6"><a href="visualising-results-for-multiple-stages.html#cb19-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">by=</span><span class="st">&#39;entryId&#39;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="visualising-results-for-multiple-stages.html#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Limit columns and set column order</span></span>
<span id="cb19-8"><a href="visualising-results-for-multiple-stages.html#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span><span class="st">&#39;entryId&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="visualising-results-for-multiple-stages.html#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Move last column to first</span></span>
<span id="cb19-10"><a href="visualising-results-for-multiple-stages.html#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">&#39;code&#39;</span>, <span class="fu">everything</span>())</span>
<span id="cb19-11"><a href="visualising-results-for-multiple-stages.html#cb19-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-12"><a href="visualising-results-for-multiple-stages.html#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="visualising-results-for-multiple-stages.html#cb19-13" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="ot">=</span> multi_overall_wide_time <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="visualising-results-for-multiple-stages.html#cb19-14" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">map_driver_names</span>(cars)</span>
<span id="cb19-15"><a href="visualising-results-for-multiple-stages.html#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="visualising-results-for-multiple-stages.html#cb19-16" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_time <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   code   SS1    SS2    SS3    SS4    SS5    SS6    SS7    SS8    SS9   SS10
## 1  OGI 980.5 1960.5 2802.5 3351.0 4102.2 4955.9 5512.6 6876.6 7491.6 8095.8
## 2  EVA 974.5 1942.7 2788.5 3335.1 4085.3 4938.9 5491.5 6275.6 6883.1 7491.1</code></pre>
</div>
<div id="rebasing-overall-times" class="section level3" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Rebasing Overall Times</h3>
<p>We can rebase the overall times with respect to a particular driver in the normal way:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="visualising-results-for-multiple-stages.html#cb21-1" aria-hidden="true" tabindex="-1"></a>example_driver <span class="ot">=</span> multi_overall_wide_time[<span class="dv">2</span>,]<span class="sc">$</span>code</span>
<span id="cb21-2"><a href="visualising-results-for-multiple-stages.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="visualising-results-for-multiple-stages.html#cb21-3" aria-hidden="true" tabindex="-1"></a>overall_wide_time_rebased <span class="ot">=</span> <span class="fu">rebase</span>(multi_overall_wide_time,</span>
<span id="cb21-4"><a href="visualising-results-for-multiple-stages.html#cb21-4" aria-hidden="true" tabindex="-1"></a>                                   example_driver, stage_codes,</span>
<span id="cb21-5"><a href="visualising-results-for-multiple-stages.html#cb21-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">id_col=</span><span class="st">&#39;code&#39;</span>)</span>
<span id="cb21-6"><a href="visualising-results-for-multiple-stages.html#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="visualising-results-for-multiple-stages.html#cb21-7" aria-hidden="true" tabindex="-1"></a>overall_wide_time_rebased <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   code  SS1  SS2   SS3  SS4  SS5   SS6   SS7   SS8   SS9  SS10
## 1  OGI  6.0 17.8  14.0 15.9 16.9  17.0  21.1 601.0 608.5 604.7
## 2  EVA  0.0  0.0   0.0  0.0  0.0   0.0   0.0   0.0   0.0   0.0
## 3  NEU -4.3 -2.2 -12.5 -8.0 -2.6 -18.7 -17.5 -37.6 -36.5 -41.7</code></pre>
</div>
<div id="finding-changes-in-rebased-gaps-across-stages" class="section level3" number="4.2.6">
<h3><span class="header-section-number">4.2.6</span> Finding Changes in Rebased Gaps Across Stages</h3>
<p>The rebasing operation essentially allows us to select a row of times for one particular driver and then subtract that row from every other row to give us a direct comparison of the gap between a specified driver and every other driver.</p>
<p>But we can also perform a consecutive column-wise differencing operation on the rebased times that allows to see how much time was gained or relative to a particular driver in going from one stage to the next (observant readers may note that this results in the rebased stage time for each stage…).</p>
<p>To subtract one column from the next, create two offset dataframes, one containing all but the first stage (first stage column) and one containing all but the last stage (final stage column). If we subtract one dataframe from the other, it gives us our column differences. Inserting the original first column back in its rightful place gives us the columnwise differences table:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="visualising-results-for-multiple-stages.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#https://stackoverflow.com/a/50411529/454773</span></span>
<span id="cb23-2"><a href="visualising-results-for-multiple-stages.html#cb23-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> overall_wide_time_rebased</span>
<span id="cb23-3"><a href="visualising-results-for-multiple-stages.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="visualising-results-for-multiple-stages.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># [-1] drops the first column, [-ncol()] drops the last</span></span>
<span id="cb23-5"><a href="visualising-results-for-multiple-stages.html#cb23-5" aria-hidden="true" tabindex="-1"></a> df_ <span class="ot">=</span> df[,stage_codes][<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> df[,stage_codes][<span class="sc">-</span><span class="fu">ncol</span>(df[,stage_codes])]</span>
<span id="cb23-6"><a href="visualising-results-for-multiple-stages.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-7"><a href="visualising-results-for-multiple-stages.html#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The split time to the first split is simply the first split time</span></span>
<span id="cb23-8"><a href="visualising-results-for-multiple-stages.html#cb23-8" aria-hidden="true" tabindex="-1"></a>df_[stage_codes[<span class="dv">1</span>]] <span class="ot">=</span> df[stage_codes[<span class="dv">1</span>]]</span>
<span id="cb23-9"><a href="visualising-results-for-multiple-stages.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Return the dataframe in a sensible column order</span></span>
<span id="cb23-10"><a href="visualising-results-for-multiple-stages.html#cb23-10" aria-hidden="true" tabindex="-1"></a>df_ <span class="sc">%&gt;%</span> <span class="fu">select</span>(stage_codes) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(stage_codes)` instead of `stage_codes` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<pre><code>##    SS1  SS2   SS3 SS4 SS5   SS6 SS7   SS8 SS9 SS10
## 1  6.0 11.8  -3.8 1.9 1.0   0.1 4.1 579.9 7.5 -3.8
## 2  0.0  0.0   0.0 0.0 0.0   0.0 0.0   0.0 0.0  0.0
## 3 -4.3  2.1 -10.3 4.5 5.4 -16.1 1.2 -20.1 1.1 -5.2</code></pre>
<p><em>(A similar technique could be used to recreate stage times from the overall times.)</em></p>
</div>
</div>
<div id="visualising-multiple-stage-results" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Visualising Multiple Stage Results</h2>
<p>The overall stage results provides information regarding the overall times and positions at the end of each stage; the rebased overall times provide us with gap information from a specified driver to every other driver.</p>
<p>So how might we use exploratory data visualisation techniques to support a conversation with that data or highlight potential stories hidden within it?</p>
<div id="visualising-first-position" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Visualising First Position</h3>
<p>One way of enriching the wide position table might be to highlight the driver in first position at the end of each stage. We can do this using the <code>formattable::formattable()</code> function.</p>
<p>First, let’s tidy up the overall position table:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="visualising-results-for-multiple-stages.html#cb26-1" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="ot">=</span> multi_overall_wide_pos <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="visualising-results-for-multiple-stages.html#cb26-2" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">map_stage_codes</span>(stage_codes) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="visualising-results-for-multiple-stages.html#cb26-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">map_driver_names</span>(cars)</span>
<span id="cb26-4"><a href="visualising-results-for-multiple-stages.html#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="visualising-results-for-multiple-stages.html#cb26-5" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   code SS1 SS2 SS3 SS4 SS5 SS6 SS7 SS8 SS9 SS10
## 1  OGI   9   9   9   8   8   7   6  22  20   20
## 2  EVA   5   5   5   5   5   5   5   5   5    5</code></pre>
<p>We can also reorder the table by the final stage position, as described by the last stage code in the <code>stage_codes</code> list. However, because we want to sort on a column name as provided by a variable, we need to use the <code>!!</code> operator to force the evaluation of the single variable value to the column name symbol (<code>as.symbol()</code>):</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="visualising-results-for-multiple-stages.html#cb28-1" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="ot">=</span> multi_overall_wide_pos <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="visualising-results-for-multiple-stages.html#cb28-2" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="sc">!!</span><span class="fu">as.symbol</span>(stage_codes[<span class="fu">length</span>(stage_codes)]))</span>
<span id="cb28-3"><a href="visualising-results-for-multiple-stages.html#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="visualising-results-for-multiple-stages.html#cb28-4" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   code SS1 SS2 SS3 SS4 SS5 SS6 SS7 SS8 SS9 SS10
## 1  TÄN   1   1   1   1   1   1   1   1   1    1
## 2  ROV   3   3   3   2   2   2   2   2   2    2</code></pre>
<p>Create a function to highlight the first position car:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="visualising-results-for-multiple-stages.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(formattable)</span>
<span id="cb30-2"><a href="visualising-results-for-multiple-stages.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="visualising-results-for-multiple-stages.html#cb30-3" aria-hidden="true" tabindex="-1"></a>highlight_first <span class="ot">=</span>  <span class="cf">function</span> (...) </span>
<span id="cb30-4"><a href="visualising-results-for-multiple-stages.html#cb30-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb30-5"><a href="visualising-results-for-multiple-stages.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>,</span>
<span id="cb30-6"><a href="visualising-results-for-multiple-stages.html#cb30-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="cf">function</span>(x) <span class="fu">ifelse</span>(x<span class="sc">==</span><span class="dv">1</span>,</span>
<span id="cb30-7"><a href="visualising-results-for-multiple-stages.html#cb30-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">style</span>(<span class="at">display =</span> <span class="st">&quot;block&quot;</span>, </span>
<span id="cb30-8"><a href="visualising-results-for-multiple-stages.html#cb30-8" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">padding =</span> <span class="st">&quot;0 4px&quot;</span>,</span>
<span id="cb30-9"><a href="visualising-results-for-multiple-stages.html#cb30-9" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">`</span><span class="at">color</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb30-10"><a href="visualising-results-for-multiple-stages.html#cb30-10" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">`</span><span class="at">column-width</span><span class="st">`</span><span class="ot">=</span><span class="st">&#39;4em&#39;</span>,</span>
<span id="cb30-11"><a href="visualising-results-for-multiple-stages.html#cb30-11" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">`</span><span class="at">border-radius</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;4px&quot;</span>,</span>
<span id="cb30-12"><a href="visualising-results-for-multiple-stages.html#cb30-12" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">`</span><span class="at">background-color</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;mediumorchid&#39;</span>),</span>
<span id="cb30-13"><a href="visualising-results-for-multiple-stages.html#cb30-13" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">style</span>()))</span>
<span id="cb30-14"><a href="visualising-results-for-multiple-stages.html#cb30-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>And then use that function to help style the table:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="visualising-results-for-multiple-stages.html#cb31-1" aria-hidden="true" tabindex="-1"></a>multi_overall_wide_pos <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="visualising-results-for-multiple-stages.html#cb31-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="visualising-results-for-multiple-stages.html#cb31-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">formattable</span>(<span class="co"># Align values in the center of each column</span></span>
<span id="cb31-4"><a href="visualising-results-for-multiple-stages.html#cb31-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">align=</span><span class="st">&#39;c&#39;</span>,</span>
<span id="cb31-5"><a href="visualising-results-for-multiple-stages.html#cb31-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">list</span>(<span class="fu">area</span>(<span class="at">col =</span> stage_codes) <span class="sc">~</span> <span class="fu">highlight_first</span>()))</span></code></pre></div>
<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:center;">
code
</th>
<th style="text-align:center;">
SS1
</th>
<th style="text-align:center;">
SS2
</th>
<th style="text-align:center;">
SS3
</th>
<th style="text-align:center;">
SS4
</th>
<th style="text-align:center;">
SS5
</th>
<th style="text-align:center;">
SS6
</th>
<th style="text-align:center;">
SS7
</th>
<th style="text-align:center;">
SS8
</th>
<th style="text-align:center;">
SS9
</th>
<th style="text-align:center;">
SS10
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
TÄN
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
<td style="text-align:center;">
<span style="display: block; padding: 0 4px; color: white; column-width: 4em; border-radius: 4px; background-color: mediumorchid">1</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
ROV
</td>
<td style="text-align:center;">
<span>3</span>
</td>
<td style="text-align:center;">
<span>3</span>
</td>
<td style="text-align:center;">
<span>3</span>
</td>
<td style="text-align:center;">
<span>2</span>
</td>
<td style="text-align:center;">
<span>2</span>
</td>
<td style="text-align:center;">
<span>2</span>
</td>
<td style="text-align:center;">
<span>2</span>
</td>
<td style="text-align:center;">
<span>2</span>
</td>
<td style="text-align:center;">
<span>2</span>
</td>
<td style="text-align:center;">
<span>2</span>
</td>
</tr>
<tr>
<td style="text-align:center;">
NEU
</td>
<td style="text-align:center;">
<span>4</span>
</td>
<td style="text-align:center;">
<span>4</span>
</td>
<td style="text-align:center;">
<span>4</span>
</td>
<td style="text-align:center;">
<span>4</span>
</td>
<td style="text-align:center;">
<span>4</span>
</td>
<td style="text-align:center;">
<span>3</span>
</td>
<td style="text-align:center;">
<span>3</span>
</td>
<td style="text-align:center;">
<span>3</span>
</td>
<td style="text-align:center;">
<span>3</span>
</td>
<td style="text-align:center;">
<span>3</span>
</td>
</tr>
</tbody>
</table>
</div>
<div id="visualising-position-changes-over-a-rally" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Visualising Position Changes Over a Rally</h3>
<p>Another useful way of summarising the positions is to chart showing the evolution of position changes.</p>
<p>The chart is cosntructed ost straightforwardly from tidy long format) data:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="visualising-results-for-multiple-stages.html#cb32-1" aria-hidden="true" tabindex="-1"></a>overall_pos_long_top10 <span class="ot">&lt;-</span> multi_overall_wide_pos <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="visualising-results-for-multiple-stages.html#cb32-2" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="visualising-results-for-multiple-stages.html#cb32-3" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">gather</span>(<span class="at">key =</span><span class="st">&quot;Stage&quot;</span>,</span>
<span id="cb32-4"><a href="visualising-results-for-multiple-stages.html#cb32-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">value =</span><span class="st">&quot;Pos&quot;</span>,</span>
<span id="cb32-5"><a href="visualising-results-for-multiple-stages.html#cb32-5" aria-hidden="true" tabindex="-1"></a>                                     stage_codes)</span>
<span id="cb32-6"><a href="visualising-results-for-multiple-stages.html#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="visualising-results-for-multiple-stages.html#cb32-7" aria-hidden="true" tabindex="-1"></a>overall_pos_long_top10 <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   code Stage Pos
## 1  TÄN   SS1   1
## 2  ROV   SS1   3
## 3  NEU   SS1   4</code></pre>
<p>It will be convenient for the stage codes to be represented as ordered factors:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="visualising-results-for-multiple-stages.html#cb34-1" aria-hidden="true" tabindex="-1"></a>overall_pos_long_top10 <span class="ot">=</span> overall_pos_long_top10 <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="visualising-results-for-multiple-stages.html#cb34-2" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">mutate</span>(<span class="at">Stage =</span> <span class="fu">factor</span>(Stage,</span>
<span id="cb34-3"><a href="visualising-results-for-multiple-stages.html#cb34-3" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">levels =</span> stage_codes))</span>
<span id="cb34-4"><a href="visualising-results-for-multiple-stages.html#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="visualising-results-for-multiple-stages.html#cb34-5" aria-hidden="true" tabindex="-1"></a>overall_pos_long_top10<span class="sc">$</span>Stage[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] SS1
## Levels: SS1 SS2 SS3 SS4 SS5 SS6 SS7 SS8 SS9 SS10</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="visualising-results-for-multiple-stages.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb36-2"><a href="visualising-results-for-multiple-stages.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="visualising-results-for-multiple-stages.html#cb36-3" aria-hidden="true" tabindex="-1"></a>pos_range <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">max</span>(overall_pos_long_top10<span class="sc">$</span>Pos)</span>
<span id="cb36-4"><a href="visualising-results-for-multiple-stages.html#cb36-4" aria-hidden="true" tabindex="-1"></a>g_pos <span class="ot">=</span> <span class="fu">ggplot</span>(overall_pos_long_top10, <span class="fu">aes</span>(<span class="at">x=</span>Stage, <span class="at">y=</span>Pos)) <span class="sc">+</span></span>
<span id="cb36-5"><a href="visualising-results-for-multiple-stages.html#cb36-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> code)) <span class="sc">+</span></span>
<span id="cb36-6"><a href="visualising-results-for-multiple-stages.html#cb36-6" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># Invert scale and relabel y-axis</span></span>
<span id="cb36-7"><a href="visualising-results-for-multiple-stages.html#cb36-7" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># https://stackoverflow.com/a/28392170/454773</span></span>
<span id="cb36-8"><a href="visualising-results-for-multiple-stages.html#cb36-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">&quot;reverse&quot;</span>,</span>
<span id="cb36-9"><a href="visualising-results-for-multiple-stages.html#cb36-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">breaks =</span> pos_range) <span class="sc">+</span></span>
<span id="cb36-10"><a href="visualising-results-for-multiple-stages.html#cb36-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>()</span>
<span id="cb36-11"><a href="visualising-results-for-multiple-stages.html#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="visualising-results-for-multiple-stages.html#cb36-12" aria-hidden="true" tabindex="-1"></a>g_pos</span></code></pre></div>
<p><img src="images/multi-stage-results-simple_pos_chart-1.png" width="672" /></p>
<p>We can producing a cleaner chart by adding driver labels to the start and end of each line using the <code>directlabels:geom_dl()</code> function, as well as dropping the axes:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="visualising-results-for-multiple-stages.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb37-2"><a href="visualising-results-for-multiple-stages.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="visualising-results-for-multiple-stages.html#cb37-3" aria-hidden="true" tabindex="-1"></a>g_pos <span class="sc">+</span></span>
<span id="cb37-4"><a href="visualising-results-for-multiple-stages.html#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">&#39; &#39;</span>,code)), <span class="co"># Add space before label</span></span>
<span id="cb37-5"><a href="visualising-results-for-multiple-stages.html#cb37-5" aria-hidden="true" tabindex="-1"></a>            <span class="co"># cex is text label size</span></span>
<span id="cb37-6"><a href="visualising-results-for-multiple-stages.html#cb37-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="fu">list</span>(<span class="st">&#39;last.bumpup&#39;</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb37-7"><a href="visualising-results-for-multiple-stages.html#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_dl</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(code, <span class="st">&#39; &#39;</span>)), <span class="co"># Add space before label</span></span>
<span id="cb37-8"><a href="visualising-results-for-multiple-stages.html#cb37-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="fu">list</span>(<span class="st">&#39;first.points&#39;</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb37-9"><a href="visualising-results-for-multiple-stages.html#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="images/multi-stage-results-cleaner_pos_chart-1.png" width="672" /></p>
<p>In the above chart, you may notice a gap at first stage position 6 where Ogier was originally placed. A more robust way to prepare the data for this sort of charts is to filter the data by class, for example limiting the data to cars in the <em>WRC</em> group/class, and then reranking the position by group/class. A finished position chart can then position the drivers by class ranking and use lables to overplot actual overall rally positions on stages where the overall stage position differs from the class rank.</p>
</div>
<div id="visualising-position-gainslosses" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Visualising Position Gains/Losses</h3>
<p>To visualise position changes for a driver from one driver to the next, we can create a table of position differences. Let’s abstract out the code we used to find differnces between columns in to a function:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="visualising-results-for-multiple-stages.html#cb38-1" aria-hidden="true" tabindex="-1"></a>coldiffs <span class="ot">=</span> <span class="cf">function</span>(df, cols, <span class="at">dropfirst=</span><span class="cn">FALSE</span>, <span class="at">firstcol=</span><span class="cn">NULL</span>){</span>
<span id="cb38-2"><a href="visualising-results-for-multiple-stages.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">=</span> <span class="fu">as.character</span>(cols)</span>
<span id="cb38-3"><a href="visualising-results-for-multiple-stages.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># [-1] drops the first column, [-ncol()] drops the last</span></span>
<span id="cb38-4"><a href="visualising-results-for-multiple-stages.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  df_ <span class="ot">=</span> df[,cols][<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> df[,cols][<span class="sc">-</span><span class="fu">ncol</span>(df[,cols])]</span>
<span id="cb38-5"><a href="visualising-results-for-multiple-stages.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-6"><a href="visualising-results-for-multiple-stages.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The split time to the first split is simply the first split time</span></span>
<span id="cb38-7"><a href="visualising-results-for-multiple-stages.html#cb38-7" aria-hidden="true" tabindex="-1"></a>  df_[cols[<span class="dv">1</span>]] <span class="ot">=</span> df[cols[<span class="dv">1</span>]]</span>
<span id="cb38-8"><a href="visualising-results-for-multiple-stages.html#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the dataframe in a sensible column order</span></span>
<span id="cb38-9"><a href="visualising-results-for-multiple-stages.html#cb38-9" aria-hidden="true" tabindex="-1"></a>  df_ <span class="ot">=</span> df_ <span class="sc">%&gt;%</span> <span class="fu">select</span>(cols)</span>
<span id="cb38-10"><a href="visualising-results-for-multiple-stages.html#cb38-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-11"><a href="visualising-results-for-multiple-stages.html#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(firstcol))</span>
<span id="cb38-12"><a href="visualising-results-for-multiple-stages.html#cb38-12" aria-hidden="true" tabindex="-1"></a>    df_[, cols[<span class="dv">1</span>]] <span class="ot">=</span> firstcol</span>
<span id="cb38-13"><a href="visualising-results-for-multiple-stages.html#cb38-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-14"><a href="visualising-results-for-multiple-stages.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (dropfirst)</span>
<span id="cb38-15"><a href="visualising-results-for-multiple-stages.html#cb38-15" aria-hidden="true" tabindex="-1"></a>    df_[,cols][<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb38-16"><a href="visualising-results-for-multiple-stages.html#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb38-17"><a href="visualising-results-for-multiple-stages.html#cb38-17" aria-hidden="true" tabindex="-1"></a>    df_</span>
<span id="cb38-18"><a href="visualising-results-for-multiple-stages.html#cb38-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s put that function through its paces. First, we can drop the first column:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="visualising-results-for-multiple-stages.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coldiffs</span>(multi_overall_wide_pos, stage_codes, <span class="at">dropfirst=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Note: Using an external vector in selections is ambiguous.
## ℹ Use `all_of(cols)` instead of `cols` to silence this message.
## ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.
## This message is displayed once per session.</code></pre>
<pre><code>##   SS2 SS3 SS4 SS5 SS6 SS7 SS8 SS9 SS10
## 1   0   0   0   0   0   0   0   0    0
## 2   0   0  -1   0   0   0   0   0    0</code></pre>
<p>Then we can retain the first column and replace it with a specified value:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="visualising-results-for-multiple-stages.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coldiffs</span>(multi_overall_wide_pos, stage_codes, <span class="at">firstcol=</span><span class="dv">999</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   SS1 SS2 SS3 SS4 SS5 SS6 SS7 SS8 SS9 SS10
## 1 999   0   0   0   0   0   0   0   0    0
## 2 999   0   0  -1   0   0   0   0   0    0</code></pre>
<p>We can now fund the position changes from stage to stage as well as tidying up the identifiers:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="visualising-results-for-multiple-stages.html#cb44-1" aria-hidden="true" tabindex="-1"></a>pos_diffs <span class="ot">=</span> <span class="fu">coldiffs</span>(multi_overall_wide_pos, stage_codes,</span>
<span id="cb44-2"><a href="visualising-results-for-multiple-stages.html#cb44-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">firstcol=</span><span class="dv">0</span>)</span>
<span id="cb44-3"><a href="visualising-results-for-multiple-stages.html#cb44-3" aria-hidden="true" tabindex="-1"></a>pos_diffs<span class="sc">$</span>code <span class="ot">=</span> multi_overall_wide_pos<span class="sc">$</span>code</span>
<span id="cb44-4"><a href="visualising-results-for-multiple-stages.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="visualising-results-for-multiple-stages.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder the columns by moving last column to first</span></span>
<span id="cb44-6"><a href="visualising-results-for-multiple-stages.html#cb44-6" aria-hidden="true" tabindex="-1"></a>pos_diffs <span class="ot">=</span> pos_diffs <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="st">&#39;code&#39;</span>, <span class="fu">everything</span>())</span>
<span id="cb44-7"><a href="visualising-results-for-multiple-stages.html#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="visualising-results-for-multiple-stages.html#cb44-8" aria-hidden="true" tabindex="-1"></a>pos_diffs <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   code SS1 SS2 SS3 SS4 SS5 SS6 SS7 SS8 SS9 SS10
## 1  TÄN   0   0   0   0   0   0   0   0   0    0
## 2  ROV   0   0   0  -1   0   0   0   0   0    0
## 3  NEU   0   0   0   0   0  -1   0   0   0    0</code></pre>
<p>Nte that we need to be careful with the sense of how we read this table: a <em>negative</em> position change means the driver has <em>improved</em> their position. It might be more meaningful to have position gain/loss, rather than strict position difference columns, where a positive value denotes an improved position:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="visualising-results-for-multiple-stages.html#cb46-1" aria-hidden="true" tabindex="-1"></a>pos_gains <span class="ot">=</span> pos_diffs</span>
<span id="cb46-2"><a href="visualising-results-for-multiple-stages.html#cb46-2" aria-hidden="true" tabindex="-1"></a>pos_gains[,stage_codes] <span class="ot">=</span> <span class="sc">-</span>pos_gains[,stage_codes[<span class="sc">-</span><span class="dv">1</span>]]</span>
<span id="cb46-3"><a href="visualising-results-for-multiple-stages.html#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="visualising-results-for-multiple-stages.html#cb46-4" aria-hidden="true" tabindex="-1"></a>pos_gains <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   code SS1 SS2 SS3 SS4 SS5 SS6 SS7 SS8 SS9 SS10
## 1  TÄN   0   0   0   0   0   0   0   0   0    0
## 2  ROV   0   0   1   0   0   0   0   0   0    0
## 3  NEU   0   0   0   0   1   0   0   0   0    0</code></pre>
<p>One way of highlighting position changes is to use coloured up/down arrows:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="visualising-results-for-multiple-stages.html#cb48-1" aria-hidden="true" tabindex="-1"></a>updown <span class="ot">=</span> <span class="cf">function</span>(...){</span>
<span id="cb48-2"><a href="visualising-results-for-multiple-stages.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>, </span>
<span id="cb48-3"><a href="visualising-results-for-multiple-stages.html#cb48-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="cf">function</span>(x) <span class="fu">style</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(x<span class="sc">&gt;</span><span class="dv">0</span>,</span>
<span id="cb48-4"><a href="visualising-results-for-multiple-stages.html#cb48-4" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">&quot;green&quot;</span>,</span>
<span id="cb48-5"><a href="visualising-results-for-multiple-stages.html#cb48-5" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">ifelse</span>(x<span class="sc">&lt;</span><span class="dv">0</span>,</span>
<span id="cb48-6"><a href="visualising-results-for-multiple-stages.html#cb48-6" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">&quot;red&quot;</span>,</span>
<span id="cb48-7"><a href="visualising-results-for-multiple-stages.html#cb48-7" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">&quot;lightgrey&quot;</span>))),          </span>
<span id="cb48-8"><a href="visualising-results-for-multiple-stages.html#cb48-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">icontext</span>(<span class="fu">ifelse</span> (x <span class="sc">&gt;</span><span class="dv">0</span>,</span>
<span id="cb48-9"><a href="visualising-results-for-multiple-stages.html#cb48-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="co"># i.e. gained position</span></span>
<span id="cb48-10"><a href="visualising-results-for-multiple-stages.html#cb48-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;arrow-up&quot;</span>,</span>
<span id="cb48-11"><a href="visualising-results-for-multiple-stages.html#cb48-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">ifelse</span> (x <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb48-12"><a href="visualising-results-for-multiple-stages.html#cb48-12" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">&quot;arrow-down&quot;</span> ,</span>
<span id="cb48-13"><a href="visualising-results-for-multiple-stages.html#cb48-13" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">&quot;resize-horizontal&quot;</span>))))</span>
<span id="cb48-14"><a href="visualising-results-for-multiple-stages.html#cb48-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s see how that works (note that we need to cast the table <code>as.htmlwidget()</code> in order to render the arrows appropriately :</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="visualising-results-for-multiple-stages.html#cb49-1" aria-hidden="true" tabindex="-1"></a>pos_gains <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="visualising-results-for-multiple-stages.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="visualising-results-for-multiple-stages.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>(<span class="fu">list</span>( </span>
<span id="cb49-4"><a href="visualising-results-for-multiple-stages.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">area</span>(<span class="at">col =</span> stage_codes) <span class="sc">~</span> <span class="fu">updown</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="visualising-results-for-multiple-stages.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.htmlwidget</span>()</span></code></pre></div>
<div id="htmlwidget-976a0e6d12b376327105" class="formattable_widget html-widget" style="width:100%;height:480px;" width="100%" height="480"></div>
<script type="application/json" data-for="htmlwidget-976a0e6d12b376327105">{"x":{"html":"<table class=\"table table-condensed\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> code <\/th>\n   <th style=\"text-align:right;\"> SS1 <\/th>\n   <th style=\"text-align:right;\"> SS2 <\/th>\n   <th style=\"text-align:right;\"> SS3 <\/th>\n   <th style=\"text-align:right;\"> SS4 <\/th>\n   <th style=\"text-align:right;\"> SS5 <\/th>\n   <th style=\"text-align:right;\"> SS6 <\/th>\n   <th style=\"text-align:right;\"> SS7 <\/th>\n   <th style=\"text-align:right;\"> SS8 <\/th>\n   <th style=\"text-align:right;\"> SS9 <\/th>\n   <th style=\"text-align:right;\"> SS10 <\/th>\n  <\/tr>\n <\/thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> TÄN <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> ROV <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: green\">\n  <i class=\"glyphicon glyphicon-arrow-up\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> NEU <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: green\">\n  <i class=\"glyphicon glyphicon-arrow-up\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n<\/span> <\/td>\n  <\/tr>\n<\/tbody>\n<\/table>"},"evals":[],"jsHooks":[]}</script>
<p>We can extend the formatter to also display the number of positions gained or lost:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="visualising-results-for-multiple-stages.html#cb50-1" aria-hidden="true" tabindex="-1"></a>updown2 <span class="ot">=</span> <span class="cf">function</span>(...){</span>
<span id="cb50-2"><a href="visualising-results-for-multiple-stages.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formatter</span>(<span class="st">&quot;span&quot;</span>, </span>
<span id="cb50-3"><a href="visualising-results-for-multiple-stages.html#cb50-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">style =</span> <span class="cf">function</span>(x) <span class="fu">style</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(x<span class="sc">&gt;</span><span class="dv">0</span>,</span>
<span id="cb50-4"><a href="visualising-results-for-multiple-stages.html#cb50-4" aria-hidden="true" tabindex="-1"></a>                                                     <span class="st">&quot;green&quot;</span>,</span>
<span id="cb50-5"><a href="visualising-results-for-multiple-stages.html#cb50-5" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">ifelse</span>(x<span class="sc">&lt;</span><span class="dv">0</span>,</span>
<span id="cb50-6"><a href="visualising-results-for-multiple-stages.html#cb50-6" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">&quot;red&quot;</span>,</span>
<span id="cb50-7"><a href="visualising-results-for-multiple-stages.html#cb50-7" aria-hidden="true" tabindex="-1"></a>                                                            <span class="st">&quot;lightgrey&quot;</span>))),          </span>
<span id="cb50-8"><a href="visualising-results-for-multiple-stages.html#cb50-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(x) <span class="fu">icontext</span>(<span class="fu">ifelse</span> (x <span class="sc">&gt;</span><span class="dv">0</span>,</span>
<span id="cb50-9"><a href="visualising-results-for-multiple-stages.html#cb50-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="co"># i.e. gained position</span></span>
<span id="cb50-10"><a href="visualising-results-for-multiple-stages.html#cb50-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">&quot;arrow-up&quot;</span>,</span>
<span id="cb50-11"><a href="visualising-results-for-multiple-stages.html#cb50-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">ifelse</span> (x <span class="sc">&lt;</span> <span class="dv">0</span>,</span>
<span id="cb50-12"><a href="visualising-results-for-multiple-stages.html#cb50-12" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">&quot;arrow-down&quot;</span> ,</span>
<span id="cb50-13"><a href="visualising-results-for-multiple-stages.html#cb50-13" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">&quot;resize-horizontal&quot;</span>)),</span>
<span id="cb50-14"><a href="visualising-results-for-multiple-stages.html#cb50-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># Add in the pos change value</span></span>
<span id="cb50-15"><a href="visualising-results-for-multiple-stages.html#cb50-15" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">ifelse</span> (x<span class="sc">!=</span><span class="dv">0</span>, <span class="fu">paste0</span>(<span class="st">&#39;(&#39;</span>,<span class="fu">abs</span>(x),<span class="st">&#39;)&#39;</span>),<span class="st">&#39;&#39;</span>)))</span>
<span id="cb50-16"><a href="visualising-results-for-multiple-stages.html#cb50-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s see how it looks:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="visualising-results-for-multiple-stages.html#cb51-1" aria-hidden="true" tabindex="-1"></a>pos_gains <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="visualising-results-for-multiple-stages.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="visualising-results-for-multiple-stages.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>(<span class="fu">list</span>( </span>
<span id="cb51-4"><a href="visualising-results-for-multiple-stages.html#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">area</span>(<span class="at">col =</span> stage_codes) <span class="sc">~</span> <span class="fu">updown2</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb51-5"><a href="visualising-results-for-multiple-stages.html#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.htmlwidget</span>()</span></code></pre></div>
<div id="htmlwidget-f85025ac4754a0dc6994" class="formattable_widget html-widget" style="width:100%;height:480px;" width="100%" height="480"></div>
<script type="application/json" data-for="htmlwidget-f85025ac4754a0dc6994">{"x":{"html":"<table class=\"table table-condensed\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> code <\/th>\n   <th style=\"text-align:right;\"> SS1 <\/th>\n   <th style=\"text-align:right;\"> SS2 <\/th>\n   <th style=\"text-align:right;\"> SS3 <\/th>\n   <th style=\"text-align:right;\"> SS4 <\/th>\n   <th style=\"text-align:right;\"> SS5 <\/th>\n   <th style=\"text-align:right;\"> SS6 <\/th>\n   <th style=\"text-align:right;\"> SS7 <\/th>\n   <th style=\"text-align:right;\"> SS8 <\/th>\n   <th style=\"text-align:right;\"> SS9 <\/th>\n   <th style=\"text-align:right;\"> SS10 <\/th>\n  <\/tr>\n <\/thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> TÄN <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> ROV <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: green\">\n  <i class=\"glyphicon glyphicon-arrow-up\"><\/i>\n  (1)\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> NEU <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: green\">\n  <i class=\"glyphicon glyphicon-arrow-up\"><\/i>\n  (1)\n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n   <td style=\"text-align:right;\"> <span style=\"color: lightgrey\">\n  <i class=\"glyphicon glyphicon-resize-horizontal\"><\/i>\n  \n<\/span> <\/td>\n  <\/tr>\n<\/tbody>\n<\/table>"},"evals":[],"jsHooks":[]}</script>
<p>Another way of visualising position changes is to create a simple summarising sparkline using the <code>sparkline::spk_chr()</code> function.</p>
<p>This requires us first to cast the data into a long format:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="visualising-results-for-multiple-stages.html#cb52-1" aria-hidden="true" tabindex="-1"></a>pos_gain_long_top10 <span class="ot">&lt;-</span> pos_gains <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="visualising-results-for-multiple-stages.html#cb52-2" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="visualising-results-for-multiple-stages.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">gather</span>(<span class="at">key =</span><span class="st">&quot;Stage&quot;</span>,</span>
<span id="cb52-4"><a href="visualising-results-for-multiple-stages.html#cb52-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">value =</span><span class="st">&quot;PosChange&quot;</span>,</span>
<span id="cb52-5"><a href="visualising-results-for-multiple-stages.html#cb52-5" aria-hidden="true" tabindex="-1"></a>                                      stage_codes)</span>
<span id="cb52-6"><a href="visualising-results-for-multiple-stages.html#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="visualising-results-for-multiple-stages.html#cb52-7" aria-hidden="true" tabindex="-1"></a>pos_gain_long_top10 <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>##   code Stage PosChange
## 1  TÄN   SS1         0
## 2  ROV   SS1         0
## 3  NEU   SS1         0</code></pre>
<p>We can then generate sparklines showing position changes:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="visualising-results-for-multiple-stages.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparkline)</span>
<span id="cb54-2"><a href="visualising-results-for-multiple-stages.html#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="visualising-results-for-multiple-stages.html#cb54-3" aria-hidden="true" tabindex="-1"></a>pos_gain_sparkline_top10 <span class="ot">&lt;-</span> pos_gain_long_top10 <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="visualising-results-for-multiple-stages.html#cb54-4" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">group_by</span>(code) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="visualising-results-for-multiple-stages.html#cb54-5" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">summarize</span>(<span class="at">spk_ =</span> <span class="fu">spk_chr</span>(PosChange,</span>
<span id="cb54-6"><a href="visualising-results-for-multiple-stages.html#cb54-6" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">type =</span><span class="st">&quot;bar&quot;</span>))</span>
<span id="cb54-7"><a href="visualising-results-for-multiple-stages.html#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="visualising-results-for-multiple-stages.html#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to create an htmlwidget form of the table</span></span>
<span id="cb54-9"><a href="visualising-results-for-multiple-stages.html#cb54-9" aria-hidden="true" tabindex="-1"></a>out <span class="ot">=</span> <span class="fu">as.htmlwidget</span>(<span class="fu">formattable</span>(pos_gain_sparkline_top10))</span>
<span id="cb54-10"><a href="visualising-results-for-multiple-stages.html#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="visualising-results-for-multiple-stages.html#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The table also has a requirement on the sparkline package</span></span>
<span id="cb54-12"><a href="visualising-results-for-multiple-stages.html#cb54-12" aria-hidden="true" tabindex="-1"></a>out<span class="sc">$</span>dependencies <span class="ot">=</span> <span class="fu">c</span>(out<span class="sc">$</span>dependencies,</span>
<span id="cb54-13"><a href="visualising-results-for-multiple-stages.html#cb54-13" aria-hidden="true" tabindex="-1"></a>                     htmlwidgets<span class="sc">:::</span><span class="fu">widget_dependencies</span>(<span class="st">&quot;sparkline&quot;</span>,</span>
<span id="cb54-14"><a href="visualising-results-for-multiple-stages.html#cb54-14" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">&quot;sparkline&quot;</span>))</span>
<span id="cb54-15"><a href="visualising-results-for-multiple-stages.html#cb54-15" aria-hidden="true" tabindex="-1"></a>out</span></code></pre></div>
<div id="htmlwidget-6513e3359d9a164a0f36" class="formattable_widget html-widget" style="width:100%;height:480px;" width="100%" height="480"></div>
<script type="application/json" data-for="htmlwidget-6513e3359d9a164a0f36">{"x":{"html":"<table class=\"table table-condensed\">\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> code <\/th>\n   <th style=\"text-align:right;\"> spk_ <\/th>\n  <\/tr>\n <\/thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> BRE <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-241490aa41678a12542f\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-241490aa41678a12542f\">{\"x\":{\"values\":[0,0,-1,0,-1,0,0,0,0,0],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> EVA <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-18bfe5e8bd69febe73c5\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-18bfe5e8bd69febe73c5\">{\"x\":{\"values\":[0,0,0,0,0,0,0,0,0,0],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> GRE <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-3d505b755b4ff0f8bdbb\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-3d505b755b4ff0f8bdbb\">{\"x\":{\"values\":[1,0,0,0,0,0,1,0,0,1],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> KAT <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-5cc81a83e1fb8bafe9e1\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-5cc81a83e1fb8bafe9e1\">{\"x\":{\"values\":[1,0,1,-1,-1,0,1,0,1,1],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> LAP <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-ae968b5565fbe68e6fa4\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-ae968b5565fbe68e6fa4\">{\"x\":{\"values\":[1,0,0,0,0,0,1,0,0,1],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> NEU <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-4948bc6d9066b84d6c74\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-4948bc6d9066b84d6c74\">{\"x\":{\"values\":[0,0,0,0,1,0,0,0,0,0],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> ROV <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-d73678a389b1f5b0a0e2\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-d73678a389b1f5b0a0e2\">{\"x\":{\"values\":[0,0,1,0,0,0,0,0,0,0],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> SOL <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-75beb3ddb5abfcecbb8e\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-75beb3ddb5abfcecbb8e\">{\"x\":{\"values\":[2,0,1,1,0,-1,1,0,-1,2],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> SUN <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-2a380bb03cafb4a9a62e\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-2a380bb03cafb4a9a62e\">{\"x\":{\"values\":[1,0,-3,0,0,0,1,0,0,1],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n  <tr>\n   <td style=\"text-align:right;\"> TÄN <\/td>\n   <td style=\"text-align:right;\"> <span id=\"htmlwidget-4c22b17300bc3ad1bb9d\" class=\"sparkline html-widget\"><\/span>\n<script type=\"application/json\" data-for=\"htmlwidget-4c22b17300bc3ad1bb9d\">{\"x\":{\"values\":[0,0,0,0,0,0,0,0,0,0],\"options\":{\"type\":\"bar\",\"height\":20,\"width\":60},\"width\":60,\"height\":20},\"evals\":[],\"jsHooks\":[]}<\/script> <\/td>\n  <\/tr>\n<\/tbody>\n<\/table>"},"evals":[],"jsHooks":[]}</script>
<p><em>Note that to render the sparkline, we need to cast the formatted table to an </em>htmlwidget* and also ensure that the required <em>sparkline</em> Javascript package is loaded into the widget.*</p>
<p>One issue with the sparkline bars is that the scales may differ. For example, across different drivers, a position change of +1 for one driver may have the same height as a position chane of +2 for another driver.</p>
</div>
</div>
<div id="retrieving-stage-time-for-multiple-stages" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Retrieving Stage Time for Multiple Stages</h2>
<p>This far, we have focused on exploring the overall results data. If required, we can also retrieve detailed results for multiple stages by requesting stage results for a specified list of stages:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="visualising-results-for-multiple-stages.html#cb55-1" aria-hidden="true" tabindex="-1"></a>multi_stage_times <span class="ot">=</span> <span class="fu">get_multi_stage_times</span>(stage_list)</span>
<span id="cb55-2"><a href="visualising-results-for-multiple-stages.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-3"><a href="visualising-results-for-multiple-stages.html#cb55-3" aria-hidden="true" tabindex="-1"></a>multi_stage_times <span class="sc">%&gt;%</span> <span class="fu">tail</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##     stageTimeId stageId entryId elapsedDurationMs  elapsedDuration    status
## 539       96810    1749   21571           1301693 00:21:41.6930000 Completed
## 540       96793    1749   21541                NA             &lt;NA&gt;       DNS
##      source position diffFirstMs        diffFirst diffPrevMs         diffPrev
## 539 Default       52      699224 00:11:39.2240000     153590 00:02:33.5900000
## 540 Default       NA          NA             &lt;NA&gt;         NA             &lt;NA&gt;</code></pre>
<p>We can then cast the data to a wide format:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="visualising-results-for-multiple-stages.html#cb57-1" aria-hidden="true" tabindex="-1"></a>multi_stage_times_wide <span class="ot">=</span> <span class="fu">get_multi_stage_times_wide</span>(multi_stage_times, stage_list)</span>
<span id="cb57-2"><a href="visualising-results-for-multiple-stages.html#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="visualising-results-for-multiple-stages.html#cb57-3" aria-hidden="true" tabindex="-1"></a>multi_stage_times_wide <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##   entryId  1747  1743  1750  1751  1748  1745  1744   1742  1746    1749
## 1   21530 980.5 980.0 842.0 548.5 751.2 853.7 556.7 1364.0 615.0 604.272
## 2   21531 974.5 968.2 845.8 546.6 750.2 853.6 552.6  784.1 607.5 608.028</code></pre>
<p>And process:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="visualising-results-for-multiple-stages.html#cb59-1" aria-hidden="true" tabindex="-1"></a>multi_stage_times_wide<span class="ot">=</span> <span class="fu">map_stage_codes</span>(multi_stage_times_wide,</span>
<span id="cb59-2"><a href="visualising-results-for-multiple-stages.html#cb59-2" aria-hidden="true" tabindex="-1"></a>                                          stage_list)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualising-results-for-a-single-stage.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="finding-pace-across-stages.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/edit/master/multi-stage-results.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/RallyDataJunkie/rally-event-sketches-2021/blob/master/multi-stage-results.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toc_depth": 3,
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
